(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[740],{735:function(e,t,r){"use strict";r.d(t,{S:function(){return i},W:function(){return n}});var n=!1;function i(e){n=e}},61740:function(e,t,r){"use strict";r.r(t),r.d(t,{InGameUi:function(){return un},leaveGameNonRoot:function(){return Fn},play:function(){return wn}});var n=r(15861),i=r(64687),o=r.n(i),s=r(18114),a=r(30161),l=r(85774),u=r(31172),c=r(70193),h=r.n(c),d=r(30701),f=r(15671),p=r(43144),m=r(19088),g=function(){function e(t){var r=this;(0,f.Z)(this,e),this.noa=void 0,this.pointerUnlockRequests=[],this.pointerUnlockCounter=0,this.lastRemovePointerLock=0,this.noa=t,this.noa.container.addListener("lostPointerLock",(function(){Date.now()-r.lastRemovePointerLock>200&&!(0,m.Si)()&&l.f$.publish("ToggleOptions")}))}return(0,p.Z)(e,[{key:"requestPointerUnlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?-1===this.pointerUnlockRequests.indexOf(e)&&this.pointerUnlockRequests.push(e):this.pointerUnlockCounter++,this.noa.container.setPointerLock(!1),l.f$.publish("pointerLockUpdate",!1),this.lastRemovePointerLock=Date.now()}},{key:"removePointerUnlockRequest",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e?(0,l.Fe)(this.pointerUnlockRequests,e):this.pointerUnlockCounter=Math.max(this.pointerUnlockCounter-1,0),this.pointerUnlockRequests.length+this.pointerUnlockCounter===0&&(this.noa.container.setPointerLock(!0),l.f$.publish("pointerLockUpdate",!0))}},{key:"reset",value:function(){this.pointerUnlockRequests=[],this.pointerUnlockCounter=0}}]),e}(),v=r(21021),y=r(69113),_=r.n(y),b=r(37762),S=r(1413),A=r(70937),x=r(65847),C=r(87683),M=r(9488),T=r(52014),P=r(16708),I=r(92643),k=r(64400),E=r(80105),R=r(89117),w=r(74654),B=r.n(w),D=r(49620),O=(r(14313),r(92366)),L=r(54588),F=r(67269),N=r(38017),U=r(40689),W=r(88996),G=r(38017).default;function z(){return z=(0,n.Z)(o().mark((function e(t){var r,n,i,s,a,u,c,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new window.FontFace("Jetbrains Mono","url(".concat(W,")")).load().then((function(e){document.fonts.add(e)})),(0,R.tM)(),n=N.blockTextureAtlas,""!==l.EU.clientEscMenuOptions.texturePackUrl&&(0!==(i=l.EU.clientEscMenuOptions.texturePackUrl).indexOf("https://")&&0!==i.indexOf("http://")&&(i="https://".concat(i)),n=i,fetch(n,{redirect:"error"}).then((function(e){e.ok||(console.log("Check atlas Resp not ok, refreshing",e.status,e),l.Cc.setItem("texturePackUrl",""),window.location.reload())})).catch((function(e){console.log("Check atlas Resp caught, refreshing",e),l.Cc.setItem("texturePackUrl",""),window.location.reload()}))),s=[r],a=function(e){var r=G[e];if(r.model){if("meta"===(null===e||void 0===e?void 0:e.split("|")[1]))return"continue";var i=K(t,r).then((function(n){var i,o=n.mesh,s=n.onMeshCreate,a={blockMesh:o,opaque:!1,solid:null===(i=r.solid)||void 0===i||i,onCustomMeshCreate:s};t.registry.registerBlock(r.id,a),null!==r.meta.metaStr&&j(t,e,a)}));s.push(i)}else{var o,a=!1;if(Array.isArray(r.texture))if("number"===typeof r.texture[0])r.texture.length>3&&(a=!0),t.registry.registerMaterial(e,{textureURL:null,color:B()(r.texture),texHasAlpha:a});else{var u=r.texture;o=[];for(var c=0;c<u.length;c++){var h="".concat(e).concat(c);t.rendering._engine.webGLVersion>=2&&!l.EU.clientEscMenuOptions.disableTexAtlas&&void 0!==r.atlasIdx[c]?t.registry.registerMaterial(h,{textureURL:n,atlasIndex:r.atlasIdx[c],texHasAlpha:a}):t.registry.registerMaterial(h,{textureURL:u[c],texHasAlpha:a}),r.texturePerSide||o.push(h)}if(r.texturePerSide){var d,f=(0,b.Z)(r.texturePerSide);try{for(f.s();!(d=f.n()).done;){var p=d.value,m="".concat(e).concat(p);o.push(m)}}catch(g){f.e(g)}finally{f.f()}}}else r.transTex&&(a=!0),t.rendering._engine.webGLVersion>=2&&!l.EU.clientEscMenuOptions.disableTexAtlas&&void 0!==r.atlasIdx?t.registry.registerMaterial(e,{textureURL:n,atlasIndex:r.atlasIdx,texHasAlpha:a}):t.registry.registerMaterial(e,{textureURL:r.texture,texHasAlpha:a});t.registry.registerBlock(r.id,{material:void 0===o?e:o,fluid:r.fluid,opaque:!a})}(0,R.JJ)(e,r.id,t.rendering.getScene(),void 0)},e.t0=o().keys((0,l.S7)(G));case 7:if((e.t1=e.t0()).done){e.next=14;break}if(u=e.t1.value,"continue"!==a(u)){e.next=12;break}return e.abrupt("continue",7);case 12:e.next=7;break;case 14:e.t2=o().keys(I.fe);case 15:if((e.t3=e.t2()).done){e.next=23;break}if(c=e.t3.value,isNaN(Number(c))){e.next=19;break}return e.abrupt("continue",15);case 19:h=I.fe[c],(0,R.JJ)(c,h.id,t.rendering.getScene(),h.type),e.next=15;break;case 23:return V(t),H(t),q(t),Z(t),l.f$.publish("loadingScreenState","Loading Game"),e.next=30,Promise.all(s);case 30:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)}function j(e,t,r){for(var n in G){var i=n.split("|");if(i[0]===t&&"meta"===i[1]){var o,s=G[n];e.registry.registerBlock(G[n].id,(0,S.Z)((0,S.Z)({},r),{},{solid:null===(o=s.solid)||void 0===o||o})),(0,R.JJ)(n,G[n].id,e.rendering.getScene(),void 0)}}}function V(e){var t;l.f$.subscribe("serverOption|skyBox",(function(r){!function(r){var n,i,o=e.rendering.getScene();t&&e.ents.deleteEntity(t),"lightblue"!==r&&("sky"===r?(n=x.Kj.CreateBox("SkyBox",1e3,e.rendering.getScene(),!1,x.Kj.BACKSIDE),(i=new T.f("sky",e.rendering.getScene())).inclination=-.2,i.turbidity=10,n.infiniteDistance=!0,i.luminance=.1,i.cameraOffset.y=50,i.freeze()):(n=k.BoxBuilder.CreateBox("skyBox",{size:1e3},o),(i=new C.K("skyBox",o)).reflectionTexture=new P.B("textures/skyBoxes/".concat(r,"/"),o),i.reflectionTexture.coordinatesMode=A.x.SKYBOX_MODE,i.diffuseColor=new M.Wo(0,0,0),i.specularColor=new M.Wo(0,0,0)),i.backFaceCulling=!1,n.material=i,i.disableLighting=!0,i.freeze(),n.applyFog=!1,t=e.ents.add([0,0,0],null,null,n),e.ents.addComponent(t,e.ents.names.followsEntity,{entity:e.playerEntity}))}(r)}))}function H(e){l.f$.subscribe("serverOption|fogEnabled",(function(e){}))}function q(e){for(var t=e.rendering.getScene(),n=0;n<10;n++){var i=new C.K("breakingBoxTexture".concat(n),t);i.diffuseTexture=new A.x("".concat(r(26927)("./destroy_stage_".concat(n,".png"))),t,null,null,A.x.NEAREST_SAMPLINGMODE),i.diffuseTexture.wrapU=A.x.CLAMP_ADDRESSMODE,i.diffuseTexture.wrapV=A.x.CLAMP_ADDRESSMODE,i.useAlphaFromDiffuseTexture=!0,i.diffuseTexture.hasAlpha=!0,i.alpha=.7,i.diffuseTexture.anisotropicFilteringLevel=1,i.specularColor=new M.Wo(0,0,0),i.freeze();var o=x.Kj.CreateBox("breakingBox".concat(n),1.01,t);o.material=i,e.rendering.addMeshToScene(o),o.setEnabled(!1)}}function Z(e){var t=L.V.CreateBox("highlight",{size:1.005},e.rendering._scene),r=e.rendering.makeStandardMaterial("highlightMat");r.backFaceCulling=!1,r.emissiveColor=new M.Wo(1,1,1),r.alpha=.2,t.material=r,r.freeze(),t.isPickable=!1,e.rendering.addMeshToScene(t),t.setEnabled(!1),e.rendering._highlightMesh=t,t.alwaysSelectAsActiveMesh=!0,t.doNotSyncBoundingInfo=!0}function K(e,t){return Y.apply(this,arguments)}function Y(){return Y=(0,n.Z)(o().mark((function e(t,r){var n,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.model.split("|")[0],i=r.model.split("|").includes("rotatable"),s=t.rendering.getScene(),"CentreCross"!==n){e.next=7;break}return e.abrupt("return",{mesh:Q(s,r),onMeshCreate:i?ae:null});case 7:if("SquareSided"!==n){e.next=11;break}return e.abrupt("return",{mesh:$(s,r),onMeshCreate:i?ae:null});case 11:if("CustomPlanes"!==n){e.next=15;break}return e.abrupt("return",{mesh:J(s,r.name,r.customPlanesInfo,r.texture),onMeshCreate:i?ae:null});case 15:if("Slab"!==n){e.next=19;break}return e.abrupt("return",{mesh:ee(s,r),onMeshCreate:se});case 19:if("door"!==n){e.next=27;break}return e.next=22,te(s,r);case 22:return e.t0=e.sent,e.t1=ne,e.abrupt("return",{mesh:e.t0,onMeshCreate:e.t1});case 27:if("trapdoor"!==n){e.next=35;break}return e.next=30,te(s,r);case 30:return e.t2=e.sent,e.t3=ie,e.abrupt("return",{mesh:e.t2,onMeshCreate:e.t3});case 35:if("rotatableOffset"!==n){e.next=43;break}return e.next=38,te(s,r);case 38:return e.t4=e.sent,e.t5=oe,e.abrupt("return",{mesh:e.t4,onMeshCreate:e.t5});case 43:if("rotatable"!==n){e.next=51;break}return e.next=46,te(s,r);case 46:return e.t6=e.sent,e.t7=ae,e.abrupt("return",{mesh:e.t6,onMeshCreate:e.t7});case 51:console.error("Unknown block mesh type",r.model);case 52:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function X(e,t,r){var n=new O.Y("".concat(t,"BlockModelMeshMat"),e),i=new A.x(r,e,null,null,A.x.NEAREST_SAMPLINGMODE);return i.wrapU=A.x.CLAMP_ADDRESSMODE,i.wrapV=A.x.CLAMP_ADDRESSMODE,n.unlit=!0,i.hasAlpha=!0,n.albedoTexture=i,n.freeze(),n}function Q(e,t){return J(e,t.name,[{textureIdx:0,yRot:0},{textureIdx:0,yRot:Math.PI/2}],[t.texture])}function J(e,t,r,n){var i,o=[],s={},a=(0,b.Z)(r);try{for(a.s();!(i=a.n()).done;){var l=i.value,u=l.textureIdx,c=l.yRot,h=D.mx.CreatePlane("".concat(t,"BlkMdl1"),{size:1,sideOrientation:x.Kj.DOUBLESIDE},e);h.isPickable=!1,h.rotation.y=c,h.rotation.x=Math.PI,h.bakeCurrentTransformIntoVertices();var d=n[u];s[d]||(s[d]=X(e,"".concat(t,"TexIdx").concat(u),d)),h.material=s[d],o.push(h)}}catch(g){a.e(g)}finally{a.f()}var f=x.Kj.MergeMeshes(o,!0,!1,null,!1,Object.keys(s).length>1);f.isPickable=!1;for(var p=0,m=o;p<m.length;p++){m[p].dispose()}return f}function $(e,t){var r=D.mx.CreatePlane("".concat(t.name,"BlkMdl1"),{size:1,sideOrientation:x.Kj.DOUBLESIDE},e);r.isPickable=!1,r.rotation.x=Math.PI,r.position.z=.49,r.bakeCurrentTransformIntoVertices();var n=D.mx.CreatePlane("".concat(t.name,"BlkMdl1"),{size:1,sideOrientation:x.Kj.DOUBLESIDE},e);n.isPickable=!1,n.rotation.x=Math.PI,n.rotation.y=Math.PI,n.position.z=-.49,n.bakeCurrentTransformIntoVertices();var i=D.mx.CreatePlane("".concat(t.name,"BlkMdl2"),{size:1,sideOrientation:x.Kj.DOUBLESIDE},e);i.isPickable=!1,i.rotation.y=Math.PI/2,i.rotation.z=Math.PI,i.position.x=.49,i.bakeCurrentTransformIntoVertices();var o=D.mx.CreatePlane("".concat(t.name,"BlkMdl2"),{size:1,sideOrientation:x.Kj.DOUBLESIDE},e);o.isPickable=!1,o.rotation.y=3*Math.PI/2,o.rotation.z=Math.PI,o.position.x=-.49,o.bakeCurrentTransformIntoVertices();var s=X(e,t.name,t.texture);r.material=s,n.material=s,i.material=s,o.material=s;var a=x.Kj.MergeMeshes([r,n,i,o],!0,!1,null,!1,!1);return a.isPickable=!1,r.dispose(),n.dispose(),i.dispose(),o.dispose(),a}function ee(e,t){var r=new R.RW(t.name,e)._makeSourceMesh();return r.material.unfreeze(),r.setEnabled(!0),r.material=r.material.clone("BlockModelSlab".concat(t.name)),r.material.disableLighting=!0,r.material.emissiveColor=new M.Wo(1,1,1),r.material.freeze(),r}function te(e,t){return re.apply(this,arguments)}function re(){return re=(0,n.Z)(o().mark((function e(t,r){var n,i,s,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.blockModel,e.next=3,F.n.ImportMeshAsync("",n,null,t);case 3:return i=e.sent,s=(s=i.meshes).filter((function(e){return e.subMeshes&&e.subMeshes.length>0})),(a=s[0]).name="".concat(r.name,"blockGlbMesh"),a.scaling=new E.P(1/8,1/8,1/8),a.bakeCurrentTransformIntoVertices(!1),a.material.unlit=!0,a.material.freeze(),a.isPickable=!1,e.abrupt("return",a);case 14:case"end":return e.stop()}}),e)}))),re.apply(this,arguments)}function ne(e,t,r,n,i){var o,s,a=.4375,l=G[i].name,u=null!==(o=l.split("|")[2])&&void 0!==o?o:"rot1",c="open"===(null!==(s=l.split("|")[3])&&void 0!==s?s:"closed");"rot1"===u&&c?(e.position.x+=a,e.rotation.y+=3*Math.PI/2):"rot1"!==u||c?"rot2"===u&&c?e.position.z-=a:"rot2"!==u||c?"rot3"===u&&c?(e.position.x-=a,e.rotation.y+=Math.PI/2):"rot3"!==u||c?"rot4"===u&&c?(e.position.z+=a,e.rotation.y+=Math.PI):"rot4"!==u||c||(e.position.x-=a,e.rotation.y+=3*Math.PI/2):(e.position.z-=a,e.rotation.y+=Math.PI):(e.position.x+=a,e.rotation.y+=Math.PI/2):e.position.z+=a}function ie(e,t,r,n,i){var o,s=G[i].name,a=.4375;if("open"===(null!==(o=s.split("|")[3])&&void 0!==o?o:"closed")){var l,u=null!==(l=s.split("|")[2])&&void 0!==l?l:"rot1";"rot4"===u?(e.position.x+=a,e.rotation.y+=3*Math.PI/2):"rot1"===u?e.position.z-=a:"rot2"===u?(e.position.x-=a,e.rotation.y+=Math.PI/2):"rot3"===u&&(e.position.z+=a,e.rotation.y+=Math.PI)}else e.position.y+=a,e.rotation.x+=Math.PI/2}function oe(e,t,r,n,i){var o,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.4375;ae(e,t,r,n,i);var a=G[i].name,l=null!==(o=a.split("|")[2])&&void 0!==o?o:"rot1";"rot1"===l?e.position.z-=s:"rot2"===l?e.position.x-=s:"rot3"===l?e.position.z+=s:"rot4"===l&&(e.position.x+=s)}function se(e,t,r,n,i){var o=(0,l.rL)().getMetaInfo(i).metaStr;"side"===o.split("|")[2]?(oe(e,t,r,n,i,.25),e.rotation.x=Math.PI/2):"top"===o.split("|")[2]?e.position.y+=.25:e.position.y-=.25}function ae(e,t,r,n,i){var o,s,a=G[i].name,l=null!==(o=G[i].modelScale)&&void 0!==o?o:1;e.scaling=new E.P(l,l,l);var u=null!==(s=a.split("|")[2])&&void 0!==s?s:"rot1";"rot2"===u?e.rotation.y+=Math.PI/2:"rot3"===u?e.rotation.y+=Math.PI:"rot4"===u&&(e.rotation.y+=3*Math.PI/2)}U.J.Configuration={decoder:{wasmUrl:"/static/draco_wasm_wrapper_gltf.js",wasmBinaryUrl:"/static/draco_decoder_gltf.wasm"}};var le,ue=r(29439),ce=r(85882),he=r(52126),de=r(47786),fe=function(){function e(t,r){var n=this;(0,f.Z)(this,e),this.worker=void 0,this.waitingChunkCallbacks={},this.seedInitReqCounts={},this.worker=r(),this.worker.onmessage=function(e){var t=e.data,r=t.id,i=t.array,o=t.metadata;if(i=de(new Uint16Array(i.data.buffer),[he.ZP.chunkSize,he.ZP.chunkSize,he.ZP.chunkSize]),n.waitingChunkCallbacks[r]){var s,a=(0,b.Z)(n.waitingChunkCallbacks[r]);try{for(a.s();!(s=a.n()).done;){(0,s.value)(i,o)}}catch(l){a.e(l)}finally{a.f()}}delete n.waitingChunkCallbacks[r]},this.worker.onerror=function(e){console.error("error from webworker\n",e)},this.worker.postMessage({type:"workerInit",chunkSize:he.ZP.chunkSize,blockMetadata:t})}return(0,p.Z)(e,[{key:"initialiseSeed",value:function(e){var t;this.worker.postMessage({type:"createSeed",seed:e}),this.seedInitReqCounts[e]=(null!==(t=this.seedInitReqCounts[e])&&void 0!==t?t:0)+1}},{key:"destroySeed",value:function(e){void 0!==this.seedInitReqCounts[e]&&this.seedInitReqCounts[e]>0&&(this.seedInitReqCounts[e]=this.seedInitReqCounts[e]-1),this.seedInitReqCounts[e]||this.worker.postMessage({type:"deleteSeed",seed:e}),this.seedInitReqCounts[e]<=0&&delete this.seedInitReqCounts[e]}},{key:"threadedGetChunk",value:function(e,t,r,n,i,o){var s,a="".concat(r,"|").concat(n,"|").concat(i,"|").concat(e),l=null!==(s=this.waitingChunkCallbacks[a])&&void 0!==s?s:[];l.push(o),this.waitingChunkCallbacks[a]=l;var u=[t.data.buffer];this.worker.postMessage({type:"chunk",id:a,array:t},u)}}]),e}(),pe=r(23257),me=r(20477),ge=r.n(me);function ve(){return ge()('/*! For license information please see procGen.worker.0b63992a.worker.js.LICENSE.txt */\n!function(){var e={189:function(e,t,n){var i=n(4687),r=n(7424).default,o=n(4704).default,a=n(861).default,s=n(6690).default,h=n(9728).default,u=function(e){try{return Object(function(){var e=new Error("Cannot find module \'perf_hooks\'");throw e.code="MODULE_NOT_FOUND",e}())}catch(t){return e}}(Date).now,c=function(e){return e&&e===Math.floor(e)&&e>0&&isFinite(e)},l=function(e){"use strict";function t(e){var n=e.max,i=void 0===n?1/0:n,r=e.ttl,o=e.updateAgeOnGet,a=void 0!==o&&o,h=e.noUpdateTTL,u=void 0!==h&&h,l=e.dispose;if(s(this,t),this.expirations=Object.create(null),this.data=new Map,this.expirationMap=new Map,void 0!==r&&!c(r))throw new TypeError("ttl must be positive integer if set");if(!c(i)&&i!==1/0)throw new TypeError("max must be positive integer or Infinity");if(this.ttl=r,this.max=i,this.updateAgeOnGet=a,this.noUpdateTTL=u,void 0!==l){if("function"!==typeof l)throw new TypeError("dispose must be function if set");this.dispose=l}}return h(t,[{key:"clear",value:function(){var e=this.dispose!==t.prototype.dispose?a(this):[];this.data.clear(),this.expirationMap.clear(),this.expirations=Object.create(null);var n,i=o(e);try{for(i.s();!(n=i.n()).done;){var s=r(n.value,2),h=s[0],u=s[1];this.dispose(u,h,"delete")}}catch(c){i.e(c)}finally{i.f()}}},{key:"set",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=i.ttl,o=void 0===r?this.ttl:r,a=i.noUpdateTTL,s=void 0===a?this.noUpdateTTL:a,h=i.noDisposeOnSet,l=void 0===h?this.noDisposeOnSet:h;if(!c(o))throw new TypeError("ttl must be positive integer");var f=this.expirationMap.get(e),d=u(),p=void 0===f?void 0:this.data.get(e);if(void 0!==f){if(s&&f>d)return p!==t&&(this.data.set(e,t),l||this.dispose(p,e,"set")),this;var v=this.expirations[f];!v||v.length<=1?delete this.expirations[f]:this.expirations[f]=v.filter((function(t){return t!==e}))}var g=Math.ceil(d+o);if(this.expirationMap.set(e,g),this.data.set(e,t),!this.expirations[g]){var m=setTimeout((function(){return n.purgeStale()}),o);m.unref&&m.unref(),this.expirations[g]=[]}for(this.expirations[g].push(e);this.size>this.max;)this.purgeToCapacity();return!l&&f&&p!==t&&this.dispose(p,e,"set"),this}},{key:"has",value:function(e){return this.data.has(e)}},{key:"getRemainingTTL",value:function(e){var t=this.expirationMap.get(e);return void 0!==t?Math.max(0,t-u()):0}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.updateAgeOnGet,i=void 0===n?this.updateAgeOnGet:n,r=t.ttl,o=void 0===r?this.ttl:r,a=this.data.get(e);return i&&this.set(e,a,{noUpdateTTL:!1,noDisposeOnSet:!0,ttl:o}),a}},{key:"dispose",value:function(e,t){}},{key:"delete",value:function(e){var t=this.expirationMap.get(e);if(void 0!==t){var n=this.data.get(e);this.data.delete(e),this.expirationMap.delete(e);var i=this.expirations[t];return i&&i.length<=1?delete this.expirations[t]:this.expirations[t]=i.filter((function(t){return t!==e})),this.dispose(n,e,"delete"),!0}return!1}},{key:"purgeToCapacity",value:function(){for(var e in this.expirations){var t=this.expirations[e];if(this.size-t.length>=this.max){var n,i=o(t);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this.data.get(r);this.data.delete(r),this.expirationMap.delete(r),this.dispose(a,r,"evict")}}catch(f){i.e(f)}finally{i.f()}delete this.expirations[e]}else{var s,h=this.size-this.max,u=o(t.splice(0,h));try{for(u.s();!(s=u.n()).done;){var c=s.value,l=this.data.get(c);this.data.delete(c),this.expirationMap.delete(c),this.dispose(l,c,"evict")}}catch(f){u.e(f)}finally{u.f()}}return}}},{key:"size",get:function(){return this.data.size}},{key:"purgeStale",value:function(){var e=u();for(var t in this.expirations){if(t>e)return;var n,i=o(this.expirations[t]);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=this.data.get(r);this.data.delete(r),this.expirationMap.delete(r),this.dispose(a,r,"stale")}}catch(s){i.e(s)}finally{i.f()}delete this.expirations[t]}}},{key:"entries",value:i.mark((function e(){var t,n,r,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=i.keys(this.expirations);case 1:if((e.t1=e.t0()).done){e.next=22;break}t=e.t1.value,n=o(this.expirations[t]),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=12;break}return a=r.value,e.next=10,[a,this.data.get(a)];case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t2=e.catch(4),n.e(e.t2);case 17:return e.prev=17,n.f(),e.finish(17);case 20:e.next=1;break;case 22:case"end":return e.stop()}}),e,this,[[4,14,17,20]])}))},{key:"keys",value:i.mark((function e(){var t,n,r,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=i.keys(this.expirations);case 1:if((e.t1=e.t0()).done){e.next=22;break}t=e.t1.value,n=o(this.expirations[t]),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=12;break}return a=r.value,e.next=10,a;case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t2=e.catch(4),n.e(e.t2);case 17:return e.prev=17,n.f(),e.finish(17);case 20:e.next=1;break;case 22:case"end":return e.stop()}}),e,this,[[4,14,17,20]])}))},{key:"values",value:i.mark((function e(){var t,n,r,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=i.keys(this.expirations);case 1:if((e.t1=e.t0()).done){e.next=22;break}t=e.t1.value,n=o(this.expirations[t]),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=12;break}return a=r.value,e.next=10,this.data.get(a);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t2=e.catch(4),n.e(e.t2);case 17:return e.prev=17,n.f(),e.finish(17);case 20:e.next=1;break;case 22:case"end":return e.stop()}}),e,this,[[4,14,17,20]])}))},{key:e,value:function(){return this.entries()}}]),t}(Symbol.iterator);e.exports=l},2470:function(e,t){"use strict";t.byteLength=function(e){var t=h(e),n=t[0],i=t[1];return 3*(n+i)/4-i},t.toByteArray=function(e){var t,n,o=h(e),a=o[0],s=o[1],u=new r(function(e,t,n){return 3*(t+n)/4-n}(0,a,s)),c=0,l=s>0?a-4:a;for(n=0;n<l;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[c++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t);return u},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,o=[],a=16383,s=0,h=i-r;s<h;s+=a)o.push(u(e,s,s+a>h?h:s+a));1===r?(t=e[i-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===r&&(t=(e[i-2]<<8)+e[i-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],i=[],r="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,s=o.length;a<s;++a)n[a]=o[a],i[o.charCodeAt(a)]=a;function h(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function u(e,t,i){for(var r,o,a=[],s=t;s<i;s+=3)r=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),a.push(n[(o=r)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},918:function(e,t,n){"use strict";var i=n(2470),r=n(545),o=n(7146);function a(){return h.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return h.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=h.prototype:(null===e&&(e=new h(t)),e.length=t),e}function h(e,t,n){if(!h.TYPED_ARRAY_SUPPORT&&!(this instanceof h))return new h(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,n)}function u(e,t,n,i){if("number"===typeof t)throw new TypeError(\'"value" argument must not be a number\');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("\'offset\' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("\'length\' is out of bounds");t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i);h.TYPED_ARRAY_SUPPORT?(e=t).__proto__=h.prototype:e=f(e,t);return e}(e,t,n,i):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!h.isEncoding(n))throw new TypeError(\'"encoding" must be a valid string encoding\');var i=0|p(t,n),r=(e=s(e,i)).write(t,n);r!==i&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(h.isBuffer(t)){var n=0|d(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(i=t.length)!==i?s(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!==typeof e)throw new TypeError(\'"size" argument must be a number\');if(e<0)throw new RangeError(\'"size" argument must not be negative\')}function l(e,t){if(c(t),e=s(e,t<0?0:0|d(t)),!h.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|d(t.length);e=s(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function d(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function p(e,t){if(h.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(i)return H(e).length;t=(""+t).toLowerCase(),i=!0}}function v(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return M(this,t,n);case"ascii":return R(this,t,n);case"latin1":case"binary":return T(this,t,n);case"base64":return x(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function m(e,t,n,i,r){if(0===e.length)return-1;if("string"===typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"===typeof t&&(t=h.from(t,i)),h.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"===typeof t)return t&=255,h.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var o,a=1,s=e.length,h=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,h/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var c=-1;for(o=n;o<s;o++)if(u(e,o)===u(t,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===h)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(n+h>s&&(n=s-h),o=n;o>=0;o--){for(var l=!0,f=0;f<h;f++)if(u(e,o+f)!==u(t,f)){l=!1;break}if(l)return o}return-1}function b(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var o=t.length;if(o%2!==0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function w(e,t,n,i){return U(H(t,e.length-n),e,n,i)}function k(e,t,n,i){return U(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,i)}function C(e,t,n,i){return k(e,t,n,i)}function S(e,t,n,i){return U(q(t),e,n,i)}function _(e,t,n,i){return U(function(e,t){for(var n,i,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)i=(n=e.charCodeAt(a))>>8,r=n%256,o.push(r),o.push(i);return o}(t,e.length-n),e,n,i)}function x(e,t,n){return 0===t&&n===e.length?i.fromByteArray(e):i.fromByteArray(e.slice(t,n))}function M(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o,a,s,h,u=e[r],c=null,l=u>239?4:u>223?3:u>191?2:1;if(r+l<=n)switch(l){case 1:u<128&&(c=u);break;case 2:128===(192&(o=e[r+1]))&&(h=(31&u)<<6|63&o)>127&&(c=h);break;case 3:o=e[r+1],a=e[r+2],128===(192&o)&&128===(192&a)&&(h=(15&u)<<12|(63&o)<<6|63&a)>2047&&(h<55296||h>57343)&&(c=h);break;case 4:o=e[r+1],a=e[r+2],s=e[r+3],128===(192&o)&&128===(192&a)&&128===(192&s)&&(h=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&h<1114112&&(c=h)}null===c?(c=65533,l=1):c>65535&&(c-=65536,i.push(c>>>10&1023|55296),c=56320|1023&c),i.push(c),r+=l}return function(e){var t=e.length;if(t<=P)return String.fromCharCode.apply(String,e);var n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=P));return n}(i)}t.Buffer=h,t.SlowBuffer=function(e){+e!=e&&(e=0);return h.alloc(+e)},t.INSPECT_MAX_BYTES=50,h.TYPED_ARRAY_SUPPORT=void 0!==n.g.TYPED_ARRAY_SUPPORT?n.g.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=a(),h.poolSize=8192,h._augment=function(e){return e.__proto__=h.prototype,e},h.from=function(e,t,n){return u(null,e,t,n)},h.TYPED_ARRAY_SUPPORT&&(h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0})),h.alloc=function(e,t,n){return function(e,t,n,i){return c(t),t<=0?s(e,t):void 0!==n?"string"===typeof i?s(e,t).fill(n,i):s(e,t).fill(n):s(e,t)}(null,e,t,n)},h.allocUnsafe=function(e){return l(null,e)},h.allocUnsafeSlow=function(e){return l(null,e)},h.isBuffer=function(e){return!(null==e||!e._isBuffer)},h.compare=function(e,t){if(!h.isBuffer(e)||!h.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,i=t.length,r=0,o=Math.min(n,i);r<o;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},h.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(e,t){if(!o(e))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===e.length)return h.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var i=h.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var a=e[n];if(!h.isBuffer(a))throw new TypeError(\'"list" argument must be an Array of Buffers\');a.copy(i,r),r+=a.length}return i},h.byteLength=p,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},h.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},h.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},h.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):v.apply(this,arguments)},h.prototype.equals=function(e){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===h.compare(this,e)},h.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},h.prototype.compare=function(e,t,n,i,r){if(!h.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(r>>>=0)-(i>>>=0),a=(n>>>=0)-(t>>>=0),s=Math.min(o,a),u=this.slice(i,r),c=e.slice(t,n),l=0;l<s;++l)if(u[l]!==c[l]){o=u[l],a=c[l];break}return o<a?-1:a<o?1:0},h.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},h.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},h.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},h.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)i=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var r=this.length-t;if((void 0===n||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return w(this,e,t,n);case"ascii":return k(this,e,t,n);case"latin1":case"binary":return C(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var P=4096;function R(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function T(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function A(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=z(e[o]);return r}function E(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function O(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function L(e,t,n,i,r,o){if(!h.isBuffer(e))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(t>r||t<o)throw new RangeError(\'"value" argument is out of bounds\');if(n+i>e.length)throw new RangeError("Index out of range")}function B(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function D(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function I(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function N(e,t,n,i,o){return o||I(e,0,n,4),r.write(e,t,n,i,23,4),n+4}function F(e,t,n,i,o){return o||I(e,0,n,8),r.write(e,t,n,i,52,8),n+8}h.prototype.slice=function(e,t){var n,i=this.length;if((e=~~e)<0?(e+=i)<0&&(e=0):e>i&&(e=i),(t=void 0===t?i:~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),t<e&&(t=e),h.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=h.prototype;else{var r=t-e;n=new h(r,void 0);for(var o=0;o<r;++o)n[o]=this[o+e]}return n},h.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i},h.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},h.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},h.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},h.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},h.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},h.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},h.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var i=this[e],r=1,o=0;++o<t&&(r*=256);)i+=this[e+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},h.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var i=t,r=1,o=this[e+--i];i>0&&(r*=256);)o+=this[e+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},h.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},h.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},h.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},h.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},h.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},h.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),r.read(this,e,!0,23,4)},h.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),r.read(this,e,!1,23,4)},h.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),r.read(this,e,!0,52,8)},h.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),r.read(this,e,!1,52,8)},h.prototype.writeUIntLE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,o=0;for(this[t]=255&e;++o<n&&(r*=256);)this[t+o]=e/r&255;return t+n},h.prototype.writeUIntBE=function(e,t,n,i){(e=+e,t|=0,n|=0,i)||L(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,o=1;for(this[t+r]=255&e;--r>=0&&(o*=256);)this[t+r]=e/o&255;return t+n},h.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,255,0),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},h.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},h.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,65535,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},h.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},h.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,4294967295,0),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},h.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);L(this,e,t,n,r-1,-r)}var o=0,a=1,s=0;for(this[t]=255&e;++o<n&&(a*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},h.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t|=0,!i){var r=Math.pow(2,8*n-1);L(this,e,t,n,r-1,-r)}var o=n-1,a=1,s=0;for(this[t+o]=255&e;--o>=0&&(a*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/a>>0)-s&255;return t+n},h.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,1,127,-128),h.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},h.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):B(this,e,t,!0),t+2},h.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,2,32767,-32768),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):B(this,e,t,!1),t+2},h.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),h.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},h.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||L(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),h.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},h.prototype.writeFloatLE=function(e,t,n){return N(this,e,t,!0,n)},h.prototype.writeFloatBE=function(e,t,n){return N(this,e,t,!1,n)},h.prototype.writeDoubleLE=function(e,t,n){return F(this,e,t,!0,n)},h.prototype.writeDoubleBE=function(e,t,n){return F(this,e,t,!1,n)},h.prototype.copy=function(e,t,n,i){if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r,o=i-n;if(this===e&&n<t&&t<i)for(r=o-1;r>=0;--r)e[r+t]=this[r+n];else if(o<1e3||!h.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},h.prototype.fill=function(e,t,n,i){if("string"===typeof e){if("string"===typeof t?(i=t,t=0,n=this.length):"string"===typeof n&&(i=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(void 0!==i&&"string"!==typeof i)throw new TypeError("encoding must be a string");if("string"===typeof i&&!h.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(o=t;o<n;++o)this[o]=e;else{var a=h.isBuffer(e)?e:H(new h(e,i).toString()),s=a.length;for(o=0;o<n-t;++o)this[o+t]=a[o%s]}return this};var j=/[^+\\/0-9A-Za-z-_]/g;function z(e){return e<16?"0"+e.toString(16):e.toString(16)}function H(e,t){var n;t=t||1/0;for(var i=e.length,r=null,o=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function q(e){return i.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\\s+|\\s+$/g,"")}(e).replace(j,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function U(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}},8041:function(e){"use strict";var t,n="object"===typeof Reflect?Reflect:null,i=n&&"function"===typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!==e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}v(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&v(e,"error",t,n)}(e,r,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!==typeof e)throw new TypeError(\'The "listener" argument must be of type Function. Received type \'+typeof e)}function h(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function u(e,t,n,i){var r,o,a,u;if(s(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),a=o[t]),void 0===a)a=o[t]=n,++e._eventsCount;else if("function"===typeof a?a=o[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(r=h(e))>0&&a.length>r&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,u=c,console&&console.warn&&console.warn(u)}return e}function c(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=c.bind(i);return r.listener=n,i.wrapFn=r,r}function f(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"===typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):p(r,r.length)}function d(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function v(e,t,n,i){if("function"===typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError(\'The "emitter" argument must be of type EventEmitter. Received type \'+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!==typeof e||e<0||r(e))throw new RangeError(\'The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received \'+e+".");a=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||r(e))throw new RangeError(\'The value of "n" is out of range. It must be a non-negative number. Received \'+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var h=o[e];if(void 0===h)return!1;if("function"===typeof h)i(h,this,t);else{var u=h.length,c=p(h,u);for(n=0;n<u;++n)i(c[n],this,t)}return!0},o.prototype.addListener=function(e,t){return u(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return u(this,e,t,!0)},o.prototype.once=function(e,t){return s(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,i,r,o,a;if(s(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return f(this,e,!0)},o.prototype.rawListeners=function(e){return f(this,e,!1)},o.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},o.prototype.listenerCount=d,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},9834:function(e,t,n){"use strict";var i=n(2582).Buffer,r=n(1881).Transform;function o(e){r.call(this),this._block=i.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}n(273)(o,r),o.prototype._transform=function(e,t,n){var i=null;try{this.update(e,t)}catch(r){i=r}n(i)},o.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(n){t=n}e(t)},o.prototype.update=function(e,t){if(function(e,t){if(!i.isBuffer(e)&&"string"!==typeof e)throw new TypeError(t+" must be a string or a buffer")}(e,"Data"),this._finalized)throw new Error("Digest already called");i.isBuffer(e)||(e=i.from(e,t));for(var n=this._block,r=0;this._blockOffset+e.length-r>=this._blockSize;){for(var o=this._blockOffset;o<this._blockSize;)n[o++]=e[r++];this._update(),this._blockOffset=0}for(;r<e.length;)n[this._blockOffset++]=e[r++];for(var a=0,s=8*e.length;s>0;++a)this._length[a]+=s,(s=this._length[a]/4294967296|0)>0&&(this._length[a]-=4294967296*s);return this},o.prototype._update=function(){throw new Error("_update is not implemented")},o.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var n=0;n<4;++n)this._length[n]=0;return t},o.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=o},2582:function(e,t,n){var i=n(918),r=i.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(o(i,t),t.Buffer=a),a.prototype=Object.create(r.prototype),o(r,a),a.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},a.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"===typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},a.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},545:function(e,t){t.read=function(e,t,n,i,r){var o,a,s=8*r-i-1,h=(1<<s)-1,u=h>>1,c=-7,l=n?r-1:0,f=n?-1:1,d=e[t+l];for(l+=f,o=d&(1<<-c)-1,d>>=-c,c+=s;c>0;o=256*o+e[t+l],l+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+e[t+l],l+=f,c-=8);if(0===o)o=1-u;else{if(o===h)return a?NaN:1/0*(d?-1:1);a+=Math.pow(2,i),o-=u}return(d?-1:1)*a*Math.pow(2,o-i)},t.write=function(e,t,n,i,r,o){var a,s,h,u=8*o-r-1,c=(1<<u)-1,l=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,p=i?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(h=Math.pow(2,-a))<1&&(a--,h*=2),(t+=a+l>=1?f/h:f*Math.pow(2,1-l))*h>=2&&(a++,h/=2),a+l>=c?(s=0,a=c):a+l>=1?(s=(t*h-1)*Math.pow(2,r),a+=l):(s=t*Math.pow(2,l-1)*Math.pow(2,r),a=0));r>=8;e[n+d]=255&s,d+=p,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[n+d]=255&a,d+=p,a/=256,u-=8);e[n+d-p]|=128*v}},273:function(e){"function"===typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},379:function(e){"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},3110:function(e){function t(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},7146:function(e){var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},1075:function(e,t,n){"use strict";var i=n(273),r=n(9834),o=n(5734).Buffer,a=new Array(16);function s(){r.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function h(e,t){return e<<t|e>>>32-t}function u(e,t,n,i,r,o,a){return h(e+(t&n|~t&i)+r+o|0,a)+t|0}function c(e,t,n,i,r,o,a){return h(e+(t&i|n&~i)+r+o|0,a)+t|0}function l(e,t,n,i,r,o,a){return h(e+(t^n^i)+r+o|0,a)+t|0}function f(e,t,n,i,r,o,a){return h(e+(n^(t|~i))+r+o|0,a)+t|0}i(s,r),s.prototype._update=function(){for(var e=a,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var n=this._a,i=this._b,r=this._c,o=this._d;n=u(n,i,r,o,e[0],3614090360,7),o=u(o,n,i,r,e[1],3905402710,12),r=u(r,o,n,i,e[2],606105819,17),i=u(i,r,o,n,e[3],3250441966,22),n=u(n,i,r,o,e[4],4118548399,7),o=u(o,n,i,r,e[5],1200080426,12),r=u(r,o,n,i,e[6],2821735955,17),i=u(i,r,o,n,e[7],4249261313,22),n=u(n,i,r,o,e[8],1770035416,7),o=u(o,n,i,r,e[9],2336552879,12),r=u(r,o,n,i,e[10],4294925233,17),i=u(i,r,o,n,e[11],2304563134,22),n=u(n,i,r,o,e[12],1804603682,7),o=u(o,n,i,r,e[13],4254626195,12),r=u(r,o,n,i,e[14],2792965006,17),n=c(n,i=u(i,r,o,n,e[15],1236535329,22),r,o,e[1],4129170786,5),o=c(o,n,i,r,e[6],3225465664,9),r=c(r,o,n,i,e[11],643717713,14),i=c(i,r,o,n,e[0],3921069994,20),n=c(n,i,r,o,e[5],3593408605,5),o=c(o,n,i,r,e[10],38016083,9),r=c(r,o,n,i,e[15],3634488961,14),i=c(i,r,o,n,e[4],3889429448,20),n=c(n,i,r,o,e[9],568446438,5),o=c(o,n,i,r,e[14],3275163606,9),r=c(r,o,n,i,e[3],4107603335,14),i=c(i,r,o,n,e[8],1163531501,20),n=c(n,i,r,o,e[13],2850285829,5),o=c(o,n,i,r,e[2],4243563512,9),r=c(r,o,n,i,e[7],1735328473,14),n=l(n,i=c(i,r,o,n,e[12],2368359562,20),r,o,e[5],4294588738,4),o=l(o,n,i,r,e[8],2272392833,11),r=l(r,o,n,i,e[11],1839030562,16),i=l(i,r,o,n,e[14],4259657740,23),n=l(n,i,r,o,e[1],2763975236,4),o=l(o,n,i,r,e[4],1272893353,11),r=l(r,o,n,i,e[7],4139469664,16),i=l(i,r,o,n,e[10],3200236656,23),n=l(n,i,r,o,e[13],681279174,4),o=l(o,n,i,r,e[0],3936430074,11),r=l(r,o,n,i,e[3],3572445317,16),i=l(i,r,o,n,e[6],76029189,23),n=l(n,i,r,o,e[9],3654602809,4),o=l(o,n,i,r,e[12],3873151461,11),r=l(r,o,n,i,e[15],530742520,16),n=f(n,i=l(i,r,o,n,e[2],3299628645,23),r,o,e[0],4096336452,6),o=f(o,n,i,r,e[7],1126891415,10),r=f(r,o,n,i,e[14],2878612391,15),i=f(i,r,o,n,e[5],4237533241,21),n=f(n,i,r,o,e[12],1700485571,6),o=f(o,n,i,r,e[3],2399980690,10),r=f(r,o,n,i,e[10],4293915773,15),i=f(i,r,o,n,e[1],2240044497,21),n=f(n,i,r,o,e[8],1873313359,6),o=f(o,n,i,r,e[15],4264355552,10),r=f(r,o,n,i,e[6],2734768916,15),i=f(i,r,o,n,e[13],1309151649,21),n=f(n,i,r,o,e[4],4149444226,6),o=f(o,n,i,r,e[11],3174756917,10),r=f(r,o,n,i,e[2],718787259,15),i=f(i,r,o,n,e[9],3951481745,21),this._a=this._a+n|0,this._b=this._b+i|0,this._c=this._c+r|0,this._d=this._d+o|0},s.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=o.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=s},3357:function(e){e.exports=function(e,t){t=t||2;for(var n=2*(e=e||1)+1,i=Math.pow(n,t)-1,r=new Array(i),o=0;o<i;o++)for(var a=r[o]=new Array(t),s=o<i/2?o:o+1,h=1;h<=t;h++){var u=s%Math.pow(n,h);a[h-1]=u/Math.pow(n,h-1)-e,s-=u}return r}},7786:function(e,t,n){var i=n(379),r=n(3110),o="undefined"!==typeof Float64Array;function a(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(a);var i=new Array(n.length);for(e=0;e<i.length;++e)i[e]=n[e][1];return i}function h(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var r="generic"===e;if(-1===t){var o="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype=\'"+e+"\';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(o)()}if(0===t){o="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype=\'"+e+"\';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(r?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(r?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",o)(u[e][0])}o=["\'use strict\'"];var a=i(t),h=a.map((function(e){return"i"+e})),c="this.offset+"+a.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),l=a.map((function(e){return"b"+e})).join(","),f=a.map((function(e){return"c"+e})).join(",");o.push("function "+n+"(a,"+l+","+f+",d){this.data=a","this.shape=["+l+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype=\'"+e+"\'","proto.dimension="+t),o.push("Object.defineProperty(proto,\'size\',{get:function "+n+"_size(){return "+a.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,\'order\',{get:"),t<4?(o.push("function "+n+"_order(){"),2===t?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+n+"_set("+h.join(",")+",v){"),r?o.push("return this.data.set("+c+",v)}"):o.push("return this.data["+c+"]=v}"),o.push("proto.get=function "+n+"_get("+h.join(",")+"){"),r?o.push("return this.data.get("+c+")}"):o.push("return this.data["+c+"]}"),o.push("proto.index=function "+n+"_index(",h.join(),"){return "+c+"}"),o.push("proto.hi=function "+n+"_hi("+h.join(",")+"){return new "+n+"(this.data,"+a.map((function(e){return["(typeof i",e,"!==\'number\'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+a.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=a.map((function(e){return"a"+e+"=this.shape["+e+"]"})),p=a.map((function(e){return"c"+e+"=this.stride["+e+"]"}));o.push("proto.lo=function "+n+"_lo("+h.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+p.join(","));for(var v=0;v<t;++v)o.push("if(typeof i"+v+"===\'number\'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");o.push("return new "+n+"(this.data,"+a.map((function(e){return"a"+e})).join(",")+","+a.map((function(e){return"c"+e})).join(",")+",b)}"),o.push("proto.step=function "+n+"_step("+h.join(",")+"){var "+a.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+a.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(v=0;v<t;++v)o.push("if(typeof i"+v+"===\'number\'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");o.push("return new "+n+"(this.data,"+a.map((function(e){return"a"+e})).join(",")+","+a.map((function(e){return"b"+e})).join(",")+",c)}");var g=new Array(t),m=new Array(t);for(v=0;v<t;++v)g[v]="a[i"+v+"]",m[v]="b[i"+v+"]";o.push("proto.transpose=function "+n+"_transpose("+h+"){"+h.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+g.join(",")+","+m.join(",")+",this.offset)}"),o.push("proto.pick=function "+n+"_pick("+h+"){var a=[],b=[],c=this.offset");for(v=0;v<t;++v)o.push("if(typeof i"+v+"===\'number\'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+a.map((function(e){return"shape["+e+"]"})).join(",")+","+a.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\\n"))(u[e],s)}var u={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,n,i){if(void 0===e)return(0,u.array[0])([]);"number"===typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var a=t.length;if(void 0===n){n=new Array(a);for(var s=a-1,c=1;s>=0;--s)n[s]=c,c*=t[s]}if(void 0===i){i=0;for(s=0;s<a;++s)n[s]<0&&(i-=(t[s]-1)*n[s])}for(var l=function(e){if(r(e))return"buffer";if(o)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=u[l];f.length<=a+1;)f.push(h(l,f.length-1));return(0,f[a+1])(e,t,n,i)}},3555:function(e,t,n){"use strict";var i=n(1159).integer,r=n(1677),o=n(9847);function a(e,t){for(var n=0,i=0;i<e.length;i++)n+=Math.pow(e[i]-t[i],2);return n}function s(e,t){if("function"===typeof e.distanceFunction)throw new Error("PoissonDiskSampling: Tried to instantiate the fixed density implementation with a distanceFunction");this.shape=e.shape,this.minDistance=e.minDistance,this.maxDistance=e.maxDistance||2*e.minDistance,this.maxTries=Math.ceil(Math.max(1,e.tries||30)),this.rng=t||Math.random,this.dimension=this.shape.length,this.squaredMinDistance=this.minDistance*this.minDistance,this.minDistancePlusEpsilon=this.minDistance+2e-14,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.minDistance/Math.sqrt(this.dimension),this.neighbourhood=o(this.dimension),this.currentPoint=null,this.processList=[],this.samplePoints=[],this.gridShape=[];for(var n=0;n<this.dimension;n++)this.gridShape.push(Math.ceil(this.shape[n]/this.cellSize));this.grid=i(this.gridShape)}s.prototype.shape=null,s.prototype.dimension=null,s.prototype.minDistance=null,s.prototype.maxDistance=null,s.prototype.minDistancePlusEpsilon=null,s.prototype.squaredMinDistance=null,s.prototype.deltaDistance=null,s.prototype.cellSize=null,s.prototype.maxTries=null,s.prototype.rng=null,s.prototype.neighbourhood=null,s.prototype.currentPoint=null,s.prototype.processList=null,s.prototype.samplePoints=null,s.prototype.gridShape=null,s.prototype.grid=null,s.prototype.addRandomPoint=function(){for(var e=new Array(this.dimension),t=0;t<this.dimension;t++)e[t]=this.rng()*this.shape[t];return this.directAddPoint(e)},s.prototype.addPoint=function(e){var t,n=!0;if(e.length===this.dimension)for(t=0;t<this.dimension&&n;t++)n=e[t]>=0&&e[t]<=this.shape[t];else n=!1;return n?this.directAddPoint(e):null},s.prototype.directAddPoint=function(e){var t,n=0,i=this.grid.stride;for(this.processList.push(e),this.samplePoints.push(e),t=0;t<this.dimension;t++)n+=(e[t]/this.cellSize|0)*i[t];return this.grid.data[n]=this.samplePoints.length,e},s.prototype.inNeighbourhood=function(e){var t,n,i,r,o=this.dimension,s=this.grid.stride;for(t=0;t<this.neighbourhood.length;t++){for(n=0,i=0;i<o;i++){if((r=(e[i]/this.cellSize|0)+this.neighbourhood[t][i])<0||r>=this.gridShape[i]){n=-1;break}n+=r*s[i]}if(-1!==n&&0!==this.grid.data[n]&&a(e,this.samplePoints[this.grid.data[n]-1])<this.squaredMinDistance)return!0}return!1},s.prototype.next=function(){for(var e,t,n,i,o,a,s;this.processList.length>0;){for(null===this.currentPoint&&(this.currentPoint=this.processList.shift()),i=this.currentPoint,e=0;e<this.maxTries;e++){for(a=!0,n=this.minDistancePlusEpsilon+this.deltaDistance*this.rng(),2===this.dimension?(t=this.rng()*Math.PI*2,o=[Math.cos(t),Math.sin(t)]):o=r(this.dimension,this.rng),s=0;a&&s<this.dimension;s++)o[s]=i[s]+o[s]*n,a=o[s]>=0&&o[s]<this.shape[s];if(a&&!this.inNeighbourhood(o))return this.directAddPoint(o)}e===this.maxTries&&(this.currentPoint=null)}return null},s.prototype.fill=function(){for(0===this.samplePoints.length&&this.addRandomPoint();this.next(););return this.samplePoints},s.prototype.getAllPoints=function(){return this.samplePoints},s.prototype.getAllPointsWithDistance=function(){throw new Error("PoissonDiskSampling: getAllPointsWithDistance() is not available in fixed-density implementation")},s.prototype.reset=function(){var e=this.grid.data,t=0;for(t=0;t<e.length;t++)e[t]=0;this.samplePoints=[],this.currentPoint=null,this.processList.length=0},e.exports=s},8966:function(e,t,n){"use strict";var i=n(1159).array,r=n(1677),o=n(9847);function a(e,t){for(var n=0,i=0;i<e.length;i++)n+=Math.pow(e[i]-t[i],2);return Math.sqrt(n)}function s(e,t){if("function"!==typeof e.distanceFunction)throw new Error("PoissonDiskSampling: Tried to instantiate the variable density implementation without a distanceFunction");this.shape=e.shape,this.minDistance=e.minDistance,this.maxDistance=e.maxDistance||2*e.minDistance,this.maxTries=Math.ceil(Math.max(1,e.tries||30)),this.distanceFunction=e.distanceFunction,this.bias=Math.max(0,Math.min(1,e.bias||0)),this.rng=t||Math.random,this.dimension=this.shape.length,this.minDistancePlusEpsilon=this.minDistance+2e-14,this.deltaDistance=Math.max(0,this.maxDistance-this.minDistancePlusEpsilon),this.cellSize=this.maxDistance/Math.sqrt(this.dimension),this.neighbourhood=o(this.dimension),this.currentPoint=null,this.currentDistance=0,this.processList=[],this.samplePoints=[],this.sampleDistance=[],this.gridShape=[];for(var n=0;n<this.dimension;n++)this.gridShape.push(Math.ceil(this.shape[n]/this.cellSize));this.grid=i(this.gridShape)}s.prototype.shape=null,s.prototype.dimension=null,s.prototype.minDistance=null,s.prototype.maxDistance=null,s.prototype.minDistancePlusEpsilon=null,s.prototype.deltaDistance=null,s.prototype.cellSize=null,s.prototype.maxTries=null,s.prototype.distanceFunction=null,s.prototype.bias=null,s.prototype.rng=null,s.prototype.neighbourhood=null,s.prototype.currentPoint=null,s.prototype.currentDistance=null,s.prototype.processList=null,s.prototype.samplePoints=null,s.prototype.sampleDistance=null,s.prototype.gridShape=null,s.prototype.grid=null,s.prototype.addRandomPoint=function(){for(var e=new Array(this.dimension),t=0;t<this.dimension;t++)e[t]=this.rng()*this.shape[t];return this.directAddPoint(e)},s.prototype.addPoint=function(e){var t,n=!0;if(e.length===this.dimension)for(t=0;t<this.dimension&&n;t++)n=e[t]>=0&&e[t]<=this.shape[t];else n=!1;return n?this.directAddPoint(e):null},s.prototype.directAddPoint=function(e){var t,n=0,i=this.grid.stride,r=this.samplePoints.length;for(this.processList.push(r),this.samplePoints.push(e),this.sampleDistance.push(this.distanceFunction(e)),t=0;t<this.dimension;t++)n+=(e[t]/this.cellSize|0)*i[t];return this.grid.data[n].push(r),e},s.prototype.inNeighbourhood=function(e){var t,n,i,r,o,s,h=this.dimension,u=this.grid.stride,c=this.distanceFunction(e);for(t=0;t<this.neighbourhood.length;t++){for(n=0,i=0;i<h;i++){if((r=(e[i]/this.cellSize|0)+this.neighbourhood[t][i])<0||r>=this.gridShape[i]){n=-1;break}n+=r*u[i]}if(-1!==n&&this.grid.data[n].length>0)for(var l=0;l<this.grid.data[n].length;l++){o=this.samplePoints[this.grid.data[n][l]],s=this.sampleDistance[this.grid.data[n][l]];var f=Math.min(s,c),d=f+(Math.max(s,c)-f)*this.bias;if(a(e,o)<this.minDistance+this.deltaDistance*d)return!0}}return!1},s.prototype.next=function(){for(var e,t,n,i,o,a,s,h;this.processList.length>0;){if(null===this.currentPoint){var u=this.processList.shift();this.currentPoint=this.samplePoints[u],this.currentDistance=this.sampleDistance[u]}for(i=this.currentPoint,o=this.currentDistance,e=0;e<this.maxTries;e++){for(s=!0,n=this.minDistancePlusEpsilon+this.deltaDistance*(o+(1-o)*this.bias),2===this.dimension?(t=this.rng()*Math.PI*2,a=[Math.cos(t),Math.sin(t)]):a=r(this.dimension,this.rng),h=0;s&&h<this.dimension;h++)a[h]=i[h]+a[h]*n,s=a[h]>=0&&a[h]<this.shape[h];if(s&&!this.inNeighbourhood(a))return this.directAddPoint(a)}e===this.maxTries&&(this.currentPoint=null)}return null},s.prototype.fill=function(){for(0===this.samplePoints.length&&this.addRandomPoint();this.next(););return this.samplePoints},s.prototype.getAllPoints=function(){return this.samplePoints},s.prototype.getAllPointsWithDistance=function(){var e,t=new Array(this.samplePoints.length),n=0,i=0;for(n=0;n<this.samplePoints.length;n++){for(e=new Array(this.dimension+1),i=0;i<this.dimension;i++)e[i]=this.samplePoints[n][i];e[this.dimension]=this.sampleDistance[n],t[n]=e}return t},s.prototype.reset=function(){var e=this.grid.data,t=0;for(t=0;t<e.length;t++)e[t]=[];this.samplePoints=[],this.currentPoint=null,this.processList.length=0},e.exports=s},9847:function(e,t,n){"use strict";var i=n(3357);var r={};e.exports=function(e){return r[e]||(r[e]=function(e){var t,n=i(2,e),r=[];for(n=n.filter((function(t){for(var n=0,i=0;i<e;i++)n+=Math.pow(Math.max(0,Math.abs(t[i])-1),2);return n<e})),t=0;t<e;t++)r.push(0);return n.push(r),n.sort((function(t,n){var i,r=0,o=0;for(i=0;i<e;i++)r+=Math.pow(t[i],2),o+=Math.pow(n[i],2);return r<o?-1:r>o?1:0})),n}(e)),r[e]}},8915:function(e,t,n){"use strict";var i=n(3555),r=n(8966);function o(e,t){this.shape=e.shape,"function"===typeof e.distanceFunction?this.implementation=new r(e,t):this.implementation=new i(e,t)}o.prototype.implementation=null,o.prototype.addRandomPoint=function(){return this.implementation.addRandomPoint()},o.prototype.addPoint=function(e){return this.implementation.addPoint(e)},o.prototype.next=function(){return this.implementation.next()},o.prototype.fill=function(){return this.implementation.fill()},o.prototype.getAllPoints=function(){return this.implementation.getAllPoints()},o.prototype.getAllPointsWithDistance=function(){return this.implementation.getAllPointsWithDistance()},o.prototype.reset=function(){this.implementation.reset()},e.exports=o},1677:function(e){"use strict";e.exports=function(e,t){var n,i,r,o,a,s=new Array(e),h=Math.floor(e/2)<<1,u=0;for(a=0;a<h;a+=2)n=-2*Math.log(t()),i=Math.sqrt(n),r=2*Math.PI*t(),u+=n,s[a]=i*Math.cos(r),s[a+1]=i*Math.sin(r);if(e%2){var c=Math.sqrt(-2*Math.log(t()))*Math.cos(2*Math.PI*t());s[e-1]=c,u+=Math.pow(c,2)}for(o=1/Math.sqrt(u),a=0;a<e;++a)s[a]*=o;return s}},1159:function(e){"use strict";e.exports={integer:function(e){var t,n=e.length,i=1,r=new Array(n);for(t=n;t>0;t--)r[t-1]=i,i*=e[t-1];return{stride:r,data:new Uint32Array(i)}},array:function(e){var t,n,i=e.length,r=1,o=new Array(i),a=[];for(t=i;t>0;t--)o[t-1]=r,r*=e[t-1];for(n=0;n<r;n++)a.push([]);return{stride:o,data:a}}}},1092:function(e){"use strict";var t={};function n(e,n,i){i||(i=Error);var r=function(e){var t,i;function r(t,i,r){return e.call(this,function(e,t,i){return"string"===typeof n?n:n(e,t,i)}(t,i,r))||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r}(i);r.prototype.name=i.name,r.prototype.code=e,t[e]=r}function i(e,t){if(Array.isArray(e)){var n=e.length;return e=e.map((function(e){return String(e)})),n>2?"one of ".concat(t," ").concat(e.slice(0,n-1).join(", "),", or ")+e[n-1]:2===n?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}n("ERR_INVALID_OPT_VALUE",(function(e,t){return\'The value "\'+t+\'" is invalid for option "\'+e+\'"\'}),TypeError),n("ERR_INVALID_ARG_TYPE",(function(e,t,n){var r,o,a,s;if("string"===typeof t&&(o="not ",t.substr(!a||a<0?0:+a,o.length)===o)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,n){return(void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t}(e," argument"))s="The ".concat(e," ").concat(r," ").concat(i(t,"type"));else{var h=function(e,t,n){return"number"!==typeof n&&(n=0),!(n+t.length>e.length)&&-1!==e.indexOf(t,n)}(e,".")?"property":"argument";s=\'The "\'.concat(e,\'" \').concat(h," ").concat(r," ").concat(i(t,"type"))}return s+=". Received type ".concat(typeof n)}),TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},6085:function(e,t,n){"use strict";var i=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};e.exports=u;var r=n(6405),o=n(7423);n(273)(u,r);for(var a=i(o.prototype),s=0;s<a.length;s++){var h=a[s];u.prototype[h]||(u.prototype[h]=o.prototype[h])}function u(e){if(!(this instanceof u))return new u(e);r.call(this,e),o.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",c)))}function c(){this._writableState.ended||process.nextTick(l,this)}function l(e){e.end()}Object.defineProperty(u.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(u.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(u.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},9543:function(e,t,n){"use strict";e.exports=r;var i=n(4917);function r(e){if(!(this instanceof r))return new r(e);i.call(this,e)}n(273)(r,i),r.prototype._transform=function(e,t,n){n(null,e)}},6405:function(e,t,n){"use strict";var i;e.exports=_,_.ReadableState=S;n(8041).EventEmitter;var r=function(e,t){return e.listeners(t).length},o=n(8747),a=n(918).Buffer,s=n.g.Uint8Array||function(){};var h,u=n(4616);h=u&&u.debuglog?u.debuglog("stream"):function(){};var c,l,f,d=n(5489),p=n(6617),v=n(5999).getHighWaterMark,g=n(1092).q,m=g.ERR_INVALID_ARG_TYPE,y=g.ERR_STREAM_PUSH_AFTER_EOF,b=g.ERR_METHOD_NOT_IMPLEMENTED,w=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;n(273)(_,o);var k=p.errorOrDestroy,C=["error","close","destroy","pause","resume"];function S(e,t,r){i=i||n(6085),e=e||{},"boolean"!==typeof r&&(r=t instanceof i),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=v(this,e,"readableHighWaterMark",r),this.buffer=new d,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(c||(c=n(8570).s),this.decoder=new c(e.encoding),this.encoding=e.encoding)}function _(e){if(i=i||n(6085),!(this instanceof _))return new _(e);var t=this instanceof i;this._readableState=new S(e,this,t),this.readable=!0,e&&("function"===typeof e.read&&(this._read=e.read),"function"===typeof e.destroy&&(this._destroy=e.destroy)),o.call(this)}function x(e,t,n,i,r){h("readableAddChunk",t);var o,u=e._readableState;if(null===t)u.reading=!1,function(e,t){if(h("onEofChunk"),t.ended)return;if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,t.sync?T(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,A(e)))}(e,u);else if(r||(o=function(e,t){var n;i=t,a.isBuffer(i)||i instanceof s||"string"===typeof t||void 0===t||e.objectMode||(n=new m("chunk",["string","Buffer","Uint8Array"],t));var i;return n}(u,t)),o)k(e,o);else if(u.objectMode||t&&t.length>0)if("string"===typeof t||u.objectMode||Object.getPrototypeOf(t)===a.prototype||(t=function(e){return a.from(e)}(t)),i)u.endEmitted?k(e,new w):M(e,u,t,!0);else if(u.ended)k(e,new y);else{if(u.destroyed)return!1;u.reading=!1,u.decoder&&!n?(t=u.decoder.write(t),u.objectMode||0!==t.length?M(e,u,t,!1):E(e,u)):M(e,u,t,!1)}else i||(u.reading=!1,E(e,u));return!u.ended&&(u.length<u.highWaterMark||0===u.length)}function M(e,t,n,i){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",n)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&T(e)),E(e,t)}Object.defineProperty(_.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),_.prototype.destroy=p.destroy,_.prototype._undestroy=p.undestroy,_.prototype._destroy=function(e,t){t(e)},_.prototype.push=function(e,t){var n,i=this._readableState;return i.objectMode?n=!0:"string"===typeof e&&((t=t||i.defaultEncoding)!==i.encoding&&(e=a.from(e,t),t=""),n=!0),x(this,e,t,!1,n)},_.prototype.unshift=function(e){return x(this,e,null,!0,!1)},_.prototype.isPaused=function(){return!1===this._readableState.flowing},_.prototype.setEncoding=function(e){c||(c=n(8570).s);var t=new c(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var i=this._readableState.buffer.head,r="";null!==i;)r+=t.write(i.data),i=i.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var P=1073741824;function R(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!==e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=P?e=P:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function T(e){var t=e._readableState;h("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(h("emitReadable",t.flowing),t.emittedReadable=!0,process.nextTick(A,e))}function A(e){var t=e._readableState;h("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,I(e)}function E(e,t){t.readingMore||(t.readingMore=!0,process.nextTick(O,e,t))}function O(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var n=t.length;if(h("maybeReadMore read 0"),e.read(0),n===t.length)break}t.readingMore=!1}function L(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function B(e){h("readable nexttick read 0"),e.read(0)}function D(e,t){h("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),I(e),t.flowing&&!t.reading&&e.read(0)}function I(e){var t=e._readableState;for(h("flow",t.flowing);t.flowing&&null!==e.read(););}function N(e,t){return 0===t.length?null:(t.objectMode?n=t.buffer.shift():!e||e>=t.length?(n=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):n=t.buffer.consume(e,t.decoder),n);var n}function F(e){var t=e._readableState;h("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,process.nextTick(j,t,e))}function j(e,t){if(h("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var n=t._writableState;(!n||n.autoDestroy&&n.finished)&&t.destroy()}}function z(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}_.prototype.read=function(e){h("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return h("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):T(this),null;if(0===(e=R(e,t))&&t.ended)return 0===t.length&&F(this),null;var i,r=t.needReadable;return h("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&h("length less than watermark",r=!0),t.ended||t.reading?h("reading or ended",r=!1):r&&(h("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=R(n,t))),null===(i=e>0?N(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&F(this)),null!==i&&this.emit("data",i),i},_.prototype._read=function(e){k(this,new b("_read()"))},_.prototype.pipe=function(e,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=e;break;case 1:i.pipes=[i.pipes,e];break;default:i.pipes.push(e)}i.pipesCount+=1,h("pipe count=%d opts=%j",i.pipesCount,t);var o=(!t||!1!==t.end)&&e!==process.stdout&&e!==process.stderr?s:v;function a(t,r){h("onunpipe"),t===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,h("cleanup"),e.removeListener("close",d),e.removeListener("finish",p),e.removeListener("drain",u),e.removeListener("error",f),e.removeListener("unpipe",a),n.removeListener("end",s),n.removeListener("end",v),n.removeListener("data",l),c=!0,!i.awaitDrain||e._writableState&&!e._writableState.needDrain||u())}function s(){h("onend"),e.end()}i.endEmitted?process.nextTick(o):n.once("end",o),e.on("unpipe",a);var u=function(e){return function(){var t=e._readableState;h("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&r(e,"data")&&(t.flowing=!0,I(e))}}(n);e.on("drain",u);var c=!1;function l(t){h("ondata");var r=e.write(t);h("dest.write",r),!1===r&&((1===i.pipesCount&&i.pipes===e||i.pipesCount>1&&-1!==z(i.pipes,e))&&!c&&(h("false write response, pause",i.awaitDrain),i.awaitDrain++),n.pause())}function f(t){h("onerror",t),v(),e.removeListener("error",f),0===r(e,"error")&&k(e,t)}function d(){e.removeListener("finish",p),v()}function p(){h("onfinish"),e.removeListener("close",d),v()}function v(){h("unpipe"),n.unpipe(e)}return n.on("data",l),function(e,t,n){if("function"===typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",f),e.once("close",d),e.once("finish",p),e.emit("pipe",n),i.flowing||(h("pipe resume"),n.resume()),e},_.prototype.unpipe=function(e){var t=this._readableState,n={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,n)),this;if(!e){var i=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var o=0;o<r;o++)i[o].emit("unpipe",this,{hasUnpiped:!1});return this}var a=z(t.pipes,e);return-1===a||(t.pipes.splice(a,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,n)),this},_.prototype.on=function(e,t){var n=o.prototype.on.call(this,e,t),i=this._readableState;return"data"===e?(i.readableListening=this.listenerCount("readable")>0,!1!==i.flowing&&this.resume()):"readable"===e&&(i.endEmitted||i.readableListening||(i.readableListening=i.needReadable=!0,i.flowing=!1,i.emittedReadable=!1,h("on readable",i.length,i.reading),i.length?T(this):i.reading||process.nextTick(B,this))),n},_.prototype.addListener=_.prototype.on,_.prototype.removeListener=function(e,t){var n=o.prototype.removeListener.call(this,e,t);return"readable"===e&&process.nextTick(L,this),n},_.prototype.removeAllListeners=function(e){var t=o.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||process.nextTick(L,this),t},_.prototype.resume=function(){var e=this._readableState;return e.flowing||(h("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,process.nextTick(D,e,t))}(this,e)),e.paused=!1,this},_.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},_.prototype.wrap=function(e){var t=this,n=this._readableState,i=!1;for(var r in e.on("end",(function(){if(h("wrapped end"),n.decoder&&!n.ended){var e=n.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){(h("wrapped data"),n.decoder&&(r=n.decoder.write(r)),!n.objectMode||null!==r&&void 0!==r)&&((n.objectMode||r&&r.length)&&(t.push(r)||(i=!0,e.pause())))})),e)void 0===this[r]&&"function"===typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var o=0;o<C.length;o++)e.on(C[o],this.emit.bind(this,C[o]));return this._read=function(t){h("wrapped _read",t),i&&(i=!1,e.resume())},this},"function"===typeof Symbol&&(_.prototype[Symbol.asyncIterator]=function(){return void 0===l&&(l=n(1218)),l(this)}),Object.defineProperty(_.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(_.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(_.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),_._fromList=N,Object.defineProperty(_.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"===typeof Symbol&&(_.from=function(e,t){return void 0===f&&(f=n(7670)),f(_,e,t)})},4917:function(e,t,n){"use strict";e.exports=c;var i=n(1092).q,r=i.ERR_METHOD_NOT_IMPLEMENTED,o=i.ERR_MULTIPLE_CALLBACK,a=i.ERR_TRANSFORM_ALREADY_TRANSFORMING,s=i.ERR_TRANSFORM_WITH_LENGTH_0,h=n(6085);function u(e,t){var n=this._transformState;n.transforming=!1;var i=n.writecb;if(null===i)return this.emit("error",new o);n.writechunk=null,n.writecb=null,null!=t&&this.push(t),i(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function c(e){if(!(this instanceof c))return new c(e);h.call(this,e),this._transformState={afterTransform:u.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"===typeof e.transform&&(this._transform=e.transform),"function"===typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",l)}function l(){var e=this;"function"!==typeof this._flush||this._readableState.destroyed?f(this,null,null):this._flush((function(t,n){f(e,t,n)}))}function f(e,t,n){if(t)return e.emit("error",t);if(null!=n&&e.push(n),e._writableState.length)throw new s;if(e._transformState.transforming)throw new a;return e.push(null)}n(273)(c,h),c.prototype.push=function(e,t){return this._transformState.needTransform=!1,h.prototype.push.call(this,e,t)},c.prototype._transform=function(e,t,n){n(new r("_transform()"))},c.prototype._write=function(e,t,n){var i=this._transformState;if(i.writecb=n,i.writechunk=e,i.writeencoding=t,!i.transforming){var r=this._readableState;(i.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},c.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},c.prototype._destroy=function(e,t){h.prototype._destroy.call(this,e,(function(e){t(e)}))}},7423:function(e,t,n){"use strict";function i(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,n){var i=e.entry;e.entry=null;for(;i;){var r=i.callback;t.pendingcb--,r(n),i=i.next}t.corkedRequestsFree.next=e}(t,e)}}var r;e.exports=_,_.WritableState=S;var o={deprecate:n(9043)},a=n(8747),s=n(918).Buffer,h=n.g.Uint8Array||function(){};var u,c=n(6617),l=n(5999).getHighWaterMark,f=n(1092).q,d=f.ERR_INVALID_ARG_TYPE,p=f.ERR_METHOD_NOT_IMPLEMENTED,v=f.ERR_MULTIPLE_CALLBACK,g=f.ERR_STREAM_CANNOT_PIPE,m=f.ERR_STREAM_DESTROYED,y=f.ERR_STREAM_NULL_VALUES,b=f.ERR_STREAM_WRITE_AFTER_END,w=f.ERR_UNKNOWN_ENCODING,k=c.errorOrDestroy;function C(){}function S(e,t,o){r=r||n(6085),e=e||{},"boolean"!==typeof o&&(o=t instanceof r),this.objectMode=!!e.objectMode,o&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=l(this,e,"writableHighWaterMark",o),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var a=!1===e.decodeStrings;this.decodeStrings=!a,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n=e._writableState,i=n.sync,r=n.writecb;if("function"!==typeof r)throw new v;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(n),t)!function(e,t,n,i,r){--t.pendingcb,n?(process.nextTick(r,i),process.nextTick(A,e,t),e._writableState.errorEmitted=!0,k(e,i)):(r(i),e._writableState.errorEmitted=!0,k(e,i),A(e,t))}(e,n,i,t,r);else{var o=R(n)||e.destroyed;o||n.corked||n.bufferProcessing||!n.bufferedRequest||P(e,n),i?process.nextTick(M,e,n,o,r):M(e,n,o,r)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new i(this)}function _(e){var t=this instanceof(r=r||n(6085));if(!t&&!u.call(_,this))return new _(e);this._writableState=new S(e,this,t),this.writable=!0,e&&("function"===typeof e.write&&(this._write=e.write),"function"===typeof e.writev&&(this._writev=e.writev),"function"===typeof e.destroy&&(this._destroy=e.destroy),"function"===typeof e.final&&(this._final=e.final)),a.call(this)}function x(e,t,n,i,r,o,a){t.writelen=i,t.writecb=a,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new m("write")):n?e._writev(r,t.onwrite):e._write(r,o,t.onwrite),t.sync=!1}function M(e,t,n,i){n||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,i(),A(e,t)}function P(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var r=t.bufferedRequestCount,o=new Array(r),a=t.corkedRequestsFree;a.entry=n;for(var s=0,h=!0;n;)o[s]=n,n.isBuf||(h=!1),n=n.next,s+=1;o.allBuffers=h,x(e,t,!0,t.length,o,"",a.finish),t.pendingcb++,t.lastBufferedRequest=null,a.next?(t.corkedRequestsFree=a.next,a.next=null):t.corkedRequestsFree=new i(t),t.bufferedRequestCount=0}else{for(;n;){var u=n.chunk,c=n.encoding,l=n.callback;if(x(e,t,!1,t.objectMode?1:u.length,u,c,l),n=n.next,t.bufferedRequestCount--,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequest=n,t.bufferProcessing=!1}function R(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function T(e,t){e._final((function(n){t.pendingcb--,n&&k(e,n),t.prefinished=!0,e.emit("prefinish"),A(e,t)}))}function A(e,t){var n=R(t);if(n&&(function(e,t){t.prefinished||t.finalCalled||("function"!==typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,process.nextTick(T,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var i=e._readableState;(!i||i.autoDestroy&&i.endEmitted)&&e.destroy()}return n}n(273)(_,a),S.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(S.prototype,"buffer",{get:o.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"===typeof Symbol&&Symbol.hasInstance&&"function"===typeof Function.prototype[Symbol.hasInstance]?(u=Function.prototype[Symbol.hasInstance],Object.defineProperty(_,Symbol.hasInstance,{value:function(e){return!!u.call(this,e)||this===_&&(e&&e._writableState instanceof S)}})):u=function(e){return e instanceof this},_.prototype.pipe=function(){k(this,new g)},_.prototype.write=function(e,t,n){var i,r=this._writableState,o=!1,a=!r.objectMode&&(i=e,s.isBuffer(i)||i instanceof h);return a&&!s.isBuffer(e)&&(e=function(e){return s.from(e)}(e)),"function"===typeof t&&(n=t,t=null),a?t="buffer":t||(t=r.defaultEncoding),"function"!==typeof n&&(n=C),r.ending?function(e,t){var n=new b;k(e,n),process.nextTick(t,n)}(this,n):(a||function(e,t,n,i){var r;return null===n?r=new y:"string"===typeof n||t.objectMode||(r=new d("chunk",["string","Buffer"],n)),!r||(k(e,r),process.nextTick(i,r),!1)}(this,r,e,n))&&(r.pendingcb++,o=function(e,t,n,i,r,o){if(!n){var a=function(e,t,n){e.objectMode||!1===e.decodeStrings||"string"!==typeof t||(t=s.from(t,n));return t}(t,i,r);i!==a&&(n=!0,r="buffer",i=a)}var h=t.objectMode?1:i.length;t.length+=h;var u=t.length<t.highWaterMark;u||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:i,encoding:r,isBuf:n,callback:o,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else x(e,t,!1,h,i,r,o);return u}(this,r,a,e,t,n)),o},_.prototype.cork=function(){this._writableState.corked++},_.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||P(this,e))},_.prototype.setDefaultEncoding=function(e){if("string"===typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new w(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(_.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(_.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),_.prototype._write=function(e,t,n){n(new p("_write()"))},_.prototype._writev=null,_.prototype.end=function(e,t,n){var i=this._writableState;return"function"===typeof e?(n=e,e=null,t=null):"function"===typeof t&&(n=t,t=null),null!==e&&void 0!==e&&this.write(e,t),i.corked&&(i.corked=1,this.uncork()),i.ending||function(e,t,n){t.ending=!0,A(e,t),n&&(t.finished?process.nextTick(n):e.once("finish",n));t.ended=!0,e.writable=!1}(this,i,n),this},Object.defineProperty(_.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(_.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),_.prototype.destroy=c.destroy,_.prototype._undestroy=c.undestroy,_.prototype._destroy=function(e,t){t(e)}},1218:function(e,t,n){"use strict";var i;function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var o=n(4297),a=Symbol("lastResolve"),s=Symbol("lastReject"),h=Symbol("error"),u=Symbol("ended"),c=Symbol("lastPromise"),l=Symbol("handlePromise"),f=Symbol("stream");function d(e,t){return{value:e,done:t}}function p(e){var t=e[a];if(null!==t){var n=e[f].read();null!==n&&(e[c]=null,e[a]=null,e[s]=null,t(d(n,!1)))}}function v(e){process.nextTick(p,e)}var g=Object.getPrototypeOf((function(){})),m=Object.setPrototypeOf((r(i={get stream(){return this[f]},next:function(){var e=this,t=this[h];if(null!==t)return Promise.reject(t);if(this[u])return Promise.resolve(d(void 0,!0));if(this[f].destroyed)return new Promise((function(t,n){process.nextTick((function(){e[h]?n(e[h]):t(d(void 0,!0))}))}));var n,i=this[c];if(i)n=new Promise(function(e,t){return function(n,i){e.then((function(){t[u]?n(d(void 0,!0)):t[l](n,i)}),i)}}(i,this));else{var r=this[f].read();if(null!==r)return Promise.resolve(d(r,!1));n=new Promise(this[l])}return this[c]=n,n}},Symbol.asyncIterator,(function(){return this})),r(i,"return",(function(){var e=this;return new Promise((function(t,n){e[f].destroy(null,(function(e){e?n(e):t(d(void 0,!0))}))}))})),i),g);e.exports=function(e){var t,n=Object.create(m,(r(t={},f,{value:e,writable:!0}),r(t,a,{value:null,writable:!0}),r(t,s,{value:null,writable:!0}),r(t,h,{value:null,writable:!0}),r(t,u,{value:e._readableState.endEmitted,writable:!0}),r(t,l,{value:function(e,t){var i=n[f].read();i?(n[c]=null,n[a]=null,n[s]=null,e(d(i,!1))):(n[a]=e,n[s]=t)},writable:!0}),t));return n[c]=null,o(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=n[s];return null!==t&&(n[c]=null,n[a]=null,n[s]=null,t(e)),void(n[h]=e)}var i=n[a];null!==i&&(n[c]=null,n[a]=null,n[s]=null,i(d(void 0,!0))),n[u]=!0})),e.on("readable",v.bind(null,n)),n}},5489:function(e,t,n){"use strict";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=n(918).Buffer,s=n(2361).inspect,h=s&&s.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,n,u;return t=e,n=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n}},{key:"concat",value:function(e){if(0===this.length)return a.alloc(0);for(var t,n,i,r=a.allocUnsafe(e>>>0),o=this.head,s=0;o;)t=o.data,n=r,i=s,a.prototype.copy.call(t,n,i),s+=o.data.length,o=o.next;return r}},{key:"consume",value:function(e,t){var n;return e<this.head.data.length?(n=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):n=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),n}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,n=1,i=t.data;for(e-=i.length;t=t.next;){var r=t.data,o=e>r.length?r.length:e;if(o===r.length?i+=r:i+=r.slice(0,e),0===(e-=o)){o===r.length?(++n,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(o));break}++n}return this.length-=n,i}},{key:"_getBuffer",value:function(e){var t=a.allocUnsafe(e),n=this.head,i=1;for(n.data.copy(t),e-=n.data.length;n=n.next;){var r=n.data,o=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,o),0===(e-=o)){o===r.length?(++i,n.next?this.head=n.next:this.head=this.tail=null):(this.head=n,n.data=r.slice(o));break}++i}return this.length-=i,t}},{key:h,value:function(e,t){return s(this,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],n&&o(t.prototype,n),u&&o(t,u),e}()},6617:function(e){"use strict";function t(e,t){i(e,t),n(e)}function n(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function i(e,t){e.emit("error",t)}e.exports={destroy:function(e,r){var o=this,a=this._readableState&&this._readableState.destroyed,s=this._writableState&&this._writableState.destroyed;return a||s?(r?r(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,process.nextTick(i,this,e)):process.nextTick(i,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!r&&e?o._writableState?o._writableState.errorEmitted?process.nextTick(n,o):(o._writableState.errorEmitted=!0,process.nextTick(t,o,e)):process.nextTick(t,o,e):r?(process.nextTick(n,o),r(e)):process.nextTick(n,o)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var n=e._readableState,i=e._writableState;n&&n.autoDestroy||i&&i.autoDestroy?e.destroy(t):e.emit("error",t)}}},4297:function(e,t,n){"use strict";var i=n(1092).q.ERR_STREAM_PREMATURE_CLOSE;function r(){}e.exports=function e(t,n,o){if("function"===typeof n)return e(t,null,n);n||(n={}),o=function(e){var t=!1;return function(){if(!t){t=!0;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];e.apply(this,i)}}}(o||r);var a=n.readable||!1!==n.readable&&t.readable,s=n.writable||!1!==n.writable&&t.writable,h=function(){t.writable||c()},u=t._writableState&&t._writableState.finished,c=function(){s=!1,u=!0,a||o.call(t)},l=t._readableState&&t._readableState.endEmitted,f=function(){a=!1,l=!0,s||o.call(t)},d=function(e){o.call(t,e)},p=function(){var e;return a&&!l?(t._readableState&&t._readableState.ended||(e=new i),o.call(t,e)):s&&!u?(t._writableState&&t._writableState.ended||(e=new i),o.call(t,e)):void 0},v=function(){t.req.on("finish",c)};return!function(e){return e.setHeader&&"function"===typeof e.abort}(t)?s&&!t._writableState&&(t.on("end",h),t.on("close",h)):(t.on("complete",c),t.on("abort",p),t.req?v():t.on("request",v)),t.on("end",f),t.on("finish",c),!1!==n.error&&t.on("error",d),t.on("close",p),function(){t.removeListener("complete",c),t.removeListener("abort",p),t.removeListener("request",v),t.req&&t.req.removeListener("finish",c),t.removeListener("end",h),t.removeListener("close",h),t.removeListener("finish",c),t.removeListener("end",f),t.removeListener("error",d),t.removeListener("close",p)}}},7670:function(e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},6545:function(e,t,n){"use strict";var i;var r=n(1092).q,o=r.ERR_MISSING_ARGS,a=r.ERR_STREAM_DESTROYED;function s(e){if(e)throw e}function h(e,t,r,o){o=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(o);var s=!1;e.on("close",(function(){s=!0})),void 0===i&&(i=n(4297)),i(e,{readable:t,writable:r},(function(e){if(e)return o(e);s=!0,o()}));var h=!1;return function(t){if(!s&&!h)return h=!0,function(e){return e.setHeader&&"function"===typeof e.abort}(e)?e.abort():"function"===typeof e.destroy?e.destroy():void o(t||new a("pipe"))}}function u(e){e()}function c(e,t){return e.pipe(t)}function l(e){return e.length?"function"!==typeof e[e.length-1]?s:e.pop():s}e.exports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var i,r=l(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new o("streams");var a=t.map((function(e,n){var o=n<t.length-1;return h(e,o,n>0,(function(e){i||(i=e),e&&a.forEach(u),o||(a.forEach(u),r(i))}))}));return t.reduce(c)}},5999:function(e,t,n){"use strict";var i=n(1092).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,n,r){var o=function(e,t,n){return null!=e.highWaterMark?e.highWaterMark:t?e[n]:null}(t,r,n);if(null!=o){if(!isFinite(o)||Math.floor(o)!==o||o<0)throw new i(r?n:"highWaterMark",o);return Math.floor(o)}return e.objectMode?16:16384}}},8747:function(e,t,n){e.exports=n(8041).EventEmitter},1881:function(e,t,n){(t=e.exports=n(6405)).Stream=t,t.Readable=t,t.Writable=n(7423),t.Duplex=n(6085),t.Transform=n(4917),t.PassThrough=n(9543),t.finished=n(4297),t.pipeline=n(6545)},5734:function(e,t,n){var i=n(918),r=i.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(o(i,t),t.Buffer=a),o(r,a),a.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},a.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"===typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},a.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},8570:function(e,t,n){"use strict";var i=n(9857).Buffer,r=i.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function o(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!==typeof t&&(i.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=h,this.end=u,t=4;break;case"utf8":this.fillLast=s,t=4;break;case"base64":this.text=c,this.end=l,t=3;break;default:return this.write=f,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=i.allocUnsafe(t)}function a(e){return e<=127?0:e>>5===6?2:e>>4===14?3:e>>3===30?4:e>>6===2?-1:-2}function s(e){var t=this.lastTotal-this.lastNeed,n=function(e,t,n){if(128!==(192&t[0]))return e.lastNeed=0,"\\ufffd";if(e.lastNeed>1&&t.length>1){if(128!==(192&t[1]))return e.lastNeed=1,"\\ufffd";if(e.lastNeed>2&&t.length>2&&128!==(192&t[2]))return e.lastNeed=2,"\\ufffd"}}(this,e);return void 0!==n?n:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function h(e,t){if((e.length-t)%2===0){var n=e.toString("utf16le",t);if(n){var i=n.charCodeAt(n.length-1);if(i>=55296&&i<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function u(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,n)}return t}function c(e,t){var n=(e.length-t)%3;return 0===n?e.toString("base64",t):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-n))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function f(e){return e.toString(this.encoding)}function d(e){return e&&e.length?this.write(e):""}t.s=o,o.prototype.write=function(e){if(0===e.length)return"";var t,n;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<e.length?t?t+this.text(e,n):this.text(e,n):t||""},o.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"\\ufffd":t},o.prototype.text=function(e,t){var n=function(e,t,n){var i=t.length-1;if(i<n)return 0;var r=a(t[i]);if(r>=0)return r>0&&(e.lastNeed=r-1),r;if(--i<n||-2===r)return 0;if((r=a(t[i]))>=0)return r>0&&(e.lastNeed=r-2),r;if(--i<n||-2===r)return 0;if((r=a(t[i]))>=0)return r>0&&(2===r?r=0:e.lastNeed=r-3),r;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=n;var i=e.length-(n-this.lastNeed);return e.copy(this.lastChar,0,i),e.toString("utf8",t,i)},o.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},9857:function(e,t,n){var i=n(918),r=i.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function a(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=i:(o(i,t),t.Buffer=a),a.prototype=Object.create(r.prototype),o(r,a),a.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},a.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var i=r(e);return void 0!==t?"string"===typeof n?i.fill(t,n):i.fill(t):i.fill(0),i},a.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r(e)},a.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return i.SlowBuffer(e)}},9043:function(e,t,n){function i(e){try{if(!n.g.localStorage)return!1}catch(i){return!1}var t=n.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation")?console.trace(t):console.warn(t),n=!0}return e.apply(this,arguments)}}},5882:function(e,t,n){var i=n(3895);function r(e){for(var t,n,r=0,o=e.length,a=0;a<e.length;){for(t=e[a],n=0;a<o&&e[a]===t;)++a,++n;r+=i.log2(n)/7|0,r+=i.log2(t>>>0)/7|0,r+=2}return r}t.size=r,t.encode=function(e,t){t||(t=new Uint8Array(r(e)));for(var n,i,o=0,a=t.length,s=0;s<e.length;){for(n=e[s],i=0;s<e.length&&e[s]===n;)++s,++i;for(;o<a&&i>=128;)t[o++]=128+(127&i),i>>>=7;if(o>=a)throw new Error("RLE buffer overflow");for(t[o++]=i,n>>>=0;o<a&&n>=128;)t[o++]=128+(127&n),n>>>=7;if(o>=a)throw new Error("RLE buffer overflow");t[o++]=n}return t},t.decode=function(e,t){for(var n,i,r,o,a=t.length,s=e.length,h=0,u=0;u<s;){for(n=0,i=0;u<s&&e[u]>=128;)n+=(127&e[u++])<<i,i+=7;if(n+=e[u++]<<i,u>=s)throw new Error("RLE buffer underrun");if(h+n>a)throw new Error("Chunk buffer overflow");for(r=0,i=0;u<s&&e[u]>=128;)r+=(127&e[u++])<<i,i+=7;if(u>=s)throw new Error("RLE buffer underrun");for(r+=e[u++]<<i,o=0;o<n;++o)t[h++]=r}return t}},3895:function(e,t){"use strict";function n(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1)&&!!e},t.log2=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=n,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var i=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,i=t,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;e[t]=i<<r&255}}(i),t.reverse=function(e){return i[255&e]<<24|i[e>>>8&255]<<16|i[e>>>16&255]<<8|i[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},2361:function(){},4616:function(){},3897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i},e.exports.__esModule=!0,e.exports.default=e.exports},5372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},3405:function(e,t,n){var i=n(3897);e.exports=function(e){if(Array.isArray(e))return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},6690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},9728:function(e){function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.exports=function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},4704:function(e,t,n){var i=n(6116);e.exports=function(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=i(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,h=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){h=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(h)throw a}}}},e.exports.__esModule=!0,e.exports.default=e.exports},9498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},8872:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(h){s=!0,r=h}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports},2218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},2281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},7061:function(e,t,n){var i=n(8698).default;function r(){"use strict";e.exports=r=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,o=n.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",h=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(T){c=function(e,t,n){return e[t]=n}}function l(e,t,n,i){var r=t&&t.prototype instanceof p?t:p,o=Object.create(r.prototype),a=new M(i||[]);return o._invoke=function(e,t,n){var i="suspendedStart";return function(r,o){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===r)throw o;return R()}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var s=S(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var h=f(e,t,n);if("normal"===h.type){if(i=n.done?"completed":"suspendedYield",h.arg===d)continue;return{value:h.arg,done:n.done}}"throw"===h.type&&(i="completed",n.method="throw",n.arg=h.arg)}}}(e,n,a),o}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(T){return{type:"throw",arg:T}}}t.wrap=l;var d={};function p(){}function v(){}function g(){}var m={};c(m,s,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(P([])));b&&b!==n&&o.call(b,s)&&(m=b);var w=g.prototype=p.prototype=Object.create(m);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(r,a,s,h){var u=f(e[r],e,a);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==i(l)&&o.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,s,h)}),(function(e){n("throw",e,s,h)})):t.resolve(l).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,h)}))}h(u.arg)}var r;this._invoke=function(e,i){function o(){return new t((function(t,r){n(e,i,t,r)}))}return r=r?r.then(o,o):o()}}function S(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a \'throw\' method")}return d}var i=f(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,d;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function x(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function P(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(o.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:R}}function R(){return{value:void 0,done:!0}}return v.prototype=g,c(w,"constructor",g),c(g,"constructor",v),v.displayName=c(g,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,u,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},k(C.prototype),c(C.prototype,h,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,i,r,o){void 0===o&&(o=Promise);var a=new C(l(e,n,i,r),o);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},k(w),c(w,u,"Generator"),c(w,s,(function(){return this})),c(w,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},t.values=P,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(x),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],a=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var s=o.call(r,"catchLoc"),h=o.call(r,"finallyLoc");if(s&&h){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!h)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),x(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;x(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports},7424:function(e,t,n){var i=n(5372),r=n(8872),o=n(6116),a=n(2218);e.exports=function(e,t){return i(e)||r(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,n){var i=n(3405),r=n(9498),o=n(6116),a=n(2281);e.exports=function(e){return i(e)||r(e)||o(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},8698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},6116:function(e,t,n){var i=n(3897);e.exports=function(e,t){if(e){if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},4687:function(e,t,n){var i=n(7061)();e.exports=i;try{regeneratorRuntime=i}catch(r){"object"===typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function t(t,n){if(t){if("string"===typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}function i(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(h){s=!0,r=h}finally{try{a||null==n.return||n.return()}finally{if(s)throw r}}return o}}(e,n)||t(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,n){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=t(e))||n&&e&&"number"===typeof e.length){i&&(e=i);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,h=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){h=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(h)throw a}}}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(n){return function(t){if(Array.isArray(t))return e(t)}(n)||function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||t(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var u=.5*(Math.sqrt(3)-1),c=(3-Math.sqrt(3))/6,l=1/6,f=(Math.sqrt(5)-1)/4,d=(5-Math.sqrt(5))/20,p=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),v=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),g=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;o(this,e);var n="function"==typeof t?t:b(t);this.p=y(n),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}return s(e,[{key:"noise2D",value:function(e,t){var n,i,r=this.permMod12,o=this.perm,a=0,s=0,h=0,l=(e+t)*u,f=Math.floor(e+l),d=Math.floor(t+l),v=(f+d)*c,g=e-(f-v),m=t-(d-v);g>m?(n=1,i=0):(n=0,i=1);var y=g-n+c,b=m-i+c,w=g-1+2*c,k=m-1+2*c,C=255&f,S=255&d,_=.5-g*g-m*m;if(_>=0){var x=3*r[C+o[S]];a=(_*=_)*_*(p[x]*g+p[x+1]*m)}var M=.5-y*y-b*b;if(M>=0){var P=3*r[C+n+o[S+i]];s=(M*=M)*M*(p[P]*y+p[P+1]*b)}var R=.5-w*w-k*k;if(R>=0){var T=3*r[C+1+o[S+1]];h=(R*=R)*R*(p[T]*w+p[T+1]*k)}return 70*(a+s+h)}},{key:"noise3D",value:function(e,t,n){var i,r,o,a,s,h,u,c,f,d,v=this.permMod12,g=this.perm,m=.3333333333333333*(e+t+n),y=Math.floor(e+m),b=Math.floor(t+m),w=Math.floor(n+m),k=(y+b+w)*l,C=e-(y-k),S=t-(b-k),_=n-(w-k);C>=S?S>=_?(s=1,h=0,u=0,c=1,f=1,d=0):C>=_?(s=1,h=0,u=0,c=1,f=0,d=1):(s=0,h=0,u=1,c=1,f=0,d=1):S<_?(s=0,h=0,u=1,c=0,f=1,d=1):C<_?(s=0,h=1,u=0,c=0,f=1,d=1):(s=0,h=1,u=0,c=1,f=1,d=0);var x=C-s+l,M=S-h+l,P=_-u+l,R=C-c+2*l,T=S-f+2*l,A=_-d+2*l,E=C-1+.5,O=S-1+.5,L=_-1+.5,B=255&y,D=255&b,I=255&w,N=.6-C*C-S*S-_*_;if(N<0)i=0;else{var F=3*v[B+g[D+g[I]]];i=(N*=N)*N*(p[F]*C+p[F+1]*S+p[F+2]*_)}var j=.6-x*x-M*M-P*P;if(j<0)r=0;else{var z=3*v[B+s+g[D+h+g[I+u]]];r=(j*=j)*j*(p[z]*x+p[z+1]*M+p[z+2]*P)}var H=.6-R*R-T*T-A*A;if(H<0)o=0;else{var q=3*v[B+c+g[D+f+g[I+d]]];o=(H*=H)*H*(p[q]*R+p[q+1]*T+p[q+2]*A)}var U=.6-E*E-O*O-L*L;if(U<0)a=0;else{var G=3*v[B+1+g[D+1+g[I+1]]];a=(U*=U)*U*(p[G]*E+p[G+1]*O+p[G+2]*L)}return 32*(i+r+o+a)}},{key:"noise4D",value:function(e,t,n,i){var r,o,a,s,h,u=this.perm,c=(e+t+n+i)*f,l=Math.floor(e+c),p=Math.floor(t+c),g=Math.floor(n+c),m=Math.floor(i+c),y=(l+p+g+m)*d,b=e-(l-y),w=t-(p-y),k=n-(g-y),C=i-(m-y),S=0,_=0,x=0,M=0;b>w?S++:_++,b>k?S++:x++,b>C?S++:M++,w>k?_++:x++,w>C?_++:M++,k>C?x++:M++;var P=S>=3?1:0,R=_>=3?1:0,T=x>=3?1:0,A=M>=3?1:0,E=S>=2?1:0,O=_>=2?1:0,L=x>=2?1:0,B=M>=2?1:0,D=S>=1?1:0,I=_>=1?1:0,N=x>=1?1:0,F=M>=1?1:0,j=b-P+d,z=w-R+d,H=k-T+d,q=C-A+d,U=b-E+2*d,G=w-O+2*d,W=k-L+2*d,Y=C-B+2*d,V=b-D+3*d,K=w-I+3*d,J=k-N+3*d,X=C-F+3*d,Z=b-1+4*d,$=w-1+4*d,Q=k-1+4*d,ee=C-1+4*d,te=255&l,ne=255&p,ie=255&g,re=255&m,oe=.6-b*b-w*w-k*k-C*C;if(oe<0)r=0;else{var ae=u[te+u[ne+u[ie+u[re]]]]%32*4;r=(oe*=oe)*oe*(v[ae]*b+v[ae+1]*w+v[ae+2]*k+v[ae+3]*C)}var se=.6-j*j-z*z-H*H-q*q;if(se<0)o=0;else{var he=u[te+P+u[ne+R+u[ie+T+u[re+A]]]]%32*4;o=(se*=se)*se*(v[he]*j+v[he+1]*z+v[he+2]*H+v[he+3]*q)}var ue=.6-U*U-G*G-W*W-Y*Y;if(ue<0)a=0;else{var ce=u[te+E+u[ne+O+u[ie+L+u[re+B]]]]%32*4;a=(ue*=ue)*ue*(v[ce]*U+v[ce+1]*G+v[ce+2]*W+v[ce+3]*Y)}var le=.6-V*V-K*K-J*J-X*X;if(le<0)s=0;else{var fe=u[te+D+u[ne+I+u[ie+N+u[re+F]]]]%32*4;s=(le*=le)*le*(v[fe]*V+v[fe+1]*K+v[fe+2]*J+v[fe+3]*X)}var de=.6-Z*Z-$*$-Q*Q-ee*ee;if(de<0)h=0;else{var pe=u[te+1+u[ne+1+u[ie+1+u[re+1]]]]%32*4;h=(de*=de)*de*(v[pe]*Z+v[pe+1]*$+v[pe+2]*Q+v[pe+3]*ee)}return 27*(r+o+a+s+h)}}]),e}(),m=g;function y(e){for(var t=new Uint8Array(256),n=0;n<256;n++)t[n]=n;for(var i=0;i<255;i++){var r=i+~~(e()*(256-i)),o=t[i];t[i]=t[r],t[r]=o}return t}function b(e){var t=0,n=0,i=0,r=1,o=function(){var e=4022871197;return function(t){t=t.toString();for(var n=0;n<t.length;n++){var i=.02519603282416938*(e+=t.charCodeAt(n));i-=e=i>>>0,e=(i*=e)>>>0,e+=4294967296*(i-=e)}return 2.3283064365386963e-10*(e>>>0)}}();return t=o(" "),n=o(" "),i=o(" "),(t-=o(e))<0&&(t+=1),(n-=o(e))<0&&(n+=1),(i-=o(e))<0&&(i+=1),function(){var e=2091639*t+2.3283064365386963e-10*r;return t=n,n=i,i=e-(r=0|e)}}var w={seaLevel:0,bedrockLevel:-100},k=-1e4,C=-1e4,S=-1e4,_=n(7786);function x(e,t,n){return Math.abs(e[0]-t)+Math.abs(e[1]-n)}function M(e,t){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function P(e,t,n){var i=e[0]-t,r=e[1]-n;return i*i+r*r}function R(e,t,n){var i=e[0]-t,r=e[1]-n;return Math.sqrt(i*i+r*r)}function T(e,t,n){var i,r,o,a=M(t,n),s=((e[0]-t[0])*(n[0]-t[0])+(e[1]-t[1])*(n[1]-t[1]))/a;return s<0?(i=t[0],r=t[1],o=0):s>1?(i=n[0],r=n[1],o=1):(i=t[0]+s*(n[0]-t[0]),r=t[1]+s*(n[1]-t[1]),o=s),{dist:R(e,i,r),fracAlong:o,lineSegmentLength:Math.sqrt(a)}}function A(e,t,n){var i=M(t,n),r=((e[0]-t[0])*(n[0]-t[0])+(e[1]-t[1])*(n[1]-t[1]))/i;return R(e,t[0]+r*(n[0]-t[0]),t[1]+r*(n[1]-t[1]))}function E(e,t,n,i,r){for(var o=[],a=e-r;a<e+i+r;++a)for(var s=t-r;s<t+i+r;++s)o.push([n.getOctaves(a,s),n.getOctaves(a+430,s-330)]);return o}function O(e,t,n,i,r){return n[(e+r)*(i+2*r)+(t+r)]}function L(e){if(Math.abs(e[0])<1e-4)e[0]=0,e[1]=1;else{var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);e[0]=e[0]/t,e[1]=e[1]/t}}function B(e){var t,n=0,i=r(e.customOctaves);try{for(i.s();!(t=i.n()).done;){n+=t.value.amplitude}}catch(o){i.e(o)}finally{i.f()}return n}var D=function(){function e(t,n){o(this,e),this.customOctaves=void 0,this._simplexes=[],console.assert(void 0!==n,"Seed must be defined"),this.customOctaves=t;for(var i=0;i<t.length;i++)this._simplexes.push(new m("".concat(n).concat(i)))}return s(e,[{key:"getOctaves",value:function(e,t){for(var n=0,i=0;i<this.customOctaves.length;i++){var r=this.customOctaves[i],o=r.amplitude,a=r.frequency;n+=this._simplexes[i].noise2D(e*a,t*a)*o}return n}}]),e}(),I=function(){function e(t,n,i){o(this,e),this.customOctaves=void 0,this._simplexes=[],this.remainingAmplitudes=void 0,this.threshold=void 0,console.assert(void 0!==i,"Seed must be defined"),this.customOctaves=t,this.threshold=n;for(var r=0;r<t.length;r++)this._simplexes.push(new m("".concat(i).concat(r)));this.remainingAmplitudes=new Array(t.length);for(var a=0,s=this.remainingAmplitudes.length-1;s>=0;s--)a+=this.customOctaves[s].amplitude,this.remainingAmplitudes[s]=a}return s(e,[{key:"getOctaves",value:function(e,t){for(var n=0,i=0;i<this.customOctaves.length;i++){if(n-this.remainingAmplitudes[i]>this.threshold.high||n+this.remainingAmplitudes[i]<this.threshold.low)return S;var r=this.customOctaves[i],o=r.amplitude,a=r.frequency;n+=this._simplexes[i].noise2D(e*a,t*a)*o}return n}}]),e}(),N=function(){function e(t){o(this,e),this.a=void 0;for(var n=2166136261,i=0;i<t.length;i++)n=Math.imul(n^t.charCodeAt(i),16777619);this.a=n}return s(e,[{key:"next",value:function(){var e=this.a+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}]),e}(),F=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o(this,e),this.array=void 0,this.chunkBottomLeft=void 0,this.needOutsideChunkDist=void 0,this.chunkBottomLeft=n,this.needOutsideChunkDist=i;var r=t+2*i;this.array=_(new Int16Array(r*r),[r,r])}return s(e,[{key:"set",value:function(e,t,n){this.array.set(e-this.chunkBottomLeft[0]+this.needOutsideChunkDist,t-this.chunkBottomLeft[1]+this.needOutsideChunkDist,n)}},{key:"get",value:function(e,t){return this.array.get(e-this.chunkBottomLeft[0]+this.needOutsideChunkDist,t-this.chunkBottomLeft[1]+this.needOutsideChunkDist)}}]),e}(),j=function(){function e(t,n,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;o(this,e),this.array=void 0,this.chunkBottomLeft=void 0,this.needOutsideChunkDist=void 0,this.chunkBottomLeft=n,this.needOutsideChunkDist=a;var s=t+2*a;this.array=_(new Int16Array(s*s*i*r),[s,s,i,r])}return s(e,[{key:"set",value:function(e,t,n,i,r){this.array.set(e-this.chunkBottomLeft[0]+this.needOutsideChunkDist,t-this.chunkBottomLeft[1]+this.needOutsideChunkDist,n,i,r)}},{key:"get",value:function(e,t,n,i){return this.array.get(e-this.chunkBottomLeft[0]+this.needOutsideChunkDist,t-this.chunkBottomLeft[1]+this.needOutsideChunkDist,n,i)}},{key:"fill",value:function(e){for(var t=0;t<this.array.shape[0];t++)for(var n=0;n<this.array.shape[1];n++)for(var i=0;i<this.array.shape[2];i++)for(var r=0;r<this.array.shape[3];r++)this.array.set(t,n,i,r,e)}}]),e}(),z=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;o(this,e),this.array=void 0,this.chunkBottomLeft=void 0,this.needOutsideChunkDist=void 0,this.chunkBottomLeft=n,this.needOutsideChunkDist=i;var r=t+2*i,a=new Array(r*r);this.array=_(a,[r,r])}return s(e,[{key:"set",value:function(e,t,n){this.array.set(e-this.chunkBottomLeft[0]+this.needOutsideChunkDist,t-this.chunkBottomLeft[1]+this.needOutsideChunkDist,n)}},{key:"get",value:function(e,t){return this.array.get(e-this.chunkBottomLeft[0]+this.needOutsideChunkDist,t-this.chunkBottomLeft[1]+this.needOutsideChunkDist)}}]),e}(),H=n(8915),q=n.n(H),U=n(189),G=n.n(U),W=function(){function e(t,n,i,r,a,s){var h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]?arguments[8]:void 0;if(o(this,e),this.minDist=void 0,this.variableDensitySettings=void 0,this.gridSize=void 0,this.cachedCells=void 0,this._tempCellCoord=[0,0],this.useIsPoint=void 0,this.useKthClosestPoint=void 0,this.seed=void 0,this.useJitteredGrid=void 0,this.customCellGap=void 0,this.mostRecentlyAccessedCell=null,console.assert(Number.isInteger(t)),this.cachedCells=new(G())({max:Ae()?100:50,ttl:6e4,updateAgeOnGet:!0}),this.minDist=t,this.variableDensitySettings=h,this.customCellGap=c,this.useJitteredGrid=u,this.gridSize=Math.floor(Math.sqrt(a*Math.pow(t,2))),u){var l=this.gridSize%t;0!==l&&(this.gridSize+=t-l)}else{var f=this.gridSize%s;0!==f&&(this.gridSize+=s-f)}this.useIsPoint=n,this.useKthClosestPoint=i,this.seed=r}return s(e,[{key:"isPoint",value:function(e,t){var n=this.getCellCoordFromGlobalCoord(e,t);return!!this.getCell(n[0],n[1]).pointsSet.has("".concat(e,"|").concat(t))}},{key:"getClosestPoint",value:function(e,t){var n,i=this.getCellCoordFromGlobalCoord(e,t),o=this.getCell(i[0],i[1]),a=[0,0],s=1e4,h=r(this._getPointsSurroundingCell(i,o));try{for(h.s();!(n=h.n()).done;){var u=n.value,c=R(u,e,t);c<s&&(a=u,s=c)}}catch(l){h.e(l)}finally{h.f()}return a}},{key:"getKClosestPointsWithWeights",value:function(e,t,n){var i=this.getCellCoordFromGlobalCoord(e,t),r=this.getCell(i[0],i[1]);return this._getPointsSurroundingCell(i,r),this._getClosestPointsForGeneratedCell(r,e,t,n)}},{key:"getPointsAroundPoint",value:function(e,t){var n=this.getCellCoordFromGlobalCoord(e,t),i=this.getCell(n[0],n[1]);return this._getPointsSurroundingCell(n,i)}},{key:"_getPointsSurroundingCell",value:function(e,t){if(!t.surroundingPoints){for(var n=h(t.points),i=e[0]-1;i<=e[0]+1;i++)for(var r=e[1]-1;r<=e[1]+1;r++)a=i,s=r,((o=e)[0]!==a||o[1]!==s)&&n.push.apply(n,h(this.getCell(i,r).points));t.surroundingPoints=n}var o,a,s;return t.surroundingPoints}},{key:"_getClosestPointsForGeneratedCell",value:function(e,t,n,i){var o,a=[0,0],s=1e5,h=r(e.surroundingPoints);try{for(h.s();!(o=h.n()).done;){var u=o.value,c=R(u,t,n);c<s&&(a=u,s=c)}}catch(b){h.e(b)}finally{h.f()}for(var l=[{pt:a,distDiffFromFirstPt:0,weight:0}],f=i,d=0;d<e.surroundingPoints.length;d++){var p=e.surroundingPoints[d];if(p[0]!==a[0]||p[1]!==a[1]){var v=R(p,t,n)-s;v<i&&(l.push({pt:p,distDiffFromFirstPt:v,weight:0}),f+=i-v)}}for(var g=0,m=l;g<m.length;g++){var y=m[g];y.weight=(i-y.distDiffFromFirstPt)/f}return l}},{key:"getCellCoordFromGlobalCoord",value:function(e,t){return this._tempCellCoord[0]=Math.floor(e/this.gridSize),this._tempCellCoord[1]=Math.floor(t/this.gridSize),this._tempCellCoord}},{key:"getCell",value:function(e,t){if(this.mostRecentlyAccessedCell&&this.mostRecentlyAccessedCell.coord[0]===e&&this.mostRecentlyAccessedCell.coord[1]===t)return this.mostRecentlyAccessedCell;var n="".concat(e,"|").concat(t),i=this.cachedCells.get(n);if(i)return this.mostRecentlyAccessedCell=i,i;var r=this.generateRandomPointsForCell(e,t),o={coord:[e,t],points:r.points,pointsSet:r.pointsSet,surroundingPoints:null};return this.cachedCells.set(n,o),this.mostRecentlyAccessedCell=o,o}},{key:"generateRandomPointsForCell",value:function(e,t){var n,i,o=e*this.gridSize,a=t*this.gridSize;if(this.useJitteredGrid){var s=new N("".concat(e).concat(t).concat(this.seed,"jitter"));n=[];for(var h=o+this.gridSize,u=a+this.gridSize,c=o;c<h;c+=this.minDist)for(var l=a;l<u;l+=this.minDist){var f=c+Math.floor(s.next()*this.minDist),d=l+Math.floor(s.next()*this.minDist);n.push([f,d])}}else{var p,v=new N("".concat(e).concat(t).concat(this.seed,"pts")),g=function(){return v.next()},m=this.gridSize-(this.customCellGap||this.minDist);if(null===this.variableDensitySettings)p=new(q())({shape:[m,m],minDistance:this.minDist,maxDistance:this.minDist,tries:40},g);else{var y=this.variableDensitySettings.min,b=this.variableDensitySettings.max,w=b-y,k=this.variableDensitySettings.func;p=new(q())({shape:[m,m],minDistance:y,maxDistance:b,tries:10,distanceFunction:function(e){return(k([e[0]+o,e[1]+a])-y)/w}},g)}n=p.fill().map((function(e){return[Math.floor(o+e[0]),Math.floor(a+e[1])]}))}if(this.useIsPoint){i=new Set;var C,S=r(n);try{for(S.s();!(C=S.n()).done;){var _=C.value;i.add("".concat(_[0],"|").concat(_[1]))}}catch(x){S.e(x)}finally{S.f()}}return{pointsSet:i,points:this.useKthClosestPoint?n:null}}}]),e}();function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){Y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J,X=function(){function e(t,n,i,r){o(this,e),this.chunkSize=void 0,this.pointsGenerator=void 0,this._tempChunkCoord=[0,0],this.maxRadiusChunk=void 0,this.seed=void 0,this.chunkSize=t,this.pointsGenerator=n,this.maxRadiusChunk=Math.floor(.5*i/this.chunkSize)+1,this.seed=r}return s(e,[{key:"getChunkCoordFromGlobalCoord",value:function(e,t){return this._tempChunkCoord[0]=Math.floor(e/this.chunkSize),this._tempChunkCoord[1]=Math.floor(t/this.chunkSize),this._tempChunkCoord}},{key:"getSurroundingFeatures",value:function(e,t){for(var n=this.getChunkCoordFromGlobalCoord(e,t),i=[],r=n[0]-this.maxRadiusChunk;r<=n[0]+this.maxRadiusChunk;r++)for(var o=n[1]-this.maxRadiusChunk;o<=n[1]+this.maxRadiusChunk;o++)this.pointsGenerator.isPoint(r,o)&&i.push(this._getRandomPointInChunk(r,o));return i}},{key:"_getRandomPointInChunk",value:function(e,t){var n=e*this.chunkSize,i=t*this.chunkSize,r=new N("".concat(e,"|").concat(t,"|").concat(this.seed));return[n+Math.floor(r.next()*this.chunkSize),i+Math.floor(r.next()*this.chunkSize)]}}]),e}(),Z=function(){function e(t,n,i){o(this,e),this.spaghettCaves=void 0,this.chunkSize=void 0,this.pitCaves={count:1,maxWidth:40,minWidth:15,distApartInChunks:5,distPerturbNoiseSetup:[{amplitude:1,frequency:1/8},{amplitude:3,frequency:.05},{amplitude:10,frequency:.01},{amplitude:29,frequency:.002}],yPerturbNoiseSetup:[{amplitude:1,frequency:.1},{amplitude:3,frequency:.02}],heightPerturbNoiseSetup:[{amplitude:3,frequency:.1},{amplitude:10,frequency:.02}],edgesTargetMidpointNoiseSetup:[{amplitude:1,frequency:1/3},{amplitude:2,frequency:1/7},{amplitude:2,frequency:1/15}],minHeight:25,maxHeight:45,minBottomPit:-99,maxBottomPit:-25,generators:[],distPerturbNoises:[],yPerturbNoises:[],heightPerturbNoises:[],edgesTargetMidpointNoise:[]},this.ravineCaves={count:2,maxWidth:15,minWidth:10,maxLength:90,minLength:50,distApartInChunks:7,distPerturbNoiseSetup:[{amplitude:1,frequency:1/8},{amplitude:3,frequency:.05},{amplitude:10,frequency:.01},{amplitude:30,frequency:.002}],yPerturbNoiseSetup:[{amplitude:1,frequency:.1},{amplitude:3,frequency:.02}],minHeight:25,maxHeight:45,maxBottomRavine:-99,minBottomRavine:-5,generators:[],distPerturbNoises:[],yPerturbNoises:[],edgesTargetMidpointNoise:[]},this.sphereCaves={count:1,maxRadius:6,minRadius:20,distApartInChunks:4,distPerturbNoiseSetup:[{amplitude:1,frequency:1/8},{amplitude:3,frequency:.05}],minCentreSphere:-79,maxCentreSphere:10,generators:[],distPerturbNoises:[]},this.seed=void 0,this.lookOutsideChunkDist=void 0,this.numCaves=void 0,this.numSpaghettiCaves=void 0,this.chunkSize=n,this.seed=t,this.lookOutsideChunkDist=i;var a={count:1,thresholdNoiseSetup:[{amplitude:1.5,frequency:1/300},{amplitude:.5,frequency:1/150},{amplitude:.35,frequency:1/70},{amplitude:.04,frequency:.2}],heightNoiseSetup:[{amplitude:25,frequency:.005},{amplitude:12,frequency:1/150}],heightPerturbSetup:[{amplitude:1,frequency:1/4},{amplitude:5,frequency:.1}],cutoffNoiseSetup:[{amplitude:1,frequency:1/300}],caveOffset:null,threshold:{low:-.1,high:.1},height:9,heightPercentCap:.5,thresholdNoises:[],heightNoises:[],heightPerturbNoises:[],cutoffNoises:[],caveBot:0};this.spaghettCaves=[];for(var s=0,h=[{caveBot:-15,amt:1},{caveBot:-35,amt:1},{caveBot:-55,amt:2},{caveBot:-75,amt:1},{caveBot:-99,amt:1}];s<h.length;s++){var u=h[s],c=u.caveBot,l=u.amt;this.spaghettCaves.push(K(K({},JSON.parse(JSON.stringify(a))),{},{caveBot:c,count:l}))}this.spaghettCaves.push({count:2,thresholdNoiseSetup:[{amplitude:1.5,frequency:1/300},{amplitude:.5,frequency:1/150},{amplitude:.35,frequency:1/70},{amplitude:.04,frequency:.2}],heightNoiseSetup:[{amplitude:18,frequency:.01},{amplitude:6,frequency:1/75}],heightPerturbSetup:[{amplitude:1,frequency:1/4},{amplitude:5,frequency:.1}],cutoffNoiseSetup:[{amplitude:1,frequency:1/300}],caveOffset:null,threshold:{low:-.1,high:.1},height:9,heightPercentCap:.5,thresholdNoises:[],heightNoises:[],heightPerturbNoises:[],cutoffNoises:[],caveBot:-98});this.spaghettCaves.push({count:1,thresholdNoiseSetup:[{amplitude:.35,frequency:1/70},{amplitude:.04,frequency:.2}],heightNoiseSetup:[{amplitude:40,frequency:1/120},{amplitude:15,frequency:1/85}],heightPerturbSetup:[{amplitude:2,frequency:.1}],cutoffNoiseSetup:[{amplitude:1,frequency:1/400}],caveOffset:null,threshold:{low:-.06,high:.06},height:12,heightPercentCap:.5,thresholdNoises:[],heightNoises:[],heightPerturbNoises:[],cutoffNoises:[],caveBot:-98});var f,d=r(this.spaghettCaves);try{for(d.s();!(f=d.n()).done;){var p,v=f.value,g=0,m=r(v.heightNoiseSetup);try{for(m.s();!(p=m.n()).done;){g+=p.value.amplitude}}catch(H){m.e(H)}finally{m.f()}v.caveOffset=v.caveBot+g}}catch(H){d.e(H)}finally{d.f()}this.numSpaghettiCaves=0,this.numCaves=0;for(var y=0;y<this.spaghettCaves.length;y++)for(var b=this.spaghettCaves[y],w=0;w<b.count;w++)b.thresholdNoises.push(new I(b.thresholdNoiseSetup,b.threshold,"".concat(t,"Cave").concat(y).concat(w))),b.heightNoises.push(new D(b.heightNoiseSetup,"".concat(t,"CaveHeightNoise").concat(y).concat(w))),b.heightPerturbNoises.push(new D(b.heightPerturbSetup,"".concat(t,"CaveHeightPerturb").concat(y).concat(w))),b.cutoffNoises.push(new D(b.cutoffNoiseSetup,"".concat(t,"CaveCutoff").concat(y).concat(w))),this.numCaves++,this.numSpaghettiCaves++;for(var k=0;k<this.pitCaves.count;k++){this.pitCaves.distPerturbNoises.push(new D(this.pitCaves.distPerturbNoiseSetup,"".concat(t,"DistPitPerturb").concat(k)));var C,S=0,_=r(this.pitCaves.distPerturbNoiseSetup);try{for(_.s();!(C=_.n()).done;){S+=C.value.amplitude}}catch(H){_.e(H)}finally{_.f()}this.pitCaves.yPerturbNoises.push(new D(this.pitCaves.yPerturbNoiseSetup,"".concat(t,"yPitPerturb").concat(k))),this.pitCaves.heightPerturbNoises.push(new D(this.pitCaves.heightPerturbNoiseSetup,"".concat(t,"heightPitPerturb").concat(k))),this.pitCaves.edgesTargetMidpointNoise.push(new D(this.pitCaves.edgesTargetMidpointNoiseSetup,"".concat(t,"edgesPitPerturb").concat(k)));var x=new W(this.pitCaves.distApartInChunks,!0,!1,"".concat(t,"PitGen").concat(k),100,n),M=new X(n,x,this.pitCaves.maxWidth+2*S,"".concat(t,"PitGen").concat(k));this.pitCaves.generators.push(M),console.assert(M.maxRadiusChunk<=this.pitCaves.distApartInChunks/2,"cannot have overlapping cave features, ".concat(M.maxRadiusChunk," ").concat(this.pitCaves.distApartInChunks/2)),this.numCaves++}for(var P=0;P<this.ravineCaves.count;P++){this.ravineCaves.distPerturbNoises.push(new D(this.ravineCaves.distPerturbNoiseSetup,"".concat(t,"DistRavPerturb").concat(P)));var R,T=0,A=r(this.ravineCaves.distPerturbNoiseSetup);try{for(A.s();!(R=A.n()).done;){T+=R.value.amplitude}}catch(H){A.e(H)}finally{A.f()}this.ravineCaves.yPerturbNoises.push(new D(this.ravineCaves.yPerturbNoiseSetup,"".concat(t,"yRavinePerturb").concat(P)));var E=new W(this.ravineCaves.distApartInChunks,!0,!1,"".concat(t,"RavineGen").concat(P),100,n),O=new X(n,E,Math.max(this.ravineCaves.maxLength,this.ravineCaves.maxWidth)+2*T,"".concat(t,"RavineGen").concat(P));this.ravineCaves.generators.push(O),console.assert(O.maxRadiusChunk<=this.ravineCaves.distApartInChunks/2,"cannot have overlapping cave features, ".concat(O.maxRadiusChunk," ").concat(this.ravineCaves.distApartInChunks/2)),this.numCaves++}for(var L=0;L<this.sphereCaves.count;L++){this.sphereCaves.distPerturbNoises.push(new D(this.sphereCaves.distPerturbNoiseSetup,"".concat(t,"DistSpherePerturb").concat(L)));var B,N=0,F=r(this.sphereCaves.distPerturbNoiseSetup);try{for(F.s();!(B=F.n()).done;){N+=B.value.amplitude}}catch(H){F.e(H)}finally{F.f()}var j=new W(this.sphereCaves.distApartInChunks,!0,!1,"".concat(t,"SphereGen").concat(L),100,n),z=new X(n,j,2*this.sphereCaves.maxRadius+2*N,"".concat(t,"SphereGen").concat(L));this.sphereCaves.generators.push(z),console.assert(z.maxRadiusChunk<=this.sphereCaves.distApartInChunks/2,"cannot have overlapping cave features, ".concat(z.maxRadiusChunk," ").concat(this.sphereCaves.distApartInChunks/2)),this.numCaves++}}return s(e,[{key:"getCaveInfoForChunk",value:function(e,t,n){var i=new j(this.chunkSize,[e,t],this.numCaves,2,this.lookOutsideChunkDist);i.fill(C);for(var r=e-this.lookOutsideChunkDist;r<e+this.chunkSize+this.lookOutsideChunkDist;++r)for(var o=t-this.lookOutsideChunkDist;o<t+this.chunkSize+this.lookOutsideChunkDist;++o)this._addSpaghettCavesForColumn(r,o,i,n.groundHeights,0);var a=this.numSpaghettiCaves;return this._addPitCaves(e,t,i,n.groundHeights,a),a+=this.pitCaves.count,this._addSphereCaves(e,t,i,n.groundHeights,a),a+=this.sphereCaves.count,this._addRavineCaves(e,t,i,n.groundHeights,a),this.removeCavesNearWater(e,t,i,n),i}},{key:"_addSpaghettCavesForColumn",value:function(e,t,n,i,o){var a,s=r(this.spaghettCaves);try{for(s.s();!(a=s.n()).done;)for(var h=a.value,u=0;u<h.count;u++){o++;var c=h.cutoffNoises[u].getOctaves(e,t),l=.08;if(!(c>=l)){var f=h.thresholdNoises[u].getOctaves(e,t);if(f!==S)if(f>h.threshold.low&&f<h.threshold.high){var d=h.threshold.high-h.threshold.low,p=h.threshold.low+d/2,v=Math.min(h.heightPercentCap,1-Math.abs(f-p)/(d/2)),g=h.height*v;c>0&&(g*=(l-c)/l);var m=h.heightPerturbNoises[u].getOctaves(e,t),y=h.heightPerturbNoises[u].getOctaves(e+980,t-370),b=h.heightNoises[u].getOctaves(e+m,t+y),w=Math.floor(b-g+h.caveOffset),k=Math.floor(b+g+h.caveOffset);k+1===i.get(e,t)&&k++,n.set(e,t,o-1,0,w),n.set(e,t,o-1,1,k)}}}}catch(C){s.e(C)}finally{s.f()}}},{key:"_addPitCaves",value:function(e,t,n,o,a){for(var s=0;s<this.pitCaves.generators.length;s++){a++;var h,u=this.pitCaves.generators[s],c=E(e,t,this.pitCaves.distPerturbNoises[s],this.chunkSize,this.lookOutsideChunkDist),l=r(u.getSurroundingFeatures(e,t));try{for(l.s();!(h=l.n()).done;)for(var f=i(h.value,2),d=f[0],p=f[1],v=new N("pit".concat(d,"|").concat(p,"|").concat(s).concat(this.seed)),g=Math.floor(v.next()*(this.pitCaves.maxWidth-this.pitCaves.minWidth))+this.pitCaves.minWidth,m=Math.floor(v.next()*(this.pitCaves.maxWidth-this.pitCaves.minWidth))+this.pitCaves.minWidth,y=d+g/2,b=d-g/2,w=p+m/2,k=p-m/2,C=Math.floor(v.next()*(this.pitCaves.maxBottomPit-this.pitCaves.minBottomPit))+this.pitCaves.minBottomPit,S=Math.floor(v.next()*(this.pitCaves.maxHeight-this.pitCaves.minHeight))+this.pitCaves.minHeight,_=-this.lookOutsideChunkDist;_<this.chunkSize+this.lookOutsideChunkDist;++_)for(var x=-this.lookOutsideChunkDist;x<this.chunkSize+this.lookOutsideChunkDist;++x){var M=e+_,P=t+x,R=O(_,x,c,this.chunkSize,this.lookOutsideChunkDist),T=M+R[0],A=P+R[1];if(!(T>y||T<b||A>w||A<k)){var L=this.pitCaves.yPerturbNoises[s].getOctaves(M,P),B=this.pitCaves.heightPerturbNoises[s].getOctaves(M,P),D=C+L,I=C+S+B,F=Math.min(y-T,T-b),j=Math.min(w-A,A-k),z=Math.min(F,j);if(z<4){var H=5+this.pitCaves.edgesTargetMidpointNoise[s].getOctaves(M,P),q=1-z/4;I-=(I-(D+=H*q))*q}D=Math.floor(D),(I=Math.floor(I))+1===o.get(M,P)&&I++,n.set(M,P,a-1,0,D),n.set(M,P,a-1,1,I)}}}catch(U){l.e(U)}finally{l.f()}}}},{key:"_addRavineCaves",value:function(e,t,n,o,a){for(var s=0;s<this.ravineCaves.generators.length;s++){a++;var h,u=this.ravineCaves.generators[s],c=E(e,t,this.ravineCaves.distPerturbNoises[s],this.chunkSize,this.lookOutsideChunkDist),l=r(u.getSurroundingFeatures(e,t));try{for(l.s();!(h=l.n()).done;){var f=h.value,d=i(f,2),p=d[0],v=d[1],g=new N("rav".concat(p,"|").concat(v,"|").concat(s).concat(this.seed)),m=Math.floor(g.next()*(this.ravineCaves.maxWidth-this.ravineCaves.minWidth))+this.ravineCaves.minWidth,y=Math.floor(g.next()*(this.ravineCaves.maxLength-this.ravineCaves.minLength))+this.ravineCaves.minLength,b=Math.floor(g.next()*(this.ravineCaves.maxBottomRavine-this.ravineCaves.minBottomRavine))+this.ravineCaves.minBottomRavine,w=Math.floor(g.next()*(this.ravineCaves.maxHeight-this.ravineCaves.minHeight))+this.ravineCaves.minHeight,k=[2*g.next()-1,2*g.next()-1];L(k);for(var C=-this.lookOutsideChunkDist;C<this.chunkSize+this.lookOutsideChunkDist;++C)for(var S=-this.lookOutsideChunkDist;S<this.chunkSize+this.lookOutsideChunkDist;++S){var _=e+C,x=t+S,M=O(C,S,c,this.chunkSize,this.lookOutsideChunkDist),P=_+M[0],T=x+M[1],B=[P,T];L([P-p,T-v]);var D=R(f,P,T);if(!(D>y)){var I=A(B,f,[f[0]+k[0],f[1]+k[1]]),F=m*(1-D/y);if(!(I>F)){var j=this.ravineCaves.yPerturbNoises[s].getOctaves(_,x),z=b+j,H=b+w+j,q=F-I;if(q<3)z+=w*(1-q/3);z=Math.floor(z),(H=Math.floor(H))+1===o.get(_,x)&&H++,n.set(_,x,a-1,0,z),n.set(_,x,a-1,1,H)}}}}}catch(U){l.e(U)}finally{l.f()}}}},{key:"_addSphereCaves",value:function(e,t,n,o,a){for(var s=0;s<this.sphereCaves.generators.length;s++){a++;var h,u=this.sphereCaves.generators[s],c=E(e,t,this.sphereCaves.distPerturbNoises[s],this.chunkSize,this.lookOutsideChunkDist),l=r(u.getSurroundingFeatures(e,t));try{for(l.s();!(h=l.n()).done;)for(var f=i(h.value,2),d=f[0],p=f[1],v=new N("sph".concat(d,"|").concat(p,"|").concat(s).concat(this.seed)),g=Math.floor(v.next()*(this.sphereCaves.maxRadius-this.sphereCaves.minRadius))+this.sphereCaves.minRadius,m=g*g,y=Math.floor(v.next()*(this.sphereCaves.maxCentreSphere-this.sphereCaves.minCentreSphere))+this.sphereCaves.minCentreSphere,b=-this.lookOutsideChunkDist;b<this.chunkSize+this.lookOutsideChunkDist;++b)for(var w=-this.lookOutsideChunkDist;w<this.chunkSize+this.lookOutsideChunkDist;++w){var k=e+b,C=t+w,S=O(b,w,c,this.chunkSize,this.lookOutsideChunkDist),_=k+S[0],x=C+S[1],M=d-_,P=p-x,R=M*M+P*P;if(!(R>m)){var T=Math.sqrt(m-R),A=Math.floor(y-T),L=Math.floor(y+T);L+1===o.get(k,C)&&L++,n.set(k,C,a-1,0,A),n.set(k,C,a-1,1,L)}}}catch(B){l.e(B)}finally{l.f()}}}},{key:"isCave",value:function(e,t,n,i){for(var r=0;r<this.numCaves;r++){var o=i.get(e,n,r,0),a=i.get(e,n,r,1);if(t>=o&&t<=a)return!0}return!1}},{key:"addCavesToChunk",value:function(e,t,n,i,r){for(var o=t;o<t+this.chunkSize;o++)for(var a=i;a<i+this.chunkSize;a++)for(var s=0;s<this.numCaves;s++){var h=r.get(o,a,s,0),u=r.get(o,a,s,1);if(h!==C)for(var c=Math.min(u+1,n+this.chunkSize),l=Math.max(h,n);l<c;l++)e.set(o-t,l-n,a-i,0)}}},{key:"removeCavesNearWater",value:function(e,t,n,i){for(var r=e-this.lookOutsideChunkDist;r<e+this.chunkSize+this.lookOutsideChunkDist;++r)for(var o=t-this.lookOutsideChunkDist;o<t+this.chunkSize+this.lookOutsideChunkDist;++o){var a=i.cavesAllowedBelowY.get(r,o);if(1e4!==a)for(var s=0;s<this.numCaves;s++){var h=n.get(r,o,s,0);n.get(r,o,s,1)>a&&(h>a?(n.set(r,o,s,0,C),n.set(r,o,s,1,C)):n.set(r,o,s,1,a))}}}}]),e}();!function(e){e[e.Maple=0]="Maple",e[e.Pine=1]="Pine",e[e.Plum=2]="Plum",e[e.Cedar=4]="Cedar",e[e.Aspen=5]="Aspen",e[e.Elm=6]="Elm",e[e.Palm=7]="Palm",e[e.AutumnMaple=8]="AutumnMaple",e[e.Pear=9]="Pear"}(J||(J={}));var $=function(){function e(t,n,i,a,s){var h;o(this,e),this.treeRadius=void 0,this.cavesGenerator=void 0,this.chunkSize=void 0,this.seed=void 0,this.treePointGen=void 0,this.blockMetadata=void 0,this.treeMinDistApart=6,this.minTreeHeight=4,this.maxTreeHeight=7,this.treeBlockIds=void 0,this.treeBlockIds=(Y(h={},J.Maple,{block:s["Maple Log"].id,base:s["Maple Log|TreeBase"].id,canopyLeaves:s["Maple Leaves|TreeCanopy"].id}),Y(h,J.Pine,{block:s["Pine Log"].id,base:s["Pine Log|TreeBase"].id,canopyLeaves:s["Pine Leaves|TreeCanopy"].id}),Y(h,J.Plum,{block:s["Plum Log"].id,base:s["Plum Log|TreeBase"].id,canopyLeaves:s["Plum Leaves|TreeCanopy"].id}),Y(h,J.Cedar,{block:s["Cedar Log"].id,base:s["Cedar Log|TreeBase"].id,canopyLeaves:s["Cedar Leaves|TreeCanopy"].id}),Y(h,J.Aspen,{block:s["Aspen Log"].id,base:s["Aspen Log|TreeBase"].id,canopyLeaves:s["Aspen Leaves|TreeCanopy"].id}),Y(h,J.Elm,{block:s["Elm Log"].id,base:s["Elm Log|TreeBase"].id,canopyLeaves:s["Elm Leaves|TreeCanopy"].id}),Y(h,J.Palm,{block:s["Palm Log"].id,base:s["Palm Log|TreeBase"].id,canopyLeaves:s["Palm Leaves|TreeCanopy"].id}),Y(h,J.AutumnMaple,{block:s["Maple Log"].id,base:s["Maple Log|TreeBase"].id,canopyLeaves:s["Autumn Maple Leaves|TreeCanopy"].id}),Y(h,J.Pear,{block:s["Pear Log"].id,base:s["Pear Log|TreeBase"].id,canopyLeaves:s["Pear Leaves|TreeCanopy"].id}),h),this.treeRadius=t.treeRadius,this.cavesGenerator=n,this.chunkSize=i,this.seed=a,this.blockMetadata=s;var u,c=1e5,l=0,f=r(t.biomeSelector.biomes);try{for(f.s();!(u=f.n()).done;){var d=u.value;d.biome.treeMinDist&&(c=Math.min(c,d.biome.treeMinDist),l=Math.max(l,d.biome.treeMinDist))}}catch(p){f.e(p)}finally{f.f()}this.treePointGen=new W(6,!0,!1,a,300,i,{func:function(e){return t._getBiome(e[0],e[1]).biome.treeMinDist||l},min:c,max:l},!1,2)}return s(e,[{key:"_getTreeTrunksForBlocksInChunk",value:function(t,n,i,r,o){for(var a=i.groundHeights,s=i.waterHeights,h=new z(this.chunkSize,[t,n],this.treeRadius),u=t-this.treeRadius;u<t+this.chunkSize+this.treeRadius;u++)for(var c=n-this.treeRadius;c<n+this.chunkSize+this.treeRadius;c++){var l=r.get(u,c)[0].biome;if(null!==l.treeMinDist)if(l.getTotalTreeChance()<=0&&console.error("Biome",l,"has 0 total tree chance"),this.treePointGen.isPoint(u,c)&&s.get(u,c)===k){var f=a.get(u,c);if(!this.cavesGenerator.isCave(u,f,c,o)){var d=new N("".concat(u).concat(c).concat(this.seed,"treeHeight")),p=e.getTreeTypeFromBiome(l,d),v=this.getRandTreeInfo(d),g=v.height,m=v.vineDir;this._addTreeToTreesNearbyBlocks(h,u,c,{pos:[u,c],height:g,vineDir:m,treeType:p},t,n)}}}return h}},{key:"getRandTreeInfo",value:function(e){return{height:Math.floor(e.next()*(this.maxTreeHeight-this.minTreeHeight))+this.minTreeHeight,vineDir:e.next()<1/30?Math.floor(4*e.next()):-1}}},{key:"_addTreeToTreesNearbyBlocks",value:function(e,t,n,i,r,o){for(var a=t-this.treeRadius;a<=t+this.treeRadius;a++)for(var s=n-this.treeRadius;s<=n+this.treeRadius;s++)if(a>=r&&a<r+this.chunkSize&&s>=o&&s<o+this.chunkSize){var h=e.get(a,s)||[];h.push(i),e.set(a,s,h)}}},{key:"getTreeBlock",value:function(e,t,n,o,a){var s=o.get(e,n);if(t<=s)return 0;if(t>s&&t<=s+this.maxTreeHeight){var h,u=r(a);try{for(u.s();!(h=u.n()).done;){var c=h.value,l=c.pos,f=o.get(l[0],l[1])+1,d=this.getTrunkBlockFromInfo(e,t,n,f,c);if(0!==d)return d}}catch(C){u.e(C)}finally{u.f()}}if(t<=s+this.maxTreeHeight+5){var p,v=r(a);try{for(v.s();!(p=v.n()).done;){var g=p.value,m=i(g.pos,2),y=m[0],b=m[1],w=o.get(y,b),k=this._getLeafBlockFromInfo(e,t,n,y,b,w+1,g);if(0!==k)return k}}catch(C){v.e(C)}finally{v.f()}}return 0}},{key:"getTrunkBlockFromInfo",value:function(e,t,n,i,r){var o=i+r.height-1,a=r.pos;if(t<=o){if(a[0]===e&&a[1]===n)return t===i?this.treeBlockIds[r.treeType].base:this.treeBlockIds[r.treeType].block;if(-1!==r.vineDir){var s=this.getVineInfoForTrunk(r.vineDir),h=s.offsetFromTrunk;if(a[0]+h[0]===e&&a[1]+h[1]===n&&t<o-1)return s.blockId}}return 0}},{key:"getVineInfoForTrunk",value:function(e){var t={offsetFromTrunk:[0,0],blockId:0};return 0===e?(t.offsetFromTrunk[0]=-1,t.blockId=this.blockMetadata["Vines|meta|rot4"].id):1===e?(t.offsetFromTrunk[1]=1,t.blockId=this.blockMetadata.Vines.id):2===e?(t.offsetFromTrunk[0]=1,t.blockId=this.blockMetadata["Vines|meta|rot2"].id):3===e&&(t.offsetFromTrunk[1]=-1,t.blockId=this.blockMetadata["Vines|meta|rot3"].id),t}},{key:"_getLeafBlockFromInfo",value:function(e,t,n,i,r,o,a){var s=a.height,h=o+s-3,u=o+s+this.treeRadius-1;if(t>h&&t<=u){var c,l;t<u-1&&(c=2.8,l=3),t===u-1?(c=1.2,l=1.7):t===u&&(c=.2,l=1.1);var f=function(e,t){var n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)}([i,r],[e,n]);return f>=l?0:f>=c?new N("".concat(e).concat(t).concat(n,"leaf")).next()<.8?this.treeBlockIds[a.treeType].canopyLeaves:0:this.treeBlockIds[a.treeType].canopyLeaves}return 0}},{key:"getAllBlocksForTree",value:function(e,t){for(var n=i(t.pos,2),r=n[0],o=n[1],a=t.height,s=(t.vineDir,[]),h=r-this.treeRadius;h<=r+this.treeRadius;h++)for(var u=e;u<=e+a;u++)for(var c=o-this.treeRadius;c<=o+this.treeRadius;c++){var l=this.getTrunkBlockFromInfo(h,u,c,e,t);if(0===l){var f=this._getLeafBlockFromInfo(h,u,c,r,o,e,t);0!==f&&s.push({x:h,y:u,z:c,id:f})}else s.push({x:h,y:u,z:c,id:l})}return s}}],[{key:"getTreeTypeFromBiome",value:function(e,t){for(var n=Math.floor(t.next()*e.getTotalTreeChance()),i=0,r=0;i<=n;)i+=e.treeChances[r].chance,r++;return e.treeChances[r-1].treeType}}]),e}(),Q=n(5882),ee=s((function e(){o(this,e),this.hasLake=!1,this.lakeCreationHasBeenAttempted=!1,this.lakeWaterHeight=0,this.lakeRadius=0,this.lakeBedHeight=0})),te=function(){function e(t,n,i,r){o(this,e),this.worldGenerator=void 0,this.gridSize=224,this.cellCenterMaxOffset=void 0,this.maxRiverSettings={width:23,atFlux:800},this.lakeSettings={minRadius:15,maxRadius:60,maxRadiusAtFlux:1700,noLakeFluxCutoff:50},this.widthOffset=2,this.seed=void 0,this.lakeRadiusNoiseModifier=void 0,this.lakeRadiusNoiseAmplitude=void 0,this.waterBodyInfos=new Map,this.lastReadInfo={lastId:null,info:null},this.worldGenerator=t;var a=Math.max(this.lakeSettings.maxRadius,this.maxRiverSettings.width/2+this.widthOffset)+r+i;this.cellCenterMaxOffset=this.gridSize/2-a,this.seed=n,this.lakeRadiusNoiseModifier=new D([{amplitude:10,frequency:1/55},{amplitude:4,frequency:.04}],"".concat(n,"GlobalHeightmapOffset")),this.lakeRadiusNoiseAmplitude=B(this.lakeRadiusNoiseModifier)}return s(e,[{key:"getInfoNeededForWaterGen",value:function(e,t){var n=[e,t],i=this.getWaterInfo(e,t,!0),o=1e4,a=0,s=0,h=0,u=0,c=0,l=0;if(i.downhill){var f=T(n,i.origin,i.downhill.origin),d=f.dist,p=f.fracAlong,v=f.lineSegmentLength;a=Math.floor(d);var g=i.incomingFlux;if(g+=p*i.selfFlux,h=Math.min(1,g/this.maxRiverSettings.atFlux),o=a-(s=Math.max(1,Math.ceil(h*this.maxRiverSettings.width)))/2,c=i.originNoWaterHeight+-3,i.downhill.lakeInfo.hasLake){l=i.downhill.lakeInfo.lakeWaterHeight;var m=v-i.downhill.lakeInfo.lakeRadius,y=v*p;u=Math.min(1,y/m)}else l=i.downhill.originNoWaterHeight+-3,u=p}var b,w=r(i.uphills);try{for(w.s();!(b=w.n()).done;){var k=b.value,C=T(n,k.origin,i.origin),S=C.dist,_=C.fracAlong,x=C.lineSegmentLength,M=Math.floor(S),P=k.incomingFlux;P+=_*k.selfFlux;var A=Math.min(1,P/this.maxRiverSettings.atFlux),E=Math.max(1,Math.ceil(A*this.maxRiverSettings.width)),O=M-E/2;if(O<o)if(o=O,a=M,h=A,s=E,c=k.originNoWaterHeight+-3,i.lakeInfo.hasLake){l=i.lakeInfo.lakeWaterHeight;var L=x-i.lakeInfo.lakeRadius,B=x*_;u=Math.min(1,B/L)}else l=i.originNoWaterHeight+-3,u=_}}catch(U){w.e(U)}finally{w.f()}if(1e4!==o){var D=1e4,I=0;if(i.lakeInfo.hasLake){var N=i.lakeInfo,F=this.lakeRadiusNoiseModifier.getOctaves(e,t);F+=this.lakeRadiusNoiseAmplitude,F*=N.lakeRadius/this.lakeSettings.maxRadius,I=N.lakeRadius-F,D=R(i.origin,e,t)-I}var j=Math.floor(l+(c-l)*(1-u)),z=j-(Math.ceil(10*h)+2);if(o<D)return{distFromWater:a,waterRadius:(s+this.widthOffset)/2,waterHeight:j,waterbedHeight:z,isLake:!1};var H=R(i.origin,e,t),q=i.lakeInfo;return{distFromWater:H,waterRadius:I,waterHeight:q.lakeWaterHeight,waterbedHeight:q.lakeBedHeight,isLake:!0}}return{distFromWater:1e4,waterRadius:0,waterHeight:0,waterbedHeight:0,isLake:!1}}},{key:"getWaterInfo",value:function(e,t,n){var i=Math.floor(e/this.gridSize),r=Math.floor(t/this.gridSize),o=this.getCellInfo(i,r);if(o.uphills||this.fillInUphillInfo(i,r,o),o.downhill||o.lakeInfo.lakeCreationHasBeenAttempted||(this.fillInLakeInfo(o),o.lakeInfo.lakeCreationHasBeenAttempted=!0),n&&o.downhill){var a=this.getWaterInfo(o.downhill.origin[0],o.downhill.origin[1],!1);o.downhill.lakeInfo=a.lakeInfo}return o}},{key:"getCellInfo",value:function(e,t){var n="".concat(e,"|").concat(t);if(n===this.lastReadInfo.lastId)return this.lastReadInfo.info;if(this.waterBodyInfos.has(n)){var i=this.waterBodyInfos.get(n);return this.lastReadInfo.lastId=n,this.lastReadInfo.info=i,i}var r=this.getCellOrigin(e,t),o=this.worldGenerator.getClosestBiomes(r[0],r[1]),a=this.worldGenerator.getNoWaterHeightmapVal(r[0],r[1],o),s={origin:r,originNoWaterHeight:a,downhill:this.getDownhillFromCell(e,t,a),uphills:null,incomingFlux:null,selfFlux:this.getRainfall(r[0],r[1]),lakeInfo:new ee};return this.lastReadInfo.lastId=n,this.lastReadInfo.info=s,this.waterBodyInfos.set(n,s),this.waterBodyInfos.size>200&&this.waterBodyInfos.delete(this.waterBodyInfos.keys().next().value),s}},{key:"fillInUphillInfo",value:function(e,t,n){var i,o=this.getUphillsFromCell(e,t),a=0,s=r(o);try{for(s.s();!(i=s.n()).done;){var h=i.value;a+=h.incomingFlux+h.selfFlux}}catch(u){s.e(u)}finally{s.f()}n.uphills=o,n.incomingFlux=a}},{key:"getUphillsFromCell",value:function(e,t){for(var n=[],i=-1;i<=1;i++)for(var r=-1;r<=1;r++){var o,a,s=e+i,h=t+r,u=Math.abs(i)+Math.abs(r);if(2!==u&&0!==u){var c=this.getCellInfo(s,h);(null===(o=c.downhill)||void 0===o?void 0:o.cell[0])===e&&(null===(a=c.downhill)||void 0===a?void 0:a.cell[1])===t&&(c.uphills||this.fillInUphillInfo(s,h,c),n.push({incomingFlux:c.incomingFlux,selfFlux:c.selfFlux,origin:c.origin,originNoWaterHeight:c.originNoWaterHeight}))}}return n}},{key:"getDownhillFromCell",value:function(e,t,n){for(var i={cell:[0,0],origin:null,originNoWaterHeight:0,lakeInfo:new ee},r=-1,o=-1;o<=1;o++)for(var a=-1;a<=1;a++){var s=e+o,h=t+a,u=Math.abs(o)+Math.abs(a);if(2!==u&&0!==u){var c=this.getCellOrigin(s,h),l=this.worldGenerator.getClosestBiomes(c[0],c[1]),f=this.worldGenerator.getNoWaterHeightmapVal(c[0],c[1],l),d=n-f;d>0&&d>r&&(r=d,i.cell[0]=s,i.cell[1]=h,i.origin=c,i.originNoWaterHeight=f)}}return-1!==r?i:null}},{key:"getCellOrigin",value:function(e,t){var n=e*this.gridSize+this.gridSize/2,i=t*this.gridSize+this.gridSize/2,r=new N("".concat(e).concat(t).concat(this.seed,"riverCell"));return[n+Math.floor(r.next()*this.cellCenterMaxOffset*2-this.cellCenterMaxOffset),i+Math.floor(r.next()*this.cellCenterMaxOffset*2-this.cellCenterMaxOffset)]}},{key:"fillInLakeInfo",value:function(e){var t=e.lakeInfo,n=e.incomingFlux+e.selfFlux;if(!(n<this.lakeSettings.noLakeFluxCutoff)){t.hasLake=!0;var i=n/this.lakeSettings.maxRadiusAtFlux,r=this.lakeSettings.minRadius+Math.ceil(i*(this.lakeSettings.maxRadius-this.lakeSettings.minRadius));t.lakeRadius=r,t.lakeWaterHeight=Math.floor(e.originNoWaterHeight-7);var o=4+.35*r;t.lakeBedHeight=Math.floor(t.lakeWaterHeight-o)}}},{key:"getRainfall",value:function(e,t){return 100}}]),e}(),ne=function(){function e(t,n,i){for(var r in o(this,e),this.ores=void 0,this.blockMetadata=void 0,this.seed=void 0,this.chunkSize=void 0,this.blockMetadata=t,this.seed=n,this.chunkSize=i,this.ores={"Moonstone Ore":{radius:2,minDistBetweenDeposits:40,minY:-85,maxY:-85,spawnChance:.5,pointGenerator:null},"Diamond Ore":{radius:2,minDistBetweenDeposits:13,minY:-100,maxY:-85,spawnChance:.28,pointGenerator:null},"Gold Ore":{radius:2,minDistBetweenDeposits:10,minY:-100,maxY:-75,spawnChance:.4,pointGenerator:null},"Iron Ore":{radius:2,minDistBetweenDeposits:5,minY:-80,maxY:15,spawnChance:.5,pointGenerator:null},"Coal Ore":{radius:3,minDistBetweenDeposits:4,minY:-60,maxY:40,spawnChance:.5,pointGenerator:null}},this.ores){var a=this.ores[r];a.pointGenerator=new W(a.minDistBetweenDeposits,!1,!0,"".concat(n).concat(r),20,i,null,!0)}}return s(e,[{key:"getOreBlocksForChunk",value:function(e,t){var n=new z(this.chunkSize,[e,t],0),i=new N("".concat(e).concat(t).concat(this.seed,"oreExists"));for(var o in this.ores){var a,s=this.ores[o],h=this.blockMetadata[o].id,u=s.pointGenerator.getPointsAroundPoint(e+this.chunkSize/2,t+this.chunkSize/2),c=e+this.chunkSize+s.radius,l=e-s.radius-1,f=t+this.chunkSize+s.radius,d=t-s.radius-1,p=r(u);try{for(p.s();!(a=p.n()).done;){var v=a.value;if(!(v[0]>=c||v[0]<=l||v[1]>=f||v[1]<=d))for(var g=new N("".concat(v[0]).concat(v[1]).concat(this.seed,"ore")),m=Math.floor(g.next()*(s.maxY-s.minY))+s.minY,y=Math.max(e,v[0]-s.radius),b=Math.min(e+this.chunkSize-1,v[0]+s.radius),w=Math.max(t,v[1]-s.radius),k=Math.min(t+this.chunkSize-1,v[1]+s.radius),C=y;C<=b;C++)for(var S=w;S<=k;S++){if(!(x(v,C,S)>s.radius)&&!(i.next()>=s.spawnChance)){var _={yLevel:m,oreId:h};if(n.get(C,S)){n.get(C,S).push(_)}else{var M=[];n.set(C,S,M),M.push(_)}}}}}catch(P){p.e(P)}finally{p.f()}}return n}},{key:"addOresToColumn",value:function(e,t,n,i,o,a,s,h){if(h){var u,c=r(h);try{for(c.s();!(u=c.n()).done;){var l=u.value,f=l.yLevel,d=l.oreId;f<s&&f>=o&&f<o+this.chunkSize&&e.set(t-i,f-o,n-a,d)}}catch(p){c.e(p)}finally{c.f()}}}}]),e}();function ie(e,t){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ie(e,t)}function re(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ie(e,t)}function oe(e){return oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},oe(e)}function ae(e){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ae(e)}function se(e,t){if(t&&("object"===ae(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return e}(e)}function he(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=oe(e);if(t){var r=oe(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return se(this,n)}}var ue,ce=function(){function e(t,n,i,a,s,h){var u=s.cactusChance,c=s.maxCactusHeight;o(this,e),this.blockMetadata=void 0,this.seed=void 0,this.grassChance=void 0,this.cactusChance=void 0,this.maxCactusHeight=void 0,this.doFlowerGen=void 0,this.flowerInfos=void 0,this.totalFlowerPatchChance=void 0,this.flowerPatchPointGen=void 0,this.chunkSize=void 0,this.maxPatchRadius=void 0,this.blockMetadata=t,this.seed=i,this.grassChance=a,this.cactusChance=u,this.maxCactusHeight=c,this.chunkSize=n;var l=.5;this.flowerInfos=[{flower:"Dandelion",patchChance:h.dandelionChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"Poppy",patchChance:h.poppyChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"Forget-me-not",patchChance:h.forgetMeNotChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"Red Tulip",patchChance:h.redTulipChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"Pink Tulip",patchChance:h.pinkTulipChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"White Tulip",patchChance:h.whiteTulipChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"Orange Tulip",patchChance:h.orangeTulipChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"Daisy",patchChance:h.daisyChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"Allium",patchChance:h.alliumChance,insidePatchSpawnChance:l,patchRadius:3},{flower:"Bluebell",patchChance:h.bluebellChance,insidePatchSpawnChance:.85,patchRadius:8},{flower:"Fallen Maple Leaves",patchChance:h.fallenMapleLeavesChance,insidePatchSpawnChance:.5,patchRadius:2},{flower:"Melon",patchChance:h.melonChance,insidePatchSpawnChance:.5,patchRadius:2},{flower:"Watermelon",patchChance:h.watermelonChance,insidePatchSpawnChance:.5,patchRadius:2},{flower:"Pumpkin",patchChance:h.pumpkinChance,insidePatchSpawnChance:.5,patchRadius:2}],this.maxPatchRadius=0;var f,d=r(this.flowerInfos);try{for(d.s();!(f=d.n()).done;){var p=f.value.patchRadius;this.maxPatchRadius=Math.max(this.maxPatchRadius,p)}}catch(y){d.e(y)}finally{d.f()}this.totalFlowerPatchChance=0;var v,g=r(this.flowerInfos);try{for(g.s();!(v=g.n()).done;){var m=v.value.patchChance;this.totalFlowerPatchChance+=m}}catch(y){g.e(y)}finally{g.f()}this.doFlowerGen=null!==h.flowerPatchDistApart,this.doFlowerGen&&(this.flowerPatchPointGen=new W(h.flowerPatchDistApart,!1,!0,i,4,n))}return s(e,[{key:"addBiomeFloraToColumn",value:function(e,t,n,i,r,o,a){if(a+1>=r&&a+1<r+this.chunkSize){var s=new N("".concat(i).concat(o).concat(this.seed,"flora"));if(s.next()<this.grassChance&&e.set(i-t,a+1-r,o-n,this.blockMetadata["Tall Grass"].id),this.doFlowerGen&&this.totalFlowerPatchChance>0){var h=this.flowerPatchPointGen.getClosestPoint(i,o),u=x(h,i,o);if(u<this.maxPatchRadius){for(var c=new N("".concat(h[0]).concat(h[1]).concat(this.seed,"flowerpatch")),l=Math.floor(c.next()*this.totalFlowerPatchChance),f=0,d=0;f<=l;)f+=this.flowerInfos[d].patchChance,d++;var p=this.flowerInfos[d-1];if(u<p.patchRadius&&s.next()<p.insidePatchSpawnChance){var v=p.flower;e.set(i-t,a+1-r,o-n,this.blockMetadata[v].id)}}}}if(0!==this.cactusChance){var g=new N("".concat(i).concat(o).concat(this.seed,"cactus")),m=g.next();if(m<this.cactusChance)for(var y=Math.floor(g.next()*(this.maxCactusHeight-1))+1,b=Math.min(a+y+1,r+this.chunkSize),w=m<this.cactusChance*(2/3),k=Math.max(a+1,r);k<b;k++)e.set(i-t,k-r,o-n,w?this.blockMetadata["Fat Cactus"].id:this.blockMetadata.Cactus.id)}}}]),e}(),le=function(){function e(t,n,i,r,a){var s=a.oreGenerator,h=a.cavesGenerator;o(this,e),this.offsettedHeight=-5,this.topsoilBlockType=void 0,this.lowsoilBlockType=void 0,this.topwaterBlockType=void 0,this.blockMetadata=void 0,this.chunkSize=void 0,this.treeMinDist=5,this._heightmapSimplex=void 0,this.worldGenerator=void 0,this.oreGenerator=void 0,this.cavesGenerator=void 0,this.floraGenerator=void 0,this.maxCactusHeight=4,this.grassChance=.025,this.maxFloraHeight=this.maxCactusHeight,this.flowerPatchDistApart=40,this.poppyChance=10,this.daisyChance=10,this.pinkTulipChance=10,this.cactusChance=0,this.forgetMeNotChance=0,this.whiteTulipChance=0,this.orangeTulipChance=0,this.redTulipChance=0,this.dandelionChance=0,this.bluebellChance=0,this.alliumChance=0,this.fallenMapleLeavesChance=0,this.melonChance=0,this.watermelonChance=0,this.pumpkinChance=0,this.mapleTreeChance=1,this.pineTreeChance=0,this.plumTreeChance=0,this.cedarTreeChance=0,this.aspenTreeChance=0,this.elmTreeChance=0,this.palmTreeChance=0,this.autumnMapleTreeChance=0,this.pearTreeChance=0,this.seed=void 0,this.totalTreeChance=void 0,this.treeChances=void 0,this.chunkSize=t,this.blockMetadata=n,this.seed=r,this.topsoilBlockType=n["Grass Block"].id,this.lowsoilBlockType=n.Dirt.id,this.topwaterBlockType=n.Water.id,this.worldGenerator=i,this.oreGenerator=s,this.cavesGenerator=h}return s(e,[{key:"init",value:function(){this.floraGenerator=new ce(this.blockMetadata,this.chunkSize,"".concat(this.seed,"flora"),this.grassChance,{cactusChance:this.cactusChance,maxCactusHeight:this.maxCactusHeight},{flowerPatchDistApart:this.flowerPatchDistApart,dandelionChance:this.dandelionChance,poppyChance:this.poppyChance,forgetMeNotChance:this.forgetMeNotChance,redTulipChance:this.redTulipChance,pinkTulipChance:this.pinkTulipChance,whiteTulipChance:this.whiteTulipChance,orangeTulipChance:this.orangeTulipChance,daisyChance:this.daisyChance,bluebellChance:this.bluebellChance,alliumChance:this.alliumChance,fallenMapleLeavesChance:this.fallenMapleLeavesChance,melonChance:this.melonChance,watermelonChance:this.watermelonChance,pumpkinChance:this.pumpkinChance}),this.treeChances=[{treeType:J.Maple,chance:this.mapleTreeChance},{treeType:J.Pine,chance:this.pineTreeChance},{treeType:J.Plum,chance:this.plumTreeChance},{treeType:J.Cedar,chance:this.cedarTreeChance},{treeType:J.Aspen,chance:this.aspenTreeChance},{treeType:J.Elm,chance:this.elmTreeChance},{treeType:J.Palm,chance:this.palmTreeChance},{treeType:J.AutumnMaple,chance:this.autumnMapleTreeChance},{treeType:J.Pear,chance:this.pearTreeChance}],this.totalTreeChance=0;var e,t=r(this.treeChances);try{for(t.s();!(e=t.n()).done;){var n=e.value.chance;this.totalTreeChance+=n}}catch(i){t.e(i)}finally{t.f()}}},{key:"xzId",value:function(e,t){return"".concat(e,"|").concat(t)}},{key:"getHeightmapVal",value:function(e,t){return this.offsettedHeight+this._heightmapSimplex.getOctaves(e,t)}},{key:"getTopsoilBlock",value:function(e,t,n){return this.topsoilBlockType}},{key:"getLowsoilBlockType",value:function(e,t,n,i){return this.lowsoilBlockType}},{key:"getTotalTreeChance",value:function(){return this.totalTreeChance}}]),e}(),fe=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,"".concat(a,"Desert"),s)).grassChance=0,h.cactusChance=6e-4,h.flowerPatchDistApart=null,h.treeMinDist=null,h.topsoilBlockType=i.Sand.id,h.lowsoilBlockType=i.Sand.id,h._heightmapSimplex=new D([{amplitude:2,frequency:1/70},{amplitude:1,frequency:1/30}],"".concat(a,"DesertBiomeHeightMap")),h}return s(n)}(le),de=function(e){re(n,e);var t=he(n);function n(){var e;o(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).cactusChance=.05,e}return s(n)}(fe),pe=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,"".concat(a,"RedDesert"),s)).topsoilBlockType=i["Red Sand"].id,h.lowsoilBlockType=i["Red Sand"].id,h}return s(n)}(fe),ve=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,"".concat(a,"Plains"),s)).grassChance=.18,h.flowerPatchDistApart=20,h.forgetMeNotChance=10,h.whiteTulipChance=10,h.orangeTulipChance=10,h.redTulipChance=10,h.dandelionChance=10,h.alliumChance=10,h.watermelonChance=2,h.topsoilBlockType=i["Grass Block"].id,h.lowsoilBlockType=i.Dirt.id,h.treeMinDist=75,h._heightmapSimplex=new D([{amplitude:4,frequency:1/70},{amplitude:2,frequency:1/30}],"".concat(a,"PlainsBiomeHeightMap")),h}return s(n)}(le),ge=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,a,s)).poppyChance=0,h.daisyChance=0,h.pinkTulipChance=0,h.grassChance=.001,h.forgetMeNotChance=0,h.whiteTulipChance=0,h.orangeTulipChance=0,h.redTulipChance=0,h.dandelionChance=0,h.alliumChance=0,h.watermelonChance=0,h.topsoilBlockType=i.Snow.id,h.topwaterBlockType=i.Ice.id,h}return s(n)}(ve),me=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,"".concat(a,"Forest"),s)).mapleTreeChance=15,h.aspenTreeChance=1,h.melonChance=3,h.topsoilBlockType=i["Grass Block"].id,h.lowsoilBlockType=i.Dirt.id,h.treeMinDist=6,h._heightmapSimplex=new D([{amplitude:4,frequency:1/70},{amplitude:2,frequency:1/30}],"".concat(a,"ForestBiomeHeightMap")),h}return s(n)}(le),ye=function(e){re(n,e);var t=he(n);function n(){var e;o(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).pumpkinChance=3,e.melonChance=0,e.aspenTreeChance=0,e.plumTreeChance=1,e}return s(n)}(me),be=function(e){re(n,e);var t=he(n);function n(){var e;o(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).melonChance=3,e.aspenTreeChance=0,e.pearTreeChance=1,e}return s(n)}(me),we=function(e){re(n,e);var t=he(n);function n(){var e;o(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).flowerPatchDistApart=13,e.fallenMapleLeavesChance=80,e.pumpkinChance=3,e.melonChance=0,e.autumnMapleTreeChance=1,e.mapleTreeChance=0,e.aspenTreeChance=0,e}return s(n)}(me),ke=function(e){re(n,e);var t=he(n);function n(){var e;o(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).melonChance=0,e.aspenTreeChance=0,e.mapleTreeChance=0,e.elmTreeChance=15,e.palmTreeChance=1,e}return s(n)}(me),Ce=function(e){re(n,e);var t=he(n);function n(){var e;o(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).melonChance=0,e.mapleTreeChance=0,e.aspenTreeChance=0,e.pineTreeChance=15,e.cedarTreeChance=1,e}return s(n)}(me),Se=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,a,s)).poppyChance=0,h.daisyChance=0,h.pinkTulipChance=0,h.grassChance=.005,h.topsoilBlockType=i.Snow.id,h.topwaterBlockType=i.Ice.id,h}return s(n)}(Ce),_e=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,"".concat(a,"Blue"),s)).bluebellChance=1,h.melonChance=0,h.flowerPatchDistApart=12,h.poppyChance=0,h.daisyChance=0,h.pinkTulipChance=0,h}return s(n)}(me),xe=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,"".concat(a,"RollingHills"),s)).topsoilBlockType=i["Grass Block"].id,h.treeMinDist=25,h.offsettedHeight=20,h._heightmapSimplex=new D([{amplitude:20,frequency:.005},{amplitude:4,frequency:1/70}],"".concat(a,"RollingHillsBiomeHeightMap")),h}return s(n)}(le),Me=function(e){re(n,e);var t=he(n);function n(e,i,r,a,s){var h;return o(this,n),(h=t.call(this,e,i,r,"".concat(a,"SnowyMountains"),s)).poppyChance=0,h.daisyChance=0,h.pinkTulipChance=0,h.grassChance=0,h.ridgedNoiseAmplitude=void 0,h.ridgedNoiseOctave1=void 0,h.ridgedNoiseOctave2=void 0,h.nonRidgedNoise=void 0,h.treeMinDist=50,h.offsettedHeight=0,h.ridgedNoiseOctave1=new D([{amplitude:80,frequency:.005}],"".concat(a,"SnowyMountainsBiomeRidgedNoise")),h.ridgedNoiseOctave2=new D([{amplitude:20,frequency:1/120}],"".concat(a,"SnowyMountainsBiomeRidgedNoiseOctave2")),h.nonRidgedNoise=new D([{amplitude:8,frequency:1/120}],"".concat(a,"SnowyMountainsBiomeNonRidgedNoise")),h.ridgedNoiseAmplitude=B(h.ridgedNoiseOctave1)+B(h.ridgedNoiseOctave2),h}return s(n,[{key:"getHeightmapVal",value:function(e,t){var n=this.ridgedNoiseAmplitude-Math.abs(this.ridgedNoiseOctave1.getOctaves(e,t))-Math.abs(this.ridgedNoiseOctave2.getOctaves(e,t));return this.offsettedHeight+n+this.nonRidgedNoise.getOctaves(e,t)}},{key:"getTopsoilBlock",value:function(e,t,n){return t>80?this.blockMetadata.Snow.id:t>60?this.blockMetadata.Stone.id:this.blockMetadata["Grass Block"].id}},{key:"getLowsoilBlockType",value:function(e,t,n,i){return t>85&&t>=i-2?this.blockMetadata.Snow.id:t>57?this.blockMetadata.Stone.id:t>53?this.blockMetadata["Rocky Dirt"].id:this.blockMetadata.Dirt.id}}]),n}(le),Pe=function(){function e(t,n,i,a,s,h){o(this,e),this.baseBiome=void 0,this.biomesTotalFrequency=void 0,this.biomes=void 0,this.seed=void 0,this.blockMetadata=void 0,this.chunkSize=void 0,this.mostRecentlyAccessedPtForBiome=[0,0],this.mostRecentlyAccessedBiome=void 0,this.mostRecentlyAccessedModifierPt=[0,0],this.mostRecentlyAccessedModifier=void 0,this.stoneTypes=void 0,this.stonesTotalFrequency=void 0,this.seed=a,this.blockMetadata=h,this.chunkSize=s;var u={oreGenerator:i,cavesGenerator:n};this.baseBiome=new le(s,h,t,a,u);var c=new fe(s,h,t,a,u),l=new de(s,h,t,a,u),f=new pe(s,h,t,a,u),d=new ve(s,h,t,a,u),p=new me(s,h,t,a,u),v=new ye(s,h,t,a,u),g=new be(s,h,t,a,u),m=new Ce(s,h,t,a,u),y=new Se(s,h,t,a,u),b=new ke(s,h,t,a,u),w=new we(s,h,t,a,u),k=new xe(s,h,t,a,u),C=new Me(s,h,t,a,u),S=new _e(s,h,t,a,u),_=new ge(s,h,t,a,u);this.biomes=[{biome:c,frequency:35},{biome:l,frequency:1},{biome:f,frequency:4},{biome:d,frequency:76},{biome:_,frequency:4},{biome:p,frequency:20},{biome:g,frequency:6},{biome:w,frequency:6},{biome:v,frequency:28},{biome:b,frequency:4},{biome:m,frequency:14},{biome:y,frequency:2},{biome:k,frequency:32},{biome:C,frequency:16},{biome:S,frequency:4}],this.biomesTotalFrequency=0;var x,M=r(this.biomes);try{for(M.s();!(x=M.n()).done;){var P=x.value;this.biomesTotalFrequency+=P.frequency,P.biome.init()}}catch(E){M.e(E)}finally{M.f()}this.stoneTypes=[{stoneId:h.Stone.id,frequency:100},{stoneId:h.Andesite.id,frequency:4},{stoneId:h.Diorite.id,frequency:2},{stoneId:h.Granite.id,frequency:1}],this.stonesTotalFrequency=0;var R,T=r(this.stoneTypes);try{for(T.s();!(R=T.n()).done;){var A=R.value;this.stonesTotalFrequency+=A.frequency}}catch(E){T.e(E)}finally{T.f()}}return s(e,[{key:"_getBiomeForBiomePoint",value:function(e){if(this.mostRecentlyAccessedBiome&&e[0]===this.mostRecentlyAccessedPtForBiome[0]&&e[1]===this.mostRecentlyAccessedPtForBiome[1])return this.mostRecentlyAccessedBiome;for(var t=new N("".concat(e[0],"|").concat(e[1],"|").concat(this.seed)),n=Math.floor(t.next()*this.biomesTotalFrequency),i=0,r=0;i<=n;)i+=this.biomes[r].frequency,r++;var o={biome:this.biomes[r-1].biome,biomeId:r-1};return this.mostRecentlyAccessedBiome=o,this.mostRecentlyAccessedPtForBiome[0]=e[0],this.mostRecentlyAccessedPtForBiome[1]=e[1],o}},{key:"getBiomeModifiersForBiomePoint",value:function(e){if(this.mostRecentlyAccessedModifier&&e[0]===this.mostRecentlyAccessedModifierPt[0]&&e[1]===this.mostRecentlyAccessedModifierPt[1])return this.mostRecentlyAccessedModifier;for(var t=new N("".concat(e[0],"|").concat(e[1],"|").concat(this.seed,"Modifiers")),n=Math.floor(t.next()*this.stonesTotalFrequency),i=0,r=0;i<=n;)i+=this.stoneTypes[r].frequency,r++;var o={stoneTypeId:this.stoneTypes[r-1].stoneId};return this.mostRecentlyAccessedModifier=o,this.mostRecentlyAccessedModifierPt[0]=e[0],this.mostRecentlyAccessedModifierPt[1]=e[1],o}},{key:"getBiomeInfoForChunkFill",value:function(e,t,n){for(var i={biomeIds:new F(this.chunkSize,[e,t]),stoneTypeIds:new F(this.chunkSize,[e,t])},r=e;r<e+this.chunkSize;r++)for(var o=t;o<t+this.chunkSize;o++){var a=n.get(r,o)[0];i.biomeIds.set(r,o,a.biomeId),i.stoneTypeIds.set(r,o,a.biomeModifiers.stoneTypeId)}return i}},{key:"getBiomeFromId",value:function(e){return this.biomes[e].biome}}]),e}(),Re=function(){function e(t,n,i,r,a,s,h,u){o(this,e),this.seed=void 0,this.chunkSize=void 0,this.biomeSelector=void 0,this.cavesGenerator=void 0,this.treeGenerator=void 0,this.blockMetadata=void 0,this.oreGenerator=void 0,this.baseBiome=void 0,this.clayGenerator=void 0,this.seed=u,this.chunkSize=t,this.biomeSelector=n,this.cavesGenerator=i,this.treeGenerator=r,this.blockMetadata=a,this.oreGenerator=s,this.baseBiome=h,this.clayGenerator=new W(50,!1,!0,u,4,t,null,!0)}return s(e,[{key:"fillChunk",value:function(e,t,n,i,r,o,a,s,h){if(!(n+this.chunkSize<=w.bedrockLevel)){for(var u=-1e4,c=1e4,l=-1e4,f=1e4,d=!1,p=t;p<t+this.chunkSize;p++)for(var v=i;v<i+this.chunkSize;v++){u=Math.max(u,r.groundHeights.get(p,v)),c=Math.min(c,r.groundHeights.get(p,v));var g=r.waterHeights.get(p,v);g!==k&&(d=!0,l=Math.max(l,g),f=Math.min(f,g))}if(u>=n&&c<n+this.chunkSize)for(var m=t;m<t+this.chunkSize;m++)for(var y=i;y<i+this.chunkSize;y++){var b=h.biomeIds.get(m,y),C=this.biomeSelector.getBiomeFromId(b),S=r.groundHeights.get(m,y);S>=n&&S<n+this.chunkSize&&e.set(m-t,S-n,y-i,C.getTopsoilBlock(m,S,y))}if(u+1>=n&&c-4<n+this.chunkSize)for(var _=t;_<t+this.chunkSize;_++)for(var x=i;x<i+this.chunkSize;x++)for(var M=h.biomeIds.get(_,x),R=this.biomeSelector.getBiomeFromId(M),T=r.groundHeights.get(_,x),A=Math.min(T,n+this.chunkSize),E=Math.max(T-4,n);E<A;E++)e.set(_-t,E-n,x-i,R.getLowsoilBlockType(_,E,x,T));if(u-4>=n)for(var O=t;O<t+this.chunkSize;O++)for(var L=i;L<i+this.chunkSize;L++)for(var B=h.stoneTypeIds.get(O,L),D=r.groundHeights.get(O,L),I=Math.min(D-4,n+this.chunkSize),N=n;N<I;N++)e.set(O-t,N-n,L-i,B);if(u-4>=n)for(var F=t;F<t+this.chunkSize;F++)for(var j=i;j<i+this.chunkSize;j++){var z=r.groundHeights.get(F,j),H=s.get(F,j);this.oreGenerator.addOresToColumn(e,F,j,t,n,i,z-4,H)}if(u>=n&&this.cavesGenerator.addCavesToChunk(e,t,n,i,a),w.bedrockLevel>=n&&w.bedrockLevel<n+this.chunkSize)for(var q=t;q<t+this.chunkSize;q++)for(var U=i;U<i+this.chunkSize;U++)e.set(q-t,w.bedrockLevel-n,U-i,this.blockMetadata.Bedrock.id);if(u+this.baseBiome.maxFloraHeight>=n&&c+1<n+this.chunkSize)for(var G=t;G<t+this.chunkSize;G++)for(var W=i;W<i+this.chunkSize;W++){var Y=h.biomeIds.get(G,W),V=this.biomeSelector.getBiomeFromId(Y),K=V.maxFloraHeight,J=r.groundHeights.get(G,W);if(!(J>=n+this.chunkSize||J<n-K))if(r.waterHeights.get(G,W)===k)this.cavesGenerator.isCave(G,J,W,a)||V.floraGenerator.addBiomeFloraToColumn(e,t,i,G,n,W,J)}if(u+this.treeGenerator.maxTreeHeight>=n)for(var X=t;X<t+this.chunkSize;X++)for(var Z=n;Z<n+this.chunkSize;Z++)for(var $=i;$<i+this.chunkSize;$++){var Q=o.get(X,$);if(void 0!==Q){var ee=this.treeGenerator.getTreeBlock(X,Z,$,r.groundHeights,Q);ee&&e.set(X-t,Z-n,$-i,ee)}}if(d&&l>=n)for(var te=t;te<t+this.chunkSize;te++)for(var ne=i;ne<i+this.chunkSize;ne++){var ie=r.waterHeights.get(te,ne);if(ie!==k)for(var re=h.biomeIds.get(te,ne),oe=this.biomeSelector.getBiomeFromId(re),ae=r.groundHeights.get(te,ne),se=Math.min(ie+1,n+this.chunkSize),he=Math.max(ae+1,n);he<se;he++){var ue=he===ie?oe.topwaterBlockType:this.blockMetadata.Water.id;e.set(te-t,he-n,ne-i,ue)}}if(d&&u>=n&&c<n+this.chunkSize)for(var ce=t;ce<t+this.chunkSize;ce++)for(var le=i;le<i+this.chunkSize;le++){var fe=r.waterHeights.get(ce,le),de=r.groundHeights.get(ce,le);if(fe!==k&&de>=n&&de<n+this.chunkSize)if(fe===de)e.set(ce-t,de-n,le-i,this.blockMetadata.Sand.id);else if(P(this.clayGenerator.getClosestPoint(ce,le),ce,le)<100)e.set(ce-t,de-n,le-i,this.blockMetadata.Clay.id),de-1>=n&&e.set(ce-t,de-1-n,le-i,this.blockMetadata.Clay.id),de-2>=n&&e.set(ce-t,de-2-n,le-i,this.blockMetadata.Clay.id);else{var pe=h.biomeIds.get(ce,le),ve=this.biomeSelector.getBiomeFromId(pe);e.set(ce-t,de-n,le-i,ve.getLowsoilBlockType(ce,de,le,de))}}}}}]),e}(),Te=n(1075);function Ae(){return ue}var Ee,Oe,Le=function(){function e(t,n,i,a){o(this,e),this.chunkSize=void 0,this.biomePointGen=void 0,this.treeRadius=2,this.neededOutsideChunkHeightRadius=this.treeRadius,this.treeGenerator=void 0,this.seed=void 0,this.biomeOffsetSimplex=void 0,this.globalHeightmap=void 0,this.heightmapPerturb=void 0,this.cavesGenerator=void 0,this.biomeSelector=void 0,this.waterBodyGenerator=void 0,this.needOutsideWaterDist=15,this.mostRecentlyAccessedChunkColumnPos=[0,0],this.mostRecentlyAccessedChunkColumn=null,this.cachedChunkColumnInfos=void 0,this.chunkFiller=void 0,this.isServer=void 0,ue=a,this.seed=i,this.cachedChunkColumnInfos=new(G())({max:a?400:200,ttl:3e4,updateAgeOnGet:!0}),this.cavesGenerator=new Z(i,t,this.neededOutsideChunkHeightRadius);var s=new ne(n,i,t);this.biomeSelector=new Pe(this,this.cavesGenerator,s,i,t,n),this.treeGenerator=new $(this,this.cavesGenerator,t,i,n),this.chunkSize=t,this.biomePointGen=new W(150,!1,!0,i,3,t),this.biomeOffsetSimplex=new D([{amplitude:1,frequency:.2},{amplitude:5,frequency:1/70}],"".concat(i,"BiomeOffsetSimplex")),this.globalHeightmap=new D([{amplitude:11,frequency:1/4e3},{amplitude:4,frequency:.001}],"".concat(i,"GlobalHeightmapOffset")),this.heightmapPerturb=new D([{amplitude:1,frequency:1/14},{amplitude:5,frequency:1/65},{amplitude:20,frequency:.004}],"".concat(i,"HeightmapPerturb"));var h,u=0,c=r(this.heightmapPerturb.customOctaves);try{for(c.s();!(h=c.n()).done;){u+=h.value.amplitude}}catch(l){c.e(l)}finally{c.f()}this.waterBodyGenerator=new te(this,i,u,this.needOutsideWaterDist),this.chunkFiller=new Re(t,this.biomeSelector,this.cavesGenerator,this.treeGenerator,n,s,this.biomeSelector.baseBiome,i)}return s(e,[{key:"getChunk",value:function(e,t,n,i){try{this._getChunk(e,t,n,i);var r=Q.encode(e.data),o=String.fromCharCode.apply(null,r);return{hash:(new Te).update(o).digest("hex")}}catch(a){console.log(a.stack),console.error(a.stack)}}},{key:"_getChunk",value:function(e,t,n,i){var r=this.getInfoForChunkColumn(t,i),o=r.biomeInfos,a=r.heightmapVals,s=r.caveInfos,h=r.treeTrunksAroundPoints,u=r.chunkOres;this.chunkFiller.fillChunk(e,t,n,i,a,h,s,u,o)}},{key:"getInfoForChunkColumn",value:function(e,t){if(this.mostRecentlyAccessedChunkColumn&&this.mostRecentlyAccessedChunkColumnPos[0]===e&&this.mostRecentlyAccessedChunkColumnPos[1]===t)return this.mostRecentlyAccessedChunkColumn;var n="".concat(e,"|").concat(t),i=this.cachedChunkColumnInfos.get(n);if(i)return this.mostRecentlyAccessedChunkColumnPos[0]=e,this.mostRecentlyAccessedChunkColumnPos[1]=t,this.mostRecentlyAccessedChunkColumn=i,i;var r=this._getClosestBiomesForChunk(e,t),o=this.getHeightMapVals(e,t,r),a=this.cavesGenerator.getCaveInfoForChunk(e,t,o),s=this.treeGenerator._getTreeTrunksForBlocksInChunk(e,t,o,r,a),h=r.get(e+Math.floor(this.chunkSize/2),t+Math.floor(this.chunkSize/2))[0].biome.oreGenerator.getOreBlocksForChunk(e,t),u={biomeInfos:this.biomeSelector.getBiomeInfoForChunkFill(e,t,r),heightmapVals:o,caveInfos:a,treeTrunksAroundPoints:s,chunkOres:h};return this.mostRecentlyAccessedChunkColumnPos[0]=e,this.mostRecentlyAccessedChunkColumnPos[1]=t,this.mostRecentlyAccessedChunkColumn=u,this.cachedChunkColumnInfos.set(n,u),u}},{key:"_getClosestBiomesForChunk",value:function(e,t){for(var n=new z(this.chunkSize,[e,t],this.neededOutsideChunkHeightRadius),i=e-this.neededOutsideChunkHeightRadius;i<e+this.chunkSize+this.neededOutsideChunkHeightRadius;++i)for(var r=t-this.neededOutsideChunkHeightRadius;r<t+this.chunkSize+this.neededOutsideChunkHeightRadius;++r){var o=this.getClosestBiomes(i,r);n.set(i,r,o)}return n}},{key:"getClosestBiomes",value:function(e,t){for(var n=this._getBiomeXOffset(e,t),i=this._getBiomeZOffset(e,t),r=this.biomePointGen.getKClosestPointsWithWeights(e+n,t+i,60),o=[],a=0;a<r.length;a++){var s=r[a],h=this.biomeSelector._getBiomeForBiomePoint(s.pt),u=h.biome,c=h.biomeId,l={weight:s.weight,biome:u,biomeId:c,biomeModifiers:null};0===a&&(l.biomeModifiers=this.biomeSelector.getBiomeModifiersForBiomePoint(s.pt)),o.push(l)}return o}},{key:"_getBiome",value:function(e,t){var n=this._getBiomeXOffset(e,t),i=this._getBiomeZOffset(e,t),r=this.biomePointGen.getClosestPoint(e+n,t+i);return this.biomeSelector._getBiomeForBiomePoint(r)}},{key:"_getBiomeXOffset",value:function(e,t){return Math.floor(this.biomeOffsetSimplex.getOctaves(e,t))}},{key:"_getBiomeZOffset",value:function(e,t){return Math.floor(this.biomeOffsetSimplex.getOctaves(e+500,t+860))}},{key:"getHeightMapVals",value:function(e,t,n){for(var i={groundHeights:new F(this.chunkSize,[e,t],this.neededOutsideChunkHeightRadius),waterHeights:new F(this.chunkSize,[e,t],this.neededOutsideChunkHeightRadius),cavesAllowedBelowY:new F(this.chunkSize,[e,t],this.neededOutsideChunkHeightRadius)},r=e-this.neededOutsideChunkHeightRadius;r<e+this.chunkSize+this.neededOutsideChunkHeightRadius;++r)for(var o=t-this.neededOutsideChunkHeightRadius;o<t+this.chunkSize+this.neededOutsideChunkHeightRadius;++o){var a=n.get(r,o),s=Math.floor(this.heightmapPerturb.getOctaves(r,o)),h=Math.floor(this.heightmapPerturb.getOctaves(r+200,o+778)),u=this.getWithWaterHeightmapVal(r+s,o+h,a),c=u.groundHeight,l=u.waterHeight,f=u.cavesAllowedBelowY;i.groundHeights.set(r,o,c),i.waterHeights.set(r,o,l),i.cavesAllowedBelowY.set(r,o,f);var d=Math.min(Math.abs((r-300)%1e3),1e3-Math.abs((r-300)%1e3)),p=Math.min(Math.abs((o-300)%1e3),1e3-Math.abs((o-300)%1e3)),v=Math.max(Math.abs(r),Math.abs(o));(v<50||v>1e4&&Math.max(d,p)<50)&&i.cavesAllowedBelowY.set(r,o,c-15)}return i}},{key:"getWithWaterHeightmapVal",value:function(e,t,n){var i=this.getNoWaterHeightmapVal(e,t,n),r=this.waterBodyGenerator.getInfoNeededForWaterGen(e,t),o=r.distFromWater,a=r.waterRadius,s=r.waterHeight,h=r.waterbedHeight,u=r.isLake,c=0,l=k,f=1e4,d=a+this.needOutsideWaterDist;if(o<=d){var p=a+4,v=s+2;if(o<=a){var g=o/a;u?(g*=g*g,c=Math.floor(h+(s-h)*g-2)):(g*=g,c=Math.floor(h+(s-h)*g)),l=s}else if(o<=p){var m=(o-a)/(p-a);c=s+Math.ceil((v-s)*m)}else{var y=(o-p)/(d-p);c=v+Math.ceil((i-v)*y)}f=c-15}else c=i;return{groundHeight:c,waterHeight:l,cavesAllowedBelowY:f}}},{key:"getNoWaterHeightmapVal",value:function(e,t,n){var i,o=e,a=t,s=0,h=r(n);try{for(h.s();!(i=h.n()).done;){var u=i.value,c=u.biome,l=u.weight;s+=c.getHeightmapVal(o,a)*l}}catch(d){h.e(d)}finally{h.f()}var f=this.globalHeightmap.getOctaves(o,a);return Math.floor(s)+Math.floor(f)}}]),e}(),Be=n(7786),De={};self.onmessage=function(e){var t=e.data;switch(t.type){case"workerInit":Ee=t.chunkSize,Oe=t.blockMetadata;break;case"createSeed":De[t.seed]=new Le(Ee,Oe,t.seed,!1);break;case"deleteSeed":delete De[t.seed];break;case"chunk":var n=t.id,r=t.array;r=Be(new Uint16Array(r.data.buffer),[Ee,Ee,Ee]);var o=i(n.split("|"),4),a=o[0],s=o[1],h=o[2],u=o[3];a=parseInt(a),s=parseInt(s),h=parseInt(h);var c=De[u].getChunk(r,a,s,h),l=[r.data.buffer];self.postMessage({id:n,array:r,metadata:c},l);break;default:console.error("Unrecognised data.type")}}}()}();',"Worker",void 0,r.p+"static/js/procGen.worker.0b63992a.worker.js")}var ye=r(47786),_e=r(85882);function be(e){var t=e.split("|"),r=(0,ue.Z)(t,3),n=r[0],i=r[1],o=r[2];return[Number(n),Number(i),Number(o)]}var Se=he._G.chunkSize,Ae=0|Math.log2(Se),xe=Se-1|0;function Ce(e){return e>>Ae|0}function Me(e){return[e[0]>>Ae|0,e[1]>>Ae|0,e[2]>>Ae|0]}function Te(e){return e&xe|0}function Pe(e,t,r){var n=he._G.chunkSize;return[0|Math.floor(e/n),0|Math.floor(t/n),0|Math.floor(r/n)]}var Ie=ye(new Uint16Array(Se*Se*Se),[Se,Se,Se]);_e.encode(Ie.data);le=Symbol.iterator;var ke,Ee,Re=function(){function e(){(0,f.Z)(this,e),this.storage={},this.zeroStorage={},this.iteratorArr=[]}return(0,p.Z)(e,[{key:"set",value:function(e,t,r,n){var i=1023&e|(1023&t)<<10|(1023&r)<<20;if(Math.abs(e)<512&&Math.abs(t)<512&&Math.abs(r)<512)this.zeroStorage[i]={x:e,y:t,z:r,val:n};else{var o=e>>10&1023|(t>>10&1023)<<10|(r>>10&1023)<<20;this.storage[o]||(this.storage[o]={}),this.storage[o][i]={x:e,y:t,z:r,val:n}}}},{key:"get",value:function(e,t,r){var n=1023&e|(1023&t)<<10|(1023&r)<<20;if(Math.abs(e)<512&&Math.abs(t)<512&&Math.abs(r)<512){var i=this.zeroStorage[n];return null===i||void 0===i?void 0:i.val}var o=e>>10&1023|(t>>10&1023)<<10|(r>>10&1023)<<20;if(this.storage[o]){var s=this.storage[o][n];return null===s||void 0===s?void 0:s.val}}},{key:"remove",value:function(e,t,r){var n=1023&e|(1023&t)<<10|(1023&r)<<20;if(Math.abs(e)<512&&Math.abs(t)<512&&Math.abs(r)<512)delete this.zeroStorage[n];else{var i=e>>10&1023|(t>>10&1023)<<10|(r>>10&1023)<<20;this.storage[i]&&delete this.storage[i][n]}}},{key:"checkStoredInfo",value:function(e,t,r,n){!n||n.x===e&&n.y===t&&n.z===r||console.error(new Error("LocationStorage: storedInfo does not match requested coords. Passed coords ".concat(e,", ").concat(t,", ").concat(r,", existingCoords/storedInfo: ").concat(JSON.stringify(n))).stack)}},{key:le,value:function(){var e=0;for(var t in e=this.addObjsFromInnerStorage(this.zeroStorage,this.iteratorArr,e),this.storage){var r=Number(t);e=this.addObjsFromInnerStorage(this.storage[r],this.iteratorArr,e)}return this.iteratorArr.length=e,this.iteratorArr.values()}},{key:"addObjsFromInnerStorage",value:function(e,t,r){for(var n in e)t[r++]=e[n];return r}}]),e}(),we=r(80427),Be=r(77604),De={},Oe=function(e){return!!De[e]},Le=!1,Fe=new fe(N.blockMetadata,(function(){return new ve})),Ne={};function Ue(e){e.worldName="overworld",(0,l.rp)(we.cU.mapSettings,(function(t){var r=t.useWorldGen,n=t.worldGenSeed;ke=r,Fe.destroySeed(Ee),Ee=n,ke&&Fe.initialiseSeed(n),e.world.markAllChunksForRemoval(),e.world._chunksPending.empty(),e.world._chunkAddSearchFrom=0,De={},Ne={},Le=!0})),e.world.maxChunksPendingCreation=10,e.world.on("worldDataNeeded",(function(t,r,n,i,o,s){if(Le)if(Ne[t]||(Ne[t]=[]),Oe(t))Ne[t].push({id:t,array:r,x:n,y:i,z:o,worldName:s}),(0,l.Xi)(we.Vz.needChunk,{id:t,lastSeen:De[t].lastSeen,hash:null});else if(ke)try{Fe.threadedGetChunk(Ee,r,n,i,o,(function(e,r){Le&&(Ne[t].push({id:t,array:e,x:n,y:i,z:o,worldName:s}),r.hash||console.error("metadata.hash is",r.hash),(0,l.Xi)(we.Vz.needChunk,{id:t,lastSeen:null,hash:r.hash}))}))}catch(a){e.logErrorMessage("Error in worldgen",a),console.error(a.stack)}else Ne[t].push({id:t,array:r,x:n,y:i,z:o,worldName:s}),(0,l.Xi)(we.Vz.needChunk,{id:t,lastSeen:null,hash:null})})),(0,l.rp)(we.cU.chunk,(function(t){try{!function(t){var r=Ne[t.id].shift();t.id!==r.id&&console.error("serverResp.id !== noaRequest.id",t.id,r.id);0===Ne[t.id].length&&delete Ne[t.id];var n=be(t.id),i=(0,ue.Z)(n,3),o=i[0],s=i[1],a=i[2];if(t.RLEArr){var u=new Uint8Array(t.RLEArr);ce.decode(u,r.array.data),e.world.setChunkData(t.id,r.array,null);var c=t.sharedBlockData?JSON.parse(Be.inflate(t.sharedBlockData,{to:"string"})):[];return void(0,l.rL)().chunkAdded(o,s,a,r.array,c)}var h=[];Oe(r.id)&&(d=r.id,f=r.array,ce.decode(De[d].blockArr,f.data),h=De[d].sharedBlockData?JSON.parse(Be.inflate(De[d].sharedBlockData,{to:"string"})):[]);var d,f;e.world.setChunkData(r.id,r.array,null),(0,l.rL)().chunkAdded(o,s,a,r.array,h)}(t)}catch(r){console.error("err in processChunk func\n",r.stack),e.logErrorMessage("Error in worldgen processChunk func",r)}})),e.world.on("chunkBeingRemoved",(function(e,r,n){var i=be(e),o=(0,ue.Z)(i,3),s=o[0],a=o[1],u=o[2];!t&&Le&&function(e,t,r){De[e]||(De[e]={blockArr:null,lastSeen:null,sharedBlockData:null}),De[e].blockArr=ce.encode(t.data),De[e].lastSeen=Date.now(),De[e].sharedBlockData=r.length>0?Be.deflate(JSON.stringify(r)):null}(e,r,(0,l.rL)().blockDataOwner.getSharedBlockArr(s,a,u)),(0,l.rL)().blockDataOwner.removingChunk(s,a,u,!1)})),(0,l.rp)(we.cU.blockChanged,(function(e){var t=e.newId,r=e.pos;(0,l.rL)().setBlock(r[0],r[1],r[2],t)}));var t=!1;(0,l.rp)(we.cU.resetMap,(function(){De={},t=!0,e.world.markAllChunksForRemoval(),t=!1})),(0,l.rp)(we.cU.resetChunk,(function(r){var n=be(r),i=(0,ue.Z)(n,3),o=i[0],s=i[1],a=i[2],u=he.ZP.chunkSize;t=!0;var c={base:[o*u,s*u,a*u],max:[o*u+1,s*u+1,a*u+1]};e.world.invalidateVoxelsInAABB(c),t=!1,(0,l.rL)().removingChunk(o,s,a,!1),delete De[r]}));var i,s=e.rendering.getScene();window.enablePerfInstru=(0,n.Z)(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(r,23257));case 2:e.t0=e.sent.SceneInstrumentation,e.t1=s,i=new e.t0(e.t1),t={},s.registerBeforeRender((function(){s.meshes.forEach((function(e){e.onBeforeDraw=function(){t[e.name]?t[e.name]++:t[e.name]=1}})),window.drawCounts=t,window.totalDrawCount=Object.values(t).reduce((function(e,t){return e+t}),0),t={}}));case 7:case"end":return e.stop()}}),e)}))),window.capturePerfInfo=function(){i.captureActiveMeshesEvaluationTime=!0,i.captureRenderTargetsRenderTime=!0,i.captureFrameTime=!0,i.captureRenderTime=!0,i.captureInterFrameTime=!0,i.captureParticlesRenderTime=!0,i.captureSpritesRenderTime=!0,i.capturePhysicsTime=!0,i.captureCameraRenderTime=!0},window.logPerfInfo=function(){console.log({activeMeshesEvaluationTimeCounter:i.activeMeshesEvaluationTimeCounter,renderTargetsRenderTimeCounter:i.renderTargetsRenderTimeCounter,drawCallsCounter:i.drawCallsCounter,frameTimeCounter:i.frameTimeCounter,renderTimeCounter:i.renderTimeCounter,interFrameTimeCounter:i.interFrameTimeCounter,particlesRenderTimeCounter:i.particlesRenderTimeCounter,spritesRenderTimeCounter:i.spritesRenderTimeCounter,physicsTimeCounter:i.physicsTimeCounter,cameraRenderTimeCounter:i.cameraRenderTimeCounter})},window.disablePerfInfo=function(){var e=new pe.SceneInstrumentation(s);e.captureActiveMeshesEvaluationTime=!1,e.captureRenderTargetsRenderTime=!1,e.captureFrameTime=!1,e.captureRenderTime=!1,e.captureInterFrameTime=!1,e.captureParticlesRenderTime=!1,e.captureSpritesRenderTime=!1,e.capturePhysicsTime=!1,e.captureCameraRenderTime=!1},window.printDrawcalls=function(){console.log(i.drawCallsCounter.current)}}var We=r(85853),Ge=r(38172),ze=r(41494);function je(e){!function(e){var t=r(71173);t.keys().forEach((function(r){var n=/\.\/(.*)\.(js|ts)/.exec(r)[1],i=t(r);i.default&&(i=i.default);var o=i(e),s=e.entities.createComponent(o);e.ents.names[n]=s}));var n=e.entities;n.getGenericPlayerState=n.getStateAccessor("genericPlayerState");var i=n.getStateAccessor("heldItem");n.getHeldItemState=i,n.getHeldItem=function(e){return i(e).heldItem},n.getPlayerMeshState=n.getStateAccessor("playerMesh"),n.getHitboxState=n.getStateAccessor("hitbox");var o=n.getStateAccessor("receivesInputs");n.getReceivesInputs=function(){return o(e.playerEntity)}}(e),function(e){e.blockTargetIdCheck=function(t){return 0!==t&&!e.registry.getBlockFluidity(t)};var t=e.entities;t.getMovement=t.getStateAccessor("movement"),t.getMoveState=t.getStateAccessor("moveState");var r=t.getStateAccessor("inventory");t.getInventoryState=r,t.getInventory=function(e){return r(e).inventory},t.getInvenOps=function(e){return r(e).opWrapper},t.hasInventory=t.getComponentAccessor("inventory")}(e)}var Ve=r(93433),He=r(20306),qe=r(38017),Ze=qe.blockIdToName,Ke=qe.blockMetadata,Ye=function(){function e(t,r){(0,f.Z)(this,e),this.noa=void 0,this.bloxd=void 0,this.noa=t,this.bloxd=r}return(0,p.Z)(e,[{key:"playerCanPlaceItem",value:function(e,t,r,n,i){if(!(i in He.E))return console.error("Called for non multiblock ".concat(i)),!1;var o,s=(0,b.Z)(He.E[i].positions);try{for(s.s();!(o=s.n()).done;){var a=o.value,l=a.block,u=a.x,c=a.y,h=a.z,d=this.bloxd.getBlock(t+u,r+c,n+h);if(this.noa.blockTargetIdCheck(d)||!this.bloxd.playerCanChangePos(e,t+u,r+c,n+h,Ke[l].id))return!1}}catch(f){s.e(f)}finally{s.f()}return!0}},{key:"getPositionsIfMultiblock",value:function(e,t){var r,n=[],i=(0,b.Z)(He.E[t].positions);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=(o.block,o.x),a=o.y,l=o.z;n.push([e[0]+s,e[1]+a,e[2]+l])}}catch(u){i.e(u)}finally{i.f()}return n}},{key:"setBlock",value:function(e,t,r,n){var i=Ze(this.bloxd.getBlock(e,t,r));if(i in He.a){var o,s=He.a[i],a=s.mainMultiblock,l=s.compX,u=s.compY,c=s.compZ,h=(0,b.Z)(He.E[a].positions);try{for(h.s();!(o=h.n()).done;){var d=o.value,f=d.x,p=d.y,m=d.z;this.bloxd.setBlockNoMulti(e+f-l,t+p-u,r+m-c,0)}}catch(M){h.e(M)}finally{h.f()}}var g=Ze(n);if(g in He.E){var v,y=(0,b.Z)(He.E[g].positions);try{for(y.s();!(v=y.n()).done;){var _=v.value,S=_.block,A=_.x,x=_.y,C=_.z;this.bloxd.setBlockNoMulti(e+A,t+x,r+C,Ke[S].id)}}catch(M){y.e(M)}finally{y.f()}}else this.bloxd.setBlockNoMulti(e,t,r,n)}}]),e}(),Xe=r(47077),Qe=r.n(Xe),Je=function(){function e(t,r){(0,f.Z)(this,e),this.noa=void 0,this.bloxd=void 0,this.currMapName=void 0,this.storage=new Re,this.noa=t,this.bloxd=r}return(0,p.Z)(e,[{key:"chunkAdded",value:function(e,t,r,n){this.storage.get(e,t,r)&&console.error(new Error("adding chunk x y z ".concat(e," ").concat(t," ").concat(r," to dataowner that already exists")).stack),this.storage.set(e,t,r,{});var i,o,s=(0,b.Z)(n);try{for(s.s();!(i=s.n()).done;){var a=i.value,l=a.pos,u=a.data,c=a.persisted;(l[0]>31||l[1]>31||l[2]>31||l[0]<0||l[1]<0||l[2]<0)&&(l=[(o=l)[0]&xe|0,o[1]&xe|0,o[2]&xe|0]),this.storage.get(e,t,r)["".concat(l[0],"|").concat(l[1],"|").concat(l[2])]=null!==u&&void 0!==u?u:{persisted:c}}}catch(h){s.e(h)}finally{s.f()}}},{key:"getPersistedBlockArr",value:function(e,t,r){var n=[],i=this.storage.get(e,t,r);for(var o in i){var s=o.split("|"),a=(0,ue.Z)(s,3),l=a[0],u=a[1],c=a[2];if(void 0!==i[o].persisted){var h=[Number(l),Number(u),Number(c)];n.push({pos:h,persisted:i[o].persisted})}}return n}},{key:"getSharedBlockArr",value:function(e,t,r){var n=[],i=this.storage.get(e,t,r);for(var o in i){var s=o.split("|"),a=(0,ue.Z)(s,3),u=a[0],c=a[1],h=a[2],d=[Number(u),Number(c),Number(h)];if((0,l.Rw)(i[o]))console.error("ChunkInfo block at local pos",o,"was nullish:",i[o]);else{var f=this.getSharedDataForBlock(d[0],d[1],d[2],i[o]);f&&n.push({pos:d,data:f})}}return n}},{key:"removingChunk",value:function(e,t,r,n){var i=this.storage.get(e,t,r),o=[e*he.ZP.chunkSize,t*he.ZP.chunkSize,r*he.ZP.chunkSize];for(var s in i){var a=s.split("|"),l=[Number(a[0]),Number(a[1]),Number(a[2])],u=Qe().add([0,0,0],l,o),c=this.bloxd.getBlock(u[0],u[1],u[2]);this.bloxd.onBlockRemoved(u[0],u[1],u[2],c,n)}this.storage.remove(e,t,r)}},{key:"blockChanged",value:function(e,t,r){var n=Ce(e),i=Ce(t),o=Ce(r),s=this.storage.get(n,i,o);if(s){var a=Te(e),l=Te(t),u=Te(r);delete s["".concat(a,"|").concat(l,"|").concat(u)]}}},{key:"getBlockData",value:function(e,t,r){var n=Ce(e),i=Ce(t),o=Ce(r),s=Te(e),a=Te(t),l=Te(r);return this.storage.get(n,i,o)["".concat(s,"|").concat(a,"|").concat(l)]}},{key:"setBlockData",value:function(e,t,r,n){var i=Ce(e),o=Ce(t),s=Ce(r),a=this.storage.get(i,o,s),l=Te(e),u=Te(t),c=Te(r);if(a)if(void 0!==n){var h=[e,t,r],d=this.getSharedDataForBlock(e,t,r,n);if(!this.bloxd.isClient&&d){this.bloxd.room.api.flushOptimisedSetBlocks(),this.bloxd.room.broadcast(we.cU.setBlockData,{pos:h,data:d});var f=this.bloxd.getBlock(e,t,r);this.bloxd.room.map.setBlock(h[0],h[1],h[2],f)}a["".concat(l,"|").concat(u,"|").concat(c)]=n}else delete a["".concat(l,"|").concat(u,"|").concat(c)]}},{key:"getSharedDataForBlock",value:function(e,t,r,n){var i,o=null!==n&&void 0!==n?n:this.getBlockData(e,t,r);if(void 0!==(null===o||void 0===o||null===(i=o.persisted)||void 0===i?void 0:i.shared))return o}}]),e}(),$e=r(4942);r(4088),r(47786);var et,tt,rt=function(){function e(t){(0,f.Z)(this,e),this.a=void 0;for(var r=2166136261,n=0;n<t.length;n++)r=Math.imul(r^t.charCodeAt(n),16777619);this.a=r}return(0,p.Z)(e,[{key:"next",value:function(){var e=this.a+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296}}]),e}();!function(e){e[e.Maple=0]="Maple",e[e.Pine=1]="Pine",e[e.Plum=2]="Plum",e[e.Cedar=4]="Cedar",e[e.Aspen=5]="Aspen",e[e.Elm=6]="Elm",e[e.Palm=7]="Palm",e[e.AutumnMaple=8]="AutumnMaple",e[e.Pear=9]="Pear"}(et||(et={}));var nt=[N.default["Aspen Sapling"].id,N.default["Maple Sapling"].id,N.default["Elm Sapling"].id,N.default["Plum Sapling"].id,N.default["Pine Sapling"].id,N.default["Cedar Sapling"].id,N.default["Palm Sapling"].id,N.default["Pear Sapling"].id,N.default["Dry Fat Cactus"].id,N.default["Dirt|GrassRoots"].id,N.default["Wheat Seeds"].id,N.default.Wheat_stage1.id,N.default.Wheat_stage2.id,N.default.Wheat_stage3.id,N.default.Wheat_stage4.id,N.default.Wheat_stage5.id],it=(tt={},(0,$e.Z)(tt,N.default["Wheat Seeds"].id,{into:"Wheat_stage1",duration:35e3}),(0,$e.Z)(tt,N.default.Wheat_stage1.id,{into:"Wheat_stage2",duration:35e3}),(0,$e.Z)(tt,N.default.Wheat_stage2.id,{into:"Wheat_stage3",duration:35e3}),(0,$e.Z)(tt,N.default.Wheat_stage3.id,{into:"Wheat_stage4",duration:35e3}),(0,$e.Z)(tt,N.default.Wheat_stage4.id,{into:"Wheat_stage5",duration:35e3}),(0,$e.Z)(tt,N.default.Wheat_stage5.id,{into:"Wheat|FreshlyGrown",duration:35e3}),tt),ot=function(){function e(t,r){var n=this;(0,f.Z)(this,e),this.chunkInfos=new Re,this.lastTickCheck=0,this.tickableIds=void 0,this.gameTickableCbs=void 0,this.playerLastTicks=Object.create(null),this.bloxd=void 0,this.room=void 0,this.bloxd=t,this.room=r,this.tickableIds=[!1],this.gameTickableCbs={};var i,o=function(e){for(;e>n.tickableIds.length;)n.tickableIds[n.tickableIds.length]=!1;n.tickableIds[e]=!0},s=(0,b.Z)(nt);try{for(s.s();!(i=s.n()).done;){var a=i.value;o(a)}}catch(h){s.e(h)}finally{s.f()}var l,u=function(e){var t,r,i=(0,b.Z)(null!==(t=null===e||void 0===e?void 0:e.tickableBlocks)&&void 0!==t?t:[]);try{for(i.s();!(r=i.n()).done;){var s,a=r.value,l=a.name,u=a.cb,c=(0,N.blockNameToId)(l);o(c);var d=null!==(s=n.gameTickableCbs[c])&&void 0!==s?s:[];d.push(u),n.gameTickableCbs[c]=d}}catch(h){i.e(h)}finally{i.f()}},c=(0,b.Z)(this.room.game.plugins);try{for(c.s();!(l=c.n()).done;){u(l.value)}}catch(h){c.e(h)}finally{c.f()}u(this.room.game)}return(0,p.Z)(e,[{key:"chunkAdded",value:function(e,t,r,n){this.chunkInfos.get(e,t,r)&&console.error(new Error("adding ticker to chunk that already exists").stack);var i={lastTick:0,tickablePos:null};this.chunkInfos.set(e,t,r,i);for(var o=[],s=he.ZP.chunkSize,a=e*s,l=t*s,u=r*s,c=0;c<n.data.length;c++){var h=n.data[c];if(this.tickableIds[h]){var d=(c/n.stride[0]|0)%s,f=(c/n.stride[1]|0)%s,p=(c/n.stride[2]|0)%s;o.push([a+d,l+f,u+p])}}i.tickablePos=o}},{key:"blockUpdated",value:function(e,t,r,n,i){if(!this.tickableIds[n]&&this.tickableIds[i]){var o=Ce(e),s=Ce(t),a=Ce(r);this.chunkInfos.get(o,s,a).tickablePos.push([e,t,r])}if(this.tickableIds[n]&&!this.tickableIds[i])for(var l=Ce(e),u=Ce(t),c=Ce(r),h=this.chunkInfos.get(l,u,c).tickablePos,d=0;d<h.length;d++)if(h[d][0]===e&&h[d][1]===t&&h[d][2]===r){h.splice(d,1);break}}},{key:"removingChunk",value:function(e,t,r){this.chunkInfos.remove(e,t,r)}},{key:"tick",value:function(){if(!(Date.now()-this.lastTickCheck<1e3)){this.lastTickCheck=Date.now();var e,t=this.room.api.getPlayerIds(),r=(0,b.Z)(t);try{for(r.s();!(e=r.n()).done;){var n=e.value;this.playerLastTicks[n]||(this.playerLastTicks[n]={hasNearbyTickables:!1,lastTick:0})}}catch(A){r.e(A)}finally{r.f()}for(var i in this.playerLastTicks)t.includes(i)||delete this.playerLastTicks[i];var o,s=(0,b.Z)(t);try{for(s.s();!(o=s.n()).done;){var a=o.value,l=this.playerLastTicks[a],u=l.hasNearbyTickables,c=l.lastTick,h=u?5e3:1e4;if(!(Date.now()-c<h)){this.playerLastTicks[a].lastTick=Date.now();for(var d=Me(this.room.api.getPosition(a)),f=(0,ue.Z)(d,3),p=f[0],m=f[1],g=f[2],v=p-5;v<=p+5;v++)for(var y=m-2;y<=m+2;y++)for(var _=g-5;_<=g+5;_++){var S=this.chunkInfos.get(v,y,_);(null===S||void 0===S?void 0:S.tickablePos.length)>0&&Date.now()-S.lastTick>5e3&&this.bloxd.hasChunkWithBlockCoordinates(v*he.ZP.chunkSize,y*he.ZP.chunkSize,_*he.ZP.chunkSize)&&(S.lastTick=Date.now(),this.tickChunk(v,y,_),this.playerLastTicks[a].hasNearbyTickables=!0)}}}}catch(A){s.e(A)}finally{s.f()}}}},{key:"tickChunk",value:function(e,t,r){var n,i=this.chunkInfos.get(e,t,r).tickablePos,o=(0,b.Z)(i);try{for(o.s();!(n=o.n()).done;){var s=(0,ue.Z)(n.value,3),a=s[0],l=s[1],u=s[2],c=this.room.getBlock(a,l,u);if(this.tickableIds[c]){var h=N.default[c].name,d=!1;if(this.gameTickableCbs[c]){var f,p=(0,b.Z)(this.gameTickableCbs[c]);try{for(p.s();!(f=p.n()).done;){var m=f.value;d=!0,m(a,l,u,h)}}catch(y){p.e(y)}finally{p.f()}}var g=h.split(" ");"Sapling"===g[g.length-1]?this.tickSapling(a,l,u,c):"Dry Fat Cactus"===h?this.tickDryFatCactus(a,l,u,c):"Dirt|GrassRoots"===h?this.tickDirtGrassRoots(a,l,u,c):it[c]?this.tickGrowable(a,l,u,c):d||console.error("Ticked unexpected block",a,l,u,c,h)}else{var v;console.error("pos ".concat(a," ").concat(l," ").concat(u," was stored in chunk with x y z ").concat(e," ").concat(t," ").concat(r," but ").concat(null===(v=N.default[c])||void 0===v?void 0:v.name," is not tickable"))}}}catch(y){o.e(y)}finally{o.f()}}},{key:"tickSapling",value:function(e,t,r,n){var i,o=this.bloxd.blockDataOwner.getBlockData(e,t,r);if(void 0===(null===(i=o)||void 0===i?void 0:i.growTime)&&(o=(0,S.Z)((0,S.Z)({},o),{},{growTime:Date.now()+7e4}),this.bloxd.blockDataOwner.setBlockData(e,t,r,o)),Date.now()>o.growTime){var s,a,l=new rt("".concat(Date.now()+e+r)),u=this.room.map.worldGenerator.treeGenerator.getRandTreeInfo(l),c=u.height,h=(u.vineDir,(0,N.blockIdToName)(n).split(" ")[0]),d={pos:[e,r],height:c,vineDir:-1,treeType:et[h]},f=this.room.map.worldGenerator.treeGenerator.getAllBlocksForTree(t,d),p=(0,b.Z)(f);try{for(p.s();!(a=p.n()).done;){var m,g=a.value,v=g.x,y=g.y,_=g.z,A=g.id;if(0===this.room.getBlock([v,y,_])||v===e&&y===t&&_===r)this.room.attemptWorldChangeBlock(null===(m=o.persisted)||void 0===m?void 0:m.planterDbId,v,y,_,A)}}catch(x){p.e(x)}finally{p.f()}this.room.getBlock([e,t,r])===n?this.room.setBlock([e,t,r],0):null!==(s=o.persisted)&&void 0!==s&&s.planterDbId&&this.bloxd.blockDataOwner.setBlockData(e,t,r,{persisted:{planterDbId:o.persisted.planterDbId}})}}},{key:"tickGrowable",value:function(e,t,r,n){var i=this.bloxd.blockDataOwner.getBlockData(e,t,r),o=it[n],s=o.into,a=o.duration;if(!i){var l=a;this.room.getBlock([e,t-1,r])===N.default["Tilled Soil"].id||(l*=1.3),i={growTime:Date.now()+l},this.bloxd.blockDataOwner.setBlockData(e,t,r,i)}Date.now()>i.growTime&&this.room.api.setBlock([e,t,r],s)}},{key:"tickDryFatCactus",value:function(e,t,r,n){var i=this,o=this.bloxd.blockDataOwner.getBlockData(e,t,r);if(o||(o={hydrateTime:Date.now()+45e3},this.bloxd.blockDataOwner.setBlockData(e,t,r,o)),Date.now()>o.hydrateTime){!function(){for(var n=-1;n>=-5;n--){var o=i.bloxd.room.getBlock([e,t+n,r]);if(o===N.UNLOADED_ID)return!0;if(!at.includes(o))return st.includes(o)}return!1}()?this.room.api.setBlock([e,t,r],"Fat Cactus|Growing"):o.hydrateTime=Date.now()+45e3}}},{key:"tickDirtGrassRoots",value:function(e,t,r,n){var i=this,o=this.bloxd.blockDataOwner.getBlockData(e,t,r);if(o||(o={regrowTime:Date.now()+45e3},this.bloxd.blockDataOwner.setBlockData(e,t,r,o)),Date.now()>o.regrowTime){!function(){for(var n=1;n<=3;n++){var o=i.bloxd.room.getBlock([e,t+n,r]);if(o&&i.bloxd.noa.registry.getBlockSolidity(o))return!1}return!0}()?this.room.api.setBlock([e,t,r],"Dirt"):this.room.api.setBlock([e,t,r],"Grass Block")}}}]),e}(),st=[N.default.Stone.id,N.default["Messy Stone"].id,N.default.Diorite.id,N.default.Andesite.id,N.default.Granite.id],at=[N.default["Fat Cactus"].id,N.default["Dry Fat Cactus"].id,N.default["Fat Cactus|Growing"].id],lt=r(57906),ut=["Maple Log","Aspen Log","Plum Log","Elm Log","Pine Log","Cedar Log","Palm Log","Pear Log"],ct=["Maple Wood Planks","Aspen Wood Planks","Plum Wood Planks","Elm Wood Planks","Pine Wood Planks","Cedar Wood Planks","Palm Wood Planks","Pear Wood Planks"],ht=["Maple Leaves","Aspen Leaves","Plum Leaves","Elm Leaves","Pine Leaves","Cedar Leaves","Palm Leaves","Pear Leaves"],dt=["Messy Stone","Stone","Diorite","Andesite","Granite"],ft=["Poppy","Red Tulip"],pt=["Tall Grass","Cactus"],mt=(0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)((0,S.Z)({"Maple Wood Planks":[{requires:[{items:["Maple Log"],amt:1}],produces:4}],"Aspen Wood Planks":[{requires:[{items:["Aspen Log"],amt:1}],produces:4}],"Plum Wood Planks":[{requires:[{items:["Plum Log"],amt:1}],produces:4}],"Elm Wood Planks":[{requires:[{items:["Elm Log"],amt:1}],produces:4}],"Pine Wood Planks":[{requires:[{items:["Pine Log"],amt:1}],produces:4}],"Cedar Wood Planks":[{requires:[{items:["Cedar Log"],amt:1}],produces:4}],"Palm Wood Planks":[{requires:[{items:["Palm Log"],amt:1}],produces:4}],"Pear Wood Planks":[{requires:[{items:["Pear Log"],amt:1}],produces:4}],"Wood Sword":[{requires:[{items:ct,amt:3}],produces:1}],"Stone Sword":[{requires:[{items:dt,amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Iron Sword":[{requires:[{items:["Iron Bar"],amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Gold Sword":[{requires:[{items:["Gold Bar"],amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Diamond Sword":[{requires:[{items:["Diamond"],amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],Stick:[{requires:[{items:ct,amt:1}],produces:1,station:"Workbench"}],"Wood Pickaxe":[{requires:[{items:ct,amt:4}],produces:1}],"Stone Pickaxe":[{requires:[{items:dt,amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Iron Pickaxe":[{requires:[{items:["Iron Bar"],amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Gold Pickaxe":[{requires:[{items:["Gold Bar"],amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Diamond Pickaxe":[{requires:[{items:["Diamond"],amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Moonstone Pickaxe":[{requires:[{items:["Moonstone"],amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Wood Axe":[{requires:[{items:ct,amt:4}],produces:1}],"Stone Axe":[{requires:[{items:dt,amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Iron Axe":[{requires:[{items:["Iron Bar"],amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Gold Axe":[{requires:[{items:["Gold Bar"],amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Diamond Axe":[{requires:[{items:["Diamond"],amt:3},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Wood Spade":[{requires:[{items:ct,amt:2}],produces:1}],"Stone Spade":[{requires:[{items:dt,amt:1},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Iron Spade":[{requires:[{items:["Iron Bar"],amt:1},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Gold Spade":[{requires:[{items:["Gold Bar"],amt:1},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Diamond Spade":[{requires:[{items:["Diamond"],amt:1},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Wood Hoe":[{requires:[{items:ct,amt:2}],produces:1}],"Stone Hoe":[{requires:[{items:dt,amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Iron Hoe":[{requires:[{items:["Iron Bar"],amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Gold Hoe":[{requires:[{items:["Gold Bar"],amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Diamond Hoe":[{requires:[{items:["Diamond"],amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],"Wood Bow":[{requires:[{items:ct,amt:3},{items:ht,amt:1},{items:["Stick"],amt:2}],produces:1}],"Stone Bow":[{requires:[{items:dt,amt:3},{items:ht,amt:1},{items:["Stick"],amt:2}],produces:1,station:"Workbench"}],"Iron Bow":[{requires:[{items:["Iron Bar"],amt:3},{items:ht,amt:1},{items:["Stick"],amt:2}],produces:1,station:"Workbench"}],"Gold Bow":[{requires:[{items:["Gold Bar"],amt:3},{items:ht,amt:1},{items:["Stick"],amt:2}],produces:1,station:"Workbench"}],"Diamond Bow":[{requires:[{items:["Diamond"],amt:3},{items:ht,amt:1},{items:["Stick"],amt:2}],produces:1,station:"Workbench"}],"Wood Crossbow":[{requires:[{items:ct,amt:4},{items:ht,amt:1},{items:["Stick"],amt:2},{items:["Iron Bar"],amt:2}],produces:1}],"Stone Crossbow":[{requires:[{items:dt,amt:4},{items:ht,amt:1},{items:["Stick"],amt:2},{items:["Iron Bar"],amt:2}],produces:1,station:"Workbench"}],"Iron Crossbow":[{requires:[{items:["Iron Bar"],amt:6},{items:ht,amt:1},{items:["Stick"],amt:2}],produces:1,station:"Workbench"}],"Gold Crossbow":[{requires:[{items:["Gold Bar"],amt:4},{items:ht,amt:1},{items:["Stick"],amt:2},{items:["Iron Bar"],amt:2}],produces:1,station:"Workbench"}],"Diamond Crossbow":[{requires:[{items:["Diamond"],amt:4},{items:ht,amt:1},{items:["Stick"],amt:2},{items:["Iron Bar"],amt:2}],produces:1,station:"Workbench"}],Arrow:[{requires:[{items:dt,amt:1},{items:["Stick"],amt:1}],produces:2,station:"Workbench"}],Shears:[{requires:[{items:["Iron Bar"],amt:2},{items:ct,amt:1}],produces:1,station:"Workbench"}],Workbench:[{requires:[{items:ct,amt:4}],produces:1}],Coal:[{requires:[{items:["Block of Coal"],amt:1}],produces:9,station:"Artisan Bench"},{requires:[{items:["Coal Ore"],amt:4},{items:["Coal"],amt:1}],produces:4,station:"Furnace"}],"Iron Bar":[{requires:[{items:["Iron Ore"],amt:1},{items:["Coal"],amt:1}],produces:1,station:"Furnace"},{requires:[{items:["Block of Iron"],amt:1}],produces:9,station:"Artisan Bench"},{requires:[{items:["Iron Watermelon"],amt:1}],produces:128,station:"Workbench"}],"Gold Bar":[{requires:[{items:["Gold Ore"],amt:1},{items:["Coal"],amt:1}],produces:1,station:"Furnace"},{requires:[{items:["Block of Gold"],amt:1}],produces:9,station:"Artisan Bench"}],Diamond:[{requires:[{items:["Block of Diamond"],amt:1}],produces:9,station:"Artisan Bench"},{requires:[{items:["Diamond Ore"],amt:4},{items:["Coal"],amt:1}],produces:4,station:"Furnace"}],Moonstone:[{requires:[{items:["Block of Moonstone"],amt:1}],produces:9,station:"Artisan Bench"},{requires:[{items:["Moonstone Ore"],amt:4},{items:["Coal"],amt:1}],produces:4,station:"Furnace"}],"Compressed Messy Stone":[{requires:[{items:["Messy Stone"],amt:9}],produces:1,station:"Artisan Bench"},{requires:[{items:["Extra Compressed Messy Stone"],amt:1}],produces:9,station:"Artisan Bench"}],"Extra Compressed Messy Stone":[{requires:[{items:["Compressed Messy Stone"],amt:9}],produces:1,station:"Artisan Bench"},{requires:[{items:["Super Compressed Messy Stone"],amt:1}],produces:9,station:"Artisan Bench"}],"Super Compressed Messy Stone":[{requires:[{items:["Extra Compressed Messy Stone"],amt:9}],produces:1,station:"Artisan Bench"},{requires:[{items:["Hyper Compressed Messy Stone"],amt:1}],produces:9,station:"Artisan Bench"}],"Hyper Compressed Messy Stone":[{requires:[{items:["Super Compressed Messy Stone"],amt:9}],produces:1,station:"Artisan Bench"},{requires:[{items:["Ultra Compressed Messy Stone"],amt:1}],produces:9,station:"Artisan Bench"}],"Ultra Compressed Messy Stone":[{requires:[{items:["Hyper Compressed Messy Stone"],amt:9}],produces:1,station:"Artisan Bench"},{requires:[{items:["Mega Compressed Messy Stone"],amt:1}],produces:9,station:"Artisan Bench"}],"Mega Compressed Messy Stone":[{requires:[{items:["Ultra Compressed Messy Stone"],amt:9}],produces:1,station:"Artisan Bench"}],Bread:[{requires:[{items:["Wheat"],amt:2},{items:["Coal"],amt:1}],produces:1,station:"Furnace"},{requires:[{items:["Wheat"],amt:3}],produces:1,station:"Workbench"},{requires:[{items:["Bread Block"],amt:1}],produces:9,station:"Workbench"}],"Bread Block":[{requires:[{items:["Bread"],amt:9}],produces:1,station:"Workbench"}],"Apple Block":[{requires:[{items:["Apple"],amt:4}],produces:1,station:"Workbench"}],Apple:[{requires:[{items:["Apple Block"],amt:1}],produces:4,station:"Workbench"}],"Plum Block":[{requires:[{items:["Plum"],amt:4}],produces:1,station:"Workbench"}],Plum:[{requires:[{items:["Plum Block"],amt:1}],produces:4,station:"Workbench"}],"Pear Block":[{requires:[{items:["Pear"],amt:4}],produces:1,station:"Workbench"}],Pear:[{requires:[{items:["Pear Block"],amt:1}],produces:4,station:"Workbench"}],"Cracked Coconut":[{requires:[{items:["Coconut"],amt:1}],produces:1,station:"Workbench"}],"Coconut Block":[{requires:[{items:["Coconut"],amt:4}],produces:1,station:"Workbench"}],Coconut:[{requires:[{items:["Coconut Block"],amt:1}],produces:4,station:"Workbench"}],"Melon Slice":[{requires:[{items:["Melon"],amt:1}],produces:4,station:"Workbench"}],"Gold Melon Slice":[{requires:[{items:["Melon Slice"],amt:2},{items:["Gold Bar"],amt:1}],produces:2,station:"Workbench"}],"Melon Seeds":[{requires:[{items:["Melon Slice"],amt:4}],produces:1,station:"Workbench"}],Melon:[{requires:[{items:["Melon Slice"],amt:4}],produces:1,station:"Workbench"}],"Watermelon Slice":[{requires:[{items:["Watermelon"],amt:1}],produces:4,station:"Workbench"}],"Gold Watermelon Slice":[{requires:[{items:["Watermelon Slice"],amt:2},{items:["Gold Bar"],amt:1}],produces:2,station:"Workbench"}],"Watermelon Seeds":[{requires:[{items:["Watermelon Slice"],amt:4}],produces:1,station:"Workbench"}],Watermelon:[{requires:[{items:["Watermelon Slice"],amt:4}],produces:1,station:"Workbench"}],"Pumpkin Pie":[{requires:[{items:["Pumpkin"],amt:1},{items:["Wheat"],amt:3}],produces:1,station:"Workbench"}],"Pumpkin Seeds":[{requires:[{items:["Pumpkin"],amt:1}],produces:1,station:"Workbench"}],"Carved Pumpkin":[{requires:[{items:["Pumpkin"],amt:1}],produces:1,station:"Artisan Bench"}],"Jack o'Lantern":[{requires:[{items:["Carved Pumpkin"],amt:1},{items:["Coal"],amt:1}],produces:1,station:"Artisan Bench"}],Stone:[{requires:[{items:["Messy Stone"],amt:4},{items:["Coal"],amt:1}],produces:4,station:"Furnace"}],Magma:[{requires:[{items:["Stone"],amt:4},{items:["Coal"],amt:1}],produces:4,station:"Furnace"}],Furnace:[{requires:[{items:dt,amt:8}],produces:1,station:"Workbench"}],Chest:[{requires:[{items:ct,amt:4}],produces:1,station:"Workbench"}],"Moonstone Chest":[{requires:[{items:["Moonstone"],amt:2}],produces:1,station:"Workbench"}],"Moonstone Explosive":[{requires:[{items:["Moonstone"],amt:1},{items:["Sand"],amt:10}],produces:4,station:"Workbench"}],Fireball:[{requires:[{items:["Magma"],amt:4},{items:["Moonstone"],amt:1}],produces:4,station:"Workbench"}],Iceball:[{requires:[{items:["Ice"],amt:4},{items:["Moonstone"],amt:1}],produces:4,station:"Workbench"}],"Artisan Bench":[{requires:[{items:ct,amt:2},{items:dt,amt:2}],produces:1,station:"Workbench"}],Snowball:[{requires:[{items:["Snow"],amt:1}],produces:4,station:"Workbench"}],Snow:[{requires:[{items:["Snowball"],amt:4}],produces:1,station:"Workbench"}],Pebble:[{requires:[{items:dt,amt:1}],produces:1,station:"Workbench"}],"Reinforced Pebble":[{requires:[{items:["Compressed Messy Stone"],amt:1}],produces:1,station:"Workbench"}],Ball:[{requires:[{items:ct,amt:4}],produces:1,station:"Workbench"}],"Reinforced Ball":[{requires:[{items:["Ball"],amt:1},{items:["Pine Log"],amt:1}],produces:1,station:"Workbench"}],"Moonstone Orb":[{requires:[{items:["Moonstone"],amt:1},{items:["Reinforced Pebble"],amt:1}],produces:4,station:"Workbench"}],Net:[{requires:[{items:ht,amt:15}],produces:1,station:"Workbench"}],"Block of Coal":[{requires:[{items:["Coal"],amt:9}],produces:1,station:"Artisan Bench"}],"Block of Iron":[{requires:[{items:["Iron Bar"],amt:9}],produces:1,station:"Artisan Bench"}],"Block of Gold":[{requires:[{items:["Gold Bar"],amt:9}],produces:1,station:"Artisan Bench"}],"Block of Diamond":[{requires:[{items:["Diamond"],amt:9}],produces:1,station:"Artisan Bench"}],"Block of Moonstone":[{requires:[{items:["Moonstone"],amt:9}],produces:1,station:"Artisan Bench"}],Glass:[{requires:[{items:["Sand"],amt:4},{items:["Coal"],amt:1}],produces:4,station:"Furnace"}],Board:[{requires:[{items:ct,amt:1}],produces:1,station:"Workbench"}],"Maple Door":[{requires:[{items:["Maple Wood Planks"],amt:2}],produces:1,station:"Workbench"}],"Pine Door":[{requires:[{items:["Pine Wood Planks"],amt:2}],produces:1,station:"Workbench"}],"Plum Door":[{requires:[{items:["Plum Wood Planks"],amt:2}],produces:1,station:"Workbench"}],"Cedar Door":[{requires:[{items:["Cedar Wood Planks"],amt:2}],produces:1,station:"Workbench"}],"Aspen Door":[{requires:[{items:["Aspen Wood Planks"],amt:2}],produces:1,station:"Workbench"}],"Elm Door":[{requires:[{items:["Elm Wood Planks"],amt:2}],produces:1,station:"Workbench"}],"Palm Door":[{requires:[{items:["Palm Wood Planks"],amt:2}],produces:1,station:"Workbench"}],"Pear Door":[{requires:[{items:["Pear Wood Planks"],amt:2}],produces:1,station:"Workbench"}],"Maple Trapdoor":[{requires:[{items:["Maple Wood Planks"],amt:1}],produces:1,station:"Workbench"}],"Pine Trapdoor":[{requires:[{items:["Pine Wood Planks"],amt:1}],produces:1,station:"Workbench"}],"Plum Trapdoor":[{requires:[{items:["Plum Wood Planks"],amt:1}],produces:1,station:"Workbench"}],"Cedar Trapdoor":[{requires:[{items:["Cedar Wood Planks"],amt:1}],produces:1,station:"Workbench"}],"Aspen Trapdoor":[{requires:[{items:["Aspen Wood Planks"],amt:1}],produces:1,station:"Workbench"}],"Elm Trapdoor":[{requires:[{items:["Elm Wood Planks"],amt:1}],produces:1,station:"Workbench"}],"Palm Trapdoor":[{requires:[{items:["Palm Wood Planks"],amt:1}],produces:1,station:"Workbench"}],"Pear Trapdoor":[{requires:[{items:["Pear Wood Planks"],amt:1}],produces:1,station:"Workbench"}],Ladder:[{requires:[{items:ct,amt:1}],produces:1,station:"Workbench"}],"Iron Ladder":[{requires:[{items:["Iron Bar"],amt:1}],produces:1,station:"Workbench"}],Bucket:[{requires:[{items:["Iron Bar"],amt:3}],produces:1,station:"Workbench"}],"Wood Helmet":[{requires:[{items:ct,amt:5}],produces:1,station:"Workbench"}],"Wood Chestplate":[{requires:[{items:ct,amt:8}],produces:1,station:"Workbench"}],"Wood Gauntlets":[{requires:[{items:ct,amt:4}],produces:1,station:"Workbench"}],"Wood Leggings":[{requires:[{items:ct,amt:7}],produces:1,station:"Workbench"}],"Wood Boots":[{requires:[{items:ct,amt:4}],produces:1,station:"Workbench"}],"Iron Helmet":[{requires:[{items:["Iron Bar"],amt:5}],produces:1,station:"Workbench"}],"Iron Chestplate":[{requires:[{items:["Iron Bar"],amt:8}],produces:1,station:"Workbench"}],"Iron Gauntlets":[{requires:[{items:["Iron Bar"],amt:4}],produces:1,station:"Workbench"}],"Iron Leggings":[{requires:[{items:["Iron Bar"],amt:7}],produces:1,station:"Workbench"}],"Iron Boots":[{requires:[{items:["Iron Bar"],amt:4}],produces:1,station:"Workbench"}],"Gold Helmet":[{requires:[{items:["Gold Bar"],amt:5}],produces:1,station:"Workbench"}],"Gold Chestplate":[{requires:[{items:["Gold Bar"],amt:8}],produces:1,station:"Workbench"}],"Gold Gauntlets":[{requires:[{items:["Gold Bar"],amt:4}],produces:1,station:"Workbench"}],"Gold Leggings":[{requires:[{items:["Gold Bar"],amt:7}],produces:1,station:"Workbench"}],"Gold Boots":[{requires:[{items:["Gold Bar"],amt:4}],produces:1,station:"Workbench"}],"Diamond Helmet":[{requires:[{items:["Diamond"],amt:5}],produces:1,station:"Workbench"}],"Diamond Chestplate":[{requires:[{items:["Diamond"],amt:8}],produces:1,station:"Workbench"}],"Diamond Gauntlets":[{requires:[{items:["Diamond"],amt:4}],produces:1,station:"Workbench"}],"Diamond Leggings":[{requires:[{items:["Diamond"],amt:7}],produces:1,station:"Workbench"}],"Diamond Boots":[{requires:[{items:["Diamond"],amt:4}],produces:1,station:"Workbench"}],"White Wood Helmet":[{requires:[{items:["White Tulip"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"White Wood Chestplate":[{requires:[{items:["White Tulip"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"White Wood Gauntlets":[{requires:[{items:["White Tulip"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"White Wood Leggings":[{requires:[{items:["White Tulip"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"White Wood Boots":[{requires:[{items:["White Tulip"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Wood Helmet":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Wood Chestplate":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Wood Gauntlets":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Wood Leggings":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Wood Boots":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Gray Wood Helmet":[{requires:[{items:["Daisy"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Gray Wood Chestplate":[{requires:[{items:["Daisy"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Gray Wood Gauntlets":[{requires:[{items:["Daisy"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Gray Wood Leggings":[{requires:[{items:["Daisy"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Gray Wood Boots":[{requires:[{items:["Daisy"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Wood Helmet":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Wood Chestplate":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Wood Gauntlets":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Wood Leggings":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Wood Boots":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Brown Wood Helmet":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Brown Wood Chestplate":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Brown Wood Gauntlets":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Brown Wood Leggings":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Brown Wood Boots":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Wood Helmet":[{requires:[{items:ft,amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Wood Chestplate":[{requires:[{items:ft,amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Wood Gauntlets":[{requires:[{items:ft,amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Wood Leggings":[{requires:[{items:ft,amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Wood Boots":[{requires:[{items:ft,amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Wood Helmet":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Wood Chestplate":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Wood Gauntlets":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Wood Leggings":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Wood Boots":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Wood Helmet":[{requires:[{items:["Dandelion"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Wood Chestplate":[{requires:[{items:["Dandelion"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Wood Gauntlets":[{requires:[{items:["Dandelion"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Wood Leggings":[{requires:[{items:["Dandelion"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Wood Boots":[{requires:[{items:["Dandelion"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Wood Helmet":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Wood Chestplate":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Wood Gauntlets":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Wood Leggings":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Wood Boots":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Green Wood Helmet":[{requires:[{items:pt,amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Green Wood Chestplate":[{requires:[{items:pt,amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Green Wood Gauntlets":[{requires:[{items:pt,amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Green Wood Leggings":[{requires:[{items:pt,amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Green Wood Boots":[{requires:[{items:pt,amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Wood Helmet":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Wood Chestplate":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Wood Gauntlets":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Wood Leggings":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Wood Boots":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Wood Helmet":[{requires:[{items:["Bluebell"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Wood Chestplate":[{requires:[{items:["Bluebell"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Wood Gauntlets":[{requires:[{items:["Bluebell"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Wood Leggings":[{requires:[{items:["Bluebell"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Wood Boots":[{requires:[{items:["Bluebell"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Wood Helmet":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Wood Chestplate":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Wood Gauntlets":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Wood Leggings":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Wood Boots":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Wood Helmet":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Wood Chestplate":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Wood Gauntlets":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Wood Leggings":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Wood Boots":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Wood Helmet":[{requires:[{items:["Allium"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Wood Chestplate":[{requires:[{items:["Allium"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Wood Gauntlets":[{requires:[{items:["Allium"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Wood Leggings":[{requires:[{items:["Allium"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Wood Boots":[{requires:[{items:["Allium"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Wood Helmet":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Wood Helmet"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Wood Chestplate":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Wood Chestplate"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Wood Gauntlets":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Wood Gauntlets"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Wood Leggings":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Wood Leggings"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Wood Boots":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Wood Boots"],amt:1}],produces:1,station:"Artisan Bench"}],Sandstone:[{requires:[{items:["Sand"],amt:2}],produces:1,station:"Artisan Bench"}],"Red Sandstone":[{requires:[{items:["Red Sand"],amt:2}],produces:1,station:"Artisan Bench"}],Bricks:[{requires:[{items:["Clay"],amt:4},{items:["Sand"],amt:1},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"Stone Bricks":[{requires:[{items:["Messy Stone","Stone"],amt:4},{items:["Sand"],amt:1},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"Mossy Stone Bricks":[{requires:[{items:["Stone Bricks"],amt:1},{items:pt,amt:1}],produces:1,station:"Artisan Bench"}],"Cracked Stone Bricks":[{requires:[{items:["Stone Bricks"],amt:4},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"Sandstone Bricks":[{requires:[{items:["Sandstone"],amt:4},{items:["Sand"],amt:1},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"Red Sandstone Bricks":[{requires:[{items:["Red Sandstone"],amt:4},{items:["Red Sand"],amt:1},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"Diorite Bricks":[{requires:[{items:["Diorite"],amt:4},{items:["Sand"],amt:1},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"Andesite Bricks":[{requires:[{items:["Andesite"],amt:4},{items:["Sand"],amt:1},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"Granite Bricks":[{requires:[{items:["Granite"],amt:4},{items:["Sand"],amt:1},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"Ice Bricks":[{requires:[{items:["Ice"],amt:1},{items:["Snow"],amt:1}],produces:1,station:"Artisan Bench"}],"Smooth Stone":[{requires:[{items:["Stone"],amt:2},{items:["Sand"],amt:1}],produces:2,station:"Artisan Bench"}],"Smooth Diorite":[{requires:[{items:["Diorite"],amt:2},{items:["Sand"],amt:1}],produces:2,station:"Artisan Bench"}],"Smooth Andesite":[{requires:[{items:["Andesite"],amt:2},{items:["Sand"],amt:1}],produces:2,station:"Artisan Bench"}],"Smooth Granite":[{requires:[{items:["Granite"],amt:2},{items:["Sand"],amt:1}],produces:2,station:"Artisan Bench"}],"Smooth Sandstone":[{requires:[{items:["Sandstone"],amt:2},{items:["Sand"],amt:1}],produces:2,station:"Artisan Bench"}],"Smooth Red Sandstone":[{requires:[{items:["Red Sandstone"],amt:2},{items:["Red Sand"],amt:1}],produces:2,station:"Artisan Bench"}],"Engraved Stone":[{requires:[{items:["Smooth Stone"],amt:2}],produces:1,station:"Artisan Bench"}],"Engraved Sandstone":[{requires:[{items:["Smooth Sandstone"],amt:2}],produces:1,station:"Artisan Bench"}],"Engraved Red Sandstone":[{requires:[{items:["Smooth Red Sandstone"],amt:2}],produces:1,station:"Artisan Bench"}],"Engraved Diorite":[{requires:[{items:["Smooth Diorite"],amt:2}],produces:1,station:"Artisan Bench"}],"Engraved Andesite":[{requires:[{items:["Smooth Andesite"],amt:2}],produces:1,station:"Artisan Bench"}],"Engraved Granite":[{requires:[{items:["Smooth Granite"],amt:2}],produces:1,station:"Artisan Bench"}],"Messy Dirt":[{requires:[{items:["Dirt"],amt:2}],produces:1,station:"Artisan Bench"}],Dirt:[{requires:[{items:["Messy Dirt"],amt:1}],produces:2}],"Rocky Dirt":[{requires:[{items:["Dirt"],amt:4},{items:dt,amt:1}],produces:4,station:"Artisan Bench"}],"Messy Stone":[{requires:[{items:["Rocky Dirt"],amt:4}],produces:1},{requires:[{items:["Compressed Messy Stone"],amt:1}],produces:9}],"Mossy Messy Stone":[{requires:[{items:["Messy Stone"],amt:1},{items:pt,amt:1}],produces:1,station:"Artisan Bench"}],"Marked Sandstone":[{requires:[{items:["Smooth Sandstone"],amt:2}],produces:1,station:"Artisan Bench"}],"Marked Red Sandstone":[{requires:[{items:["Smooth Red Sandstone"],amt:2}],produces:1,station:"Artisan Bench"}]},vt("Maple Slab","Maple Wood Planks")),vt("Pine Slab","Pine Wood Planks")),vt("Plum Slab","Plum Wood Planks")),vt("Cedar Slab","Cedar Wood Planks")),vt("Aspen Slab","Aspen Wood Planks")),vt("Elm Slab","Elm Wood Planks")),vt("Palm Slab","Palm Wood Planks")),vt("Pear Slab","Pear Wood Planks")),vt("Dirt Slab","Dirt")),vt("Grass Slab","Grass Block")),vt("Messy Stone Slab","Messy Stone")),vt("Stone Slab","Stone")),vt("Smooth Stone Slab","Smooth Stone")),vt("Engraved Stone Slab","Engraved Stone")),vt("Stone Bricks Slab","Stone Bricks")),vt("Mossy Stone Slab","Mossy Messy Stone")),vt("Mossy Stone Bricks Slab","Mossy Stone Bricks")),vt("Andesite Slab","Andesite")),vt("Smooth Andesite Slab","Smooth Andesite")),vt("Engraved Andesite Slab","Engraved Andesite")),vt("Andesite Bricks Slab","Andesite Bricks")),vt("Diorite Slab","Diorite")),vt("Smooth Diorite Slab","Smooth Diorite")),vt("Engraved Diorite Slab","Engraved Diorite")),vt("Diorite Bricks Slab","Diorite Bricks")),vt("Granite Slab","Granite")),vt("Smooth Granite Slab","Smooth Granite")),vt("Engraved Granite Slab","Engraved Granite")),vt("Granite Bricks Slab","Granite Bricks")),vt("Sandstone Slab","Sandstone")),vt("Smooth Sandstone Slab","Smooth Sandstone")),vt("Engraved Sandstone Slab","Engraved Sandstone")),vt("Marked Sandstone Slab","Marked Sandstone")),vt("Sandstone Bricks Slab","Sandstone Bricks")),vt("Red Sandstone Slab","Red Sandstone")),vt("Smooth Red Sandstone Slab","Smooth Red Sandstone")),vt("Engraved Red Sandstone Slab","Engraved Red Sandstone")),vt("Marked Red Sandstone Slab","Marked Red Sandstone")),vt("Red Sandstone Bricks Slab","Red Sandstone Bricks")),vt("Bricks Slab","Bricks")),vt("Ice Bricks Slab","Ice Bricks")),{},{"White Planks":[{requires:[{items:["White Tulip"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Planks":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Gray Planks":[{requires:[{items:["Daisy"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Black Planks":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:ct,amt:2}],produces:2,station:"Artisan Bench"}],"Brown Planks":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Red Planks":[{requires:[{items:ft,amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Orange Planks":[{requires:[{items:["Orange Tulip"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Planks":[{requires:[{items:["Dandelion"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Lime Planks":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Green Planks":[{requires:[{items:pt,amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Planks":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Planks":[{requires:[{items:["Bluebell"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Blue Planks":[{requires:[{items:["Forget-me-not"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Purple Planks":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Planks":[{requires:[{items:["Allium"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Pink Planks":[{requires:[{items:["Pink Tulip"],amt:1},{items:ct,amt:1}],produces:1,station:"Artisan Bench"}],"Green Wool":[{requires:[{items:ht,amt:4},{items:pt,amt:4}],produces:1,station:"Artisan Bench"}],"White Wool":[{requires:[{items:["White Tulip"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Wool":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Gray Wool":[{requires:[{items:["Daisy"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Wool":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Green Wool"],amt:2}],produces:2,station:"Artisan Bench"}],"Brown Wool":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Wool":[{requires:[{items:ft,amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Wool":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Wool":[{requires:[{items:["Dandelion"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Wool":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Wool":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Wool":[{requires:[{items:["Bluebell"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Wool":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Wool":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Wool":[{requires:[{items:["Allium"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Wool":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Green Wool"],amt:1}],produces:1,station:"Artisan Bench"}],"Baked Clay":[{requires:[{items:["Clay"],amt:4},{items:["Coal"],amt:1}],produces:4,station:"Artisan Bench"}],"White Baked Clay":[{requires:[{items:["White Tulip"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Baked Clay":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Gray Baked Clay":[{requires:[{items:["Daisy"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Baked Clay":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Baked Clay"],amt:2}],produces:2,station:"Artisan Bench"}],"Brown Baked Clay":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Baked Clay":[{requires:[{items:ft,amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Baked Clay":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Baked Clay":[{requires:[{items:["Dandelion"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Baked Clay":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Green Baked Clay":[{requires:[{items:pt,amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Baked Clay":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Baked Clay":[{requires:[{items:["Bluebell"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Baked Clay":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Baked Clay":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Baked Clay":[{requires:[{items:["Allium"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Baked Clay":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Baked Clay"],amt:1}],produces:1,station:"Artisan Bench"}],"White Ceramic":[{requires:[{items:["White Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Light Gray Ceramic":[{requires:[{items:["Light Gray Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Gray Ceramic":[{requires:[{items:["Gray Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Black Ceramic":[{requires:[{items:["Black Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Brown Ceramic":[{requires:[{items:["Brown Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Red Ceramic":[{requires:[{items:["Red Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Orange Ceramic":[{requires:[{items:["Orange Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Yellow Ceramic":[{requires:[{items:["Yellow Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Lime Ceramic":[{requires:[{items:["Lime Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Green Ceramic":[{requires:[{items:["Green Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Light Blue Ceramic":[{requires:[{items:["Light Blue Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Blue Ceramic":[{requires:[{items:["Blue Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Purple Ceramic":[{requires:[{items:["Purple Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Magenta Ceramic":[{requires:[{items:["Magenta Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Pink Ceramic":[{requires:[{items:["Pink Baked Clay"],amt:2},{items:["Sand"],amt:2},{items:["Coal"],amt:1}],produces:2,station:"Artisan Bench"}],"Gray Concrete":[{requires:[{items:dt,amt:1},{items:["Clay"],amt:1},{items:["Sand"],amt:2}],produces:2,station:"Artisan Bench"}],"White Concrete":[{requires:[{items:["White Tulip"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Concrete":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Concrete":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Gray Concrete"],amt:2}],produces:2,station:"Artisan Bench"}],"Brown Concrete":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Concrete":[{requires:[{items:ft,amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Concrete":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Concrete":[{requires:[{items:["Dandelion"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Concrete":[{requires:[{items:pt,amt:1},{items:["White Tulip"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Green Concrete":[{requires:[{items:pt,amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Concrete":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Concrete":[{requires:[{items:["Bluebell"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Concrete":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Concrete":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Concrete":[{requires:[{items:["Allium"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Concrete":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Gray Concrete"],amt:1}],produces:1,station:"Artisan Bench"}],"Lime Bed":[{requires:[{items:["Green Wool"],amt:3},{items:ct,amt:3}],produces:1,station:"Artisan Bench"}],"White Bed":[{requires:[{items:["White Tulip"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Gray Bed":[{requires:[{items:["White Tulip"],amt:1},{items:["Daisy"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Gray Bed":[{requires:[{items:["Daisy"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Black Bed":[{requires:[{items:ft,amt:1},{items:["Dandelion"],amt:1},{items:["Forget-me-not"],amt:1},{items:["Lime Bed"],amt:2}],produces:2,station:"Artisan Bench"}],"Brown Bed":[{requires:[{items:ft,amt:1},{items:pt,amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Red Bed":[{requires:[{items:ft,amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Orange Bed":[{requires:[{items:["Orange Tulip"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Yellow Bed":[{requires:[{items:["Dandelion"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Green Bed":[{requires:[{items:pt,amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Cyan Bed":[{requires:[{items:pt,amt:1},{items:["Forget-me-not"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Light Blue Bed":[{requires:[{items:["Bluebell"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Blue Bed":[{requires:[{items:["Forget-me-not"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Purple Bed":[{requires:[{items:ft,amt:1},{items:["Forget-me-not"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Magenta Bed":[{requires:[{items:["Allium"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}],"Pink Bed":[{requires:[{items:["Pink Tulip"],amt:1},{items:["Lime Bed"],amt:1}],produces:1,station:"Artisan Bench"}]}),gt=function(){function e(t){(0,f.Z)(this,e),this.bloxd=void 0,this.playerRecipes={},this.bloxd=t,this.bloxd.isClient&&this.onPlayerJoin(this.bloxd.noa.playerEntity)}return(0,p.Z)(e,[{key:"onPlayerJoin",value:function(e){this.playerRecipes[e]=JSON.parse(JSON.stringify(mt))}},{key:"onPlayerLeave",value:function(e){delete this.playerRecipes[e]}},{key:"onClientReset",value:function(){this.playerRecipes[this.bloxd.noa.playerEntity]=JSON.parse(JSON.stringify(mt))}},{key:"editRecipesForPlayer",value:function(e,t,r){this.playerRecipes[e][t]=r}},{key:"getItemsHavingOneIngredientOf",value:function(e,t,r){var n=this,i=this.playerRecipes[e],o=[],s=function(s){i[s].forEach((function(i,a){i.station;n.canUseRecipeAtStation(e,s,a,r)&&n.itemCanBeCrafted(e,t,s,a)&&o.push({name:s,craftingIdx:a,haveIngredients:!0})}))};for(var a in i)s(a);var l=function(s){i[s].forEach((function(i,a){i.station;n.canUseRecipeAtStation(e,s,a,r)&&n.haveOneOrMoreIngredientOf(e,t,s,a)&&!n.itemCanBeCrafted(e,t,s,a)&&o.push({name:s,craftingIdx:a,haveIngredients:!1})}))};for(var u in i)l(u);return o}},{key:"canUseRecipeAtStation",value:function(e,t,r,n){var i=this.playerRecipes[e][t][r].station;return!("Workbench"!==n&&"Artisan Bench"!==n||i)||(n&&n===i||!n&&!i)}},{key:"haveOneOrMoreIngredientOf",value:function(e,t,r,n){var i,o=this.playerRecipes[e][r],s=(0,b.Z)(o[n].requires);try{for(s.s();!(i=s.n()).done;){var a,l=i.value.items,u=(0,b.Z)(l);try{for(u.s();!(a=u.n()).done;){var c=a.value;if(0!==t.getAmountOfItem(c))return!0}}catch(h){u.e(h)}finally{u.f()}}}catch(h){s.e(h)}finally{s.f()}return!1}},{key:"itemCanBeCrafted",value:function(e,t,r,n){var i=this.playerRecipes[e][r];if(void 0===i[n])return!1;var o,s=(0,b.Z)(i[n].requires);try{for(s.s();!(o=s.n()).done;){var a,l=o.value,u=l.items,c=l.amt,h=0,d=(0,b.Z)(u);try{for(d.s();!(a=d.n()).done;){var f=a.value;h+=t.getAmountOfItem(f)}}catch(p){d.e(p)}finally{d.f()}if(h<c)return!1}}catch(p){s.e(p)}finally{s.f()}return!0}},{key:"spaceInInvenToCraft",value:function(e,t,r,n){var i=this.playerRecipes[e][r];if(!1!==this.bloxd.registry.metadatas[r].stackable){if(null===t.getFreeInventoryPosition())return!1}else if(i[n].produces>t.getNumFreeSlots())return!1;return!0}},{key:"craftItem",value:function(e,t,r,n){if(!this.itemCanBeCrafted(e,t,r,n))return!1;if(!this.spaceInInvenToCraft(e,t,r,n))return!1;var i,o=this.playerRecipes[e][r],s=(0,b.Z)(o[n].requires);try{for(s.s();!(i=s.n()).done;){var a,l=i.value,u=l.items,c=l.amt,h=[],d=(0,b.Z)(u);try{for(d.s();!(a=d.n()).done;){var f=a.value;h.push({item:f,amt:t.getAmountOfItem(f)})}}catch(C){d.e(C)}finally{d.f()}h.sort((function(e,t){return e.amt-t.amt}));for(var p=c,m=0,g=h;m<g.length;m++){var v=g[m],y=v.item,_=v.amt;if(_>0&&(_>=p?(t.removeItemName(y,p),p=0):(t.removeItemName(y,_),p-=_)),0===p)break}}}catch(C){s.e(C)}finally{s.f()}var S=o[n].produces,A=0;if(!1!==this.bloxd.registry.metadatas[r].stackable)A=t.pickUpItem({name:r,typeObj:this.bloxd.getItemTypeObj(r),amount:S});else for(var x=0;x<S;x++)A+=t.pickUpItem({name:r,typeObj:this.bloxd.getItemTypeObj(r),amount:null});return S===A||(console.error(new Error("Crafted the wrong amount!").stack),!1)}},{key:"getRecipesForPlayer",value:function(e){return this.playerRecipes[e]}}]),e}();function vt(e,t){return(0,$e.Z)({},e,[{requires:[{items:[t],amt:2}],produces:4,station:"Artisan Bench"}])}var yt=r(90574),_t=r(66645),bt=r(79520),St=r(91314),At=function(){function e(t){var r=this;(0,f.Z)(this,e),this.bloxd=t,this.metadatas=(0,S.Z)({},I.EG),t.isClient&&(0,l.rp)(we.cU.customItemsUpdate,(function(e){var t,n=(0,b.Z)(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=i.name,s=i.itemObj;r.registerItem(o,s),r.bloxd.rendering.customItemUpdate(o,s)}}catch(a){n.e(a)}finally{n.f()}}))}return(0,p.Z)(e,[{key:"registerItem",value:function(e,t){var r,n=null!==(r=t.id)&&void 0!==r?r:Object.values(this.metadatas).reduce((function(e,t){return Math.max(e,t.id)}),0)+1,i=(0,S.Z)((0,S.Z)({},t),{},{name:e,id:n,isCustom:!0});this.metadatas[e]=i,this.metadatas[n]=i,this.bloxd.isClient||this.bloxd.room.broadcast(we.cU.customItemsUpdate,[{name:e,itemObj:i}]),(0,N.addMetaInfoForItem)(this.metadatas,i)}},{key:"onPlayerJoinServer",value:function(e){var t=[];for(var r in this.metadatas)isNaN(Number(r))&&this.metadatas[r].isCustom&&t.push({name:r,itemObj:this.metadatas[r]});this.bloxd.room.mapEntToClient[e].send(we.cU.customItemsUpdate,t)}}]),e}(),xt=r(62043),Ct=function(){function e(t,r){var n=this;(0,f.Z)(this,e),this.isClient=!0,this.noa=void 0,this.ents=void 0,this.multiblockManager=void 0,this.room=void 0,this.blockDataOwner=void 0,this.craftingManager=void 0,this.rendering=void 0,this.registry=new At(this),this.chunkTicker=void 0,this.noa=t,this.ents=t.ents,this.multiblockManager=new Ye(t,this),this.room=r,this.blockDataOwner=new Je(t,this),this.craftingManager=new gt(this),this.isClient?this.rendering=new l.EU.BloxdClientRenderingClass(this):this.chunkTicker=new ot(this,r),this.isClient&&(0,l.ZC)((function(){n.onClientReset()}))}return(0,p.Z)(e,[{key:"setBlock",value:function(e,t,r,n){this.multiblockManager.setBlock(e,t,r,n)}},{key:"setBlockNoMulti",value:function(e,t,r,n){var i=this.getBlock(e,t,r);this.isClient?this.hasChunkWithBlockCoordinates(e,t,r)&&this.noa.setBlock(n,e,t,r):(this.chunkTicker.blockUpdated(e,t,r,i,n),this.room.map.setBlock(e,t,r,n)),this.getMetaInfo(n).rootId!==this.getMetaInfo(i).rootId&&(this.onBlockRemoved(e,t,r,i,!0),this.blockDataOwner.blockChanged(e,t,r),this.blockAdded(e,t,r,n))}},{key:"getBlock",value:function(e,t,r){return this.isClient?this.noa.getBlock(e,t,r):this.room.map.getBlock(e,t,r)}},{key:"playerCanPlaceItem",value:function(e,t,r,n,i){return i in He.E?this.multiblockManager.playerCanPlaceItem(e,t,r,n,i):this.playerCanChangePos(e,t,r,n,i)}},{key:"playerCanChangePos",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return this.isClient?(console.log(this.hasChunkWithBlockCoordinates(t,r,n),!this.noa.registry.getBlockSolidity(i),this.noa.world.walkThroughType.has(i),!this.noa.ents.isTerrainBlocked(t,r,n)),this.hasChunkWithBlockCoordinates(t,r,n)&&this.posSatisfiesModifyConstraints(e,t,r,n)&&(!this.noa.registry.getBlockSolidity(i)||this.noa.world.walkThroughType.has(i)||!this.noa.ents.isTerrainBlocked(t,r,n))):this.hasChunkWithBlockCoordinates(t,r,n)&&this.posSatisfiesModifyConstraints(e,t,r,n)}},{key:"posSatisfiesModifyConstraints",value:function(e,t,r,n){if(this.isClient)return console.assert(e===this.noa.playerEntity||e===this.noa.serverPlayerEntity,"eId in client posSatisfiesModifyConstraints must be local player"),this.noa.world.canChangeBlock(t,r,n);var i=this.getBlock(t,r,n),o=this.room.clientOptions[e].canChange,s=this.room.playerAuthInfo[e];return o?(0,xt.Np)(t,r,n,i,s.cantChangeBlockCoord,s.canChangeBlockCoord,s.cantChangeBlockType,s.canChangeBlockType,s.cantChangeBlockRect,s.canChangeBlockRect,!1):(0,xt.Np)(t,r,n,i,s.canChangeBlockCoord,s.cantChangeBlockCoord,s.canChangeBlockType,s.cantChangeBlockType,s.canChangeBlockRect,s.cantChangeBlockRect,!0)}},{key:"canWaterBucketAtPos",value:function(e,t,r,n){return this.playerCanChangePos(e,t,r,n)||!this.getPlayerClientOption(e,"strictWaterBuckets")}},{key:"getPlayerClientOption",value:function(e,t){return this.isClient?(console.assert(e===this.noa.playerEntity||e===this.noa.serverPlayerEntity,"eId in client getPlayerClientOption must be local player"),this.noa.serverSettings[t]):this.room.api.getClientOption(e,t)}},{key:"getItemId",value:function(e){if(e&&"Air"!==e){if(this.registry.metadatas[e])return this.registry.metadatas[e].id;throw new Error("Invalid block name. You sent ".concat(e,". The only valid item names are 'Air' and those contained within the blockMetadata/itemMetadata files or those registered with the api"))}return 0}},{key:"getItemName",value:function(e){return e&&0!==e?this.registry.metadatas[e].name:"Air"}},{key:"getItemTypeObj",value:function(e){return e&&"Air"!==e?l.EU.itemsClient[e]:null}},{key:"getMetaInfo",value:function(e){return e&&"Air"!==e?this.registry.metadatas[e].meta:Mt}},{key:"getItemStat",value:function(e,t,r){var n;if(["ttb","displayName","harvestLevel","stoodOnSpeedMultiplier","specialToolDrop","description","altActionable","eatHealAmt","hitPlayerDamage"].includes(r)){var i,o,s,a=this.getItemName(t),l=r[0].toUpperCase()+r.slice(1),u="".concat(a).concat(l);return"displayName"===r?null!==(s=this.getPlayerClientOption(e,u))&&void 0!==s?s:a:null!==(i=this.getPlayerClientOption(e,u))&&void 0!==i?i:null===(o=this.registry.metadatas[t])||void 0===o?void 0:o[r]}return null===(n=this.registry.metadatas[t])||void 0===n?void 0:n[r]}},{key:"getBlockTypeIsHarvestable",value:function(e,t){var r=this.getInvenHeldItem(e);if(t&&!this.getPlayerClientOption(e,"creative")){var n,i,o,s=null===(n=I.i[null===r||void 0===r?void 0:r.name])||void 0===n?void 0:n.harvests,a=null===(i=I.i[null===r||void 0===r?void 0:r.name])||void 0===i?void 0:i.level,l="rock"===this.registry.metadatas[t].harvestType&&0!==this.registry.metadatas[t].harvestLevel&&"rock"!==s;return"rock"===s&&(null!==(o=this.getItemStat(e,t,"harvestLevel"))&&void 0!==o?o:0)>(null!==a&&void 0!==a?a:0)&&(l=!0),!l}return!0}},{key:"getInvenHeldItem",value:function(e){return this.noa.ents.hasComponent(e,"inventory")?this.noa.ents.getInventory(e).getItemAtSelectedSlot():null}},{key:"getIsStoodOnBlock",value:function(e){return(0,yt.So)(this.noa,e).length>=1}},{key:"getStoodBlockSpeedMultiplier",value:function(e){this.isClient&&console.assert(e===this.noa.playerEntity,"eId in client getStoodBlockSpeedMultiplier must be local player");var t=(0,yt.So)(this.noa,e);console.assert(t.length>0,"getStoodBlockSpeedMultiplier called when player is not standing on a block");var r,n=(0,b.Z)(t);try{for(n.s();!(r=n.n()).done;){var i=r.value,o=this.getItemStat(e,i,"stoodOnSpeedMultiplier");if(void 0!==o)return o}}catch(s){n.e(s)}finally{n.f()}return 1}},{key:"getPlayerTargetInfo",value:function(e){var t,r,n=this.getPlayerEyePos(e);this.isClient?(console.assert(e===this.noa.playerEntity,"Should only get targeted block for local player"),t=null!==(r=this.noa.actionDirection)&&void 0!==r?r:this.noa.camera.getDirection()):t=this.room.playerAuthInfo[e].useDir;return this.noa.pickBlock(n,t)}},{key:"getPlayerEidList",value:function(){var e=this;return this.isClient?Object.keys(this.noa.playerNames).filter((function(t){return t!==e.noa.playerEntity.toString()})):Object.values(this.room.mapSeshToEnt)}},{key:"getPlayersAvailableForShopInput",value:function(e,t){if("player"===t.userInput.type){var r,n=null!==(r=t.userInput.excludedPlayers)&&void 0!==r?r:[e];return this.getPlayerEidList().filter((function(e){return!n.includes(e)}))}console.error("Used getPlayersAvailableForInput on non-player userInput ShopItem")}},{key:"swapDoorTypeOpenClosed",value:function(e,t,r,n,i){var o,s=N.blockMetadata[i].name.split("|"),a=s[0],u=[t,r,n],c=a;if(a in He.a){var h=He.a[a];c=h.mainMultiblock,u=[t-h.compX,r-h.compY,n-h.compZ]}var d=[c];(o=d).push.apply(o,(0,Ve.Z)(s.slice(1))),1===d.length&&d.push("meta","rot1","closed");var f="open"===d[3]?"closed":"open";d[3]=f,"rot1"===d[2]&&"closed"===d[3]&&(d=[d[0]]);var p=d.join("|");if(this.setBlock(u[0],u[1],u[2],(0,N.blockNameToId)(p)),this.isClient){var m=(0,_t.r_)("open"===f?"doorOpen":"doorClose"),g=[t+.5,r+1,n+.5];(0,bt.GW)().play(m,1,(0,l.dP)(e)===(0,l.Zx)().playerEntity?void 0:g)}return{setPos:u,id:(0,N.blockNameToId)(p)}}},{key:"hasChunkWithBlockCoordinates",value:function(e,t,r){return this.isClient?this.noa.world.hasChunkWithBlockCoordinates(e,t,r):this.room.map.hasChunkWithBlockCoordinates(e,t,r)}},{key:"chunkAdded",value:function(e,t,r,n,i){this.blockDataOwner.chunkAdded(e,t,r,i),this.isClient?this.rendering.removeBoardsInChunk(e,t,r):this.chunkTicker.chunkAdded(e,t,r,n);var o,s=(0,b.Z)(i);try{for(s.s();!(o=s.n()).done;){var a=o.value,l=(0,ue.Z)(a.pos,3),u=l[0],c=l[1],h=l[2],d=n.get(u,c,h),f=e*he.ZP.chunkSize,p=t*he.ZP.chunkSize,m=r*he.ZP.chunkSize;this.blockAdded(f+u,p+c,m+h,d)}}catch(g){s.e(g)}finally{s.f()}}},{key:"removingChunk",value:function(e,t,r,n){this.blockDataOwner.removingChunk(e,t,r,n),this.isClient?this.rendering.removeBoardsInChunk(e,t,r):this.chunkTicker.removingChunk(e,t,r)}},{key:"getPlayerEyePos",value:function(e){var t=this.noa.entities.getMoveState(e).crouching,r=this.noa.ents.getPosition(e);return[r[0],r[1]+he.ZP.playerHeight*(t?he.ZP.crouchingEyeHeightRatio:he.ZP.playerEyeToHeightRatio),r[2]]}},{key:"globalToLocal",value:function(e,t){return Qe().subtract(null!==t&&void 0!==t?t:Qe().create(),e,this.noa.worldOriginOffset)}},{key:"localToGlobal",value:function(e,t){return Qe().add(null!==t&&void 0!==t?t:Qe().create(),e,this.noa.worldOriginOffset)}},{key:"tick",value:function(){this.isClient||this.chunkTicker.tick()}},{key:"onPlayerJoin",value:function(e){this.craftingManager.onPlayerJoin(e),this.isClient||this.registry.onPlayerJoinServer(e)}},{key:"onPlayerLeave",value:function(e){this.craftingManager.onPlayerLeave(e)}},{key:"onClientReset",value:function(){this.craftingManager.onClientReset()}},{key:"onPlayerChangeBlock",value:function(e,t,r,n,i,o){this.isClient||"Sapling"===(0,N.blockIdToName)(o).split(" ").slice(-1)[0]&&(console.assert(void 0===this.blockDataOwner.getBlockData(t,r,n),"Sapling block data is not undefined"),this.blockDataOwner.setBlockData(t,r,n,{persisted:{planterDbId:this.room.api.getPlayerDbId(e)}}))}},{key:"onBlockRemoved",value:function(e,t,r,n,i){if(this.isClient)"Board"===this.getMetaInfo(n).rootName&&this.rendering.removeBoard(e,t,r);else{if("Chest"===this.getMetaInfo(n).rootName){var o=this.blockDataOwner.getBlockData(e,t,r);null!==o&&void 0!==o&&o.openedByPlayer&&this.room.closeStandardChestForPlayer(o.openedByPlayer,e,t,r)}if(!i)return;if("Chest"===this.getMetaInfo(n).rootName){var s=this.blockDataOwner.getBlockData(e,t,r);if(null!==s&&void 0!==s&&s.persisted){var a,l=(0,lt.Ii)(s.persisted.chestStr,this.noa),u=(0,b.Z)(l.getItems());try{for(u.s();!(a=u.n()).done;){var c=a.value;if(null!==c){var h=c.name,d=c.amount;this.room.createItem([e+.5,t+.5,r+.5],this.getItemId(h),null!==d&&void 0!==d?d:1,!0)}}}catch(f){u.e(f)}finally{u.f()}}}}}},{key:"blockAdded",value:function(e,t,r,n){this.isClient&&this.hasChunkWithBlockCoordinates(e,t,r)&&"Board"===this.getMetaInfo(n).rootName&&this.rendering.addBoard(e,t,r,n)}},{key:"canAttack",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isClient)return console.error(new Error("canAttack not implemented for client").stack),!1;if(void 0!==t&&this.room.clientOptions[e]&&this.room.clientOptions[t]&&null!==this.room.clientOptions[t]._health&&!this.room.otherPlayerSettings[e][t]._invincible&&(r||this.room.otherPlayerSettings[e][t].canAttack)&&this.room.api.isAlive(t)){var n=this.room.hasGameReceivedPlayer(e),i=this.room.hasGameReceivedPlayer(t);return n||console.error(new Error("Game hasn't received player").stack),i||console.error(new Error("Game hasn't received player").stack),n&&i}return!1}},{key:"playerAttemptDamageOtherPlayer",value:function(e,t,r,n,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=!(arguments.length>9&&void 0!==arguments[9])||arguments[9],c=arguments.length>10?arguments[10]:void 0,h=arguments.length>11&&void 0!==arguments[11]&&arguments[11];if(this.isClient)return console.error(new Error("playerAttemptDamageOtherPlayer not implemented for client").stack),!1;if(!this.canAttack(e,t,h))return!1;for(var d=this.room.mapEntToClient[e],f=0,p=this.ents.getInvenOps(t),m=0;m<I.XL.length;m++){var g,v=p.playerInventory.numSlots-I.XL.length+m,y=null===(g=p.getItemAtIdx(v))||void 0===g?void 0:g.name;y&&(f+=I.hz[y].reduction)}var _=this.room.playerAuthInfo[t];r*=1-f,_.currentEffects["Damage Reduction"]&&(r*=.6),r*=this.getPlayerClientOption(e,"dealingDamageMultiplier"),r*=this.getPlayerClientOption(t,"receivingDamageMultiplier");var b=r=Math.ceil(r),S=Date.now()-_.lastReceivedCdAttackTime<400;if(u&&S){if(_.lastReceivedCdAttackDmg>=r)return!1;b=r,r-=_.lastReceivedCdAttackDmg}var A=this.room.gamePlayerCb(d,"onPlayerDamagingOtherPlayer",e,t,r,n);if("preventDamage"===A||null===A)return!1;"number"===typeof A&&(r=A),u&&(_.lastReceivedCdAttackDmg=b,S||(_.lastReceivedCdAttackTime=Date.now()));var x=this.room.api.getPosition(t),C=this.room.api.changeHealth(t,-r,{playerId:e,withItem:n}),M=!1;if(C){var T=this.room.gamePlayerCb(d,"onPlayerKilledOtherPlayer",e,t,r,n);if("keepInventory"!==T)for(var P=this.ents.getInvenOps(t),k=0;k<P.playerInventory.numSlots;k++){var E=this.room.api.getItemSlot(t,k);if(E){if("Protector"===E.name)continue;this.room.api.createItemDrop(x[0]+.5*Math.random()-.25,x[1]+1.5,x[2]+.5*Math.random()-.25,E.name,E.amount),this.room.api.setItemSlot(t,k,"Air")}}}else if(l){var R,w,B=this.noa.ents.getMoveState(e).speed;B>this.room.clientOptions[e].walkingSpeed*this.room.clientOptions[e].speedMultiplier&&!this.room.playerAuthInfo[e].hasUsedFirstSprintHit&&(M=!0,this.room.playerAuthInfo[e].hasUsedFirstSprintHit=!0);var D=null===(R=this.room.api.getHeldItem(e))||void 0===R?void 0:R.name;this.room.mapEntToClient[t].send(we.cU.attacked,{sprinted:M,dir:i,scalar:null!==(w=I.GI[D])&&void 0!==w?w:1,redVert:s})}return a&&(this.room.broadcast(we.cU.entityHurt,{eId:t,yourAttack:!1,kbPs:!1,cPs:!1},{except:d}),d.send(we.cU.entityHurt,{eId:t,yourAttack:!0,kbPs:M,cPs:o}),this.room.api.playSound(t,"hit",1,1.2+.1*Math.random()),t!==e&&(c?this.room.api.playSound(e,c.sound,c.volume,c.pitch):this.room.api.playSound(e,"hit",1,1.2+.1*Math.random()))),_.lastHurtTime=Date.now(),!0}},{key:"useThrowable",value:function(e,t,r,n){var i=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(this.isClient)console.error(new Error("Should not be called on client").stack);else{var a=(this.room.eIdCounter--).toString();this.room.gamePlayerCb(e,"onPlayerUsedThrowable",r,t,a);var l=new St.O(this,a,t),u=this.getPlayerEyePos(r);l.initServer({pos:u,throwerEId:r,thrownDir:n,dispose:function(){i.noa.ents.deleteEntity(a),i.room.state.deleteEntity(a)},extraVelocityMult:o,extraDamageMult:s}),this.room.state.createEntity(a,t),this.room.state.setEntityPosition(a,u)}}},{key:"getInventory",value:function(e){var t;return null===(t=this.noa.ents.getInventoryState(e))||void 0===t?void 0:t.inventory}},{key:"hasItem",value:function(e,t){return this.getInventory(e).getAmountOfItem(t)>0}}]),e}(),Mt=Object.freeze(new N.ItemMetaInfo("Air",0,"",null,null,null,null,null,null,null)),Tt=r(60136),Pt=r(43668),It=r(47313),kt=r(34703),Et=r(85008),Rt=r(46417),wt=It.memo((function(){return(0,Et.iP)(),(0,Rt.jsx)(Bt,{})})),Bt=function(e){(0,Tt.Z)(r,e);var t=(0,Pt.Z)(r);function r(e){var n;return(0,f.Z)(this,r),(n=t.call(this,e)).showQueue=[],n.slideDuration=1,n.state={showQueue:[],currState:null},n.currMessage=null,n.justShowed=!1,n}return(0,p.Z)(r,[{key:"componentDidMount",value:function(){var e=this;this.sub=l.f$.subscribe("TopRightHelper",(function(t){e.showQueue.push(t),e.setState({showQueue:e.showQueue})}))}},{key:"componentWillUnmount",value:function(){l.f$.unsubscribe(this.sub),clearTimeout(this.slideOutTimeout),clearTimeout(this.hidingMessageTimeout)}},{key:"componentDidUpdate",value:function(e,t){var r=this;this.justShowed&&(this.justShowed=!1,this.setState({currState:"slideIn"}),this.slideOutTimeout=setTimeout((function(){r.setState({currState:"slideOut"})}),1e3*((this.currMessage.duration||8)-1)),this.hidingMessageTimeout=setTimeout((function(){r.showQueue.shift(),r.currMessage=null,r.setState({showQueue:r.showQueue,currState:null})}),1e3*(this.currMessage.duration||8)))}},{key:"render",value:function(){var e,t,r,n,i,o=!0;if(this.state.showQueue.length>0&&null===this.state.currState?(this.currMessage=this.state.showQueue[0],this.justShowed=!0,e="slideIn"):"slideOut"===this.state.currState?e="slideOut":null===this.currMessage&&(o=!1),this.currMessage){var s=this.currMessage.color||"rgb(102, 102, 102)";t={width:this.currMessage.width||"250px",height:this.currMessage.height||"70px",animation:"1s ".concat("slideOut"===e?"HelperSlideKeyFrameReverse":"HelperSlideKeyFrame")},r={backgroundColor:s},n={animation:"2s ".concat("slideOut"===e?"CloseNotification":"ExpandNotification")},i={fontSize:this.currMessage.fontSize||"16px",animation:"2s ".concat("slideOut"===e?"textDisappear":"textAppear")}}return o?(0,Rt.jsxs)("div",{className:"TopRightHelperBox",style:t,children:[(0,Rt.jsx)("div",{className:"LeftSide",style:r,children:(0,Rt.jsx)("i",{className:"fas fa-".concat(this.currMessage.iconSizeMult||3,"x fa-").concat(this.currMessage.icon," HelperIcon")})}),(0,Rt.jsx)("div",{className:"RightSide",style:n,children:(0,Rt.jsx)("div",{className:"HelperText",style:i,children:this.currMessage.text})})]}):null}}]),r}(It.Component),Dt=r(4873);function Ot(){var e=(0,It.useState)(0),t=(0,ue.Z)(e,2),r=t[0],n=t[1],i=(0,l.Zx)(),o=(0,kt._)("changedHotbarUsingNumkeys",!(0,m.Uu)()),s=(0,ue.Z)(o,2),a=s[0],u=s[1],c=function(e){i.ents.getInventory(i.playerEntity).setSelectedSlotIndex(e),n(e),(0,l.Xi)(we.Vz.newSelectedInventorySlotI,e)};(0,kt.lF)("ScrollInventorySlot",(function(e){var t=r+e;t<0?t=9:t>9&&(t=0),c(t)})),(0,kt.lF)("setSelectedInventorySlotI",(function(e){c(e),u(!1)}));var h=i.ents.getInventory(i.playerEntity),d=(0,It.useState)(h.getHotBar()),f=(0,ue.Z)(d,2),p=f[0],g=f[1],v=p[r];return(0,kt.lF)("updatedInventory",(function(){g(h.getHotBar())})),(0,It.useEffect)((function(){var e=l.f$.subscribe("DropHotbarItem",(function(e){if(v){var t,n=e&&null!==(t=v.amount)&&void 0!==t?t:1;i.ents.getInvenOps(i.playerEntity).removeItemClient(r,n)}}));return function(){l.f$.unsubscribe(e)}}),[v,r,i.ents,i.playerEntity]),(0,Rt.jsxs)("div",{className:"hotbarContainer",children:[(0,Rt.jsx)("div",{className:"hotbar",children:new Array(10).fill(0).map((function(e,t){return(0,Rt.jsxs)("div",{className:"item ".concat(t===r?"SelectedItem":""),style:{marginLeft:"".concat(t,"0%")},onPointerDown:function(){c(t)},children:[p[t]?(0,Rt.jsx)(Dt.a,{itemName:p[t].typeObj.name,amount:Ft(p[t])}):null,a&&(0,Rt.jsx)("div",{className:"HotbarItemNumber SmallTextBold",children:t<9?t+1:0})]},t)}))}),(0,Rt.jsx)(Lt,{selectedItem:v})]})}function Lt(e){var t,r=e.selectedItem,n=(0,It.useState)(!1),i=(0,ue.Z)(n,2),o=i[0],s=i[1],a=(0,It.useRef)(null),l=(0,kt.GG)(),u=(0,It.useCallback)((function(){var e;clearTimeout(a.current),s(!0),l(),void 0===(null===r||void 0===r||null===(e=r.metadata)||void 0===e?void 0:e.shotsLeft)&&(a.current=setTimeout((function(){s(!1)}),2e3))}),[r]);(0,It.useEffect)((function(){return u(),function(){clearTimeout(a.current),s(!1)}}),[r,u]),(0,kt.lF)("serverOption|".concat(null===r||void 0===r?void 0:r.typeObj.name,"DisplayName"),(function(){s(!0)}));var c=(0,It.useState)(null===r||void 0===r||null===(t=r.metadata)||void 0===t?void 0:t.shotsLeft),h=(0,ue.Z)(c,2),d=h[0],f=h[1];(0,It.useEffect)((function(){var e;f(null===r||void 0===r||null===(e=r.metadata)||void 0===e?void 0:e.shotsLeft)}),[r]),(0,kt.lF)("localPlayerNewShotsLeft",(function(e){f(e)}));var p=(0,Et.Lm)();return(0,Rt.jsx)(Rt.Fragment,{children:o&&r?(0,Rt.jsxs)("div",{className:"SelectedItemName SmallTextBold",style:{bottom:"".concat(Math.min(Math.round(.05*p),70),"px")},children:[(0,Rt.jsx)(kt.fD,{text:"string"===typeof r.typeObj.displayName?r.typeObj.displayName.split("|")[0]:r.typeObj.displayName}),void 0!==d?(0,Rt.jsx)("div",{className:"SelectedItemShotsLeft",children:" : ".concat(d,"|").concat(r.typeObj.clipSize)}):null]}):null})}function Ft(e){return e.typeObj.stackable?e.amount:0}var Nt=r(7727),Ut=r(63368),Wt=r(30845),Gt=r(31493),zt=r(46123),jt=r.n(zt),Vt=It.memo((function(e){var t=e.categories;return(0,Et.iP)(),(0,Rt.jsx)(Ht,{categories:t})})),Ht=function(e){(0,Tt.Z)(r,e);var t=(0,Pt.Z)(r);function r(e){var n,i,o,s,a;if((0,f.Z)(this,r),(s=t.call(this,e)).itemsDivRef=void 0,s.useScrollLocation=void 0,s.lastRewardedAttempt=void 0,s.onBoughtInfoTimeout=void 0,s.localCategoryInfo=void 0,s.currSub=void 0,s.categoriesSub=void 0,s.playerNamesUpdatedSub=void 0,s.showShopSub=void 0,s.forceShopSub=void 0,s.isForcedOpen=!1,s.overShopInfoSub=void 0,s.toggleShop=function(){var e={showShop:s.isForcedOpen||!s.state.showShop};e.showShop!==s.state.showShop&&(s.state.showShop?e.currentItemsScrollLocation=s.itemsDivRef.current.scrollTop:s.useScrollLocation=!0,s.setState(e))},s.onNewCategories=function(e){var t,r;if(e&&0!==Object.keys(e).length){var n=null;for(var i in e)0===Object.keys(e[i].items).length&&delete e[i];var o=new Set;for(var a in e)for(var u in o.add(a),!0===e[a].autoSelectCategory&&(n=a),s.localCategoryInfo[a]||(s.localCategoryInfo[a]={redDot:!1,items:{}}),e[a].redDot&&(s.localCategoryInfo[a].redDot=!0),e[a].forceRemoveRedDot&&(s.localCategoryInfo[a].redDot=!1),e[a].items){var c=e[a].items[u];s.localCategoryInfo[a].items[u]||(s.localCategoryInfo[a].items[u]={redDot:!1}),c.redDot&&(s.localCategoryInfo[a].items[u].redDot=!0),c.forceRemoveRedDot&&(s.localCategoryInfo[a].items[u].redDot=!1)}for(var h in s.localCategoryInfo)if(o.has(h))for(var d in s.localCategoryInfo[h].items){var f;null!==(f=e[h])&&void 0!==f&&f.items[d]||delete s.localCategoryInfo[h].items[d]}else delete s.localCategoryInfo[h];var p=(0,S.Z)({},s.state.itemUserInputs),m={categories:e,itemUserInputs:p};for(var g in e){var v=function(t){var r,n,i,o=e[g].items[t],a=s.state.itemUserInputs[t];if("dropdown"===(null===(r=o.userInput)||void 0===r?void 0:r.type)){var u=!a||!o.userInput.dropdownOptions.some((function(e){return("object"===typeof e?e.option:e)===a}));if(u){var c=o.userInput.dropdownOptions[0];p[t]="object"===typeof c?c.option:c}}else if("text"===(null===(n=o.userInput)||void 0===n?void 0:n.type))a||(p[t]="");else if("player"===(null===(i=o.userInput)||void 0===i?void 0:i.type)){var h=(0,l.rL)().getPlayersAvailableForShopInput((0,l.Zx)().serverPlayerEntity,o);a&&h.includes(a)||(p[t]=h.length>0?h[0]:null)}};for(var y in e[g].items)v(y)}for(var _ in null===n||s.state.showShop?e[s.state.selectedCategoryName]?null!==(t=e[s.state.selectedCategoryName])&&void 0!==t&&null!==(r=t.items)&&void 0!==r&&r[s.state.selectedItemName]||(m.selectedItemName=Object.keys(e[s.state.selectedCategoryName].items)[0]):(m.selectedCategoryName=Object.keys(e)[0],m.selectedItemName=Object.keys(e[m.selectedCategoryName].items)[0]):(m.selectedCategoryName=n,m.selectedItemName=Object.keys(e[n].items)[0]),s.setState(m),e)if(e[_].redDot){l.f$.publish("showShopIconRedDot",!0,!0);break}var b=!1;for(var A in s.localCategoryInfo)s.localCategoryInfo[A].redDot&&(b=!0);return b||l.f$.publish("showShopIconRedDot",!1,!0),m}s.setState({categories:{}})},s.setOnBoughtInfo=function(e){s.setState({onBoughtInfo:e}),clearTimeout(s.onBoughtInfoTimeout),s.onBoughtInfoTimeout=setTimeout((function(){s.setState({onBoughtInfo:null})}),3e3)},s.getShop=function(e){var t=s.state.currencies,r=s.state.categories,n=s.state.selectedCategoryName,i=s.state.selectedItemName,o=r[n],a=null===o||void 0===o?void 0:o.items[i],u=function(e,t){var r={category:n,name:e,shopVersion:(0,l.Zx)().serverSettings._shopVersion,userInput:s.state.itemUserInputs[e]};if(t.isRewardedAd){if(Date.now()-s.lastRewardedAttempt<5e3)return;(0,d.pD)((function(){console.log("bought rewarded ad"),(0,l.Xi)(we.Vz.itemBought,r),s.setOnBoughtInfo(t.onBoughtMessage)}),(function(){console.log("Rewarded ad failed"),s.setState({showRewardedAdFail:!0})})),s.lastRewardedAttempt=Date.now()}else{(0,l.Xi)(we.Vz.itemBought,r);var i=(0,l.Uo)(e,t,s.state.itemUserInputs[e]);if(!isNaN(i)&&t.currency){var o=(0,S.Z)({},s.state.currencies);o[t.currency].amount-=i,s.setState({currencies:o})}t.onBoughtMessage&&s.setOnBoughtInfo(t.onBoughtMessage)}},c=function(e,t){s.setState({itemUserInputs:(0,S.Z)((0,S.Z)({},s.state.itemUserInputs),{},(0,$e.Z)({},e,t))})};d.sB[(0,d.cY)()].showRewardedAds||function(e){for(var t in e)for(var r in e[t].items)e[t].items[r].isRewardedAd&&(delete e[t].items[r],0===Object.keys(e[t].items).length&&delete e[t])}(r);var h=s.getShopIsShowing();return(0,Rt.jsxs)("div",{style:{display:h?"":"none",pointerEvents:h?void 0:"none"},children:[(0,Rt.jsx)(kt.rW,{show:"crazygames"!==d.j5||h,close:s.toggleShop,forcePointerLock:!h,globallyUniqueKey:"ShopComponent",children:0!==Object.keys(s.state.categories).length&&(0,Rt.jsx)(Rt.Fragment,{children:(0,Rt.jsxs)("div",{className:"ShopBody SmallTextLight",children:[(0,Rt.jsxs)("div",{className:"ShopSidebarMenu",children:[!s.isForcedOpen&&(0,Rt.jsx)(Ut.El,{onClick:s.toggleShop,className:"ShopResumeButton",children:"Resume"}),(0,Rt.jsx)(kt.w3,{className:"ShopCategories",items:Object.keys(r).map((function(e){return{str:e,redDot:!0===s.localCategoryInfo[e].redDot}})),selectedItemStr:n,onClick:function(e){!0===s.localCategoryInfo[e].redDot&&(s.localCategoryInfo[e].redDot=!1,s.redDotCountDecreased()),s.setState({selectedCategoryName:e,selectedItemName:Object.keys(s.state.categories[e].items)[0]})}}),(0,Rt.jsx)("div",{className:"ShopCurrencies",children:t&&Object.keys(t).map((function(e){return(0,Rt.jsxs)("div",{className:"ShopCurrencyDiv",children:[(0,Rt.jsx)("div",{className:"ShopCurrencyAmtIcon",style:{color:t[e].iconColour},children:(0,Rt.jsx)(Xt,{iconName:t[e].icon})}),"\xa0",t[e].amount]},e)}))})]}),(0,Rt.jsxs)("div",{className:"ShopItemsWrapper",children:[(0,Rt.jsx)("div",{className:"ShopBannerDiv",children:(0,Rt.jsx)(Nt.YL,{info:e[0],showing:s.state.showShop})}),(0,Rt.jsx)("div",{className:"ShopItems",ref:s.itemsDivRef,children:Object.keys(r[n].items).map((function(e){var r,a=o.items[e],h=s.state.itemUserInputs[e],d=(0,l.Uo)(e,a,h);return(0,Rt.jsxs)("div",{className:"ShopItem ".concat(e===i?"SelectedShopItem":""),onClick:function(){s.setState({selectedItemName:e}),!0===s.localCategoryInfo[n].items[e].redDot&&(s.localCategoryInfo[n].items[e].redDot=!1,s.setState({categories:(0,S.Z)({},s.state.categories)}))},children:[(0,Rt.jsx)("div",{className:"ShopItemHeaderDiv",children:(0,Rt.jsx)("div",{className:"ShopItemHeader",children:(0,Rt.jsx)(kt.fD,{text:null!==(r=a.customTitle)&&void 0!==r?r:e})})}),(0,Rt.jsx)("div",{className:"ItemImageDiv",children:a.image&&(0,Rt.jsx)(Zt,{image:a.image,color:a.imageColour,minWidth:5,minHeight:4.8})}),(0,Rt.jsx)(Yt,{item:a,currInput:h,updateInput:function(t){c(e,t)}}),(0,Rt.jsx)(Kt,{item:a,cost:d,currenciesObj:t,outerClassName:"BuyItemDiv",userInputValid:null!==h,onBuy:function(){u(e,a)}}),!0===s.localCategoryInfo[n].items[e].redDot&&(0,Rt.jsx)(kt.op,{top:"-0.2rem",right:"-0.2rem"})]},e)}))})]}),(0,Rt.jsx)(qt,{selectedItemName:i,selectedItem:a,currencies:t,buyItem:u,currUserInput:s.state.itemUserInputs[i],updateUserInput:function(e){c(i,e)}})]})})}),null!==s.state.onBoughtInfo?(0,Rt.jsx)("div",{className:"ShopOnBoughtInfo",children:(0,Rt.jsx)(kt.fD,{text:s.state.onBoughtInfo})}):null,s.state.showRewardedAdFail?(0,Rt.jsx)(kt.rL,{className:"RewardedAdFailInfo",hide:function(){s.setState({showRewardedAdFail:!1})},bgClassName:"RewardedAdFailBg",containerClassName:"RewardedAdFailContainer",children:(0,Rt.jsx)("div",{children:"The rewarded ad failed. You need to disable adblock if you have it enabled."})}):null]})},e.categories)for(var u in a=e.categories)0===Object.keys(a[u].items).length&&delete a[u];else a={};var c=Object.keys(a)[0];s.state={showShop:!1,selectedCategoryName:c,selectedItemName:null===(n=Object.keys(null!==(i=null===(o=a[c])||void 0===o?void 0:o.items)&&void 0!==i?i:{}))||void 0===n?void 0:n[0],currentItemsScrollLocation:0,currencies:(0,l.Zx)().serverSettings.currencyAmounts,categories:a,showRewardedAdFail:!1,onBoughtInfo:null,itemUserInputs:{}},s.itemsDivRef=It.createRef(),s.useScrollLocation=!1,s.lastRewardedAttempt=0,s.onBoughtInfoTimeout=null,s.localCategoryInfo={};var h=s.onNewCategories(e.categories);return s.state=(0,S.Z)((0,S.Z)({},s.state),h),s}return(0,p.Z)(r,[{key:"shouldComponentUpdate",value:function(e,t,r){return t.showShop||this.state.showShop}},{key:"componentDidMount",value:function(){var e=this;this.currSub=l.f$.subscribe("serverOption|currencyAmounts",(function(t){e.setState({currencies:t})})),this.categoriesSub=l.f$.subscribe("serverOption|shopInfo",this.onNewCategories),this.playerNamesUpdatedSub=l.f$.subscribe("playerNamesUpdated",(function(){e.onNewCategories((0,S.Z)({},e.state.categories))})),this.showShopSub=l.f$.subscribe("toggleShop",(function(){e.toggleShop()})),this.forceShopSub=l.f$.subscribe("forceShowShop",(function(t){e.isForcedOpen=t,e.toggleShop()})),this.overShopInfoSub=l.f$.subscribe("overShopInfo",(function(t){e.setOnBoughtInfo(t)}))}},{key:"componentWillUnmount",value:function(){l.f$.unsubscribe(this.currSub),l.f$.unsubscribe(this.categoriesSub),l.f$.unsubscribe(this.playerNamesUpdatedSub),l.f$.unsubscribe(this.showShopSub),l.f$.unsubscribe(this.overShopInfoSub)}},{key:"getShopIsShowing",value:function(){return 0!==Object.keys(this.state.categories).length&&this.state.showShop}},{key:"componentDidUpdate",value:function(e,t){this.useScrollLocation&&(this.itemsDivRef.current&&(this.itemsDivRef.current.scrollTop=this.state.currentItemsScrollLocation),this.useScrollLocation=!1);var r=this.state.selectedCategoryName;this.getShopIsShowing()&&!0===this.localCategoryInfo[r].redDot&&(this.localCategoryInfo[r].redDot=!1,this.redDotCountDecreased(),this.setState({categories:(0,S.Z)({},this.state.categories)})),this.getShopIsShowing()&&!t.showShop?(0,d.D9)():!this.getShopIsShowing()&&t.showShop&&(0,d.Uz)()}},{key:"redDotCountDecreased",value:function(){for(var e in this.state.categories)if(!0===this.localCategoryInfo[e].redDot)return;l.f$.publish("showShopIconRedDot",!1,!0)}},{key:"render",value:function(){return(0,Rt.jsx)(Nt.OV,{getChildren:this.getShop,useAdBannersArgs:{banners:[{adId:2,adType:"leaderboard",maxWidth:window.innerWidth-42*(0,l.P3)(),maxHeight:101}],showing:this.getShopIsShowing()}})}}]),r}(It.Component);function qt(e){var t,r=e.selectedItemName,n=e.selectedItem,i=e.currencies,o=e.buyItem,s=e.currUserInput,a=e.updateUserInput,u=(0,l.Uo)(r,n,s);return(0,Rt.jsxs)("div",{className:"SelectedItemViewer",children:[(0,Rt.jsx)("div",{className:"SelectedItemHeaderDiv SmallTextBold",children:(0,Rt.jsx)("div",{className:"SelectedItemHeader",children:(0,Rt.jsx)(kt.fD,{text:null!==(t=n.customTitle)&&void 0!==t?t:r})})}),(0,Rt.jsx)("div",{className:"SelectedItemImageDiv",children:n.image&&(0,Rt.jsx)(Zt,{image:n.image,color:n.imageColour,minWidth:8,minHeight:7.5})}),(0,Rt.jsx)("div",{className:"SelectedItemDescription",children:(0,Rt.jsx)(kt.fD,{text:n.description})}),(0,Rt.jsx)(Yt,{item:n,currInput:s,updateInput:a}),(0,Rt.jsx)(Kt,{item:n,cost:u,currenciesObj:i,outerClassName:"SelectedBuyItemDiv",userInputValid:null!==s,onBuy:function(){o(r,n)}})]})}function Zt(e){var t,r=e.image,n=e.color,i=e.minWidth,o=e.minHeight,s=r.split("|")[0];if(s in l.EU.itemsClient)return(0,Rt.jsx)("div",{className:"ShopBlock",style:{minWidth:"".concat(i,"rem"),height:"0",minHeight:"".concat(o,"rem")},children:(0,Rt.jsx)(Dt.a,{itemName:s,amount:null!==(t=parseInt(r.split("|")[1]))&&void 0!==t?t:0,amountFontSize:"".concat(o/4,"rem")})});if(".jpg"===s.slice(-4)||".png"===s.slice(-4)){var u=".jpg"===s.slice(-4)?1.6*i:i;return(0,Rt.jsx)("img",{className:jt()({ShopPixelImage:".png"===s.slice(-4)}),style:{width:"".concat(u,"rem"),height:"auto",fontSize:"1.25rem"},src:"textures/games/".concat((0,a.$E)(),"/").concat(s),alt:s,draggable:!1})}return(0,Rt.jsx)("i",{className:"fas fa-".concat(r," SelectedItemImage"),style:{color:n}})}function Kt(e){var t,r,n=e.item,i=e.cost,o=e.currenciesObj,s=e.outerClassName,a=e.userInputValid,l=e.onBuy,u=(isNaN(i)||void 0===n.currency||i<=o[n.currency].amount)&&a&&(null===(t=n.canBuy)||void 0===t||t),c=!isNaN(i)&&0!==i;return c?(r=i,!0===n.sell&&(r=-1*i),r=r.toString()):0===i?r="Free":n.isRewardedAd?r="Watch ad":n.buyButtonText?r=n.buyButtonText:(console.error("Shop item does not have correct values. Defaulting the text on the buy button to Get. Shop item:",n),r="Get"),(0,Rt.jsx)(Ut.El,{className:"".concat(s," SmallTextLight"),disabled:!u,onClick:function(){var e;(isNaN(i)||void 0===n.currency||i<=o[n.currency].amount)&&a&&(null===(e=n.canBuy)||void 0===e||e)&&l()},children:(0,Rt.jsxs)("div",{className:"BuyItemCostAndIcon",children:[c&&(0,Rt.jsx)("div",{style:{color:u?o[n.currency].iconColour:"lightgray"},className:"BuyItemIcon",children:(0,Rt.jsx)(Xt,{iconName:o[n.currency].icon})}),(0,Rt.jsx)("div",{className:"BuyItemCost",children:(0,Rt.jsx)(kt.fD,{text:r})})]})})}function Yt(e){var t=e.item,r=e.currInput,n=e.updateInput,i=(0,It.useRef)(null);if(!t.userInput)return null;if("text"===t.userInput.type){console.assert(void 0!==r,"Rendered ItemUserInput but currInput is undefined. Item: ".concat(JSON.stringify(t)));var o=t.userInput.wordCharsOnly;return(0,Rt.jsx)("div",{className:"ShopItemUserInput ShopItemUserInputTextWrapper",children:(0,Rt.jsx)(Wt.o,{className:"ShopItemUserInputText",placeholderText:t.userInput.placeholderText,defaultValue:r,domRef:i,onValueChange:function(e,t){!0===o&&(e=(0,l.w8)(e)),i.current.value=e,n(e)}})})}if("dropdown"===t.userInput.type)return console.assert(void 0!==r,"Rendered ItemUserInput but currInput is undefined. Item: ".concat(JSON.stringify(t))),(0,Rt.jsx)("div",{className:"ShopItemUserInput ShopItemUserInputDropdown",children:(0,Rt.jsx)(Gt.L,{options:t.userInput.dropdownOptions.map((function(e){return"object"===typeof e?e.option:e})),value:r,onChange:function(e){var t=e.value;n(t)}})});if("player"===t.userInput.type){var s=(0,l.rL)().getPlayersAvailableForShopInput((0,l.Zx)().serverPlayerEntity,t);return(0,Rt.jsx)("div",{className:"ShopItemUserInput ShopItemUserInputDropdown",children:(0,Rt.jsx)(Gt.L,{options:s.map((function(e){return{value:e,label:(0,l.Zx)().playerNames[e]}})),value:r,onChange:function(e){var t=e.value;n(t)}})})}}function Xt(e){var t=e.iconName;return t in l.EU.itemsClient?(0,Rt.jsx)(Dt.a,{itemName:t,amount:1}):(0,Rt.jsx)("i",{className:"fas fa-".concat(t," 2x")})}var Qt=r(31382),Jt=r(96724),$t=r(95319);function er(e){var t=e.tasks,r=e.lastDisplayedTasks;return(0,Rt.jsx)(Rt.Fragment,{children:Object.keys(t).map((function(e){return(0,Rt.jsx)(tr,{task:t[e],lastDisplayedAs:r[e]},t[e].text)}))})}function tr(e){var t=e.task,r=e.lastDisplayedAs,n=(0,It.useState)((null===r||void 0===r?void 0:r.progress)/t.goal),i=(0,ue.Z)(n,2),o=i[0],s=i[1],a=(0,It.useState)(!1),l=(0,ue.Z)(a,2),u=l[0],c=l[1],h=(0,It.useState)(t.claimed||!1),d=(0,ue.Z)(h,2),f=d[0],p=d[1];return(0,It.useEffect)((function(){s(t.progress/t.goal)}),[t.progress,t.goal]),f?null:(0,Rt.jsxs)("div",{className:"Task",children:[(0,Rt.jsx)("div",{className:"TaskDescDiv",children:(0,Rt.jsx)(kt.xv,{vw:1.5,maxPx:30,children:t.text})}),t.progress<t.goal?(0,Rt.jsxs)("div",{className:"TaskProgress",children:[0!==o?(0,Rt.jsx)("div",{className:"TaskProgressForeground",style:{width:"".concat(100*o,"%")}}):null,(0,Rt.jsx)("div",{className:"TaskProgressText",children:"".concat(t.progress,"/").concat(t.goal)})]}):(0,Rt.jsx)("div",{className:"ClaimRewardButton Button",onClick:function(){c(!0)},children:(0,Rt.jsx)(kt.xv,{vw:1.5,maxPx:30,children:"Claim Reward"})}),u?(0,Rt.jsx)(rr,{task:t,close:function(){t.claimed=!0,p(!0),c(!1)}}):null]})}function rr(e){var t=e.task,r=e.close,n=(0,It.useState)(0),i=(0,ue.Z)(n,2),o=i[0],s=i[1],a=(0,It.useState)("closed"),u=(0,ue.Z)(a,2),c=u[0],h=u[1];(0,It.useEffect)((function(){var e;return"animStart"===c&&(e=setTimeout((function(){h("animEnd")}),700)),function(){clearTimeout(e)}}),[c]),(0,$t.x)((function(){(0,l.Xi)(we.Vz.completeTask,t.text,!0)}));var d=(0,kt.$i)("currencyAmounts");return(0,Rt.jsxs)("div",{className:"RewardBackground",onClick:function(){if("animEnd"===c)if(0===t.rewards.length)r(),(0,l.Xi)(we.Vz.completeTask,t.text,!0);else{var e=(0,l.Zx)().serverSettings.currencyAmounts;for(var n in o)e[n].amount+=o[n];l.f$.publish("serverOption|currencyAmounts",e),h("closed")}else"closed"===c&&(s(t.rewards.pop()),h("animStart"))},children:[(0,Rt.jsx)("img",{className:"Chest",alt:"closed"!==c?"open chest":"closed chest",src:"/textures/miscImages/Treasure Chest ".concat("closed"!==c?"open":"closed",".png")}),(0,Rt.jsx)("div",{className:"Rewards",children:"closed"!==c?Object.keys(o).map((function(e){return(0,Rt.jsxs)("div",{className:"Reward",children:[(0,Rt.jsx)("i",{className:"fas fa-".concat(d[e].icon," 3x UiCurrencyIcon RewardIcon"),style:{color:d[e].iconColour}}),(0,Rt.jsx)("div",{className:"RewardAmountText",children:"animStart"===c?0:o[e]})]},e)})):null}),"animStart"===c?(0,Rt.jsx)(nr,{}):null,(0,Rt.jsx)("div",{className:"ChestsLeft",children:t.rewards.length})]})}function nr(){var e=(0,It.useState)(0),t=(0,ue.Z)(e,2),r=t[0],n=t[1];(0,It.useEffect)((function(){n(1)}),[]);return new Array(40).fill().map((function(e,t){return(0,Rt.jsx)("i",{className:"fas fa-star 3x UiCurrencyIcon OpenStar",style:{bottom:"".concat(50*r*Math.cos(t/40*(2*Math.PI))+50,"vh"),left:"".concat(50*r*Math.sin(t/40*(2*Math.PI)),"vh"),opacity:0===r?1:0}},t)}))}function ir(e){var t=e.lbStats,r=e.storedState,n=void 0===r?{}:r,i=(0,It.useState)(n.selectedCat||(null===t||void 0===t?void 0:t[0])||null),o=(0,ue.Z)(i,2),s=o[0],a=o[1],u=(0,It.useState)(n.selectedTimeframe||"Today"),c=(0,ue.Z)(u,2),h=c[0],d=c[1],f=(0,It.useState)(null),p=(0,ue.Z)(f,2),m=p[0],g=p[1];(0,It.useEffect)((function(){null===s&&null!==t&&t.length>0&&a(t[0])}),[t,s]);var v=(0,It.useState)(n.seeingTop||!1),y=(0,ue.Z)(v,2),_=y[0],S=y[1],A=(0,It.useState)(!1),x=(0,ue.Z)(A,2),C=x[0],M=x[1],T=(0,It.useCallback)((function(){null!==s&&null!==h&&((0,l.Xi)(we.Vz.leaderboardRequest,{category:s.value,timeframe:h,seeTop:_},!0),E(!0),N&&U(null))}),[s,h,n,_]);(0,It.useEffect)((function(){T(),n.selectedCat=s,n.selectedTimeframe=h,n.seeingTop=_}),[s,h,n,_,T]),(0,It.useEffect)((function(){if((null===m||void 0===m?void 0:m.length)>0)if(_)_&&M(null===R(m));else{var e,t=(0,b.Z)(m);try{for(t.s();!(e=t.n()).done;){if(1===e.value.place)return void M(!1)}}catch(r){t.e(r)}finally{t.f()}M(!0)}}),[m,_]),(0,kt.lF)("leaderboardResponse",(function(e){for(var r=e.category,n=e.timeframe,i=e.data,o=0;o<t;o++)if(t[o].value===r){a(t[o]);break}d(n),g(i),E(!1)}));var P=(0,It.useState)(!0),I=(0,ue.Z)(P,2),k=I[0],E=I[1];function R(e){for(var t=0;t<e.length;t++)if(e[t].name===(0,l.Zx)().playerNames[(0,l.Zx)().playerEntity])return e[t].place;return null}var w=(0,It.useState)(!1),B=(0,ue.Z)(w,2),D=B[0],O=B[1],L=(0,It.useState)(null),F=(0,ue.Z)(L,2),N=F[0],U=F[1];(0,It.useEffect)((function(){if(m&&!D){var e=R(m);e<(n.lastSeenPlayerPlace||0)&&U(n.lastSeenPlayerPlace-e),O(!0)}}),[m,n,D]),(0,It.useEffect)((function(){return function(){m&&(n.lastSeenPlayerPlace=R(m))}}),[m,n]);var W=(0,It.useRef)(null),G=(0,It.useState)(void 0),z=(0,ue.Z)(G,2),j=z[0],V=z[1];return(0,It.useEffect)((function(){var e,t;j!==(null===(e=W.current)||void 0===e?void 0:e.offsetHeight)&&V(null===(t=W.current)||void 0===t?void 0:t.offsetHeight)})),l.EU.isLoggedIn?(0,Rt.jsxs)(Rt.Fragment,{children:[(0,Rt.jsxs)("div",{className:"LeaderboardSelectors",children:[(0,Rt.jsx)("div",{className:"LeaderboardSelect",children:(0,Rt.jsx)(Gt.L,{options:t.map((function(e){return{label:e.label,value:e.value}})),value:s,onChange:function(e){a(e)},controlClassName:"LBSelectClass",arrowClassName:"LBSelectArrow",menuClassName:"LBDropdownMenu"})}),(0,Rt.jsx)("div",{className:"LeaderboardSelect",children:(0,Rt.jsx)(Gt.L,{options:["Today","This week","All Time"].map((function(e){return{value:e,label:e,className:"LBDropdownMenuItem"}})),value:h,onChange:function(e){d(e.label)},controlClassName:"LBSelectClass",arrowClassName:"LBSelectArrow",menuClassName:"LBDropdownMenu"})}),C?(0,Rt.jsx)("div",{className:"SeeTopText",onClick:function(){S(!_)},children:_?"See Yourself":"See Top"}):null]}),(0,Rt.jsx)("div",{className:"LBTableWrapper",children:k?(0,Rt.jsx)("div",{className:"loader"}):null===N?(0,Rt.jsxs)(Rt.Fragment,{children:[(0,Rt.jsx)("div",{className:"LBTableHeaderBG",style:{height:j?"calc(".concat(j,"px + 1.4vmin)"):"6.5vmin"}}),(0,Rt.jsxs)("table",{className:"LBTable",children:[(0,Rt.jsx)("thead",{className:"LBTableTHead",ref:W,children:(0,Rt.jsxs)("tr",{children:[(0,Rt.jsx)("th",{className:"LBTablePlaceTH LBTableTH",children:"PLACE"}),(0,Rt.jsx)("th",{className:"LBTablePlayerTH LBTableTH",children:"PLAYER"}),(0,Rt.jsx)("th",{className:"LBTableValueTH LBTableTH",children:s.label.toUpperCase()})]})}),(0,Rt.jsx)("tbody",{children:m.map((function(e){return(0,Rt.jsxs)("tr",{className:"LBTableTR ".concat(e.name===(0,l.Zx)().playerNames[(0,l.Zx)().playerEntity]?"LBTableTRYou":""),children:[(0,Rt.jsx)("td",{className:"LBTableTD",children:"#".concat(e.place)}),(0,Rt.jsx)("td",{className:"LBTableTD",children:e.name}),(0,Rt.jsx)("td",{className:"LBTableTD",children:e.stat})]},e.name)}))})]})]}):(0,Rt.jsx)("div",{className:"LBIncreaseWrapper",onClick:function(){U(null)},children:(0,Rt.jsxs)("div",{className:"LBIncreaseDiv",children:[(0,Rt.jsx)("div",{className:"TriangleUp"}),(0,Rt.jsx)("div",{className:"LBIncreaseText",children:"".concat(N," Place").concat(N>1?"s":"")})]})})})]}):(0,Rt.jsxs)("div",{className:"LBLoginDiv",children:[(0,Rt.jsx)("div",{className:"LBLoginInfo",children:"Login to see the leaderboard"}),(0,Rt.jsx)("div",{className:"LBLoginInfo",children:"You can login from the top left homescreen"})]})}l.f$.subscribe("requiredLibrariesLoaded",(function(){setTimeout((function(){var e=new Image,t=new Image;e.src="/textures/miscImages/Treasure Chest open.png",t.src="/textures/miscImages/Treasure Chest closed.png"}),1e4)}));var or=It.memo((function(){(0,Et.iP)();var e=(0,kt.$i)("_tasks"),t=(0,kt.$i)("_availableLeaderboards"),r=(0,It.useState)({}),n=(0,ue.Z)(r,2),i=n[0],o=n[1];e&&Object.keys(e).length>0&&0===Object.keys(i).length&&o(e);var s=(0,It.useState)({tasks:{},leaderboard:{}}),a=(0,ue.Z)(s,1)[0],l={tasks:{Title:"Tasks",getIsDefined:function(){return!!e&&Object.keys(e).length>0},content:(0,Rt.jsx)(er,{tasks:e,lastDisplayedTasks:i})},leaderboard:{Title:"Leaderboard",getIsDefined:function(){return(null===t||void 0===t?void 0:t.length)>0},content:(0,Rt.jsx)(ir,{lbStats:t,storedState:a.leaderboard})}},u=(0,It.useState)(y()),c=(0,ue.Z)(u,2),h=c[0],f=c[1],p=(0,It.useState)(!1),m=(0,ue.Z)(p,2),g=m[0],v=m[1];function y(){for(var e in l)if(l[e].getIsDefined())return e;return null}(0,kt.lF)("ToggleMenu",(function(){h&&(g?C():v(!0))})),(0,It.useEffect)((function(){h||f(y())}),[y()]);var _=(0,It.useState)(!1),b=(0,ue.Z)(_,2),A=b[0],x=b[1];function C(){v(!1),o((0,S.Z)({},e))}(0,It.useEffect)((function(){g&&h&&!A&&x(!0)}),[g,A,h]),(0,It.useEffect)((function(){!A&&e&&"tasks"!==h&&f("tasks")}),[A,e,h]),(0,It.useEffect)((function(){g&&h?(0,d.D9)():(0,d.Uz)()}),[g]);var M=(0,Nt.VA)({showing:h&&g,banners:[{adType:"leaderboard",adId:4,maxWidth:.75*document.documentElement.clientWidth,maxHeight:24*document.documentElement.clientHeight/100}]});return(0,Rt.jsx)(Rt.Fragment,{children:h?(0,Rt.jsx)("div",{style:{display:g?"block":"none",pointerEvents:g?void 0:"none"},children:(0,Rt.jsxs)(kt.rW,{close:C,escDoesExit:!1,closeClassnameList:["VerticalMenuScreenDiv"],forcePointerLock:!g,globallyUniqueKey:"RetentionFeaturesComponent",children:[(0,Rt.jsxs)("div",{className:"VerticalMenuScreenDiv",children:[(0,Rt.jsx)(ar,{}),(0,Rt.jsxs)("div",{className:"MenuDiv",children:[(0,Rt.jsx)(sr,{setCategory:f,menuCategories:l,selectedCat:h}),(0,Rt.jsx)("div",{className:"MenuCategoryContainer",children:l[h].content})]})]}),(0,Rt.jsxs)("div",{className:"BottomScreenMenuWrapper",children:["crazygames"!==d.j5&&(0,Rt.jsx)("div",{className:"MenuBannerDiv",children:(0,Rt.jsx)(Nt.YL,{info:M[0],showing:g})}),(0,Rt.jsx)("div",{className:"DiscordMenuDivDiv",children:(0,Rt.jsx)("div",{className:"DiscordMenuDiv",children:(0,Rt.jsx)(lr,{tasks:e})})})]})]})}):null})}));function sr(e){var t=e.selectedCat,r=e.setCategory,n=e.menuCategories;return(0,Rt.jsx)("div",{className:"MenuHeader",children:Object.keys(n).map((function(e){return n[e].getIsDefined()?(0,Rt.jsx)("div",{className:"MenuHeaderCategory ".concat(e===t?"SelectedHeaderCat":"UnselectedHeaderCat"),onClick:function(){r(e)},children:n[e].Title},e):null}))})}function ar(){var e=(0,kt.$i)("currencyAmounts");return(0,Rt.jsx)("div",{className:"TopScreenCurrencies",children:Object.keys(e).map((function(t){return(0,Rt.jsxs)("div",{className:"TopScreenCurrencyDiv",children:[(0,Rt.jsx)("i",{className:"fas fa-".concat(e[t].icon," 3x UiCurrencyIcon"),style:{color:e[t].iconColour}}),(0,Rt.jsx)("div",{className:"UiCurrencyAmount",children:e[t].amount})]},t)}))})}function lr(e){var t=e.tasks;return(0,Rt.jsxs)("a",{className:"MenuDiscordButtonWrapper",href:"https://discord.gg/vwMp5y25RX",target:"_blank",rel:"noreferrer",children:[(0,Rt.jsx)("div",{className:"DiscordButton",onClick:function(){l.Cc.setItem("DiscordPressed",!0),(0,l.Xi)(we.Vz.generalCookieSet,{cookie:"joinDiscord",value:!0}),"joinDiscord"in t&&l.f$.publish("clientTaskProgress",{taskId:"joinDiscord",progress:1})}}),(0,Rt.jsx)(kt.op,{})]})}var ur=r(69844),cr=r(23455),hr=It.memo((function(){return(0,Et.iP)(),(0,Rt.jsx)(dr,{})})),dr=function(e){(0,Tt.Z)(r,e);var t=(0,Pt.Z)(r);function r(e){var n;return(0,f.Z)(this,r),(n=t.call(this,e)).state={weaponHits:[]},n.timeouts=[],n.weaponHitIndicatorLifetime=1e3,n.weaponHits=[],n}return(0,p.Z)(r,[{key:"componentDidMount",value:function(){var e=this;this.weaponHitsSub=l.f$.subscribe("shotPlayer",(function(t){var r=t.damage,n=t.wasCrit,i=t.distance,o=Date.now();e.weaponHits=[].concat((0,Ve.Z)(e.weaponHits),[{damage:r,timeReceived:o,wasCrit:n,distanceToHit:i}]),e.setState({weaponHits:e.weaponHits});var s=setTimeout((function(){e.timeouts=e.timeouts.filter((function(e){return e!==s})),e.weaponHits=e.weaponHits.filter((function(e){return e.timeReceived!==o})),e.setState({weaponHits:e.weaponHits})}),e.weaponHitIndicatorLifetime);e.timeouts.push(s)}))}},{key:"componentWillUnmount",value:function(){l.f$.unsubscribe(this.weaponHitsSub);var e,t=(0,b.Z)(this.timeouts);try{for(t.s();!(e=t.n()).done;){var r=e.value;clearTimeout(r)}}catch(n){t.e(n)}finally{t.f()}}},{key:"render",value:function(){var e=this;return(0,Rt.jsx)("div",{className:"WeaponDamageNumberWrapper",children:this.weaponHits.map((function(t){var r,n=t.damage,i=t.timeReceived,o=t.wasCrit,s=t.distanceToHit;return t.pos||(t.pos=function(e){var t=50/(.35*Math.pow(e,.7)),r=-Math.PI/4+Math.random()*Math.PI/2;return{x:t*Math.sin(r),y:-t*Math.cos(r)}}(s)),r=o?"WeaponDamageCrit":"WeaponDamageNormal",(0,Rt.jsx)(fr,{className:"WeaponDamageNumber ".concat(r),classNames:"WeaponDamageNumber",timeout:e.weaponHitIndicatorLifetime,enterActiveStyle:{transform:"translate(calc(".concat(t.pos.x,"vh - 50%), calc(").concat(t.pos.y,"vh - 50%))"),transition:"transform ".concat(e.weaponHitIndicatorLifetime,"ms ease-out")},children:(0,Rt.jsx)("div",{children:Math.floor(n)})},i)}))})}}]),r}(It.Component);function fr(e){var t=e.children,r=e.className,n=e.classNames,i=e.timeout,o=e.enterActiveStyle,s=(0,It.useState)(!1),a=(0,ue.Z)(s,2),l=a[0],u=a[1];(0,It.useEffect)((function(){u(!0)}),[]);var c=(0,It.useRef)(null),h=(0,It.useState)(!1),d=(0,ue.Z)(h,2),f=d[0],p=d[1];return(0,Rt.jsx)(cr.Z,{className:r,classNames:n||r,in:l,timeout:i,nodeRef:c,onEntering:function(){p(!0)},children:(0,It.cloneElement)(t,{ref:c,style:f&&o||void 0})})}function pr(){return(0,Rt.jsx)(mr,{actualValueSetting:"_health",maxValueSetting:"maxHealth",icon:"heart",text:"",color:"red"})}function mr(e){var t=e.actualValueSetting,r=e.maxValueSetting,n=e.icon,i=(e.text,e.color,(0,kt.$i)(t)),o=(0,kt.$i)(r);return(0,Et.Lm)(),null===i?null:(0,Rt.jsx)("div",{className:"BottomScreenStatBarWrapper",children:(0,Rt.jsxs)("div",{className:"BottomScreenStatBarBackground",children:[(0,Rt.jsx)("div",{className:"BottomScreenStatBar",style:{transform:"scaleX(".concat(Math.max(i/o,0),")"),transformOrigin:"left center"}}),(0,Rt.jsxs)(kt.xv,{vw:1.2,maxPx:14.4,className:"BottomScreenStatBarText SmallTextBold",children:[(0,Rt.jsx)("i",{className:"fas fa-".concat(n)})," ".concat(Math.ceil(i),"/").concat(o)]})]})})}var gr=r(93239),vr=It.memo((function(){(0,Et.iP)();var e=(0,It.useState)(!1),t=(0,ue.Z)(e,2),r=t[0],n=t[1],i=(0,It.useRef)(0),o=(0,It.useRef)(null),s=(0,It.useReducer)((function(e){return e+1}),0),a=(0,ue.Z)(s,2),u=(a[0],a[1]),c=(0,kt.$i)("respawnButtonText"),h=(0,kt.$i)("usePlayAgainButton"),f=(0,It.useState)((0,l.Zx)().serverSettings.secsToRespawn),p=(0,ue.Z)(f,2),m=p[0],g=p[1],v=(0,It.useState)((0,l.Zx)().serverSettings.autoRespawn),y=(0,ue.Z)(v,2),_=y[0],b=y[1];(0,kt.lF)("serverOption|secsToRespawn",(function(e){g(e),r&&i.current>=0&&e<i.current&&(i.current=e,_&&i.current<=0&&x())})),(0,kt.lF)("serverOption|autoRespawn",(function(e){b(e),e&&r&&i.current<=0&&x()}));var S=function(e){e?n(!1):(n(!0),i.current=m,u(),_&&i.current<=0&&x(),clearInterval(o.current),null===o.current&&i.current>0&&(o.current=setInterval((function(){i.current=Math.max(i.current-1,0),u(),i.current<=0&&(clearInterval(o.current),o.current=null,(0,l.Zx)().serverSettings.autoRespawn&&x())}),1e3)))};(0,kt.lF)("otherPlayerSettingsClientifiedEId|".concat((0,l.Zx)().playerEntity,"|_isAlive"),(function(e){console.log("Updating respawn component from otherPlayerSettingsClientifiedEId. isAlive:",e),S(e)})),(0,It.useEffect)((function(){var e=(0,l.Zx)();console.log("Updating respawn component from initial mount"),S(e.otherPlayerSettings[e.playerEntity][e.playerEntity]._isAlive)}),[]);var A=(0,It.useRef)(0),x=function(){if(Date.now()-A.current>1e3){var e=function(){(0,l.Xi)(we.Vz.respawn),A.current=Date.now()};(0,l.Zx)().serverSettings.autoRespawn?e():(0,d.kB)((function(){e()}),"respawn")}},C=(0,Nt.VA)({showing:r,banners:[{adType:"leaderboard",adId:1,maxWidth:.8*document.documentElement.clientWidth,maxHeight:.35*document.documentElement.clientHeight},{adType:"square",adId:1,maxWidth:window.innerWidth<1e3||window.innerHeight<700?0:1e4,maxHeight:1e5}]}),M=0===i.current,T=M?"":" in ".concat(i.current);return(0,Rt.jsx)(kt.NV,{showing:r,globallyUniqueKey:"RespawnComponent",children:(0,Rt.jsxs)(kt.rW,{close:function(){n(!1)},zIndex:1,togglePointerLock:!1,closeOnPressBackground:!1,children:[(0,Rt.jsxs)("div",{className:"CenteredRespawnDiv",children:[(0,Rt.jsxs)("div",{className:"RespawnMainContent",children:[_&&(0,Rt.jsxs)("div",{className:"AutoRespawnText FullyFancyText",children:["Respawning",T]}),!_&&(0,Rt.jsxs)(Rt.Fragment,{children:[h&&(0,Rt.jsx)(Ut.gG,{className:"RespawnButton",onClick:function(){(0,d.kB)((function(){(0,gr.I4)(l.EU.connectedPlayingMode,null)}))},children:"Play Again"}),(0,Rt.jsx)(Ut.El,{className:"RespawnButton",onClick:x,disabled:!M,children:"".concat(c).concat(T)}),(0,Rt.jsx)(Ut.QT,{className:"RespawnButton",onClick:function(){(0,gr.mH)()},disabled:!M,children:"Exit Game".concat(T)})]})]}),(0,Rt.jsx)("div",{className:"RespawnLbBannerDiv",children:(0,Rt.jsx)(Nt.YL,{info:C[0]})})]}),(0,Rt.jsx)("div",{className:"RespawnSideSquareBannerDiv",children:(0,Rt.jsx)(Nt.YL,{info:C[1]})})]})})})),yr=r(66293),_r=r(32901),br=he.yE?7e7:7e3,Sr=It.memo((function(){var e=(0,It.useRef)([]),t=(0,kt.GG)();(0,kt.lF)("playerKilled",(function(r){var n,i,o=r.deadEId,s=r.killerEId,a=r.withItem,u=r.headshot,c=r.killstreak,h=e.current;if(h.length>=3){var d=h.shift();clearTimeout(d.timeout)}""!==(0,l.Zx)().otherPlayerSettings[(0,l.Zx)().playerEntity][s].killfeedColour?(n=(0,l.Zx)().otherPlayerSettings[(0,l.Zx)().playerEntity][s].killfeedColour,i=(0,l.Zx)().otherPlayerSettings[(0,l.Zx)().playerEntity][o].killfeedColour):(n=s===(0,l.Zx)().serverPlayerEntity?"#2727f1":"#912c2c",i=o===(0,l.Zx)().serverPlayerEntity?"#2727f1":"#912c2c");var f={deadName:(0,l.Zx)().playerNames[o],killerName:(0,l.Zx)().playerNames[s],withItem:a,wasHeadshot:u,killstreak:c,timeout:setTimeout((function(){h.shift(),t()}),br),reactId:"".concat(s,"|").concat(o,"|").concat(Date.now()),killerColour:n,deadColour:i};h.push(f),t()})),(0,It.useEffect)((function(){var t=e.current;return function(){for(;t.length>0;){var e=t.pop().timeout;clearTimeout(e)}}}),[]);return(0,Rt.jsx)("div",{className:"Killfeed",children:e.current.map((function(e){var t,r=e.deadName,n=e.killerName,i=e.withItem,o=e.wasHeadshot,s=e.killstreak,a=e.killerColour,u=e.deadColour,c=e.reactId;return(0,Rt.jsxs)("div",{className:"IndividualKillWrapper SmallTextLight",style:{background:"linear-gradient(90deg, ".concat(_r(a).alpha(.5)," calc(100% - 10rem), ").concat(_r(u).alpha(.5)," 100%)")},children:[s>=2?(0,Rt.jsx)("div",{className:"KillfeedKillstreak",children:(0,l.jM)(s)}):null,(0,Rt.jsx)("div",{className:"KillfeedKillerName",children:n}),(0,Rt.jsx)("div",{className:"KillfeedItem",style:{height:"5vmin",width:"Gun"===(null===(t=l.EU.itemsClient[i])||void 0===t?void 0:t.type)?"7.5vmin":"5vmin"},children:(0,Rt.jsx)(Dt.a,{itemName:i,amount:0,gunTransform:"scaleX(-1)",itemMarginTop:0})}),o?(0,Rt.jsx)("i",{className:"fas fa-crosshairs 3x KillfeedHeadshotIcon"}):null,(0,Rt.jsx)("div",{className:"KillfeedDeadName",children:r})]},c)}))})})),Ar=r(3170),xr=It.memo((function(){return(0,Rt.jsx)("div",{className:"BottomRightElements",children:(0,Rt.jsx)(Tr,{})})})),Cr=0,Mr=1;function Tr(){var e=(0,It.useRef)([]),t=(0,It.useRef)(Cr),r=(0,It.useRef)(),n=(0,It.useRef)(),i=(0,kt.$i)("showProgressBar");(0,It.useEffect)((function(){return function(){t.current=Cr,clearTimeout(r.current)}}),[i]),(0,kt.lF)("progressBarUpdate",(function(r){var n=r.toFraction,i=r.toDuration;e.current.push({toFraction:n,toDuration:i}),t.current===Cr&&o()}));var o=function i(){console.assert(t.current===Cr);var o=e.current;if(o.length>0){var s=o.shift(),a=s.toFraction,l=s.toDuration;t.current=Mr;n.current.style.transition="transform ".concat(Math.max(l-50,0),"ms linear"),n.current.style.backgroundColor="var(--darkerColourShaded)",r.current=setTimeout((function(){n.current.style.transform="scaleX(".concat(a,")"),r.current=setTimeout((function(){1===a&&(n.current.style.backgroundColor="var(--buttonColourShaded)"),t.current=Cr,i()}),Math.max(l-50,0))}),50)}};if(!i)return null;return(0,Rt.jsx)("div",{className:"ProgressBarBackground",children:(0,Rt.jsx)("div",{className:"ProgressBarForeground",ref:n,style:{width:"".concat(15,"vw"),transformOrigin:"left center",transform:"scaleX(0)"}})})}var Pr=r(34177),Ir={Helmet:r(82113),Chestplate:r(7673),Gauntlets:r(5827),Leggings:r(45100),Boots:r(3145)},kr=0;l.f$.subscribe("noaTick",(function(){Date.now()-kr>9200&&((0,l.Xi)(we.Vz.chestConf,(0,l.xO)(),!0),kr=Date.now())}));var Er=It.memo((function(e){var t=e.touchScreen,r=(0,l.Zx)(),n=r.ents.getInventory(r.playerEntity),i=r.ents.getInvenOps(r.playerEntity),o=i.openChest,s=(0,It.useState)(!1),a=(0,ue.Z)(s,2),u=a[0],c=a[1],h=(0,It.useState)(null),d=(0,ue.Z)(h,2),f=d[0],p=d[1],m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:!u;if(!t&&J.current&&($.current=J.current.scrollTop),p(e),c(t),o){(0,l.Xi)(we.Vz.closeChest,null),i.chestClosed();var r=(0,bt.GW)().play("chestClose",1);r.rate(.8+.4*Math.random())}};(0,kt.lF)("ToggleInventory",m),(0,kt.lF)("chestToggleFromServer",(function(e){if(p(null),c(e),e)(0,bt.GW)().play("chestOpen",1).rate(.8+.4*Math.random());else if(o){(0,bt.GW)().play("chestClose",1).rate(.8+.4*Math.random())}}));(0,kt.lF)("updatedInventory",(function(e){S()}));var g=(0,It.useRef)(null),v=(0,It.useRef)(null),y=(0,It.useRef)(null),_=(0,It.useReducer)((function(e){return e+1}),0),b=(0,ue.Z)(_,2),S=(b[0],b[1]),A=(0,kt.$i)("inventoryItemsMoveable"),x=function(e,t){i.movePosWithAmtClient(v.current.idx,e,t)?(v.current.amount-=t,v.current.amount<=0&&(v.current=null)):console.error("movePosWithAmtClient failed")},C=(0,It.useRef)(0),M=function(e){return function(t){var r=Wr(t);r||w(t.pageX,t.pageY),A&&(R(t),C.current=Date.now(),r&&(E.current.itemBeingDragged=!0),T(t,e))}},T=function(e,t){var r,s=i.getItemAtIdx(t),a=0===(r=e).button||void 0===r.button;if(-1===t)if(v.current){var l=a&&v.current.amount||1;i.removeItemClient(v.current.idx,l)&&(v.current.amount-=l,v.current.amount<=0&&(v.current=null))}else a&&m();else if(Ur(e)){var u;if(!s)return;var c=s.amount;if(t===(null===(u=v.current)||void 0===u?void 0:u.idx)&&(c=v.current.amount<=0?0:s.amount-v.current.amount),0===c)return;var h=(0,I.r9)(s.name),d=-1!==I.XL.indexOf(h)?n.numSlots-I.XL.length+I.XL.indexOf(h):null;!I.XL.includes(h)||null!==i.getItemAtIdx(d)&&t!==d?o?t<n.numSlots?i.moveItemIntoIdxsClient(n.numSlots,n.numSlots+o.numSlots,t,c):i.moveItemIntoIdxsClient(0,n.numSlots-I.XL.length,t,c):i.inCreative?t<10?i.moveItemIntoIdxsClient(10,n.numSlots-I.XL.length,t,c):t<n.numSlots?i.moveItemIntoIdxsClient(0,10,t,c):i.moveItemIntoIdxsClient(0,n.numSlots-I.XL.length,t,c):t<10?i.moveItemIntoIdxsClient(10,n.numSlots-I.XL.length,t,c):i.moveItemIntoIdxsClient(0,10,t,c):t<n.numSlots-I.XL.length||t>=n.numSlots?i.swapPosClient(d,t):(i.moveItemIntoIdxsClient(0,n.numSlots-I.XL.length,d,c),(0,bt.GW)().play("equip_leather1",1).rate(.9+.3*Math.random()))}else if(v.current){var f=v.current.idx;if(s&&v.current.name===s.name&&v.current.amount>0&&Ft(s)>0&&(s.amount<he.ZP.maxItemStackSize||t===f))a?s.amount+v.current.amount<=he.ZP.maxItemStackSize||t===f?x(t,v.current.amount):x(t,he.ZP.maxItemStackSize-s.amount):x(t,1);else if(v.current.amount>0&&!s)x(t,a?v.current.amount:1);else if(a||s||0===v.current.amount){if(i.swapPosClient(t,v.current.idx)){var p=i.getItemAtIdx(f),g=!i.openChest&&i.inCreative&&v.current.idx>=i.playerInventory.numSlots;p&&v.current.idx!==t&&!g?v.current={idx:v.current.idx,name:p.typeObj.name,amount:Ft(p)}:v.current=null}}else x(t,1)}else{if(!s)return;if(a)v.current={idx:t,name:s.typeObj.name,amount:Ft(s)};else{var y=Math.ceil(Ft(s)/2);v.current={idx:t,name:s.typeObj.name,amount:y}}}S()},P=function(e){return function(e){var t=Wr(e);if(R(e),t&&v.current&&Date.now()-C.current>150){var r=document.elementFromPoint(e.clientX,e.clientY),n=r.getAttribute("data-inven-idx");null!==n?T(e,parseInt(n)):r.classList.contains("InventoryBackgroundScreen")&&T(e,-1)}E.current.itemBeingDragged=!1,w(e.pageX,e.pageY)}},k=(0,It.useRef)({x:0,y:0}),E=(0,It.useRef)({isTouch:!1,itemBeingDragged:!1}),R=function(e){E.current.isTouch=Wr(e)};(0,It.useEffect)((function(){var e;if(u){if(!E.current.isTouch){var t=k.current;w(t.x,t.y)}e=function(e){e.preventDefault(),R(e),w(e.pageX,e.pageY)},document.addEventListener("pointermove",e)}return function(){document.removeEventListener("pointermove",e)}}));var w=function(e,t){var r=k.current;r.x=e,r.y=t,g.current?E.current.isTouch&&!E.current.itemBeingDragged?g.current.style.transform="translate(0.5rem, 0.5rem)":g.current.style.transform="translate(".concat(r.x,"px, ").concat(r.y,"px)"):y.current&&(y.current.style.transform="translate(".concat(r.x+10,"px, ").concat(r.y+10,"px)"))};(0,It.useEffect)((function(){return ze.bo.setInventoryOpen(u),function(){ze.bo.setInventoryOpen(!1)}}),[u]);var B=(0,It.useState)(null),D=(0,ue.Z)(B,2),O=D[0],L=D[1],F=(0,It.useState)(null),N=(0,ue.Z)(F,2),U=N[0],W=N[1],G=function(e){return function(t,r){void 0!==e&&L(t?e:null),t&&void 0===r&&console.error(new Error("here").stack),W(t?r:null)}};(0,kt.lF)("DropInvenItem",(function(e){if(null!==O&&null!==i.getItemAtIdx(O)){var t,r,n=i.getItemAtIdx(O),o=e&&null!==(t=n.amount)&&void 0!==t?t:1;i.removeItemClient(O,o),O===(null===(r=v.current)||void 0===r?void 0:r.idx)&&(v.current.amount-=o,v.current.amount<=0&&(v.current=null),S())}})),(0,kt.lF)("numkeyPressed",(function(e){var t=e-1;null!==O&&u&&(i.swapPosClient(t,O)&&v.current&&(v.current.idx===O?v.current.idx=t:v.current.idx===t&&(v.current.idx=O)),S())})),(0,It.useEffect)((function(){u||(v.current=null,W(null),S())}),[u]),(0,kt.lF)("EscKeyPressed",(function(){m(null,!1)})),(0,kt.lF)("syncedInvenFromServer",(function(){v.current=null,S()})),(0,kt.lF)("craftingRecipesEdited",(function(e){var t=e.itemName,r=e.recipesForItem;(null===q||void 0===q?void 0:q.name)===t&&(null===q||void 0===q?void 0:q.craftingIdx)>=r.length&&Z(null),S()}));var z,j=(0,kt.$i)("canCraft"),V=(0,It.useReducer)((function(e,t){return(null===e||void 0===e?void 0:e.name)!==(null===t||void 0===t?void 0:t.name)||(null===e||void 0===e?void 0:e.craftingIdx)!==(null===t||void 0===t?void 0:t.craftingIdx)?t:e}),null),H=(0,ue.Z)(V,2),q=H[0],Z=H[1],K=(0,It.useState)(""),Y=(0,ue.Z)(K,2),X=Y[0],Q=Y[1],J=(0,It.useRef)(null),$=(0,It.useRef)(0);return(0,It.useEffect)((function(){u&&J.current&&(J.current.scrollTop=$.current)}),[u]),o?z=(0,Rt.jsx)("div",{className:"GridItemSlots LeftSideItemSlots",children:new Array(i.openChest.numSlots).fill(0).map((function(e,t){var r=n.numSlots+t;return(0,Rt.jsx)(Dr,{idx:r,draggedInfo:v.current,setHovered:G(r),pointerDown:M(r),pointerUp:P()},r)}))}):!i.inCreative||null!==f&&j?j&&(z=(0,Rt.jsx)(Rr,{onCraft:function(){!function(){if(v.current){var e=v.current,t=e.idx,r=e.name,n=e.amount;(null===i.getItemAtIdx(t)||i.getItemAtIdx(t).name!==r||i.getItemAtIdx(t).amount<n)&&(v.current=null)}}()},craftingStation:f,selectedCraftable:q,dispatchSelectedCraftable:Z,setHovered:G()})):z=(0,Rt.jsx)(Nr,{creativeScrollDiv:J,playerInven:n,getSetHoveringForIdx:G,getPointerDownForIdx:M,getPointerUpForIdx:P,creativeSearchVal:X,setCreativeSearchVal:Q}),(0,Rt.jsxs)("div",{className:"InventoryCompWrapper",style:{touchAction:u?"none":null},children:[v.current&&(0,Rt.jsx)(Or,{draggedInfo:v.current,toAddRef:g}),!v.current&&null!==U&&(0,Rt.jsx)(Lr,{itemName:U,domRef:y}),(0,Rt.jsx)(Fr,{touchScreen:t}),(0,Rt.jsx)(kt.rW,{show:u,className:"InventoryBackgroundScreen",globallyUniqueKey:"Inventory",close:m,forcePointerLock:!u,zIndex:3,closeOnPressBackground:!1,preventContextMenu:!0,pointerDown:M(-1),pointerUp:P(),doGameplayStartStopOnShow:!0,children:(0,Rt.jsxs)("div",{className:"Inventory",children:[(0,Rt.jsxs)("div",{className:"InvenBody",children:[z,(0,Rt.jsxs)("div",{className:"InvenBodyRight",children:[(0,Rt.jsx)("div",{className:"ArmourItemSlots",children:new Array(I.XL.length).fill(0).map((function(e,t){var r,i=n.numSlots-I.XL.length+t,o=null===(r=v.current)||void 0===r?void 0:r.name,s=I.XL[t],a=M(i),l=P();return(0,Rt.jsx)(Dr,{idx:i,draggedInfo:v.current,setHovered:G(i),pointerDown:function(e){o&&(0,I.r9)(o)!==s||a(e)},pointerUp:function(e){o&&o.split(" ")[1]!==s||l(e)},defaultIconB64:Ir[s]},i)}))}),(0,Rt.jsx)("div",{className:"GridItemSlots",children:new Array(n.numSlots-10-I.XL.length).fill(0).map((function(e,t){var r=t+10;return(0,Rt.jsx)(Dr,{idx:r,draggedInfo:v.current,setHovered:G(r),pointerDown:M(r),pointerUp:P()},r)}))})]})]}),(0,Rt.jsx)("div",{className:"InvenHotbar",children:new Array(10).fill(0).map((function(e,t){return(0,Rt.jsx)(Dr,{idx:t,draggedInfo:v.current,setHovered:G(t),pointerDown:M(t),pointerUp:P()},t)}))})]})})]})}));function Rr(e){var t=e.onCraft,r=e.dispatchSelectedCraftable,n=e.selectedCraftable,i=e.craftingStation,o=e.setHovered,s=(0,l.Zx)(),a=s.ents.getInventory(s.playerEntity),u=(0,l.rL)().craftingManager.getItemsHavingOneIngredientOf(s.playerEntity,a,i),c=n;return u.length>0&&null===n&&(c=u[0]),(0,It.useEffect)((function(){var e;u.some((function(e){return e.name===(null===n||void 0===n?void 0:n.name)&&e.craftingIdx===(null===n||void 0===n?void 0:n.craftingIdx)}))||r(null!==(e=u[0])&&void 0!==e?e:null)})),(0,Rt.jsx)("div",{className:"Craftables",children:u.length>0&&(0,Rt.jsxs)(Rt.Fragment,{children:[(0,Rt.jsxs)("div",{className:"CraftablesLeftSide",children:[(0,Rt.jsx)("div",{className:"CraftingStationHeader SmallTextBold",children:i}),(0,Rt.jsx)("div",{className:"CraftableItems",children:u.map((function(e){var t=e.name,n=e.craftingIdx,i=e.haveIngredients;return(0,Rt.jsx)(Br,{itemName:t,onClick:function(){r(e)},isSelected:c.name===t&&c.craftingIdx===n,haveIngredients:i,setHovered:o},"".concat(t,"_").concat(n))}))})]}),(0,Rt.jsx)(wr,{recipeItem:c,onCraft:t,setHovered:o})]})})}function wr(e){var t=e.recipeItem,r=t.name,n=t.craftingIdx,i=e.onCraft,o=e.setHovered,s=(0,l.Zx)(),a=s.ents.getInventory(s.playerEntity),u=!(0,l.rL)().craftingManager.spaceInInvenToCraft(s.playerEntity,a,r,n),c=(0,l.rL)().craftingManager.itemCanBeCrafted(s.playerEntity,a,r,n),h=(0,l.rL)().craftingManager.getRecipesForPlayer(s.playerEntity)[r],d="4rem";return 3===h[n].requires.length?d="3.75rem":h[n].requires.length>=4&&(d="3.25rem"),(0,Rt.jsxs)("div",{className:"CraftableInfo SmallTextBold",children:[(0,Rt.jsx)("div",{className:"CraftableHeader",children:r}),h[n].requires.map((function(e){var t=e.items,r=e.amt;return(0,Rt.jsx)("div",{className:"CraftingRecipeItemReq",style:{width:d,height:d},onPointerEnter:function(){null===o||void 0===o||o(!0,t[0])},onPointerLeave:function(){null===o||void 0===o||o(!1)},children:(0,Rt.jsx)(Dt.a,{itemName:t[0],amount:r})},t[0])})),(!c||u)&&(0,Rt.jsxs)("div",{className:"CantCraftInfo",children:[!c&&"Missing ingredients",(0,Rt.jsx)("br",{}),u&&"Inventory is full"]}),(0,Rt.jsx)(Ut.El,{className:"DoCraftButton",onClick:function(e){if(Ur(e)){for(var t=[];(0,l.rL)().craftingManager.craftItem(s.playerEntity,a,r,n);)i(),t.push({itemName:r,craftingIdx:n});(0,l.Xi)(we.Vz.craftItem,t)}else{(0,l.rL)().craftingManager.craftItem(s.playerEntity,a,r,n)&&(i(),(0,l.Xi)(we.Vz.craftItem,[{itemName:r,craftingIdx:n}]))}},disabled:!c||u,children:(0,Rt.jsx)("div",{className:"DoCraftItem",onPointerEnter:function(){null===o||void 0===o||o(!0,r)},onPointerLeave:function(){null===o||void 0===o||o(!1)},children:(0,Rt.jsx)(Dt.a,{itemName:r,amount:h[n].produces})})})]})}function Br(e){var t=e.onClick,r=e.itemName,n=e.isSelected,i=e.haveIngredients,o=e.setHovered;return(0,Rt.jsx)("div",{className:jt()("InvenItem",{CraftableItemNotEnoughIngredients:!i}),onClick:t,style:{cursor:n?null:"pointer"},onPointerEnter:function(){null===o||void 0===o||o(!0,r)},onPointerLeave:function(){null===o||void 0===o||o(!1)},children:(0,Rt.jsx)(Dt.a,{itemName:r,amount:1})})}function Dr(e){var t=e.idx,r=e.setHovered,n=e.pointerDown,i=e.pointerUp,o=e.draggedInfo,s=e.defaultIconB64,a=void 0===s?null:s,u=(0,l.Zx)(),c=u.ents.getInvenOps(u.playerEntity).getItemAtIdx(t);return(0,Rt.jsxs)("div",{className:"InvenItem",onPointerEnter:function(){var e;null===r||void 0===r||r(!0,null!==(e=null===c||void 0===c?void 0:c.name)&&void 0!==e?e:null)},onPointerLeave:function(){null===r||void 0===r||r(!1)},onPointerDown:n,onPointerUp:i,"data-inven-idx":t,children:[c&&function(){var e=Ft(c);return(null===o||void 0===o?void 0:o.idx)===t&&e>0&&(e-=o.amount),((null===o||void 0===o?void 0:o.idx)!==t||e>0)&&(0,Rt.jsx)(Dt.a,{itemName:c.typeObj.name,amount:e})}(),a&&(!c||(null===o||void 0===o?void 0:o.idx)===t)&&(0,Rt.jsx)("div",{className:"InvenItemUnfilled",style:{backgroundImage:"url(".concat(a,")")}})]})}function Or(e){var t=e.draggedInfo,r=t.name,n=t.amount,i=e.toAddRef;return(0,Rt.jsx)("div",{className:"DraggedInvenItem",ref:i,children:(0,Rt.jsx)(Dt.a,{itemName:r,amount:n})})}function Lr(e){var t=e.itemName,r=e.domRef,n=(0,l.Zx)(),i=(0,l.rL)().getItemStat(n.playerEntity,t,"displayName"),o=(0,l.rL)().getItemStat(n.playerEntity,t,"description");return(0,Rt.jsxs)("div",{className:"InvenHoveredItemInfo SmallTextBold",ref:r,children:[(0,Rt.jsx)(kt.fD,{text:i}),(0,Rt.jsx)("div",{className:"InvenHoveredItemInfoDescription",children:(0,Rt.jsx)(kt.fD,{text:o})})]})}function Fr(e){var t=e.touchScreen,r=function(){var e=(0,l.Zx)().ents.getInventoryState((0,l.Zx)().playerEntity);if(null!==e&&void 0!==e&&e.inventory){var t=e.inventory;return ut.some((function(e){return t.getAmountOfItem(e)>0}))}return!1};return(0,kt.lF)("updatedInventory",(function(e){(0,l.Zx)().serverSettings.creative||l.Cc.getItem("LogInInventoryRedDotTutorialComplete")||(r()?(l.f$.publish("RedDotOpenInventoryIcon",!0),l.f$.publish("TouchTutorialOpenInventoryIcon",!0)):(l.f$.publish("RedDotOpenInventoryIcon",!1),l.f$.publish("TouchTutorialOpenInventoryIcon",!1)))})),(0,kt.lF)("ToggleInventory",(function(){r()&&(l.Cc.setItem("LogInInventoryRedDotTutorialComplete",!0),l.f$.publish("RedDotOpenInventoryIcon",!1),l.f$.publish("TouchTutorialOpenInventoryIcon",!1))})),(0,Rt.jsx)("div",{className:"OpenInventoryEllipses",onPointerDown:function(){l.f$.publish("ToggleInventory")},children:(0,Rt.jsx)(kt.z2,{touchScreen:t,icon:"ellipsis",keyboardButton:"Tab",keyboardButtonClassname:"OpenInventoryEllipsesPrompt",onPointerDown:function(e){l.f$.publish("ToggleInventory"),e.stopPropagation()},showRedDotPubSubId:"RedDotOpenInventoryIcon",showTouchTutorialPubSubId:"TouchTutorialOpenInventoryIcon",touchIconPosition:"topleft"})})}var Nr=It.memo((function(e){var t=e.creativeScrollDiv,r=e.playerInven,n=e.getSetHoveringForIdx,i=e.getPointerDownForIdx,o=e.getPointerUpForIdx,s=e.creativeSearchVal,a=e.setCreativeSearchVal,l=(0,Pr.O)(s);return(0,Rt.jsxs)("div",{className:"CreativeItemSlotsWrapper",children:[(0,Rt.jsx)("div",{className:"CreativeItemSlotsSearchWrapper",children:(0,Rt.jsx)(Wt.o,{className:"CreativeItemSlotsSearch",placeholderText:"Search",defaultValue:s,maxLength:1e4,onValueChange:function(e,t){a(e)},blurOnEnter:!0})}),(0,Rt.jsx)("div",{className:"CreativeItemSlots",ref:t,children:(0,Rt.jsx)("div",{className:"CreativeItemSlotsInner",children:l.map((function(e){var t=r.numSlots+e;return(0,Rt.jsx)(Dr,{idx:t,draggedInfo:null,setHovered:n(t),pointerDown:i(t),pointerUp:o(t)},t)}))})})]})}));function Ur(e){return!!e.shiftKey}function Wr(e){return!(!e.touches&&"touch"!==e.pointerType&&"pen"!==e.pointerType)}var Gr,zr,jr,Vr,Hr=r(32692),qr=r(43971),Zr=r(90690),Kr=r(37105),Yr=r(4268),Xr=r(23056),Qr={head:"Head",body:"Body",legs:"Legs"},Jr={Head:"head",Body:"body",Legs:"legs"},$r=document.createElement("canvas");$r.classList.add("CharCustomisationPreviewCanvas");var en=It.memo((function(){var e=(0,It.useState)(!1),t=(0,ue.Z)(e,2),r=t[0],n=t[1],i=function(){n(!r)};(0,kt.lF)("ToggleCharCustomisation",(function(){i()}));var o=(0,It.useRef)({head:"Bob",body:"Bob",legs:"Bob"}),s=(0,kt.GG)(),a=(0,It.useRef)(!1);(0,kt.lF)("charCustomisationUpdated",(function(e){var t,n=!1,i=(0,b.Z)(e);try{for(i.s();!(t=i.n()).done;){var u=t.value,c=u.eId,h=u.part,d=u.selected;if(c!==(0,l.Zx)().serverPlayerEntity)return;n=!0,r&&a.current||(o.current=(0,S.Z)((0,S.Z)({},o.current),{},(0,$e.Z)({},h,d)),jr&&jr.updateInstanceCustomisation(Vr,h,d)),s()}}catch(f){i.e(f)}finally{i.f()}n&&(a.current=!0)}));var u=(0,It.useState)(Object.values(Jr)[0]),c=(0,ue.Z)(u,2),h=c[0],d=c[1],f=(0,It.useRef)(null);return(0,It.useEffect)((function(){if(r){if(f.current.appendChild($r),!Gr)Gr=new Zr.D($r,!0,{preserveDrawingBuffer:!0}),(zr=new Kr.x(Gr)).clearColor=new M.HE(61/255,75/255,121/255,1),zr.ambientColor=new M.Wo(1,1,1),new Yr.Y("Camera",3*Math.PI/2,Math.PI/2,22,E.P.Zero(),zr).attachControl($r,!0),(0,We.sM)(zr).then((function(e){var t=e.container,r=e.customisationMgr;jr=r;var n=(0,We.ur)(t,r);for(var i in Vr=n,n.setEnabled(!0),n.position=new E.P(0,-8.2,0),n.rotation=new E.P(0,.2,0),n.rotationQuaternion=null,qr.uH)r.updateInstanceCustomisation(n,i,o.current[i]);var s=new Xr.e("light",new E.P(-.1,1,-.3),zr);s.diffuse=new M.Wo(1,1,1),s.specular=new M.Wo(1,1,1),s.groundColor=new M.Wo(.5,.5,.5)}));return Gr.runRenderLoop((function(){zr.render()})),function(){Gr.stopRenderLoop()}}}),[r]),(0,Rt.jsx)(kt.rW,{close:function(){i()},zIndex:2,togglePointerLock:!0,show:r,globallyUniqueKey:"CharCustomisationUI",forcePointerLock:!r,doGameplayStartStopOnShow:!0,children:(0,Rt.jsxs)("div",{className:"CharCustomisation SmallTextLight",children:[(0,Rt.jsx)(kt.w3,{items:Object.keys(Jr),onClick:function(e){d(Jr[e])},selectedItemStr:Qr[h]}),(0,Rt.jsxs)("div",{className:"CharCustomisPartSelectorWrapper",children:[(0,Rt.jsx)("div",{className:"CharCustomisPartSelector",children:Object.keys(qr.uH[h]).map((function(e){var t=e===o.current[h];return(0,Rt.jsx)("div",{className:jt()("CharCustomPartWrapper",{SelectedCharCustomPartWrapper:t}),children:(0,Rt.jsx)("div",{className:"CharCustomPart",style:{backgroundImage:"url(".concat(qr.uH[h][e].previewTex,")")},onClick:function(){if(e!==o.current[h]){o.current=(0,S.Z)((0,S.Z)({},o.current),{},(0,$e.Z)({},h,e)),s();var t={partType:h,selected:e};(0,l.Xi)(we.Vz.updateMyCosmetic,t),jr&&jr.updateInstanceCustomisation(Vr,h,e)}}})},e)}))}),(0,Rt.jsx)("div",{className:"CharCustomisSelectedText",children:"Selected: ".concat(o.current[h])})]}),(0,Rt.jsx)("div",{className:"CharCustomisationPreview",ref:f})]})})})),tn=It.memo((function(){var e=(0,kt.GG)(),t=function(t,n){r(t),(0,l.Xi)(we.Vz.UiRequestResp,{id:t,response:n}),e()},r=function(t){var r=n.current.findIndex((function(e){return e.id===t}));-1!==r&&(n.current.splice(r,1),e())};(0,kt.lF)("newUiRequest",(function(t){n.current.push(t),e()})),(0,kt.lF)("removeUiRequest",(function(e){r(e)})),(0,kt.lF)("YKeyPressed",(function(){n.current.length>0&&t(n.current[0].id,!0)})),(0,kt.lF)("XKeyPressed",(function(){n.current.length>0&&t(n.current[0].id,!1)}));var n=(0,It.useRef)([]);return(0,Rt.jsx)("div",{className:"UiRequests",children:n.current.map((function(e){var r=e.id,i=e.text,o=r!==n.current[0].id;return(0,Rt.jsxs)("div",{className:"UiRequest",children:[(0,Rt.jsx)("div",{className:"UiReqText",children:(0,Rt.jsx)(kt.fD,{text:i})}),(0,Rt.jsx)(Ut.gG,{className:"UiReqAcceptButt UiReqButton",onClick:function(){t(r,!0)},disabled:o,children:"Y"}),(0,Rt.jsx)(Ut.QT,{className:"UiReqDismissButt UiReqButton",onClick:function(){t(r,!1)},disabled:o,children:"X"})]},r)}))})})),rn=It.memo((function(){var e=(0,It.useRef)([]),t=(0,kt.GG)();(0,kt.lF)("uiRequestPopup",(function(r){var n=r.text,i=r.callback;e.current.push({text:n,callback:i}),t()}));var r=function(r){(0,e.current.shift().callback)(r),t()},n=e.current.length>0;return n?(0,Rt.jsx)(kt.rW,{close:function(){r(!1)},escDoesExit:!0,show:n,forcePointerLock:!n,globallyUniqueKey:"UiRequestPopup",children:(0,Rt.jsxs)("div",{className:"UiRequestPopupWrapper",children:[(0,Rt.jsx)(kt.fD,{text:e.current[0].text}),(0,Rt.jsxs)("div",{className:"UiRequestPopupButtons",children:[(0,Rt.jsx)(Ut.El,{className:"UiRequestPopupButton",onClick:function(){return r(!0)},children:"Yes"}),(0,Rt.jsx)(Ut.QT,{className:"UiRequestPopupButton",onClick:function(){return r(!1)},children:"No"})]})]})}):null})),nn=It.memo((function(){var e=(0,It.useRef)({}),t=(0,It.useReducer)((function(e){return e+1}),0),r=(0,ue.Z)(t,2),n=(r[0],r[1]);return(0,kt.lF)("EffectUpdate",(function(t){var r=t.name,i=t.icon,o=t.duration;0===o?delete e.current[r]:e.current[r]={icon:i,duration:o,startTime:Date.now()},n()})),(0,It.useEffect)((function(){var t=setInterval((function(){if(0!==Object.keys(e.current).length){for(var t in e.current)Date.now()-e.current[t].startTime>=e.current[t].duration&&delete e.current[t];n()}}),1e3);return function(){clearInterval(t)}}),[]),(0,Rt.jsx)("div",{className:"EffectInfosWrapper",children:Object.entries(e.current).map((function(t){var r=(0,ue.Z)(t,2),n=r[0],i=r[1],o=i.icon,s=i.duration;return(0,Rt.jsxs)("div",{className:"EffectInfo",children:[(0,Rt.jsx)("div",{className:"EffectInfoIcon",children:(0,Rt.jsx)(Dt.a,{itemName:o,amount:0})}),(0,Rt.jsxs)("div",{className:"EffectInfoRightSide",children:[(0,Rt.jsx)("div",{className:"EffectInfoName SmallTextBold",children:n}),(0,Rt.jsx)("div",{className:"EffectInfoDuration SmallTextLight",children:(0,l.l8)(s-(Date.now()-e.current[n].startTime))})]})]},n)}))})})),on=[{numLines:7,charsPerLine:16,uiFontSize:3.3,ingameFontSize:25},{numLines:5,charsPerLine:11,uiFontSize:4.6,ingameFontSize:36},{numLines:3,charsPerLine:7,uiFontSize:7.5,ingameFontSize:58}];function sn(e,t){for(var r=on[t],n=r.numLines,i=r.charsPerLine,o=e.split("\n"),s=0;s<o.length;s++){var a=o[s];a.length>i&&(o[s]=a.substring(0,i),o.length<n&&o.splice(s+1,0,a.substring(i)))}return o.length>n&&o.splice(n,o.length-n),o.join("\n")}var an=It.memo((function(){var e=(0,It.useState)(null),t=(0,ue.Z)(e,2),r=t[0],n=t[1],i=(0,It.useState)(""),o=(0,ue.Z)(i,2),s=o[0],a=o[1],u=(0,It.useState)(0),c=(0,ue.Z)(u,2),h=c[0],d=c[1],f=function(e){a(sn(s,e)),d(e),l.Cc.setItem("lastBoardTextSize",e)};(0,kt.lF)("EditBoard",(function(e){var t=e.pos;if(n(t),null!==t){var r,i,o,s=(0,l.rL)().blockDataOwner.getBlockData(t[0],t[1],t[2]);a(null!==(r=null===s||void 0===s?void 0:s.persisted.shared.text)&&void 0!==r?r:"");var u=null!==(i=null!==(o=null===s||void 0===s?void 0:s.persisted.shared.textSize)&&void 0!==o?o:l.Cc.getItem("lastBoardTextSize"))&&void 0!==i?i:0;d(u),l.Cc.setItem("lastBoardTextSize",u)}})),(0,It.useEffect)((function(){return(0,Qt.IA)(null===r),function(){(0,Qt.IA)(!0)}})),(0,It.useEffect)((function(){setTimeout((function(){p.current&&p.current.focus()}),1)}),[r]),(0,It.useEffect)((function(){var e=(0,l.Zx)().ents.getMoveState((0,l.Zx)().playerEntity);null!==r?e.speedMultiplier.setMultiplierType("signOpened",0):e.speedMultiplier.setMultiplierType("signOpened",1)}),[r]);var p=(0,It.useRef)(null),m=on[h].uiFontSize,g=1.3*m;return(0,Rt.jsxs)(kt.rW,{className:"WriteOnBoardBg",close:function(){n(null),(0,l.Xi)(we.Vz.updateBoard,{pos:r,newText:s,textSize:h})},escDoesExit:!0,show:null!==r,forcePointerLock:null===r,globallyUniqueKey:"WriteOnSignComp",children:[(0,Rt.jsxs)("div",{className:"WriteOnBoardWrapper",children:[(0,Rt.jsx)("img",{src:"".concat((0,l.jH)("board_full")),alt:"Board",className:"WriteOnBoardImg"}),(0,Rt.jsx)("textarea",{className:"WriteOnBoardTextArea",value:s,ref:p,style:{fontSize:"".concat(m,"rem"),lineHeight:"".concat(g,"rem")},onKeyDown:function(e){e.stopPropagation()},spellCheck:"false",autoComplete:"off",onChange:function(e){a(sn(e.target.value,h))}})]}),(0,Rt.jsx)("div",{className:"WriteOnBoardTextSizeHeader SmallTextBold",children:"Text Size"}),(0,Rt.jsxs)("div",{className:"WriteOnBoardTextSizeButtons",children:[(0,Rt.jsx)(Ut.El,{className:"WriteOnBoardTextSizeButton",onClick:function(){f(0)},disabled:0===h,children:"Small"}),(0,Rt.jsx)(Ut.El,{className:"WriteOnBoardTextSizeButton",onClick:function(){f(1)},disabled:1===h,children:"Medium"}),(0,Rt.jsx)(Ut.El,{className:"WriteOnBoardTextSizeButton",onClick:function(){f(2)},disabled:2===h,children:"Large"})]})]})})),ln=r(82700),un=function(e){(0,Tt.Z)(r,e);var t=(0,Pt.Z)(r);function r(e){var n,i;return(0,f.Z)(this,r),(i=t.call(this,e)).serverOptionSub=void 0,i.leftRoomSub=void 0,i.state={serverSettings:(null===(n=(0,l.Zx)())||void 0===n?void 0:n.serverSettings)||{},showLeftRoomInfo:!1},i}return(0,p.Z)(r,[{key:"componentDidMount",value:function(){var e=this;this.serverOptionSub=l.f$.subscribe("newAllServerOptions",(function(t){e.setState({serverSettings:t})})),(0,l.Qo)("CookieConsent",!0),this.leftRoomSub=l.f$.subscribe("colyRoomLeft",(function(){e.setState({showLeftRoomInfo:!0})})),setTimeout((function(){(0,l.gx)()}),0)}},{key:"componentWillUnmount",value:function(){l.f$.unsubscribe(this.serverOptionSub),l.f$.unsubscribe(this.leftRoomSub)}},{key:"render",value:function(){var e=this;return(0,Rt.jsxs)(Rt.Fragment,{children:[(0,Rt.jsx)(pn,{touchScreen:this.props.touchScreen,useProfanityFilter:this.props.escMenuOptions.useProfanityFilter,showChat:this.props.escMenuOptions.showChat,showCoordinates:this.props.escMenuOptions.showCoordinates,showChunkCoordinates:this.props.escMenuOptions.showChunkCoordinates}),(0,Rt.jsx)(yr.X,{}),this.props.touchScreen?(0,Rt.jsx)(Jt.a,{escMenuOptions:this.props.escMenuOptions}):null,(0,Rt.jsx)(wt,{}),(0,Rt.jsx)(mn,{}),(0,Rt.jsx)(Vt,{categories:this.state.serverSettings.shopInfo}),(0,Rt.jsx)(gn,{ShopClick:function(){l.f$.publish("toggleShop")},touchScreen:this.props.touchScreen}),(0,Rt.jsx)(kt.sC,{touchScreen:this.props.touchScreen}),(0,Rt.jsx)(kt.xM,{}),(0,Rt.jsx)(ur.Tx,{touchScreen:this.props.touchScreen,optionChangeCBs:this.props.optionChangeCBs,escMenuOptions:this.props.escMenuOptions,showingOptions:this.props.settingsAreOpen}),(0,Rt.jsx)(or,{}),(0,Rt.jsx)(cn,{}),(0,Rt.jsx)(hr,{}),(0,Rt.jsx)(vr,{}),this.state.serverSettings.showKillfeed&&(0,Rt.jsx)(Sr,{}),(0,Rt.jsx)(en,{}),(0,Rt.jsx)(Ar.t,{}),(0,Rt.jsx)(xr,{}),(0,Rt.jsx)(rn,{}),(0,Rt.jsx)(tn,{}),(0,Rt.jsx)(an,{}),(0,Rt.jsx)(ln.o,{}),this.state.serverSettings.useInventory&&this.state.serverSettings.useFullInventory&&(0,Rt.jsx)(Er,{touchScreen:this.props.touchScreen}),(0,Rt.jsx)(nn,{}),this.state.showLeftRoomInfo?(0,Rt.jsx)(kt.rL,{hide:function(){e.setState({showLeftRoomInfo:!1})},className:"LeftRoomInfo",children:"You have disconnected from the server. This either means you have lost internet access or the server is updating and will be back online in a few minutes. If the server is updating, you can continue exploring the world here, but some things may not work as expected. To reconnect to the server refresh your page or leave and rejoin the game."}):null,(0,Rt.jsx)(vn,{})]})}}]),r}(It.Component),cn=It.memo((function(){(0,Et.iP)();var e=(0,kt.$i)("middleTextUpper"),t=(0,kt.$i)("middleTextLower"),r=(0,kt.$i)("useInventory");return(0,Rt.jsxs)("div",{className:"BottomMiddleElements",children:[e&&""!==e?(0,Rt.jsx)("div",{className:"MiddleText MiddleTextUpper SmallTextBold",children:(0,Rt.jsx)(kt.fD,{text:e})}):null,t&&""!==t?(0,Rt.jsx)("div",{className:"MiddleText",children:(0,Rt.jsx)(kt.fD,{text:t})}):null,(0,Rt.jsx)(kt.g4,{}),(0,Rt.jsx)(pr,{}),r?(0,Rt.jsx)(Ot,{}):null]})}));function hn(){var e=(0,It.useRef)(null);return(0,It.useEffect)((function(){var t,r,n=0,i=0,o=performance.now(),s=0,a=function(){n++,i++;var t=performance.now();if(!(t-o<1e3)){var r=Math.round(n/(t-o)*1e3);if(e.current.textContent=r,n=0,o=t,r<55){var a,u;s+=1;var c=(0,l.Zx)(),h=l.Cc.getItem("decreaseLoadDistPromptDeniedCount"),d=c.serverSettings.minChunkAddDist;s>=15&&((0,l.Zx)().world._chunkAddDistance[0]>d||(0,l.Zx)().world._chunkAddDistance[1]>he.ZP.minVertChunkLoadDist)&&(null!==(a=l.Cc.getItem("lastDecreaseLoadDistPromptTime"))&&void 0!==a?a:0)+432e5<Date.now()&&(null!==(u=l.Cc.getItem("decreaseLoadDistPromptDeniedCount"))&&void 0!==u?u:0)<3&&(l.Cc.setItem("lastDecreaseLoadDistPromptTime",Date.now()),l.f$.publish("uiRequestPopup",{text:"Lag (low FPS) caused by high chunk load distance. Decrease it?",callback:function(e){e?(c.world.setAddRemoveDistance([d,he.ZP.minVertChunkLoadDist],[d+1,he.ZP.minVertChunkLoadDist+1]),l.Cc.setItem("chunkHorizAddDist",d),l.Cc.setItem("chunkVertAddDist",he.ZP.minVertChunkLoadDist),l.f$.publish("updatedChunkLoadDist"),l.Cc.setItem("decreaseLoadDistPromptDeniedCount",0)):l.Cc.setItem("decreaseLoadDistPromptDeniedCount",h+1)}}))}else s=0}};return(0,l.Zx)().on("afterRender",a),(0,l.Zx)().GA&&(t=setTimeout((function(){var e=performance.now();i=0,r=setTimeout((function(){var t=performance.now()-e,r=1e3*i/t;(0,l.Zx)().GA.addDesignEvent("bloxdFps",r)}),15e3)}),15e3)),function(){(0,l.Zx)().off("afterRender",a),clearTimeout(t),clearTimeout(r)}}),[]),(0,Rt.jsxs)("div",{className:"FpsWrapperDiv",children:[(0,Rt.jsx)("div",{children:"FPS"}),(0,Rt.jsx)("div",{className:"FpsNumberDiv",ref:e})]})}function dn(){var e=(0,It.useRef)(null),t=(0,It.useRef)(null),r=(0,It.useRef)(null),n=(0,It.useRef)(0);return(0,It.useEffect)((function(){var i=function(){if(e.current&&2===++n.current){var i=(0,l.Zx)().ents.getPosition((0,l.Zx)().playerEntity);e.current.textContent=i[0].toFixed(2),t.current.textContent=i[1].toFixed(2),r.current.textContent=i[2].toFixed(2),n.current=0}};return(0,l.Zx)().on("tick",i),function(){(0,l.Zx)().off("tick",i)}})),(0,Rt.jsxs)("div",{className:"CoordinateUI",children:[(0,Rt.jsx)("div",{className:"SingleCoordinateUI",ref:e}),(0,Rt.jsx)("div",{className:"SingleCoordinateUI",ref:t}),(0,Rt.jsx)("div",{className:"SingleCoordinateUI",ref:r})]})}function fn(){var e=(0,It.useRef)(null),t=(0,It.useRef)(null),r=(0,It.useRef)(null),n=(0,It.useRef)(null),i=(0,It.useRef)(0);return(0,It.useEffect)((function(){var o=(0,l.Zx)(),s=function(){if(e.current&&2===++i.current){var s=o.ents.getPosition(o.playerEntity),a=Pe(s[0],s[1],s[2]);e.current.textContent="".concat(a[0]," ").concat(a[1]," ").concat(a[2]);var l=he.ZP.chunkSize,u=s[0]%l;u<0&&(u+=32);var c=s[1]%l;c<0&&(c+=32);var h=s[2]%l;h<0&&(h+=32),t.current.textContent=u.toFixed(2),r.current.textContent=c.toFixed(2),n.current.textContent=h.toFixed(2),i.current=0}};return o.on("tick",s),function(){o.off("tick",s)}})),(0,Rt.jsxs)("div",{className:"CoordinateUI ChunkCoordUI",children:[(0,Rt.jsx)("div",{className:"SingleCoordinateUI",ref:e}),(0,Rt.jsx)("div",{className:"SingleCoordinateUI",ref:t}),(0,Rt.jsx)("div",{className:"SingleCoordinateUI",ref:r}),(0,Rt.jsx)("div",{className:"SingleCoordinateUI",ref:n})]})}var pn=It.memo((function(e){var t=e.touchScreen,r=e.useProfanityFilter,n=e.showChat,i=e.showCoordinates,o=e.showChunkCoordinates;(0,Et.iP)();var s=a.ob[l.EU.modeAttemptedPlay],u="".concat(null!==s&&void 0!==s&&s.combinedTitle?"".concat(null===s||void 0===s?void 0:s.combinedTitle," "):"").concat(s.title).concat(s.subText?" ".concat(s.subText):"");return(0,Rt.jsxs)("div",{className:"TopLeftElements",children:[n&&(0,Rt.jsx)(Qt.en,{touchScreen:t,useProfanityFilter:r}),(0,Rt.jsxs)("div",{className:"RightOfChatWrapper",children:[(0,Rt.jsxs)("div",{className:"LobbyNameWrapper",children:[(0,Rt.jsx)("div",{children:"Lobby"}),(0,Rt.jsx)("div",{className:"LobbyNameGamemode",children:u}),(0,Rt.jsx)("div",{children:null!==l.EU.connectedLobbyName?l.EU.connectedLobbyName:"null"})]}),(0,Rt.jsx)(hn,{})]}),(0,Rt.jsxs)("div",{className:"CoordinatesWrapper",children:[i&&(0,Rt.jsx)(dn,{}),o&&(0,Rt.jsx)(fn,{})]})]})})),mn=It.memo((function(){(0,Et.iP)();var e=(0,kt.$i)("RightInfoText");return null!==e&&""!==e?(0,Rt.jsx)("div",{className:"RightInfoDiv",children:(0,Rt.jsx)(kt.fD,{text:e})}):null})),gn=It.memo((function(e){var t=e.ShopClick,r=e.touchScreen;(0,Et.iP)();var n=!!(0,kt.$i)("shopInfo"),i={Shop:{icon:(0,l.Zx)().serverSettings.useCommandsShopIcon?"terminal":"cart-shopping",key:"B",clickCb:t,showTouchTutorialPubSubId:"showShopTouchTutorial",showRedDotPubSubId:"showShopIconRedDot"},Menu:{icon:"bars",key:"M",clickCb:function(){l.f$.publish("ToggleMenu")}},CharCustomisation:{icon:"shirt",key:"N",clickCb:function(){l.f$.publish("ToggleCharCustomisation")}}},o=[],s=(0,kt.$i)("_tasks"),a=(0,kt.$i)("_availableLeaderboards");return(s||a)&&o.push("Menu"),n&&o.push("Shop"),o.push("CharCustomisation"),(0,Rt.jsx)("div",{className:"BottomLeftIcons",children:o.map((function(e){var t=i[e],n=t.icon,o=t.key,s=t.clickCb,a=t.showTouchTutorialPubSubId,l=t.showRedDotPubSubId;return(0,Rt.jsx)("div",{className:"BottomLeftIcon",children:(0,Rt.jsx)(kt.z2,{touchScreen:r,icon:n,keyboardButton:o,onClick:function(){s()},showTouchTutorialPubSubId:a,showRedDotPubSubId:l})},e)}))})})),vn=It.memo((function(){var e=(0,It.useState)(!1),t=(0,ue.Z)(e,2),r=t[0],n=t[1],i=function(){n(!1)};(0,kt.lF)("ctrlCrouchWithoutFullscreen",(function(){n(!0)})),(0,kt.lF)("displaymodeFullscreenChange",(function(e){e&&i()}));var o="crazygames"===d.j5;return(0,Rt.jsx)(kt.rW,{close:i,escDoesExit:!0,show:r,forcePointerLock:!r,globallyUniqueKey:"CantCtrlCrouchIfNotFullscreenComp",children:(0,Rt.jsxs)("div",{className:"CantCtrlCrouchIfNotFullscreenComp SmallTextBold",children:[(0,Rt.jsx)("div",{className:"CantCtrlCrouchHeader",children:"Go fullscreen to crouch with ctrl"}),o&&(0,Rt.jsx)("div",{className:"CantCtrlCrouchInstructions SmallTextLight",children:"Press the crazygames full screen button"}),(0,Rt.jsx)("div",{className:"CantCtrlCrouchSubtext SmallTextLight",children:"(Otherwise I can't stop CTRL+W closing the window!)"}),(0,Rt.jsxs)("div",{className:"CantCtrlCrouchButtonsContainer",children:[!o&&(0,Rt.jsx)(Ut.gG,{className:"CantCtrlCrouchButtonWrapper",onClick:function(){(0,Hr.V9)(),i()},children:(0,Rt.jsx)("div",{className:"CantCtrlCrouchButton",children:"Go Fullscreen"})}),(0,Rt.jsx)(Ut.QT,{className:"CantCtrlCrouchButtonWrapper",onClick:function(){i()},children:(0,Rt.jsx)("div",{className:"CantCtrlCrouchButton",children:"Nevermind"})})]})]})})})),yn=r(24412),_n=r(90673),bn=r(77129),Sn={debug:!1,align:"center",vAlign:"middle",fontSize:14,fontWeight:"",fontStyle:"",fontVariant:"",font:"Arial",lineHeight:null,justify:!1,drawText:function(e,t,r,n,i,o){var s=this;if(i<=0||o<=0||this.fontSize<=0)return{height:0};var a=r+i,u=n+o,c=this.fontStyle,h=this.fontVariant,d=this.fontWeight,f=this.fontSize,p=this.font,m="".concat(c," ").concat(h," ").concat(d," ").concat(f,"px ").concat(p);e.font=m;var g,v=n+o/2+this.fontSize/2;"right"===this.align?(g=a,e.textAlign="right"):"left"===this.align?(g=r,e.textAlign="left"):(g=r+i/2,e.textAlign="center");var y,_=(0,b.Z)(t);try{for(_.s();!(y=_.n()).done;){var S=y.value;e.measureText(S).width>=i&&(t=t.replace(S,""))}}catch(k){_.e(k)}finally{_.f()}t=(0,l.Xl)(t);var A=[],x=t.split("\n"),C=this.justify?e.measureText("\u200a").width:0;x.forEach((function(t){var r=e.measureText(t).width;if(r<=i)A.push(t);else{var n,o,a,l=t,u=i;for(r=e.measureText(l).width;r>u;){for(n=0,o=0,a="";o<u;)n++,a=l.substr(0,n),o=e.measureText(a).width;n--,a=a.substr(0,n);var c=n;if(" "!=l.substr(n,1)){for(;" "!=l.substr(n,1)&&0!=n;)n--;0==n&&(n=c),a=l.substr(0,n)}a=s.justify?s.justifyLine(e,a,C,"\u200a",i):a,l=l.substr(n),r=e.measureText(l).width,A.push(a)}r>0&&A.push(l)}}));var M=this.lineHeight?this.lineHeight:this.getTextHeight(e,t,m),T=M*(A.length-1),P=T/2,I=n;return"top"===this.vAlign?v=n+this.fontSize:"bottom"===this.vAlign?(v=u-T,I=u):(I=n+o/2,v-=P),A.forEach((function(t){t=t.trim(),e.fillText(t,g,v),v+=M})),this.debug&&(e.lineWidth=3,e.strokeStyle="#00909e",e.strokeRect(r,n,i,o),e.lineWidth=2,e.strokeStyle="#f6d743",e.beginPath(),e.moveTo(g,n),e.lineTo(g,u),e.stroke(),e.strokeStyle="#ff6363",e.beginPath(),e.moveTo(r,I),e.lineTo(a,I),e.stroke()),{height:T+M}},getTextHeight:function(e,t,r){var n=e.textBaseline,i=e.font;e.textBaseline="bottom",e.font=r;var o=e.measureText(t).actualBoundingBoxAscent;return e.textBaseline=n,e.font=i,o},justifyLine:function(e,t,r,n,i){var o=t.trim(),s=e.measureText(o).width,a=o.split(/\s+/).length-1,l=Math.floor((i-s)/r);if(a<=0||l<=0)return o;for(var u=Math.floor(l/a),c=l-a*u,h=[],d=0;d<u;d++)h.push(n);return h=h.join(""),o.replace(/\s+/g,(function(e){var t=c>0?h+n:h;return c--,e+t}))}},An=r(52644),xn=function(){function e(t){var r=this;(0,f.Z)(this,e),this.bloxd=void 0,this.noa=void 0,this.cachedEntityMeshTypes={},this.bloxd=t,this.noa=t.noa,this.noa.ents.createComponent({name:"isBoard"}),(0,l.ZC)((function(){var e,t=(0,b.Z)(r.bloxd.ents.getStatesList("isBoard"));try{for(t.s();!(e=t.n()).done;){var n=e.value;r.bloxd.ents.deleteEntity(n.__id)}}catch(i){t.e(i)}finally{t.f()}}))}return(0,p.Z)(e,[{key:"addBoard",value:function(e,t,r,n){var i,o,s=this;this.removeBoard(e,t,r);var a=this.bloxd.blockDataOwner.getBlockData(e,t,r),l=null!==(i=null===a||void 0===a?void 0:a.persisted.shared.text)&&void 0!==i?i:"",u=null!==(o=null===a||void 0===a?void 0:a.persisted.shared.textSize)&&void 0!==o?o:0,c=this.bloxd.noa.rendering.getScene(),h=this.noa.ents.add([e,t,r],1,1),d=null;this.noa.ents.addComponent(h,"hidingMeshManager",{addMeshComponent:function(){var e=function(){var e,t=new bn.Y("BoardTextTransform",c);if(""===l.trim())e=new x.Kj("EmptyBoardMesh",c);else{var r=7/8;e=L.V.CreatePlane("BoardPlane",{width:1,height:r},c);var i=256,o=new _n.c("BoardDynamicTexture",{width:i,height:224},c),s=o.getContext();Sn.fontSize=on[u].ingameFontSize,Sn.fontWeight="bolder",Sn.font="'Jetbrains Mono'",Sn.drawText(s,l,0,0,i,224),o.update();var a=new C.K("mat",c);a.diffuseTexture=o,a.diffuseTexture.hasAlpha=!0,a.specularColor=new M.Wo(0,0,0),a.freeze(),e.material=a,e.freezeWorldMatrix(),oe(t,0,0,0,n,.375),t.rotation.y+=Math.PI,e.rotation=t.rotation}return{mesh:e,transform:t}}(),t=e.mesh,r=e.transform;d=t,s.noa.entities.addComponent(h,"mesh",{mesh:t,offset:[.5+r.position.x,.5+r.position.y,.5+r.position.z]})},removeMeshComponent:function(){var e;null===(e=d)||void 0===e||e.dispose(!1,!0),s.noa.entities.removeComponent(h,"mesh")},addShadow:!1,hideDist:25}),this.noa.ents.addComponent(h,"isBoard")}},{key:"removeBoard",value:function(e,t,r){var n,i=[e,t,r],o=(0,b.Z)(this.bloxd.ents.getStatesList("isBoard"));try{for(o.s();!(n=o.n()).done;){var s=n.value;if(Qe().squaredDistance(this.bloxd.ents.getPosition(s.__id),i)<.01)return void this.bloxd.ents.deleteEntity(s.__id)}}catch(a){o.e(a)}finally{o.f()}}},{key:"removeBoardsInChunk",value:function(e,t,r){var n,i=(0,b.Z)(this.bloxd.ents.getStatesList("isBoard"));try{for(i.s();!(n=i.n()).done;){var o=n.value,s=Me(this.bloxd.ents.getPosition(o.__id)),a=(0,ue.Z)(s,3),l=a[0],u=a[1],c=a[2];l===e&&u===t&&c===r&&this.bloxd.ents.deleteEntity(o.__id)}}catch(h){i.e(h)}finally{i.f()}}},{key:"getThrowableMesh",value:function(e){var t;return"Fireball"===e?t=l.EU.itemsClient["Fireball Block"].getMesh(.95):"Iceball"===e?t=l.EU.itemsClient["Iceball Block"].getMesh(.95):(t=l.EU.itemsClient[e].getMesh(.13)).billboardMode=An.x.BILLBOARDMODE_Y,t}},{key:"getEntityMesh",value:function(e,t,r){var n=this.noa.rendering.getScene();if("BloxdBlock"===e)return{mesh:l.EU.itemsClient[t.blockName].getMesh(t.size,r),meshOffset:Qe().fromValues(0,t.size/2,0),nameYOffset:t.size+.3};if("Box"===e){var i="".concat(e,"|").concat(JSON.stringify(t));if(!this.cachedEntityMeshTypes[i]){var o=k.BoxBuilder.CreateBox("".concat(i,"EntityMesh"),{width:t.width,height:t.height,depth:t.depth},this.noa.rendering.getScene()),s=new C.K("".concat(i,"EntityMesh"),n);console.log("Creating with opts",t,t.diffuseColor[0]/255,t.diffuseColor[1]/255,t.diffuseColor[2]/255),s.diffuseColor=new M.Wo(t.diffuseColor[0]/255,t.diffuseColor[1]/255,t.diffuseColor[2]/255),s.specularColor=new M.Wo(0,0,0),s.emissiveColor=new M.Wo(t.emissiveColor[0]/255,t.emissiveColor[1]/255,t.emissiveColor[2]/255),s.freeze(),o.material=s,o.alwaysSelectAsActiveMesh=!0,o.doNotSyncBoundingInfo=!0,o.setEnabled(!1),n.removeMesh(o),this.cachedEntityMeshTypes[i]=o}var a=this.cachedEntityMeshTypes[i].createInstance("".concat(i,"EntityMeshInstance"));return this.noa.rendering.addMeshToScene(a),a.position.x=0,a.position.y=0,a.position.z=0,r(a),{mesh:a,meshOffset:Qe().fromValues(0,t.height/2,0),nameYOffset:t.height+.3}}console.error("Not implemented custom meshes for type",e)}},{key:"customItemUpdate",value:function(e,t){(0,R.JJ)(e,t.id,this.bloxd.noa.rendering.getScene(),t.type)}}]),e}();function Cn(){return ge()('/*! For license information please see meshing.worker.js.LICENSE.txt */\n!function(){var e={379:function(e){"use strict";e.exports=function(e){for(var t=new Array(e),r=0;r<e;++r)t[r]=r;return t}},110:function(e){function t(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},786:function(e,t,r){var i=r(379),n=r(110),s="undefined"!==typeof Float64Array;function o(e,t){return e[0]-t[0]}function a(){var e,t=this.stride,r=new Array(t.length);for(e=0;e<r.length;++e)r[e]=[Math.abs(t[e]),e];r.sort(o);var i=new Array(r.length);for(e=0;e<i.length;++e)i[e]=r[e][1];return i}function u(e,t){var r=["View",t,"d",e].join("");t<0&&(r="View_Nil"+e);var n="generic"===e;if(-1===t){var s="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype=\'"+e+"\';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(s)()}if(0===t){s="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype=\'"+e+"\';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(n?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(n?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",s)(h[e][0])}s=["\'use strict\'"];var o=i(t),u=o.map((function(e){return"i"+e})),c="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),l=o.map((function(e){return"b"+e})).join(","),f=o.map((function(e){return"c"+e})).join(",");s.push("function "+r+"(a,"+l+","+f+",d){this.data=a","this.shape=["+l+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype=\'"+e+"\'","proto.dimension="+t),s.push("Object.defineProperty(proto,\'size\',{get:function "+r+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?s.push("proto.order=[0]"):(s.push("Object.defineProperty(proto,\'order\',{get:"),t<4?(s.push("function "+r+"_order(){"),2===t?s.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&s.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):s.push("ORDER})")),s.push("proto.set=function "+r+"_set("+u.join(",")+",v){"),n?s.push("return this.data.set("+c+",v)}"):s.push("return this.data["+c+"]=v}"),s.push("proto.get=function "+r+"_get("+u.join(",")+"){"),n?s.push("return this.data.get("+c+")}"):s.push("return this.data["+c+"]}"),s.push("proto.index=function "+r+"_index(",u.join(),"){return "+c+"}"),s.push("proto.hi=function "+r+"_hi("+u.join(",")+"){return new "+r+"(this.data,"+o.map((function(e){return["(typeof i",e,"!==\'number\'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),p=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));s.push("proto.lo=function "+r+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+p.join(","));for(var _=0;_<t;++_)s.push("if(typeof i"+_+"===\'number\'&&i"+_+">=0){d=i"+_+"|0;b+=c"+_+"*d;a"+_+"-=d}");s.push("return new "+r+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),s.push("proto.step=function "+r+"_step("+u.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(_=0;_<t;++_)s.push("if(typeof i"+_+"===\'number\'){d=i"+_+"|0;if(d<0){c+=b"+_+"*(a"+_+"-1);a"+_+"=ceil(-a"+_+"/d)}else{a"+_+"=ceil(a"+_+"/d)}b"+_+"*=d}");s.push("return new "+r+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var g=new Array(t),m=new Array(t);for(_=0;_<t;++_)g[_]="a[i"+_+"]",m[_]="b[i"+_+"]";s.push("proto.transpose=function "+r+"_transpose("+u+"){"+u.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+g.join(",")+","+m.join(",")+",this.offset)}"),s.push("proto.pick=function "+r+"_pick("+u+"){var a=[],b=[],c=this.offset");for(_=0;_<t;++_)s.push("if(typeof i"+_+"===\'number\'&&i"+_+">=0){c=(c+this.stride["+_+"]*i"+_+")|0}else{a.push(this.shape["+_+"]);b.push(this.stride["+_+"])}");return s.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),s.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",s.join("\\n"))(h[e],a)}var h={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,r,i){if(void 0===e)return(0,h.array[0])([]);"number"===typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var o=t.length;if(void 0===r){r=new Array(o);for(var a=o-1,c=1;a>=0;--a)r[a]=c,c*=t[a]}if(void 0===i){i=0;for(a=0;a<o;++a)r[a]<0&&(i-=(t[a]-1)*r[a])}for(var l=function(e){if(n(e))return"buffer";if(s)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=h[l];f.length<=o+1;)f.push(u(l,f.length-1));return(0,f[o+1])(e,t,r,i)}}},t={};function r(i){var n=t[i];if(void 0!==n)return n.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,r),s.exports}r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function t(t,r){if(t){if("string"===typeof t)return e(t,r);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,r):void 0}}function i(e,r){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=t(e))||r&&e&&"number"===typeof e.length){i&&(e=i);var n=0,s=function(){};return{s:s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,u=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){u=!0,o=e},f:function(){try{a||null==i.return||i.return()}finally{if(u)throw o}}}}function n(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var i,n,s=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(i=r.next()).done)&&(s.push(i.value),!t||s.length!==t);o=!0);}catch(u){a=!0,n=u}finally{try{o||null==r.return||r.return()}finally{if(a)throw n}}return s}}(e,r)||t(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var s=r(786),o=r.n(s),a=function(e,t){return a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},a(e,t)};function u(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var h=function(){return h=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},h.apply(this,arguments)};function c(e,t,r,i){var n,s=arguments.length,o=s<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,r,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(s<3?n(o):s>3?n(t,r,o):n(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function l(e,t,r,i){return new(r||(r=Promise))((function(n,s){function o(e){try{u(i.next(e))}catch(t){s(t)}}function a(e){try{u(i.throw(e))}catch(t){s(t)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}u((i=i.apply(e,t||[])).next())}))}function f(e,t){var r,i,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(a){s=[6,a],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}Object.create;Object.create;var d=function(){function e(e,t,r,i){void 0===t&&(t=!1),this.initialize(e,t,r,i)}return e.prototype.initialize=function(e,t,r,i){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=r,this.currentTarget=i,this},e}(),p=function(e,t,r){void 0===r&&(r=null),this.callback=e,this.mask=t,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},_=(function(){function e(){}e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,r,i,n){void 0===i&&(i=-1),void 0===n&&(n=null);var s=new e;s._observers=new Array,s._observables=t;for(var o=0,a=t;o<a.length;o++){var u=a[o].add(r,i,!1,n);u&&s._observers.push(u)}return s}}(),function(){function e(e){this._observers=new Array,this._eventState=new d(0),e&&(this._onObserverAdded=e)}return e.FromPromise=function(t,r){var i=new e;return t.then((function(e){i.notifyObservers(e)})).catch((function(e){if(!r)throw e;r.notifyObservers(e)})),i},Object.defineProperty(e.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),e.prototype.add=function(e,t,r,i,n){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===i&&(i=null),void 0===n&&(n=!1),!e)return null;var s=new p(e,t,i);return s.unregisterOnNextCall=n,r?this._observers.unshift(s):this._observers.push(s),this._onObserverAdded&&this._onObserverAdded(s),s},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&(-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0))},e.prototype.removeCallback=function(e,t){for(var r=0;r<this._observers.length;r++){var i=this._observers[r];if(!i._willBeUnregistered&&(i.callback===e&&(!t||t===i.scope)))return this._deferUnregister(i),!0}return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)},e.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,r,i,n){if(void 0===t&&(t=-1),!this._observers.length)return!0;var s=this._eventState;s.mask=t,s.target=r,s.currentTarget=i,s.skipNextObservers=!1,s.lastReturnValue=e,s.userInfo=n;for(var o=0,a=this._observers;o<a.length;o++){var u=a[o];if(!u._willBeUnregistered&&(u.mask&t&&(u.scope?s.lastReturnValue=u.callback.apply(u.scope,[e,s]):s.lastReturnValue=u.callback(e,s),u.unregisterOnNextCall&&this._deferUnregister(u)),s.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,r,i,n){var s=this;void 0===t&&(t=-1);var o=Promise.resolve(e);if(!this._observers.length)return o;var a=this._eventState;return a.mask=t,a.target=r,a.currentTarget=i,a.skipNextObservers=!1,a.userInfo=n,this._observers.forEach((function(r){a.skipNextObservers||r._willBeUnregistered||r.mask&t&&(o=r.scope?o.then((function(t){return a.lastReturnValue=t,r.callback.apply(r.scope,[e,a])})):o.then((function(t){return a.lastReturnValue=t,r.callback(e,a)})),r.unregisterOnNextCall&&s._deferUnregister(r))})),o.then((function(){return e}))},e.prototype.notifyObserver=function(e,t,r){if(void 0===r&&(r=-1),!e._willBeUnregistered){var i=this._eventState;i.mask=r,i.skipNextObservers=!1,e.callback(t,i),e.unregisterOnNextCall&&this._deferUnregister(e)}},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,r=this._observers;t<r.length;t++){var i=r[t];if(i.mask&e||i.mask===e)return!0}return!1},e}());function g(){return"undefined"!==typeof window}function m(){return"undefined"!==typeof navigator}function y(){return"undefined"!==typeof document}function v(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t}var b={IsWindowObjectExist:g,IsNavigatorAvailable:m,IsDocumentAvailable:y,GetDOMTextContent:v},T=function(){function e(){}return e._CheckLimit=function(t,r){var i=e._LogLimitOutputs[t];return i?i.current++:(i={limit:r,current:1},e._LogLimitOutputs[t]=i),i.current<=i.limit},e._GenerateLimitMessage=function(t,r){var i=e._LogLimitOutputs[t];if(i&&e.MessageLimitReached&&i.current===i.limit)switch(r){case 0:e.Log(e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"log"));break;case 1:e.Warn(e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"warning"));break;case 2:e.Error(e.MessageLimitReached.replace(/%LIMIT%/g,""+i.limit).replace(/%TYPE%/g,"error"))}},e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e},e._LogDisabled=function(e,t){},e._LogEnabled=function(t,r){if(void 0===r||e._CheckLimit(t,r)){var i=e._FormatMessage(t);console.log("BJS - "+i);var n="<div style=\'color:white\'>"+i+"</div><br>";e._AddLogEntry(n),e._GenerateLimitMessage(t,0)}},e._WarnDisabled=function(e,t){},e._WarnEnabled=function(t,r){if(void 0===r||e._CheckLimit(t,r)){var i=e._FormatMessage(t);console.warn("BJS - "+i);var n="<div style=\'color:orange\'>"+t+"</div><br>";e._AddLogEntry(n),e._GenerateLimitMessage(t,1)}},e._ErrorDisabled=function(e,t){},e._ErrorEnabled=function(t,r){if(void 0===r||e._CheckLimit(t,r)){var i=e._FormatMessage(t);e.errorsCount++,console.error("BJS - "+i);var n="<div style=\'color:red\'>"+i+"</div><br>";e._AddLogEntry(n),e._GenerateLimitMessage(t,2)}},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!1,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){(t&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(t&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(t&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!1,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",e._LogCache="",e._LogLimitOutputs={},e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}(),M=function(e,t){return e?e.getClassName&&"Mesh"===e.getClassName()?null:e.getClassName&&"SubMesh"===e.getClassName()?e.clone(t):e.clone?e.clone():null:null};var x=function(){function e(){}return e.DeepCopy=function(e,t,r,i){for(var n=function(e){var t=[];do{Object.getOwnPropertyNames(e).forEach((function(e){-1===t.indexOf(e)&&t.push(e)}))}while(e=Object.getPrototypeOf(e));return t}(e),s=0,o=n;s<o.length;s++){var a=o[s];if(("_"!==a[0]||i&&-1!==i.indexOf(a))&&(!a.endsWith("Observable")&&(!r||-1===r.indexOf(a)))){var u=e[a],h=typeof u;if("function"!==h)try{if("object"===h)if(u instanceof Array){if(t[a]=[],u.length>0)if("object"==typeof u[0])for(var c=0;c<u.length;c++){var l=M(u[c],t);-1===t[a].indexOf(l)&&t[a].push(l)}else t[a]=u.slice(0)}else t[a]=M(u,t);else t[a]=u}catch(f){T.Warn(f.message)}}}},e}(),E=function(){function e(){}return Object.defineProperty(e,"Now",{get:function(){return b.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),e}();function A(e){return"".concat(e," needs to be imported before as it contains a side-effect required by your code.")}var P,R=function(){function e(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}return e.prototype._injectCustomRequestHeaders=function(){if(!this._shouldSkipRequestModifications(this._requestURL))for(var t in e.CustomRequestHeaders){var r=e.CustomRequestHeaders[t];r&&this._xhr.setRequestHeader(t,r)}},e.prototype._shouldSkipRequestModifications=function(t){return e.SkipRequestModificationForBabylonCDN&&(t.includes("preview.babylonjs.com")||t.includes("cdn.babylonjs.com"))},Object.defineProperty(e.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(e){this._xhr.onprogress=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(e){this._xhr.responseType=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeout",{get:function(){return this._xhr.timeout},set:function(e){this._xhr.timeout=e},enumerable:!1,configurable:!0}),e.prototype.addEventListener=function(e,t,r){this._xhr.addEventListener(e,t,r)},e.prototype.removeEventListener=function(e,t,r){this._xhr.removeEventListener(e,t,r)},e.prototype.abort=function(){this._xhr.abort()},e.prototype.send=function(t){e.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(t)},e.prototype.open=function(t,r){for(var i=0,n=e.CustomRequestModifiers;i<n.length;i++){var s=n[i];if(this._shouldSkipRequestModifications(r))return;s(this._xhr,r)}return r=(r=r.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=r,this._xhr.open(t,r,!0)},e.prototype.setRequestHeader=function(e,t){this._xhr.setRequestHeader(e,t)},e.prototype.getResponseHeader=function(e){return this._xhr.getResponseHeader(e)},e.CustomRequestHeaders={},e.CustomRequestModifiers=new Array,e.SkipRequestModificationForBabylonCDN=!0,e}(),I=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}(),S=function(){function e(){}return e.FilesToLoad={},e}(),C=function(){function e(){}return e.ExponentialBackoff=function(e,t){return void 0===e&&(e=3),void 0===t&&(t=500),function(r,i,n){return 0!==i.status||n>=e||-1!==r.indexOf("file:")?-1:Math.pow(2,n)*t}},e}(),D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t._setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},t}(Error),O=0,F=4e3,w=4001,B=4002,L=function(e){function t(r,i,n){var s=e.call(this,r)||this;return s.errorCode=i,s.innerError=n,s.name="RuntimeError",D._setPrototypeOf(s,t.prototype),s}return u(t,e),t}(D),N=function(e){for(var t,r,i,n,s,o,a,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h="",c=0,l=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);c<l.length;)n=(t=l[c++])>>2,s=(3&t)<<4|(r=c<l.length?l[c++]:Number.NaN)>>4,o=(15&r)<<2|(i=c<l.length?l[c++]:Number.NaN)>>6,a=63&i,isNaN(r)?o=a=64:isNaN(i)&&(a=64),h+=u.charAt(n)+u.charAt(s)+u.charAt(o)+u.charAt(a);return h},U=function(e){return atob(e)},k=function(e){for(var t=U(e),r=t.length,i=new Uint8Array(new ArrayBuffer(r)),n=0;n<r;n++)i[n]=t.charCodeAt(n);return i.buffer},V=function(){function e(){this.children=[]}return e.prototype.isValid=function(e){return!0},e.prototype.process=function(e,t){var r="";if(this.line){var i=this.line,n=t.processor;if(n){if(n.lineProcessor&&(i=n.lineProcessor(i,t.isFragment,t.processingContext)),n.attributeProcessor&&this.line.startsWith("attribute"))i=n.attributeProcessor(this.line,e,t.processingContext);else if(n.varyingProcessor&&this.line.startsWith("varying"))i=n.varyingProcessor(this.line,t.isFragment,e,t.processingContext);else if(n.uniformProcessor&&n.uniformRegexp&&n.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(i=n.uniformProcessor(this.line,t.isFragment,e,t.processingContext));else if(n.uniformBufferProcessor&&n.uniformBufferRegexp&&n.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(i=n.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(n.textureProcessor&&n.textureRegexp&&n.textureRegexp.test(this.line))i=n.textureProcessor(this.line,t.isFragment,e,t.processingContext);else if((n.uniformProcessor||n.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\\s+(?:(?:highp)?|(?:lowp)?)\\s*(\\S+)\\s+(\\S+)\\s*;/.test(this.line)?n.uniformProcessor&&(i=n.uniformProcessor(this.line,t.isFragment,e,t.processingContext)):n.uniformBufferProcessor&&(i=n.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,n.endOfUniformBufferProcessor&&(i=n.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}r+=i+"\\r\\n"}return this.children.forEach((function(i){r+=i.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},e}(),G=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var i=r[t];if("#"!==i[0])if(i.trim().startsWith("//"))this._lines.push(i);else for(var n=i.split(";"),s=0;s<n.length;s++){var o=n[s];(o=o.trim())&&this._lines.push(o+(s!==n.length-1?";":""))}else this._lines.push(i)}},enumerable:!1,configurable:!0}),e}(),W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.process=function(e,t){for(var r=0;r<this.children.length;r++){var i=this.children[r];if(i.isValid(e))return i.process(e,t)}return""},t}(V),z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(V),K=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e.postfixToInfix=function(t){for(var r=[],i=0,n=t;i<n.length;i++){var s=n[i];if(void 0===e._OperatorPriority[s])r.push(s);else{var o=r[r.length-1],a=r[r.length-2];r.length-=2,r.push("(".concat(a).concat(s).concat(o,")"))}}return r[r.length-1]},e.infixToPostfix=function(t){for(var r=[],i=-1,n=function(){""!==(h=h.trim())&&(r.push(h),h="")},s=function(t){i<e._Stack.length-1&&(e._Stack[++i]=t)},o=function(){return e._Stack[i]},a=function(){return-1===i?"!!INVALID EXPRESSION!!":e._Stack[i--]},u=0,h="";u<t.length;){var c=t.charAt(u),l=u<t.length-1?t.substr(u,2):"";if("("===c)h="",s(c);else if(")"===c){for(n();-1!==i&&"("!==o();)r.push(a());a()}else if(e._OperatorPriority[l]>1){for(n();-1!==i&&e._OperatorPriority[o()]>=e._OperatorPriority[l];)r.push(a());s(l),u++}else h+=c;u++}for(n();-1!==i;)"("===o()?a():r.push(a());return r},e._OperatorPriority={")":0,"(":1,"||":2,"&&":3},e._Stack=["","","","","","","","","","","","","","","","","","","",""],e}(),j=function(e){function t(t,r){void 0===r&&(r=!1);var i=e.call(this)||this;return i.define=t,i.not=r,i}return u(t,e),t.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},t}(K),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(K),X=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return u(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(K),q=function(e){function t(t,r,i){var n=e.call(this)||this;return n.define=t,n.operand=r,n.testValue=i,n}return u(t,e),t.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var r=!1,i=parseInt(t),n=parseInt(this.testValue);switch(this.operand){case">":r=i>n;break;case"<":r=i<n;break;case"<=":r=i<=n;break;case">=":r=i>=n;break;case"==":r=i===n}return r},t}(K);!function(e){e[e.GLSL=0]="GLSL",e[e.WGSL=1]="WGSL"}(P||(P={}));var Y,Z=/defined\\s*?\\((.+?)\\)/g,Q=/defined\\s*?\\[(.+?)\\]/g,J=/#include\\s?<(.+)>(\\((.*)\\))*(\\[(.*)\\])*/g,$=function(){function e(){}return e.Initialize=function(e){e.processor&&e.processor.initializeShaders&&e.processor.initializeShaders(e.processingContext)},e.Process=function(e,t,r,i){var n,s=this;(null===(n=t.processor)||void 0===n?void 0:n.preProcessShaderCode)&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var n=s._ProcessShaderConversion(e,t,i);r(n)}))},e.PreProcess=function(e,t,r,i){var n,s=this;(null===(n=t.processor)||void 0===n?void 0:n.preProcessShaderCode)&&(e=t.processor.preProcessShaderCode(e,t.isFragment)),this._ProcessIncludes(e,t,(function(e){t.processCodeAfterIncludes&&(e=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",e));var n=s._ApplyPreProcessing(e,t,i);r(n)}))},e.Finalize=function(e,t,r){return r.processor&&r.processor.finalizeShaders?r.processor.finalizeShaders(e,t,r.processingContext):{vertexCode:e,fragmentCode:t}},e._ProcessPrecision=function(e,t){var r;if(null===(r=t.processor)||void 0===r?void 0:r.noPrecision)return e;var i=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=i?"precision highp float;\\n"+e:"precision mediump float;\\n"+e:i||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){var t=/defined\\((.+)\\)/.exec(e);if(t&&t.length)return new j(t[1].trim(),"!"===e[0]);for(var r="",i=0,n=0,s=["==",">=","<=","<",">"];n<s.length&&(r=s[n],!((i=e.indexOf(r))>-1));n++);if(-1===i)return new j(e);var o=e.substring(0,i).trim(),a=e.substring(i+r.length).trim();return new q(o,r,a)},e._BuildSubExpression=function(e){e=e.replace(Z,"defined[$1]");for(var t=[],r=0,i=K.infixToPostfix(e);r<i.length;r++){var n=i[r];if("||"!==n&&"&&"!==n)t.push(n);else if(t.length>=2){var s=t[t.length-1],o=t[t.length-2];t.length-=2;var a="&&"==n?new X:new H;"string"===typeof s&&(s=s.replace(Q,"defined($1)")),"string"===typeof o&&(o=o.replace(Q,"defined($1)")),a.leftOperand="string"===typeof o?this._ExtractOperation(o):o,a.rightOperand="string"===typeof s?this._ExtractOperation(s):s,t.push(a)}}var u=t[t.length-1];return"string"===typeof u&&(u=u.replace(Q,"defined($1)")),"string"===typeof u?this._ExtractOperation(u):u},e._BuildExpression=function(e,t){var r=new z,i=e.substring(0,t),n=e.substring(t);return n=n.substring(0,(n.indexOf("//")+1||n.length+1)-1).trim(),r.testExpression="#ifdef"===i?new j(n):"#ifndef"===i?new j(n,!0):this._BuildSubExpression(n),r},e._MoveCursorWithinIf=function(e,t,r){for(var i=e.currentLine;this._MoveCursor(e,r);){var n=(i=e.currentLine).substring(0,5).toLowerCase();if("#else"===n){var s=new V;return t.children.push(s),void this._MoveCursor(e,s)}if("#elif"===n){var o=this._BuildExpression(i,5);t.children.push(o),r=o}}},e._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var r=e.currentLine,i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(r);if(i&&i.length){switch(i[0]){case"#ifdef":var n=new W;t.children.push(n);var s=this._BuildExpression(r,6);n.children.push(s),this._MoveCursorWithinIf(e,n,s);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":n=new W;t.children.push(n);s=this._BuildExpression(r,7);n.children.push(s),this._MoveCursorWithinIf(e,n,s);break;case"#if":n=new W,s=this._BuildExpression(r,3);t.children.push(n),n.children.push(s),this._MoveCursorWithinIf(e,n,s)}}else{var o=new V;if(o.line=r,t.children.push(o),"#"===r[0]&&"d"===r[1]){var a=r.replace(";","").split(" ");o.additionalDefineKey=a[1],3===a.length&&(o.additionalDefineValue=a[2])}}}return!1},e._EvaluatePreProcessors=function(e,t,r){var i=new V,n=new G;return n.lineIndex=-1,n.lines=e.split("\\n"),this._MoveCursor(n,i),i.process(t,r)},e._PreparePreProcessors=function(e,t){for(var r,i={},n=0,s=e.defines;n<s.length;n++){var o=s[n].replace("#define","").replace(";","").trim().split(" ");i[o[0]]=o.length>1?o[1]:""}return(null===(r=e.processor)||void 0===r?void 0:r.shaderLanguage)===P.GLSL&&(i.GL_ES="true"),i.__VERSION__=e.version,i[e.platformName]="true",t._getGlobalDefines(i),i},e._ProcessShaderConversion=function(e,t,r){var i=this._ProcessPrecision(e,t);if(!t.processor)return i;if(t.processor.shaderLanguage===P.GLSL&&-1!==i.indexOf("#version 3"))return i.replace("#version 300 es","");var n=t.defines,s=this._PreparePreProcessors(t,r);return t.processor.preProcessor&&(i=t.processor.preProcessor(i,n,t.isFragment,t.processingContext)),i=this._EvaluatePreProcessors(i,s,t),t.processor.postProcessor&&(i=t.processor.postProcessor(i,n,t.isFragment,t.processingContext,r)),r._features.needShaderCodeInlining&&(i=r.inlineShaderCode(i)),i},e._ApplyPreProcessing=function(e,t,r){var i,n,s=e,o=t.defines,a=this._PreparePreProcessors(t,r);return(null===(i=t.processor)||void 0===i?void 0:i.preProcessor)&&(s=t.processor.preProcessor(s,o,t.isFragment,t.processingContext)),s=this._EvaluatePreProcessors(s,a,t),(null===(n=t.processor)||void 0===n?void 0:n.postProcessor)&&(s=t.processor.postProcessor(s,o,t.isFragment,t.processingContext,r)),r._features.needShaderCodeInlining&&(s=r.inlineShaderCode(s)),s},e._ProcessIncludes=function(t,r,i){for(var n=this,s=J.exec(t),o=new String(t),a=!1,u=function(){var u=s[1];if(-1!==u.indexOf("__decl__")&&(u=u.replace(/__decl__/,""),r.supportsUniformBuffers&&(u=(u=u.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),u+="Declaration"),!r.includesShadersStore[u]){var h=r.shadersRepository+"ShadersInclude/"+u+".fx";return e._FileToolsLoadFile(h,(function(e){r.includesShadersStore[u]=e,n._ProcessIncludes(o,r,i)})),{value:void 0}}var c=r.includesShadersStore[u];if(s[2])for(var l=s[3].split(","),f=0;f<l.length;f+=2){var d=new RegExp(l[f],"g"),p=l[f+1];c=c.replace(d,p)}if(s[4]){var _=s[5];if(-1!==_.indexOf("..")){var g=_.split(".."),m=parseInt(g[0]),y=parseInt(g[1]),v=c.slice(0);c="",isNaN(y)&&(y=r.indexParameters[g[1]]);for(var b=m;b<y;b++)r.supportsUniformBuffers||(v=v.replace(/light\\{X\\}.(\\w*)/g,(function(e,t){return t+"{X}"}))),c+=v.replace(/\\{X\\}/g,b.toString())+"\\n"}else r.supportsUniformBuffers||(c=c.replace(/light\\{X\\}.(\\w*)/g,(function(e,t){return t+"{X}"}))),c=c.replace(/\\{X\\}/g,_)}o=o.replace(s[0],c),a=a||c.indexOf("#include<")>=0||c.indexOf("#include <")>=0,s=J.exec(t)};null!=s;){var h=u();if("object"===typeof h)return h.value}a?this._ProcessIncludes(o.toString(),r,i):i(o)},e._FileToolsLoadFile=function(e,t,r,i,n,s){throw A("FileTools")},e}(),ee=function(){function e(){}return e.GetShadersRepository=function(t){return void 0===t&&(t=P.GLSL),t===P.GLSL?e.ShadersRepository:e.ShadersRepositoryWGSL},e.GetShadersStore=function(t){return void 0===t&&(t=P.GLSL),t===P.GLSL?e.ShadersStore:e.ShadersStoreWGSL},e.GetIncludesShadersStore=function(t){return void 0===t&&(t=P.GLSL),t===P.GLSL?e.IncludesShadersStore:e.IncludesShadersStoreWGSL},e.ShadersRepository="src/Shaders/",e.ShadersStore={},e.IncludesShadersStore={},e.ShadersRepositoryWGSL="src/ShadersWGSL/",e.ShadersStoreWGSL={},e.IncludesShadersStoreWGSL={},e}(),te=function(){function e(t,r,i,n,s,o,a,u,h,c,l,f){void 0===n&&(n=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===l&&(l=""),void 0===f&&(f=P.GLSL);var d,p,m,y=this;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new _,this.onErrorObservable=new _,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._wasPreviouslyUsingInstances=null,this._isDisposed=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=t,this._key=l;var v,b,T=void 0,M=null;if(r.attributes){var x=r;if(this._engine=i,this._attributesNames=x.attributes,this._uniformsNames=x.uniformsNames.concat(x.samplers),this._samplerList=x.samplers.slice(),this.defines=x.defines,this.onError=x.onError,this.onCompiled=x.onCompiled,this._fallbacks=x.fallbacks,this._indexParameters=x.indexParameters,this._transformFeedbackVaryings=x.transformFeedbackVaryings||null,this._multiTarget=!!x.multiTarget,this._shaderLanguage=null!==(d=x.shaderLanguage)&&void 0!==d?d:P.GLSL,x.uniformBuffersNames){this._uniformBuffersNamesList=x.uniformBuffersNames.slice();for(var E=0;E<x.uniformBuffersNames.length;E++)this._uniformBuffersNames[x.uniformBuffersNames[E]]=E}M=null!==(p=x.processFinalCode)&&void 0!==p?p:null,T=null!==(m=x.processCodeAfterIncludes)&&void 0!==m?m:void 0}else this._engine=s,this.defines=null==o?"":o,this._uniformsNames=i.concat(n),this._samplerList=n?n.slice():[],this._attributesNames=r,this._uniformBuffersNamesList=[],this._shaderLanguage=f,this.onError=h,this.onCompiled=u,this._indexParameters=c,this._fallbacks=a;this._attributeLocationByName={},this.uniqueId=e._UniqueIdSeed++;var A=g()?this._engine.getHostDocument():null;t.vertexSource?v="source:"+t.vertexSource:t.vertexElement?(v=A?A.getElementById(t.vertexElement):null)||(v=t.vertexElement):v=t.vertex||t,t.fragmentSource?b="source:"+t.fragmentSource:t.fragmentElement?(b=A?A.getElementById(t.fragmentElement):null)||(b=t.fragmentElement):b=t.fragment||t,this._processingContext=this._engine._getShaderProcessingContext(this._shaderLanguage);var R={defines:this.defines.split("\\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:ee.GetShadersRepository(this._shaderLanguage),includesShadersStore:ee.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:T},I=[void 0,void 0],S=function(){if(I[0]&&I[1]){R.isFragment=!0;var e=I[0],r=I[1];$.Process(r,R,(function(r){M&&(r=M("fragment",r));var i=$.Finalize(e,r,R);y._useFinalCode(i.vertexCode,i.fragmentCode,t)}),y._engine)}};this._loadShader(v,"Vertex","",(function(e){$.Initialize(R),$.Process(e,R,(function(t){y._rawVertexSourceCode=e,M&&(t=M("vertex",t)),I[0]=t,S()}),y._engine)})),this._loadShader(b,"Fragment","Pixel",(function(e){y._rawFragmentSourceCode=e,I[1]=e,S()}))}return Object.defineProperty(e,"ShadersRepository",{get:function(){return ee.ShadersRepository},set:function(e){ee.ShadersRepository=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new _),this._onBindObservable},enumerable:!1,configurable:!0}),e.prototype._useFinalCode=function(e,t,r){if(r){var i=r.vertexElement||r.vertex||r.spectorName||r,n=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode=(this._shaderLanguage===P.WGSL?"//":"")+"#define SHADER_NAME vertex:"+i+"\\n"+e,this._fragmentSourceCode=(this._shaderLanguage===P.WGSL?"//":"")+"#define SHADER_NAME fragment:"+n+"\\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getUniformNames=function(){return this._uniformsNames},e.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},e.prototype.getIndexParameters=function(){return this._indexParameters},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},e.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(r){return void this._processCompilationErrors(r,e)}this._isDisposed||setTimeout((function(){t._checkIsReady(e)}),16)},e.prototype._loadShader=function(e,t,r,i){if("undefined"!==typeof HTMLElement&&e instanceof HTMLElement)return void i(v(e));if("source:"!==e.substr(0,7))if("base64:"!==e.substr(0,7)){var n,s=ee.GetShadersStore(this._shaderLanguage);if(s[e+t+"Shader"])i(s[e+t+"Shader"]);else if(r&&s[e+r+"Shader"])i(s[e+r+"Shader"]);else n="."===e[0]||"/"===e[0]||e.indexOf("http")>-1?e:ee.GetShadersRepository(this._shaderLanguage)+e,this._engine._loadFile(n+"."+t.toLowerCase()+".fx",i)}else{i(window.atob(e.substr(7)))}else i(e.substr(7))},Object.defineProperty(e.prototype,"vertexSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getVertexShaderCode())&&void 0!==t?t:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fragmentSourceCode",{get:function(){var e,t;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(t=null===(e=this._pipelineContext)||void 0===e?void 0:e._getFragmentShaderCode())&&void 0!==t?t:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),e.prototype._rebuildProgram=function(e,t,r,i){var n=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){i&&i(t)},this.onCompiled=function(){var e=n.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(63);n._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines,i=this._pipelineContext;this._isReady=!1;try{var n=this._engine;this._pipelineContext=n.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var s=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?n._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,s,null,this._transformFeedbackVaryings,this._key):n._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,s,r,this._transformFeedbackVaryings,this._key),n._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(e._attributes=[],e._pipelineContext._fillEffectInformation(e,e._uniformBuffersNames,e._uniformsNames,e._uniforms,e._samplerList,e._samplers,t,e._attributes),t)for(var r=0;r<t.length;r++){var s=t[r];e._attributeLocationByName[s]=e._attributes[r]}n.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),i&&e.getEngine()._deletePipelineContext(i)})),this._pipelineContext.isAsync&&this._checkIsReady(i)}catch(o){this._processCompilationErrors(o,i)}},e.prototype._getShaderCodeAndErrorLine=function(e,t,r){var i=r?/FRAGMENT SHADER ERROR: 0:(\\d+?):/:/VERTEX SHADER ERROR: 0:(\\d+?):/,n=null;if(t&&e){var s=t.match(i);if(s&&2===s.length){var o=parseInt(s[1]),a=e.split("\\n",-1);a.length>=o&&(n="Offending line [".concat(o,"] in ").concat(r?"fragment":"vertex"," code: ").concat(a[o-1]))}}return[e,n]},e.prototype._processCompilationErrors=function(t,r){var i,n,s,o,a;void 0===r&&(r=null),this._compilationError=t.message;var u=this._attributesNames,h=this._fallbacks;if(T.Error("Unable to compile effect:"),T.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),T.Error("Attributes: "+u.map((function(e){return" "+e}))),T.Error("Defines:\\r\\n"+this.defines),e.LogShaderCodeOnCompilationError){var c=null,l=null,f=null;(null===(s=this._pipelineContext)||void 0===s?void 0:s._getVertexShaderCode())&&(f=(i=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1))[0],c=i[1],f&&(T.Error("Vertex code:"),T.Error(f))),(null===(o=this._pipelineContext)||void 0===o?void 0:o._getFragmentShaderCode())&&(f=(n=this._getShaderCodeAndErrorLine(null===(a=this._pipelineContext)||void 0===a?void 0:a._getFragmentShaderCode(),this._compilationError,!0))[0],l=n[1],f&&(T.Error("Fragment code:"),T.Error(f))),c&&T.Error(c),l&&T.Error(l)}T.Error("Error: "+this._compilationError),r&&(this._pipelineContext=r,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),h?(this._pipelineContext=null,h.hasMoreFallbacks?(this._allFallbacksProcessed=!1,T.Error("Trying next fallback."),this.defines=h.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!1,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t,e)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var i=this._samplerList.indexOf(e),n=1;n<t.length;n++){var s=r+(n-1).toString();this._samplerList.splice(i+n,0,s)}for(var o=0,a=0,u=this._samplerList;a<u.length;a++){var h=u[a];this._samplers[h]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t,e)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t,e)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t,e)},e.prototype.bindUniformBuffer=function(t,r){var i=this._uniformBuffersNames[r];void 0===i||e._BaseCache[i]===t&&this._engine._features.useUBOBindingCache||(e._BaseCache[i]=t,this._engine.bindUniformBufferBase(t,i,r))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){return this._pipelineContext.setInt(e,t),this},e.prototype.setInt2=function(e,t,r){return this._pipelineContext.setInt2(e,t,r),this},e.prototype.setInt3=function(e,t,r,i){return this._pipelineContext.setInt3(e,t,r,i),this},e.prototype.setInt4=function(e,t,r,i,n){return this._pipelineContext.setInt4(e,t,r,i,n),this},e.prototype.setIntArray=function(e,t){return this._pipelineContext.setIntArray(e,t),this},e.prototype.setIntArray2=function(e,t){return this._pipelineContext.setIntArray2(e,t),this},e.prototype.setIntArray3=function(e,t){return this._pipelineContext.setIntArray3(e,t),this},e.prototype.setIntArray4=function(e,t){return this._pipelineContext.setIntArray4(e,t),this},e.prototype.setFloatArray=function(e,t){return this._pipelineContext.setArray(e,t),this},e.prototype.setFloatArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},e.prototype.setFloatArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},e.prototype.setFloatArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},e.prototype.setArray=function(e,t){return this._pipelineContext.setArray(e,t),this},e.prototype.setArray2=function(e,t){return this._pipelineContext.setArray2(e,t),this},e.prototype.setArray3=function(e,t){return this._pipelineContext.setArray3(e,t),this},e.prototype.setArray4=function(e,t){return this._pipelineContext.setArray4(e,t),this},e.prototype.setMatrices=function(e,t){return this._pipelineContext.setMatrices(e,t),this},e.prototype.setMatrix=function(e,t){return this._pipelineContext.setMatrix(e,t),this},e.prototype.setMatrix3x3=function(e,t){return this._pipelineContext.setMatrix3x3(e,t),this},e.prototype.setMatrix2x2=function(e,t){return this._pipelineContext.setMatrix2x2(e,t),this},e.prototype.setFloat=function(e,t){return this._pipelineContext.setFloat(e,t),this},e.prototype.setBool=function(e,t){return this._pipelineContext.setInt(e,t?1:0),this},e.prototype.setVector2=function(e,t){return this._pipelineContext.setVector2(e,t),this},e.prototype.setFloat2=function(e,t,r){return this._pipelineContext.setFloat2(e,t,r),this},e.prototype.setVector3=function(e,t){return this._pipelineContext.setVector3(e,t),this},e.prototype.setFloat3=function(e,t,r,i){return this._pipelineContext.setFloat3(e,t,r,i),this},e.prototype.setVector4=function(e,t){return this._pipelineContext.setVector4(e,t),this},e.prototype.setQuaternion=function(e,t){return this._pipelineContext.setQuaternion(e,t),this},e.prototype.setFloat4=function(e,t,r,i,n){return this._pipelineContext.setFloat4(e,t,r,i,n),this},e.prototype.setColor3=function(e,t){return this._pipelineContext.setColor3(e,t),this},e.prototype.setColor4=function(e,t,r){return this._pipelineContext.setColor4(e,t,r),this},e.prototype.setDirectColor4=function(e,t){return this._pipelineContext.setDirectColor4(e,t),this},e.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this),this._isDisposed=!0},e.RegisterShader=function(e,t,r,i){void 0===i&&(i=P.GLSL),t&&(ee.GetShadersStore(i)["".concat(e,"PixelShader")]=t),r&&(ee.GetShadersStore(i)["".concat(e,"VertexShader")]=r)},e.ResetCache=function(){e._BaseCache={}},e.LogShaderCodeOnCompilationError=!0,e._UniqueIdSeed=0,e._BaseCache={},e.ShadersStore=ee.ShadersStore,e.IncludesShadersStore=ee.IncludesShadersStore,e}(),re=function(){function e(e){void 0===e&&(e=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,e&&this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zOffsetUnits",{get:function(){return this._zOffsetUnits},set:function(e){this._zOffsetUnits!==e&&(this._zOffsetUnits=e,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,this.zOffsetUnits)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}(),ie=function(){function e(){this.reset()}return e.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=e.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=e.KEEP,this.opDepthFail=e.KEEP,this.opStencilDepthPass=e.REPLACE},Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this.func},set:function(e){this.func=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this.funcRef},set:function(e){this.funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this.funcMask},set:function(e){this.funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this.opStencilFail},set:function(e){this.opStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this.opDepthFail},set:function(e){this.opDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this.opStencilDepthPass},set:function(e){this.opStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this.mask},set:function(e){this.mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this.enabled},set:function(e){this.enabled=e},enumerable:!1,configurable:!0}),e.ALWAYS=519,e.KEEP=7680,e.REPLACE=7681,e}(),ne=function(){function e(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,r,i){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===r&&this._blendConstants[3]===i||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=r,this._blendConstants[3]=i,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,r,i){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===r&&this._blendFunctionParameters[3]===i||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=i,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}(),se=function(){function e(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}return Object.defineProperty(e.prototype,"wrapU",{get:function(){return this._cachedWrapU},set:function(e){this._cachedWrapU=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapV",{get:function(){return this._cachedWrapV},set:function(e){this._cachedWrapV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wrapR",{get:function(){return this._cachedWrapR},set:function(e){this._cachedWrapR=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anisotropicFilteringLevel",{get:function(){return this._cachedAnisotropicFilteringLevel},set:function(e){this._cachedAnisotropicFilteringLevel=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"comparisonFunction",{get:function(){return this._comparisonFunction},set:function(e){this._comparisonFunction=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"useMipMaps",{get:function(){return this._useMipMaps},set:function(e){this._useMipMaps=e},enumerable:!1,configurable:!0}),e.prototype.setParameters=function(e,t,r,i,n,s){return void 0===e&&(e=1),void 0===t&&(t=1),void 0===r&&(r=1),void 0===i&&(i=1),void 0===n&&(n=2),void 0===s&&(s=0),this._cachedWrapU=e,this._cachedWrapV=t,this._cachedWrapR=r,this._cachedAnisotropicFilteringLevel=i,this.samplingMode=n,this._comparisonFunction=s,this},e.prototype.compareSampler=function(e){return this._cachedWrapU===e._cachedWrapU&&this._cachedWrapV===e._cachedWrapV&&this._cachedWrapR===e._cachedWrapR&&this._cachedAnisotropicFilteringLevel===e._cachedAnisotropicFilteringLevel&&this.samplingMode===e.samplingMode&&this._comparisonFunction===e._comparisonFunction&&this._useMipMaps===e._useMipMaps},e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.DepthStencil=12]="DepthStencil",e[e.CubeRawRGBD=13]="CubeRawRGBD",e[e.Depth=14]="Depth"}(Y||(Y={}));var oe=function(e){function t(r,i,n){void 0===n&&(n=!1);var s=e.call(this)||this;return s.isReady=!1,s.isCube=!1,s.is3D=!1,s.is2DArray=!1,s.isMultiview=!1,s.url="",s.generateMipMaps=!1,s.samples=0,s.type=-1,s.format=-1,s.onLoadedObservable=new _,s.onErrorObservable=new _,s.onRebuildCallback=null,s.width=0,s.height=0,s.depth=0,s.baseWidth=0,s.baseHeight=0,s.baseDepth=0,s.invertY=!1,s._invertVScale=!1,s._associatedChannel=-1,s._source=Y.Unknown,s._buffer=null,s._bufferView=null,s._bufferViewArray=null,s._bufferViewArrayArray=null,s._size=0,s._extension="",s._files=null,s._workingCanvas=null,s._workingContext=null,s._cachedCoordinatesMode=null,s._isDisabled=!1,s._compression=null,s._sphericalPolynomial=null,s._sphericalPolynomialPromise=null,s._sphericalPolynomialComputed=!1,s._lodGenerationScale=0,s._lodGenerationOffset=0,s._useSRGBBuffer=!1,s._lodTextureHigh=null,s._lodTextureMid=null,s._lodTextureLow=null,s._isRGBD=!1,s._linearSpecularLOD=!1,s._irradianceTexture=null,s._hardwareTexture=null,s._maxLodLevel=null,s._references=1,s._gammaSpace=null,s._engine=r,s._source=i,s._uniqueId=t._Counter++,n||(s._hardwareTexture=r._createHardwareTexture()),s}return u(t,e),Object.defineProperty(t.prototype,"useMipMaps",{get:function(){return this.generateMipMaps},set:function(e){this.generateMipMaps=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),t.prototype.getEngine=function(){return this._engine},Object.defineProperty(t.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),t.prototype.incrementReferences=function(){this._references++},t.prototype.updateSize=function(e,t,r){void 0===r&&(r=1),this._engine.updateTextureDimensions(this,e,t,r),this.width=e,this.height=t,this.depth=r,this.baseWidth=e,this.baseHeight=t,this.baseDepth=r,this._size=e*t*r},t.prototype._rebuild=function(){var e,t=this;if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){var r=this.onRebuildCallback(this),i=function(e){e._swapAndDie(t,!1),t.isReady=r.isReady};r.isAsync?r.proxy.then(i):i(r.proxy)}else{var n;switch(this.source){case Y.Temp:break;case Y.Url:return void(n=this._engine.createTexture(null!==(e=this._originalUrl)&&void 0!==e?e:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){n._swapAndDie(t,!1),t.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case Y.Raw:(n=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,void 0,this._useSRGBBuffer))._swapAndDie(this,!1),this.isReady=!0;break;case Y.Raw3D:(n=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case Y.Raw2DArray:(n=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type))._swapAndDie(this,!1),this.isReady=!0;break;case Y.Dynamic:(n=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this,!1),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);break;case Y.Cube:return void(n=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){n._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer));case Y.CubeRaw:(n=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this,!1),this.isReady=!0;break;case Y.CubeRawRGBD:return;case Y.CubePrefiltered:return void((n=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(t,!1),t.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}}},t.prototype._swapAndDie=function(e,t){var r;void 0===t&&(t=!0),null===(r=this._hardwareTexture)||void 0===r||r.setUsage(e._source,this.generateMipMaps,this.isCube,this.width,this.height),e._hardwareTexture=this._hardwareTexture,t&&(e._isRGBD=this._isRGBD),this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var i=this._engine.getLoadedTexturesCache(),n=i.indexOf(this);-1!==n&&i.splice(n,1),-1===(n=i.indexOf(e))&&i.push(e)},t.prototype.dispose=function(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},t._Counter=0,t}(se),ae=function(){function e(){this.shaderLanguage=P.GLSL}return e.prototype.postProcessor=function(e,t,r,i,n){if(!n.getCaps().drawBuffersExtension){e=e.replace(/#extension.+GL_EXT_draw_buffers.+(enable|require)/g,"")}return e},e}(),ue=function(){function e(){this.shaderLanguage=P.GLSL}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},e.prototype.postProcessor=function(e,t,r){var i=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\\s*\\(/g,"texture("),r)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\\s*\\(/g,"textureLod(")).replace(/textureCubeLodEXT\\s*\\(/g,"textureLod(")).replace(/textureCube\\s*\\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\\s+?main\\s*\\(/g,(i?"":"out vec4 glFragColor;\\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\\nlayout (num_views = 2) in;\\n"+e;return e},e}(),he=function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=e._Counter++}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),e._Counter=0,e}(),ce=function(e){function t(t){var r=e.call(this)||this;return r._buffer=t,r}return u(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),t}(he),le=function(){function e(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!1,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e.prototype._fillEffectInformation=function(e,t,r,i,n,s,o,a){var u,h=this.engine;if(h.supportsUniformBuffers)for(var c in t)e.bindUniformBlock(c,t[c]);for(this.engine.getUniforms(this,r).forEach((function(e,t){i[r[t]]=e})),this._uniforms=i,u=0;u<n.length;u++){null==e.getUniform(n[u])&&(n.splice(u,1),u--)}n.forEach((function(e,t){s[e]=t}));for(var l=0,f=h.getAttributes(this,o);l<f.length;l++){var d=f[l];a.push(d)}},e.prototype.dispose=function(){this._uniforms={}},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._cacheFloat2=function(e,t,r){var i=this._valueCache[e];if(!i||2!==i.length)return i=[t,r],this._valueCache[e]=i,!0;var n=!1;return i[0]!==t&&(i[0]=t,n=!0),i[1]!==r&&(i[1]=r,n=!0),n},e.prototype._cacheFloat3=function(e,t,r,i){var n=this._valueCache[e];if(!n||3!==n.length)return n=[t,r,i],this._valueCache[e]=n,!0;var s=!1;return n[0]!==t&&(n[0]=t,s=!0),n[1]!==r&&(n[1]=r,s=!0),n[2]!==i&&(n[2]=i,s=!0),s},e.prototype._cacheFloat4=function(e,t,r,i,n){var s=this._valueCache[e];if(!s||4!==s.length)return s=[t,r,i,n],this._valueCache[e]=s,!0;var o=!1;return s[0]!==t&&(s[0]=t,o=!0),s[1]!==r&&(s[1]=r,o=!0),s[2]!==i&&(s[2]=i,o=!0),s[3]!==n&&(s[3]=n,o=!0),o},e.prototype.setInt=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setInt(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setInt2=function(e,t,r){this._cacheFloat2(e,t,r)&&(this.engine.setInt2(this._uniforms[e],t,r)||(this._valueCache[e]=null))},e.prototype.setInt3=function(e,t,r,i){this._cacheFloat3(e,t,r,i)&&(this.engine.setInt3(this._uniforms[e],t,r,i)||(this._valueCache[e]=null))},e.prototype.setInt4=function(e,t,r,i,n){this._cacheFloat4(e,t,r,i,n)&&(this.engine.setInt4(this._uniforms[e],t,r,i,n)||(this._valueCache[e]=null))},e.prototype.setIntArray=function(e,t){this._valueCache[e]=null,this.engine.setIntArray(this._uniforms[e],t)},e.prototype.setIntArray2=function(e,t){this._valueCache[e]=null,this.engine.setIntArray2(this._uniforms[e],t)},e.prototype.setIntArray3=function(e,t){this._valueCache[e]=null,this.engine.setIntArray3(this._uniforms[e],t)},e.prototype.setIntArray4=function(e,t){this._valueCache[e]=null,this.engine.setIntArray4(this._uniforms[e],t)},e.prototype.setArray=function(e,t){this._valueCache[e]=null,this.engine.setArray(this._uniforms[e],t)},e.prototype.setArray2=function(e,t){this._valueCache[e]=null,this.engine.setArray2(this._uniforms[e],t)},e.prototype.setArray3=function(e,t){this._valueCache[e]=null,this.engine.setArray3(this._uniforms[e],t)},e.prototype.setArray4=function(e,t){this._valueCache[e]=null,this.engine.setArray4(this._uniforms[e],t)},e.prototype.setMatrices=function(e,t){t&&(this._valueCache[e]=null,this.engine.setMatrices(this._uniforms[e],t))},e.prototype.setMatrix=function(e,t){this._cacheMatrix(e,t)&&(this.engine.setMatrices(this._uniforms[e],t.toArray())||(this._valueCache[e]=null))},e.prototype.setMatrix3x3=function(e,t){this._valueCache[e]=null,this.engine.setMatrix3x3(this._uniforms[e],t)},e.prototype.setMatrix2x2=function(e,t){this._valueCache[e]=null,this.engine.setMatrix2x2(this._uniforms[e],t)},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];void 0!==r&&r===t||this.engine.setFloat(this._uniforms[e],t)&&(this._valueCache[e]=t)},e.prototype.setVector2=function(e,t){this._cacheFloat2(e,t.x,t.y)&&(this.engine.setFloat2(this._uniforms[e],t.x,t.y)||(this._valueCache[e]=null))},e.prototype.setFloat2=function(e,t,r){this._cacheFloat2(e,t,r)&&(this.engine.setFloat2(this._uniforms[e],t,r)||(this._valueCache[e]=null))},e.prototype.setVector3=function(e,t){this._cacheFloat3(e,t.x,t.y,t.z)&&(this.engine.setFloat3(this._uniforms[e],t.x,t.y,t.z)||(this._valueCache[e]=null))},e.prototype.setFloat3=function(e,t,r,i){this._cacheFloat3(e,t,r,i)&&(this.engine.setFloat3(this._uniforms[e],t,r,i)||(this._valueCache[e]=null))},e.prototype.setVector4=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},e.prototype.setQuaternion=function(e,t){this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&(this.engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w)||(this._valueCache[e]=null))},e.prototype.setFloat4=function(e,t,r,i,n){this._cacheFloat4(e,t,r,i,n)&&(this.engine.setFloat4(this._uniforms[e],t,r,i,n)||(this._valueCache[e]=null))},e.prototype.setColor3=function(e,t){this._cacheFloat3(e,t.r,t.g,t.b)&&(this.engine.setFloat3(this._uniforms[e],t.r,t.g,t.b)||(this._valueCache[e]=null))},e.prototype.setColor4=function(e,t,r){this._cacheFloat4(e,t.r,t.g,t.b,r)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r)||(this._valueCache[e]=null))},e.prototype.setDirectColor4=function(e,t){this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&(this.engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a)||(this._valueCache[e]=null))},e.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},e.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},e}(),fe=function(){function e(){}return e.SetMatrixPrecision=function(t){if(e.MatrixTrackPrecisionChange=!1,t&&!e.MatrixUse64Bits&&e.MatrixTrackedMatrices)for(var r=0;r<e.MatrixTrackedMatrices.length;++r){var i=e.MatrixTrackedMatrices[r],n=i._m;i._m=new Array(16);for(var s=0;s<16;++s)i._m[s]=n[s]}e.MatrixUse64Bits=t,e.MatrixCurrentType=e.MatrixUse64Bits?Array:Float32Array,e.MatrixTrackedMatrices=null},e.MatrixUse64Bits=!1,e.MatrixTrackPrecisionChange=!0,e.MatrixCurrentType=Float32Array,e.MatrixTrackedMatrices=[],e}(),de=function(){function e(e,t){if(void 0===e&&(e=null),this._MSAARenderBuffer=null,this._context=t,!e&&!(e=t.createTexture()))throw new Error("Unable to create webGL texture");this.set(e)}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),e.prototype.setUsage=function(){},e.prototype.set=function(e){this._webGLTexture=e},e.prototype.reset=function(){this._webGLTexture=null,this._MSAARenderBuffer=null},e.prototype.release=function(){this._MSAARenderBuffer&&(this._context.deleteRenderbuffer(this._MSAARenderBuffer),this._MSAARenderBuffer=null),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},e}(),pe=function(){function e(e,t){void 0===t&&(t=!0),this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),t&&(this.materialContext=e.createMaterialContext())}return e.IsWrapper=function(e){return void 0===e.getPipelineContext},e.GetEffect=function(e){return void 0===e.getPipelineContext?e.effect:e},e.prototype.setEffect=function(e,t,r){var i;void 0===r&&(r=!0),this.effect=e,void 0!==t&&(this.defines=t),r&&(null===(i=this.drawContext)||void 0===i||i.reset())},e.prototype.dispose=function(){var e;null===(e=this.drawContext)||void 0===e||e.dispose()},e}(),_e=function(){function e(e){void 0===e&&(e=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,e&&this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"func",{get:function(){return this._func},set:function(e){this._func!==e&&(this._func=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef!==e&&(this._funcRef=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask!==e&&(this._funcMask=e,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail!==e&&(this._opStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail!==e&&(this._opDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass!==e&&(this._opStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask!==e&&(this._mask=e,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled!==e&&(this._enabled=e,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.reset=function(){var e;this.stencilMaterial=void 0,null===(e=this.stencilGlobal)||void 0===e||e.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){var t;if(e){var r=!this.useStencilGlobalOnly&&!!(null===(t=this.stencilMaterial)||void 0===t?void 0:t.enabled);this.enabled=r?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=r?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=r?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=r?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=r?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=r?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=r?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=r?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}},e}(),ge=function(){},me=function(){function e(t,r,i,n){var s=this;this._name="WebGL",this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=null,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this.disableUniformBuffers=!1,this.onDisposeObservable=new _,this._frameId=0,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new _,this.onContextRestoredObservable=new _,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new re,this._stencilStateComposer=new _e,this._stencilState=new ie,this._alphaState=new ne,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._renderTargetWrapperCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._activeRequests=new Array,this._adaptToDeviceRatio=!1,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new _,this._isWebGPU=!1,this._snapshotRenderingMode=0,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={};var o=null;if(i=i||{},this._creationOptions=i,this._adaptToDeviceRatio=null!==n&&void 0!==n&&n,this._stencilStateComposer.stencilGlobal=this._stencilState,fe.SetMatrixPrecision(!!i.useHighPrecisionMatrix),t){if(n=n||i.adaptToDeviceRatio||!1,t.getContext){if(o=t,this._renderingCanvas=o,void 0!==r&&(i.antialias=r),void 0===i.deterministicLockstep&&(i.deterministicLockstep=!1),void 0===i.lockstepMaxSteps&&(i.lockstepMaxSteps=4),void 0===i.timeStep&&(i.timeStep=1/60),void 0===i.preserveDrawingBuffer&&(i.preserveDrawingBuffer=!1),void 0===i.audioEngine&&(i.audioEngine=!0),void 0!==i.audioEngineOptions&&void 0!==i.audioEngineOptions.audioContext&&(this._audioContext=i.audioEngineOptions.audioContext),void 0!==i.audioEngineOptions&&void 0!==i.audioEngineOptions.audioDestination&&(this._audioDestination=i.audioEngineOptions.audioDestination),void 0===i.stencil&&(i.stencil=!0),!1===i.premultipliedAlpha&&(this.premultipliedAlpha=!1),void 0===i.xrCompatible&&(i.xrCompatible=!0),this._doNotHandleContextLost=!!i.doNotHandleContextLost,navigator&&navigator.userAgent){this._checkForMobile=function(){var e=navigator.userAgent;s.hostInformation.isMobile=-1!==e.indexOf("Mobile")||-1!==e.indexOf("Mac")&&y()&&"ontouchend"in document},this._checkForMobile(),g()&&window.addEventListener("resize",this._checkForMobile);for(var a=navigator.userAgent,u=0,h=e.ExceptionList;u<h.length;u++){var c=h[u],l=c.key,f=c.targets;if(new RegExp(l).test(a)){if(c.capture&&c.captureConstraint){var d=c.capture,p=c.captureConstraint,m=new RegExp(d).exec(a);if(m&&m.length>0)if(parseInt(m[m.length-1])>=p)continue}for(var v=0,b=f;v<b.length;v++){switch(b[v]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":i.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),s._contextWasLost=!0,T.Warn("WebGL context lost."),s.onContextLostObservable.notifyObservers(s)},this._onContextRestored=function(){s._restoreEngineAfterContextLost(s._initGLContext.bind(s))},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),i.powerPreference="high-performance"),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._badDesktopOS&&(i.xrCompatible=!1),!i.disableWebGL2Support)try{this._gl=o.getContext("webgl2",i)||o.getContext("experimental-webgl2",i),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(R){}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",i)||o.getContext("experimental-webgl",i)}catch(R){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var M=this._gl.getContextAttributes();M&&(i.stencil=M.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==i.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=i.useHighPrecisionFloats);var x=g()&&window.devicePixelRatio||1,E=i.limitDeviceRatio||x;this._hardwareScalingLevel=n?1/Math.min(E,x):1,this.resize(),this._isStencilEnable=!!i.stencil,this._initGLContext(),this._initFeatures();for(var A=0;A<this._caps.maxVertexAttribs;A++)this._currentBufferPointers[A]=new ge;this._shaderProcessor=this.webGLVersion>1?new ue:new ae,this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent);var P="Babylon.js v".concat(e.Version);console.log(P+" - ".concat(this.description)),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",P)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@5.14.1"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"5.14.1"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return te.ShadersRepository},set:function(e){te.ShadersRepository=e},enumerable:!1,configurable:!0}),e.prototype._getShaderProcessor=function(e){return this._shaderProcessor},Object.defineProperty(e.prototype,"useReverseDepthBuffer",{get:function(){return this._useReverseDepthBuffer},set:function(e){e!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=e,this._depthCullingState.depthFunc=e?518:515)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),e.prototype.getCreationOptions=function(){return this._creationOptions},Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"framebufferDimensionsObject",{set:function(e){this._framebufferDimensionsObject=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotRendering",{get:function(){return!1},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshotRenderingMode",{get:function(){return this._snapshotRenderingMode},set:function(e){this._snapshotRenderingMode=e},enumerable:!1,configurable:!0}),e.prototype.snapshotRenderingReset=function(){this.snapshotRendering=!1},e._CreateCanvas=function(e,t){if("undefined"===typeof document)return new OffscreenCanvas(e,t);var r=document.createElement("canvas");return r.width=e,r.height=t,r},e.prototype.createCanvas=function(t,r){return e._CreateCanvas(t,r)},e.prototype.createCanvasImage=function(){return document.createElement("img")},e.prototype._restoreEngineAfterContextLost=function(e){var t=this;setTimeout((function(){return l(t,void 0,void 0,(function(){var t,r,i,n,s;return f(this,(function(o){switch(o.label){case 0:return this._dummyFramebuffer=null,t=this._depthCullingState.depthTest,r=this._depthCullingState.depthFunc,i=this._depthCullingState.depthMask,n=this._stencilState.stencilTest,[4,e()];case 1:return o.sent(),this._rebuildEffects(),null===(s=this._rebuildComputeEffects)||void 0===s||s.call(this),this._rebuildInternalTextures(),this._rebuildRenderTargetWrappers(),this._rebuildBuffers(),this.wipeCaches(!0),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=r,this._depthCullingState.depthMask=i,this._stencilState.stencilTest=n,T.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1,[2]}}))}))}),0)},e.prototype._sharedInit=function(e,t,r){this._renderingCanvas=e},e.prototype._getShaderProcessingContext=function(e){return null},e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++){t[e]._rebuild()}},e.prototype._rebuildRenderTargetWrappers=function(){for(var e=0,t=this._renderTargetWrapperCache.slice();e<t.length;e++){t[e]._rebuild()}},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e];t._pipelineContext=null,t._wasPreviouslyReady=!1,t._prepareEffect()}te.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects){if(!this._compiledEffects[e].isReady())return!1}return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++){t[e]._rebuild()}for(var r=0,i=this._storageBuffers;r<i.length;r++){i[r]._rebuild()}},e.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?256:128},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var i=this._gl.getExtension("WEBGL_depth_texture");null!=i&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=i.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var n=this._gl.getExtension("OES_vertex_array_object");null!=n&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=n.createVertexArrayOES.bind(n),this._gl.bindVertexArray=n.bindVertexArrayOES.bind(n),this._gl.deleteVertexArray=n.deleteVertexArrayOES.bind(n))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var s=this._gl.getExtension("ANGLE_instanced_arrays");null!=s?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=s.drawArraysInstancedANGLE.bind(s),this._gl.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s),this._gl.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),a=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&a&&(this._caps.highPrecisionShaderSupported=0!==o.precision&&0!==a.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var u=this._gl.getExtension("EXT_blend_minmax");null!=u&&(this._caps.blendMinMax=!0,this._gl.MAX=u.MAX_EXT,this._gl.MIN=u.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0;else{var h=this._gl.getExtension("EXT_sRGB");null!=h&&(this._caps.supportSRGBBuffers=!0,this._gl.SRGB=h.SRGB_EXT,this._gl.SRGB8=h.SRGB_ALPHA_EXT,this._gl.SRGB8_ALPHA8=h.SRGB_ALPHA_EXT)}this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&!(!this._creationOptions||!this._creationOptions.forceSRGBBufferSupportState)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var c=0;c<this._maxSimultaneousTextures;c++)this._nextFreeTextureSlots.push(c)},e.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=this.createCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.getInfo=function(){return this.getGlInfo()},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++){(0,this._activeRenderLoops[t])()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getAudioContext=function(){return this._audioContext},e.prototype.getAudioDestination=function(){return this._audioDestination},e.prototype.getHostWindow=function(){return g()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(t,r){return e.QueueNewFrame(t,r)},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},e.prototype.clear=function(e,t,r,i){void 0===i&&(i=!1);var n=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=n;var s=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),s|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),s|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),s|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(s)},e.prototype._viewport=function(e,t,r,i){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=i,this._gl.viewport(e,t,r,i))},e.prototype.setViewport=function(e,t,r){var i=t||this.getRenderWidth(),n=r||this.getRenderHeight(),s=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(s*i,o*n,i*e.width,n*e.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},e.prototype.resize=function(e){var t,r;if(void 0===e&&(e=!1),this._adaptToDeviceRatio){var i=g()&&window.devicePixelRatio||1,n=this._creationOptions.limitDeviceRatio||i;this._hardwareScalingLevel=this._adaptToDeviceRatio?1/Math.min(n,i):1}g()?(t=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,r=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(t=this._renderingCanvas?this._renderingCanvas.width:100,r=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(t/this._hardwareScalingLevel,r/this._hardwareScalingLevel,e)},e.prototype.setSize=function(e,t,r){return void 0===r&&(r=!1),!!this._renderingCanvas&&(e|=0,t|=0,!(!r&&this._renderingCanvas.width===e&&this._renderingCanvas.height===t)&&(this._renderingCanvas.width=e,this._renderingCanvas.height=t,!0))},e.prototype.bindFramebuffer=function(e,t,r,i,n,s,o){var a,u,h,c,l;void 0===t&&(t=0),void 0===s&&(s=0),void 0===o&&(o=0);var f=e;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(f._MSAAFramebuffer?f._MSAAFramebuffer:f._framebuffer);var d=this._gl;e.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,null===(a=e.texture._hardwareTexture)||void 0===a?void 0:a.underlyingResource,s,o):e.isCube&&d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(u=e.texture._hardwareTexture)||void 0===u?void 0:u.underlyingResource,s);var p=e._depthStencilTexture;if(p){var _=e._depthStencilTextureWithStencil?d.DEPTH_STENCIL_ATTACHMENT:d.DEPTH_ATTACHMENT;e.is2DArray?d.framebufferTextureLayer(d.FRAMEBUFFER,_,null===(h=p._hardwareTexture)||void 0===h?void 0:h.underlyingResource,s,o):e.isCube?d.framebufferTexture2D(d.FRAMEBUFFER,_,d.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(c=p._hardwareTexture)||void 0===c?void 0:c.underlyingResource,s):d.framebufferTexture2D(d.FRAMEBUFFER,_,d.TEXTURE_2D,null===(l=p._hardwareTexture)||void 0===l?void 0:l.underlyingResource,s)}this._cachedViewport&&!n?this.setViewport(this._cachedViewport,r,i):(r||(r=e.width,s&&(r/=Math.pow(2,s))),i||(i=e.height,s&&(i/=Math.pow(2,s))),this._viewport(0,0,r,i)),this.wipeCaches()},e.prototype.setState=function(e,t,r,i,n,s,o){var a,u;void 0===t&&(t=0),void 0===i&&(i=!1),void 0===o&&(o=0),(this._depthCullingState.cull!==e||r)&&(this._depthCullingState.cull=e);var h=null===(u=null!==(a=this.cullBackFaces)&&void 0!==a?a:n)||void 0===u||u?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==h||r)&&(this._depthCullingState.cullFace=h),this.setZOffset(t),this.setZOffsetUnits(o);var c=i?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==c||r)&&(this._depthCullingState.frontFace=c),this._stencilStateComposer.stencilMaterial=s},e.prototype.setZOffset=function(e){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-e:e},e.prototype.getZOffset=function(){var e=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-e:e},e.prototype.setZOffsetUnits=function(e){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-e:e},e.prototype.getZOffsetUnits=function(){var e=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-e:e},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype._currentFrameBufferIsDefaultFrameBuffer=function(){return null===this._currentFramebuffer},e.prototype.generateMipmaps=function(e){this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)},e.prototype.unBindFramebuffer=function(e,t,r){var i;void 0===t&&(t=!1);var n=e;this._currentRenderTarget=null;var s=this._gl;if(n._MSAAFramebuffer){if(e.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(e,t,r);s.bindFramebuffer(s.READ_FRAMEBUFFER,n._MSAAFramebuffer),s.bindFramebuffer(s.DRAW_FRAMEBUFFER,n._framebuffer),s.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,s.COLOR_BUFFER_BIT,s.NEAREST)}!(null===(i=e.texture)||void 0===i?void 0:i.generateMipMaps)||t||e.isCube||this.generateMipmaps(e.texture),r&&(n._MSAAFramebuffer&&this._bindUnboundFramebuffer(n._framebuffer),r()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var i=new ce(r);return this.bindArrayBuffer(i),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),t):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,t),this._resetVertexBufferBinding(),i.references=1,i},e.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),i=new ce(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(i);var n=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,n,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),i.references=1,i.is32Bits=4===n.BYTES_PER_ELEMENT,i},e.prototype._normalizeIndexData=function(e){if(2===e.BYTES_PER_ELEMENT)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);this._gl.uniformBlockBinding(i,n,r)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype._bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,r,i,n,s,o){var a=this._currentBufferPointers[t];if(a){var u=!1;a.active?(a.buffer!==e&&(a.buffer=e,u=!0),a.size!==r&&(a.size=r,u=!0),a.type!==i&&(a.type=i,u=!0),a.normalized!==n&&(a.normalized=n,u=!0),a.stride!==s&&(a.stride=s,u=!0),a.offset!==o&&(a.offset=o,u=!0)):(u=!0,a.active=!0,a.index=t,a.size=r,a.type=i,a.normalized=n,a.stride=s,a.offset=o,a.buffer=e),(u||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,i,n,s,o))}},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t,r){var i=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var n=0;n<i.length;n++){var s=t.getAttributeLocation(n);if(s>=0){var o=i[n],a=null;if(r&&(a=r[o]),a||(a=e[o]),!a)continue;this._gl.enableVertexAttribArray(s),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[s]=!0);var u=a.getBuffer();u&&(this._vertexAttribPointer(u,s,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(s,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(u))))}}},e.prototype.recordVertexArrayObject=function(e,t,r,i){var n=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(n),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r,i),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),n},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,r,i,n){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==n){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=n;var s=n.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,a=0;a<s;a++)if(a<r.length){var u=n.getAttributeLocation(a);u>=0&&(this._gl.enableVertexAttribArray(u),this._vertexAttribArraysEnabled[u]=!0,this._vertexAttribPointer(e,u,r[a],this._gl.FLOAT,!1,i,o)),o+=4*r[a]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,r,i){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r,i)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var i=this._currentInstanceBuffers[t];e!=i&&i.references&&(e=i,this.bindArrayBuffer(i));var n=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(n,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},e.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},e.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var i=0;i<4;i++){var n=r[i];this._vertexAttribArraysEnabled[n]||(this._gl.enableVertexAttribArray(n),this._vertexAttribArraysEnabled[n]=!0),this._vertexAttribPointer(e,n,4,this._gl.FLOAT,!1,64,16*i),this._gl.vertexAttribDivisor(n,1),this._currentInstanceLocations.push(n),this._currentInstanceBuffers.push(e)}},e.prototype.bindInstancesBuffer=function(e,t,r){void 0===r&&(r=!0),this.bindArrayBuffer(e);var i=0;if(r)for(var n=0;n<t.length;n++){i+=4*(s=t[n]).attributeSize}for(n=0;n<t.length;n++){var s;void 0===(s=t[n]).index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),s.index<0||(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(e,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,i,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(e))}},e.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},e.prototype.disableInstanceAttribute=function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},e.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},e.prototype.draw=function(e,t,r,i){this.drawElementsType(e?0:1,t,r,i)},e.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(2,e,t,r)},e.prototype.drawUnIndexed=function(e,t,r,i){this.drawArraysType(e?0:1,t,r,i)},e.prototype.drawElementsType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(n,r,s,t*o,i):this._gl.drawElements(n,r,s,t*o)},e.prototype.drawArraysType=function(e,t,r,i){this.applyStates(),this._reportDrawCall();var n=this._drawMode(e);i?this._gl.drawArraysInstanced(n,t,r,i):this._gl.drawArrays(n,t,r)},e.prototype._drawMode=function(e){switch(e){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(e){if(this._compiledEffects[e._key]){delete this._compiledEffects[e._key];var t=e.getPipelineContext();t&&this._deletePipelineContext(t)}},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},e.prototype._getGlobalDefines=function(e){if(e)return this.isNDCHalfZRange?e.IS_NDC_HALF_ZRANGE="":delete e.IS_NDC_HALF_ZRANGE,void(this.useReverseDepthBuffer?e.USE_REVERSE_DEPTHBUFFER="":delete e.USE_REVERSE_DEPTHBUFFER);var t="";return this.isNDCHalfZRange&&(t+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(t&&(t+="\\n"),t+="#define USE_REVERSE_DEPTHBUFFER"),t},e.prototype.createEffect=function(e,t,r,i,n,s,o,a,u,h){var c;void 0===h&&(h=P.GLSL);var l=e.vertexElement||e.vertex||e.vertexToken||e.vertexSource||e,f=e.fragmentElement||e.fragment||e.fragmentToken||e.fragmentSource||e,d=this._getGlobalDefines(),p=null!==(c=null!==n&&void 0!==n?n:t.defines)&&void 0!==c?c:"";d&&(p+=d);var _=l+"+"+f+"@"+p;if(this._compiledEffects[_]){var g=this._compiledEffects[_];return o&&g.isReady()&&o(g),g}var m=new te(e,t,r,i,this,n,s,o,a,u,_,h);return this._compiledEffects[_]=m,m},e._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\\n":"")+e},e.prototype._compileShader=function(t,r,i,n){return this._compileRawShader(e._ConcatenateShader(t,i,n),r)},e.prototype._compileRawShader=function(e,t){var r=this._gl,i=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!i){for(var n=r.NO_ERROR,s=r.NO_ERROR;(s=r.getError())!==r.NO_ERROR;)n=s;throw new Error("Something went wrong while creating a gl ".concat(t," shader object. gl error=").concat(n,", gl isContextLost=").concat(r.isContextLost(),", _contextWasLost=").concat(this._contextWasLost))}return r.shaderSource(i,e),r.compileShader(i),i},e.prototype._getShaderSource=function(e){return this._gl.getShaderSource(e)},e.prototype.createRawShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null),i=i||this._gl;var s=this._compileRawShader(t,"vertex"),o=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,s,o,i,n)},e.prototype.createShaderProgram=function(e,t,r,i,n,s){void 0===s&&(s=null),n=n||this._gl;var o=this._webGLVersion>1?"#version 300 es\\n#define WEBGL2 \\n":"",a=this._compileShader(t,"vertex",i,o),u=this._compileShader(r,"fragment",i,o);return this._createShaderProgram(e,a,u,n,s)},e.prototype.inlineShaderCode=function(e){return e},e.prototype.createPipelineContext=function(e){var t=new le;return t.engine=this,this._caps.parallelShaderCompile&&(t.isParallelCompiled=!0),t},e.prototype.createMaterialContext=function(){},e.prototype.createDrawContext=function(){},e.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");return i.attachShader(s,t),i.attachShader(s,r),i.linkProgram(s),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},e.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,i=e.fragmentShader,n=e.program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var s,o;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS))if(s=this._gl.getShaderInfoLog(r))throw e.vertexCompilationError=s,new Error("VERTEX SHADER "+s);if(!this._gl.getShaderParameter(i,this._gl.COMPILE_STATUS))if(s=this._gl.getShaderInfoLog(i))throw e.fragmentCompilationError=s,new Error("FRAGMENT SHADER "+s);if(o=t.getProgramInfoLog(n))throw e.programLinkError=o,new Error(o)}if(this.validateShaderPrograms&&(t.validateProgram(n),!t.getProgramParameter(n,t.VALIDATE_STATUS)&&(o=t.getProgramInfoLog(n))))throw e.programValidationError=o,new Error(o);t.deleteShader(r),t.deleteShader(i),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,r,i,n,s,o,a,u,h){var c=e;c.program=i?this.createRawShaderProgram(c,t,r,void 0,u):this.createShaderProgram(c,t,r,a,void 0,u),c.program.__SPECTOR_rebuildProgram=o},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;if(r.isParallelCompiled){var i=r.onCompiled;r.onCompiled=i?function(){i(),t()}:t}else t()},e.prototype.getUniforms=function(e,t){for(var r=new Array,i=e,n=0;n<t.length;n++)r.push(this._gl.getUniformLocation(i.program,t[n]));return r},e.prototype.getAttributes=function(e,t){for(var r=[],i=e,n=0;n<t.length;n++)try{r.push(this._gl.getAttribLocation(i.program,t[n]))}catch(s){r.push(-1)}return r},e.prototype.enableEffect=function(e){(e=null!==e&&pe.IsWrapper(e)?e.effect:e)&&e!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,e=e,this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setInt=function(e,t){return!!e&&(this._gl.uniform1i(e,t),!0)},e.prototype.setInt2=function(e,t,r){return!!e&&(this._gl.uniform2i(e,t,r),!0)},e.prototype.setInt3=function(e,t,r,i){return!!e&&(this._gl.uniform3i(e,t,r,i),!0)},e.prototype.setInt4=function(e,t,r,i,n){return!!e&&(this._gl.uniform4i(e,t,r,i,n),!0)},e.prototype.setIntArray=function(e,t){return!!e&&(this._gl.uniform1iv(e,t),!0)},e.prototype.setIntArray2=function(e,t){return!(!e||t.length%2!==0)&&(this._gl.uniform2iv(e,t),!0)},e.prototype.setIntArray3=function(e,t){return!(!e||t.length%3!==0)&&(this._gl.uniform3iv(e,t),!0)},e.prototype.setIntArray4=function(e,t){return!(!e||t.length%4!==0)&&(this._gl.uniform4iv(e,t),!0)},e.prototype.setArray=function(e,t){return!!e&&(!(t.length<1)&&(this._gl.uniform1fv(e,t),!0))},e.prototype.setArray2=function(e,t){return!(!e||t.length%2!==0)&&(this._gl.uniform2fv(e,t),!0)},e.prototype.setArray3=function(e,t){return!(!e||t.length%3!==0)&&(this._gl.uniform3fv(e,t),!0)},e.prototype.setArray4=function(e,t){return!(!e||t.length%4!==0)&&(this._gl.uniform4fv(e,t),!0)},e.prototype.setMatrices=function(e,t){return!!e&&(this._gl.uniformMatrix4fv(e,!1,t),!0)},e.prototype.setMatrix3x3=function(e,t){return!!e&&(this._gl.uniformMatrix3fv(e,!1,t),!0)},e.prototype.setMatrix2x2=function(e,t){return!!e&&(this._gl.uniformMatrix2fv(e,!1,t),!0)},e.prototype.setFloat=function(e,t){return!!e&&(this._gl.uniform1f(e,t),!0)},e.prototype.setFloat2=function(e,t,r){return!!e&&(this._gl.uniform2f(e,t,r),!0)},e.prototype.setFloat3=function(e,t,r,i){return!!e&&(this._gl.uniform3f(e,t,r,i),!0)},e.prototype.setFloat4=function(e,t,r,i,n){return!!e&&(this._gl.uniform4f(e,t,r,i,n),!0)},e.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},e.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},e.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stencilStateComposer",{get:function(){return this._stencilStateComposer},enumerable:!1,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(e,t){var r=this._gl,i=r.NEAREST,n=r.NEAREST;switch(e){case 11:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:i=r.LINEAR,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:i=r.NEAREST,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:i=r.NEAREST,n=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:i=r.NEAREST,n=r.LINEAR;break;case 1:i=r.NEAREST,n=r.NEAREST;break;case 9:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:i=r.LINEAR,n=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:i=r.LINEAR,n=r.LINEAR;break;case 12:i=r.LINEAR,n=r.NEAREST}return{min:n,mag:i}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype._createHardwareTexture=function(){return new de(this._createTexture(),this._gl)},e.prototype._createInternalTexture=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=Y.Unknown);var n={};void 0!==t&&"object"===typeof t?(n.generateMipMaps=t.generateMipMaps,n.type=void 0===t.type?0:t.type,n.samplingMode=void 0===t.samplingMode?3:t.samplingMode,n.format=void 0===t.format?5:t.format,n.useSRGBBuffer=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer):(n.generateMipMaps=t,n.type=0,n.samplingMode=3,n.format=5,n.useSRGBBuffer=!1),n.useSRGBBuffer=n.useSRGBBuffer&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU),(1!==n.type||this._caps.textureFloatLinearFiltering)&&(2!==n.type||this._caps.textureHalfFloatLinearFiltering)||(n.samplingMode=1),1!==n.type||this._caps.textureFloat||(n.type=0,T.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));var s=this._gl,o=new oe(this,i);o._useSRGBBuffer=!!n.useSRGBBuffer;var a=e.width||e,u=e.height||e,h=e.layers||0,c=this._getSamplingParameters(n.samplingMode,!!n.generateMipMaps),l=0!==h?s.TEXTURE_2D_ARRAY:s.TEXTURE_2D,f=this._getRGBABufferInternalSizedFormat(n.type,n.format,n.useSRGBBuffer),d=this._getInternalFormat(n.format),p=this._getWebGLTextureType(n.type);return this._bindTextureDirectly(l,o),0!==h?(o.is2DArray=!0,s.texImage3D(l,0,f,a,u,h,0,d,p,null)):s.texImage2D(l,0,f,a,u,0,d,p,null),s.texParameteri(l,s.TEXTURE_MAG_FILTER,c.mag),s.texParameteri(l,s.TEXTURE_MIN_FILTER,c.min),s.texParameteri(l,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(l,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),n.generateMipMaps&&this._gl.generateMipmap(l),this._bindTextureDirectly(l,null),o.baseWidth=a,o.baseHeight=u,o.width=a,o.height=u,o.depth=h,o.isReady=!0,o.samples=1,o.generateMipMaps=!!n.generateMipMaps,o.samplingMode=n.samplingMode,o.type=n.type,o.format=n.format,this._internalTexturesCache.push(o),o},e.prototype._getUseSRGBBuffer=function(e,t){return e&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU||t)},e.prototype._createTextureBase=function(t,r,i,n,s,o,a,u,h,c,l,f,d,p,_,g){var m=this;void 0===s&&(s=3),void 0===o&&(o=null),void 0===a&&(a=null),void 0===c&&(c=null),void 0===l&&(l=null),void 0===f&&(f=null),void 0===d&&(d=null);var y="data:"===(t=t||"").substr(0,5),v="blob:"===t.substr(0,5),b=y&&-1!==t.indexOf(";base64,"),M=l||new oe(this,Y.Url),x=t;!this._transformTextureUrl||b||l||c||(t=this._transformTextureUrl(t)),x!==t&&(M._originalUrl=x);var E=t.lastIndexOf("."),A=d||(E>-1?t.substring(E).toLowerCase():""),P=null;A.indexOf("?")>-1&&(A=A.split("?")[0]);for(var R=0,S=e._TextureLoaders;R<S.length;R++){var C=S[R];if(C.canLoad(A,p)){P=C;break}}n&&n._addPendingData(M),M.url=t,M.generateMipMaps=!r,M.samplingMode=s,M.invertY=i,M._useSRGBBuffer=this._getUseSRGBBuffer(!!g,r),this._doNotHandleContextLost||(M._buffer=c);var D=null;o&&!l&&(D=M.onLoadedObservable.add(o)),l||this._internalTexturesCache.push(M);var O=function(e,i){n&&n._removePendingData(M),t===x?(D&&M.onLoadedObservable.remove(D),I.UseFallbackTexture&&m._createTextureBase(I.FallbackTexture,r,M.invertY,n,s,null,a,u,h,c,M),e=(e||"Unknown error")+(I.UseFallbackTexture?" - Fallback texture was used":""),M.onErrorObservable.notifyObservers({message:e,exception:i}),a&&a(e,i)):(T.Warn("Failed to load ".concat(t,", falling back to ").concat(x)),m._createTextureBase(x,r,M.invertY,n,s,o,a,u,h,c,M,f,d,p,_,g))};if(P){var F=function(e){P.loadData(e,M,(function(e,t,r,i,o,a){a?O("TextureLoader failed to load data"):u(M,A,n,{width:e,height:t},M.invertY,!r,i,(function(){return o(),!1}),s)}),_)};c?c instanceof ArrayBuffer?F(new Uint8Array(c)):ArrayBuffer.isView(c)?F(c):a&&a("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(t,(function(e){return F(new Uint8Array(e))}),void 0,n?n.offlineProvider:void 0,!0,(function(e,t){O("Unable to load "+(e&&e.responseURL,t))}))}else{var w=function(e){v&&!m._doNotHandleContextLost&&(M._buffer=e),u(M,A,n,e,M.invertY,r,!1,h,s)};!y||b?c&&("string"===typeof c.decoding||c.close)?w(c):e._FileToolsLoadImage(t,w,O,n?n.offlineProvider:null,p,M.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof c||c instanceof ArrayBuffer||ArrayBuffer.isView(c)||c instanceof Blob?e._FileToolsLoadImage(c,w,O,n?n.offlineProvider:null,p,M.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):c&&w(c)}return M},e.prototype.createTexture=function(e,t,r,i,n,s,o,a,u,h,c,l,f,d,p){var _=this;return void 0===n&&(n=3),void 0===s&&(s=null),void 0===o&&(o=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===c&&(c=null),this._createTextureBase(e,t,r,i,n,s,o,this._prepareWebGLTexture.bind(this),(function(e,t,r,n,s,o){var a=_._gl,u=r.width===e&&r.height===t,c=h?_._getInternalFormat(h,s._useSRGBBuffer):".jpg"!==n||s._useSRGBBuffer?s._useSRGBBuffer?a.SRGB8_ALPHA8:a.RGBA:a.RGB,l=h?_._getInternalFormat(h):".jpg"!==n||s._useSRGBBuffer?a.RGBA:a.RGB;if(s._useSRGBBuffer&&1===_.webGLVersion&&(l=c),u)return a.texImage2D(a.TEXTURE_2D,0,c,l,a.UNSIGNED_BYTE,r),!1;var f=_._caps.maxTextureSize;if(r.width>f||r.height>f||!_._supportsHardwareTextureRescaling)return _._prepareWorkingCanvas(),!(!_._workingCanvas||!_._workingContext)&&(_._workingCanvas.width=e,_._workingCanvas.height=t,_._workingContext.drawImage(r,0,0,r.width,r.height,0,0,e,t),a.texImage2D(a.TEXTURE_2D,0,c,l,a.UNSIGNED_BYTE,_._workingCanvas),s.width=e,s.height=t,!1);var d=new oe(_,Y.Temp);return _._bindTextureDirectly(a.TEXTURE_2D,d,!0),a.texImage2D(a.TEXTURE_2D,0,c,l,a.UNSIGNED_BYTE,r),_._rescaleTexture(d,s,i,c,(function(){_._releaseTexture(d),_._bindTextureDirectly(a.TEXTURE_2D,s,!0),o()})),!0}),a,u,h,c,l,f,p)},e._FileToolsLoadImage=function(e,t,r,i,n,s){throw A("FileTools")},e.prototype._rescaleTexture=function(e,t,r,i,n){},e.prototype.createRawTexture=function(e,t,r,i,n,s,o,a,u,h,c){throw void 0===a&&(a=null),void 0===u&&(u=0),void 0===h&&(h=0),void 0===c&&(c=!1),A("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(e,t,r,i,n,s,o,a){throw void 0===a&&(a=null),A("Engine.RawTexture")},e.prototype.createRawTexture3D=function(e,t,r,i,n,s,o,a,u,h){throw void 0===u&&(u=null),void 0===h&&(h=0),A("Engine.RawTexture")},e.prototype.createRawTexture2DArray=function(e,t,r,i,n,s,o,a,u,h){throw void 0===u&&(u=null),void 0===h&&(h=0),A("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},e.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1);var i=this._getTextureTarget(t),n=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(i,this._gl.TEXTURE_MAG_FILTER,n.mag,t),this._setTextureParameterInteger(i,this._gl.TEXTURE_MIN_FILTER,n.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(i)),this._bindTextureDirectly(i,null),t.samplingMode=e},e.prototype.updateTextureDimensions=function(e,t,r,i){void 0===i&&(i=1)},e.prototype.updateTextureWrappingMode=function(e,t,r,i){void 0===r&&(r=null),void 0===i&&(i=null);var n=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==i&&(this._setTextureParameterInteger(n,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(i),e),e._cachedWrapR=i),this._bindTextureDirectly(n,null)},e.prototype._setupDepthStencilTexture=function(e,t,r,i,n,s){void 0===s&&(s=1);var o=t.width||t,a=t.height||t,u=t.layers||0;e.baseWidth=o,e.baseHeight=a,e.width=o,e.height=a,e.is2DArray=u>0,e.depth=u,e.isReady=!0,e.samples=s,e.generateMipMaps=!1,e.samplingMode=i?2:1,e.type=0,e._comparisonFunction=n;var h=this._gl,c=this._getTextureTarget(e),l=this._getSamplingParameters(e.samplingMode,!1);h.texParameteri(c,h.TEXTURE_MAG_FILTER,l.mag),h.texParameteri(c,h.TEXTURE_MIN_FILTER,l.min),h.texParameteri(c,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(c,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===n?(h.texParameteri(c,h.TEXTURE_COMPARE_FUNC,515),h.texParameteri(c,h.TEXTURE_COMPARE_MODE,h.NONE)):(h.texParameteri(c,h.TEXTURE_COMPARE_FUNC,n),h.texParameteri(c,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE)))},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,i,n,s,o){void 0===s&&(s=0),void 0===o&&(o=0);var a=this._gl,u=a.TEXTURE_2D;if(e.isCube&&(u=a.TEXTURE_CUBE_MAP_POSITIVE_X+s),e._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=a.COMPRESSED_SRGB8_ETC2:e._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:e._useSRGBBuffer=!1;break;case 36492:t=a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:e._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:e._useSRGBBuffer=!1;break;default:e._useSRGBBuffer=!1}this._gl.compressedTexImage2D(u,o,t,r,i,0,n)},e.prototype._uploadDataToTextureDirectly=function(e,t,r,i,n,s){void 0===r&&(r=0),void 0===i&&(i=0),void 0===s&&(s=!1);var o=this._gl,a=this._getWebGLTextureType(e.type),u=this._getInternalFormat(e.format),h=void 0===n?this._getRGBABufferInternalSizedFormat(e.type,e.format,e._useSRGBBuffer):this._getInternalFormat(n,e._useSRGBBuffer);this._unpackFlipY(e.invertY);var c=o.TEXTURE_2D;e.isCube&&(c=o.TEXTURE_CUBE_MAP_POSITIVE_X+r);var l=Math.round(Math.log(e.width)*Math.LOG2E),f=Math.round(Math.log(e.height)*Math.LOG2E),d=s?e.width:Math.pow(2,Math.max(l-i,0)),p=s?e.height:Math.pow(2,Math.max(f-i,0));o.texImage2D(c,i,h,d,p,0,u,a,t)},e.prototype.updateTextureData=function(e,t,r,i,n,s,o,a,u){void 0===o&&(o=0),void 0===a&&(a=0),void 0===u&&(u=!1);var h=this._gl,c=this._getWebGLTextureType(e.type),l=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var f=h.TEXTURE_2D;e.isCube&&(f=h.TEXTURE_CUBE_MAP_POSITIVE_X+o),this._bindTextureDirectly(f,e,!0),h.texSubImage2D(f,a,r,i,n,s,l,c,t),u&&this._gl.generateMipmap(f),this._bindTextureDirectly(f,null)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(s,e,!0),this._uploadDataToTextureDirectly(e,t,r,i),this._bindTextureDirectly(s,null,!0)},e.prototype._prepareWebGLTextureContinuation=function(e,t,r,i,n){var s=this._gl;if(s){var o=this._getSamplingParameters(n,!r);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o.min),r||i||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,r,i,n,s,o,a,u,h){var c=this;void 0===h&&(h=3);var l=this.getCaps().maxTextureSize,f=Math.min(l,this.needPOTTextures?e.GetExponentOfTwo(n.width,l):n.width),d=Math.min(l,this.needPOTTextures?e.GetExponentOfTwo(n.height,l):n.height),p=this._gl;p&&(t._hardwareTexture?(this._bindTextureDirectly(p.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===s||!!s),t.baseWidth=n.width,t.baseHeight=n.height,t.width=f,t.height=d,t.isReady=!0,u(f,d,n,r,t,(function(){c._prepareWebGLTextureContinuation(t,i,o,a,h)}))||this._prepareWebGLTextureContinuation(t,i,o,a,h)):i&&i._removePendingData(t))},e.prototype._setupFramebufferDepthAttachments=function(e,t,r,i,n){void 0===n&&(n=1);var s=this._gl;if(e&&t)return this._createRenderBuffer(r,i,n,s.DEPTH_STENCIL,s.DEPTH24_STENCIL8,s.DEPTH_STENCIL_ATTACHMENT);if(t){var o=s.DEPTH_COMPONENT16;return this._webGLVersion>1&&(o=s.DEPTH_COMPONENT32F),this._createRenderBuffer(r,i,n,o,o,s.DEPTH_ATTACHMENT)}return e?this._createRenderBuffer(r,i,n,s.STENCIL_INDEX8,s.STENCIL_INDEX8,s.STENCIL_ATTACHMENT):null},e.prototype._createRenderBuffer=function(e,t,r,i,n,s,o){void 0===o&&(o=!0);var a=this._gl,u=a.createRenderbuffer();return a.bindRenderbuffer(a.RENDERBUFFER,u),r>1&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(a.RENDERBUFFER,r,n,e,t):a.renderbufferStorage(a.RENDERBUFFER,i,e,t),a.framebufferRenderbuffer(a.FRAMEBUFFER,s,a.RENDERBUFFER,u),o&&a.bindRenderbuffer(a.RENDERBUFFER,null),u},e.prototype._releaseTexture=function(e){var t;this._deleteTexture(null===(t=e._hardwareTexture)||void 0===t?void 0:t.underlyingResource),this.unbindAllTextures();var r=this._internalTexturesCache.indexOf(e);-1!==r&&this._internalTexturesCache.splice(r,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},e.prototype._releaseRenderTargetWrapper=function(e){var t=this._renderTargetWrapperCache.indexOf(e);-1!==t&&this._renderTargetWrapperCache.splice(t,1)},e.prototype._deleteTexture=function(e){e&&this._gl.deleteTexture(e)},e.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),i=0;i<r.length;i++){var n=e.getUniform(r[i]);n&&(this._boundUniforms[i]=n)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,r,i){var n,s;void 0===r&&(r=!1),void 0===i&&(i=!1);var o=!1,a=t&&t._associatedChannel>-1;if(r&&a&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||i){if(this._activateCurrentTexture(),t&&t.isMultiview)throw console.error(e,t),"_bindTextureDirectly called with a multiview texture!";this._gl.bindTexture(e,null!==(s=null===(n=null===t||void 0===t?void 0:t._hardwareTexture)||void 0===n?void 0:n.underlyingResource)&&void 0!==s?s:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else r&&(o=!0,this._activateCurrentTexture());return a&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),o},e.prototype._bindTexture=function(e,t,r){if(void 0!==e){t&&(t._associatedChannel=e),this._activeChannel=e;var i=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(i,t)}},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},e.prototype.setTexture=function(e,t,r,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},e.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},e.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(e,t,r,i,n){if(void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===n&&(n=""),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var s;s=i?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&s&&(s._associatedChannel=e);var o=!0;this._boundTexturesCache[e]===s&&(r||this._bindSamplerUniformToChannel(s._associatedChannel,e),o=!1),this._activeChannel=e;var a=this._getTextureTarget(s);if(o&&this._bindTextureDirectly(a,s,r),s&&!s.isMultiview){if(s.isCube&&s._cachedCoordinatesMode!==t.coordinatesMode){s._cachedCoordinatesMode=t.coordinatesMode;var u=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=u,t.wrapV=u}s._cachedWrapU!==t.wrapU&&(s._cachedWrapU=t.wrapU,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),s)),s._cachedWrapV!==t.wrapV&&(s._cachedWrapV=t.wrapV,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),s)),s.is3D&&s._cachedWrapR!==t.wrapR&&(s._cachedWrapR=t.wrapR,this._setTextureParameterInteger(a,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),s)),this._setAnisotropicLevel(a,s,t.anisotropicFilteringLevel)}return!0},e.prototype.setTextureArray=function(e,t,r,i){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var n=0;n<r.length;n++){var s=r[n].getInternalTexture();s?(this._textureUnits[n]=e+n,s._associatedChannel=e+n):this._textureUnits[n]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var o=0;o<r.length;o++)this._setTexture(this._textureUnits[o],r[o],!0)}},e.prototype._setAnisotropicLevel=function(e,t,r){var i=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(r=1),i&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)},e.prototype._setTextureParameterFloat=function(e,t,r,i){this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameterf(e,t,r)},e.prototype._setTextureParameterInteger=function(e,t,r,i){i&&this._bindTextureDirectly(e,i,!0,!0),this._gl.texParameteri(e,t,r)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){var e;this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),null===(e=this.releaseComputeEffects)||void 0===e||e.call(this),this.unbindAllAttributes(),this._boundUniforms=[],g()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),window.removeEventListener("resize",this._checkForMobile)),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,te.ResetCache();for(var t=0,r=this._activeRequests;t<r.length;t++){r[t].abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,i,0);var s=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&s===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,a=t.UNSIGNED_BYTE,u=new Uint8Array(4);t.readPixels(0,0,1,1,o,a,u),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(i),t.deleteFramebuffer(n),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},e.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(e,t){void 0===t&&(t=!1);var r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA;switch(e){case 0:r=this._gl.ALPHA;break;case 1:r=this._gl.LUMINANCE;break;case 2:r=this._gl.LUMINANCE_ALPHA;break;case 6:r=this._gl.RED;break;case 7:r=this._gl.RG;break;case 4:r=t?this._gl.SRGB:this._gl.RGB;break;case 5:r=t?this._gl.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:r=this._gl.RED_INTEGER;break;case 9:r=this._gl.RG_INTEGER;break;case 10:r=this._gl.RGB_INTEGER;break;case 11:r=this._gl.RGBA_INTEGER}return r},e.prototype._getRGBABufferInternalSizedFormat=function(e,t,r){if(void 0===r&&(r=!1),1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return r?this._gl.SRGB:this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return r?this._gl.SRGB8:this._gl.RGB8;case 5:return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return r?this._gl.SRGB8_ALPHA8:this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(t,r,i,n,s,o){var a=this,u=e._FileToolsLoadFile(t,r,i,n,s,o);return this._activeRequests.push(u),u.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),u},e._FileToolsLoadFile=function(e,t,r,i,n,s){throw A("FileTools")},e.prototype.readPixels=function(e,t,r,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=!0);var o=n?4:3,a=n?this._gl.RGBA:this._gl.RGB,u=new Uint8Array(i*r*o);return s&&this.flushFramebuffer(),this._gl.readPixels(e,t,r,i,a,this._gl.UNSIGNED_BYTE,u),Promise.resolve(u)},Object.defineProperty(e,"IsSupportedAsync",{get:function(){return Promise.resolve(this.isSupported())},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),e.isSupported=function(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(r){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(e,"HasMajorPerformanceCaveat",{get:function(){if(null===this._HasMajorPerformanceCaveat)try{var e=this._CreateCanvas(1,1),t=e.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(r){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var r=e.CeilingPOT(t),i=e.FloorPOT(t);return r-t>t-i?i:r},e.GetExponentOfTwo=function(t,r,i){var n;switch(void 0===i&&(i=2),i){case 1:n=e.FloorPOT(t);break;case 2:n=e.NearestPOT(t);break;default:n=e.CeilingPOT(t)}return Math.min(n,r)},e.QueueNewFrame=function(e,t){return g()?(t||(t=window),t.requestPostAnimationFrame?t.requestPostAnimationFrame(e):t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):"undefined"!==typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},e.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:y()?document:null},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\\\.0\\\\.3239\\\\.(\\\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e._IsSupported=null,e._HasMajorPerformanceCaveat=null,e}(),ye=function(){function e(){}return e.SetImmediate=function(e){g()&&window.setImmediate?window.setImmediate(e):setTimeout(e,1)},e}(),ve=new RegExp(/^data:([^,]+\\/[^,]+)?;base64,/i),be=function(e){function t(r,i){var n=e.call(this,r,F)||this;return n.name="LoadFileError",D._setPrototypeOf(n,t.prototype),i instanceof R?n.request=i:n.file=i,n}return u(t,e),t}(L),Te=function(e){function t(r,i){var n=e.call(this,r,w)||this;return n.request=i,n.name="RequestFileError",D._setPrototypeOf(n,t.prototype),n}return u(t,e),t}(L),Me=function(e){function t(r,i){var n=e.call(this,r,B)||this;return n.file=i,n.name="ReadFileError",D._setPrototypeOf(n,t.prototype),n}return u(t,e),t}(L),xe={DefaultRetryStrategy:C.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:function(e){return e}},Ee=function(e){return e=e.replace(/#/gm,"%23")},Ae=function(e,t){if((!e||0!==e.indexOf("data:"))&&xe.CorsBehavior)if("string"===typeof xe.CorsBehavior||xe.CorsBehavior instanceof String)t.crossOrigin=xe.CorsBehavior;else{var r=xe.CorsBehavior(e);r&&(t.crossOrigin=r)}},Pe=function(e,t,r,i,n,s){var o,a;void 0===n&&(n="");var u=!1;e instanceof ArrayBuffer||ArrayBuffer.isView(e)?"undefined"!==typeof Blob?(a=URL.createObjectURL(new Blob([e],{type:n})),u=!0):a="data:".concat(n,";base64,")+N(e):e instanceof Blob?(a=URL.createObjectURL(e),u=!0):(a=Ee(e),a=xe.PreprocessUrl(e));var c=I.LastCreatedEngine,l=function(t){if(r){var i=a||e.toString();r("Error while trying to load image: ".concat(0===i.indexOf("http")||i.length<=128?i:i.slice(0,128)+"..."),t)}};if("undefined"===typeof Image||null!==(o=null===c||void 0===c?void 0:c._features.forceBitmapOverHTMLImageElement)&&void 0!==o&&o)return Ie(a,(function(i){c.createImageBitmap(new Blob([i],{type:n}),h({premultiplyAlpha:"none"},s)).then((function(e){t(e),u&&URL.revokeObjectURL(a)})).catch((function(t){r&&r("Error while trying to load image: "+e,t)}))}),void 0,i||void 0,!0,(function(e,t){l(t)})),null;var f=new Image;Ae(a,f);var d=function e(){f.removeEventListener("load",e),f.removeEventListener("error",p),t(f),u&&f.src&&URL.revokeObjectURL(f.src)},p=function e(t){f.removeEventListener("load",d),f.removeEventListener("error",e),l(t),u&&f.src&&URL.revokeObjectURL(f.src)};f.addEventListener("load",d),f.addEventListener("error",p);var _=function(){f.src=a};if("blob:"!==a.substr(0,5)&&"data:"!==a.substr(0,5)&&i&&i.enableTexturesOffline)i.open((function(){i&&i.loadImage(a,f)}),_);else{if(-1!==a.indexOf("file:")){var g=decodeURIComponent(a.substring(5).toLowerCase());if(S.FilesToLoad[g]){try{var m=void 0;try{m=URL.createObjectURL(S.FilesToLoad[g])}catch(y){m=URL.createObjectURL(S.FilesToLoad[g])}f.src=m,u=!0}catch(v){f.src=""}return f}}_()}return f},Re=function(e,t,r,i,n){var s=new FileReader,o={onCompleteObservable:new _,abort:function(){return s.abort()}};return s.onloadend=function(){return o.onCompleteObservable.notifyObservers(o)},n&&(s.onerror=function(){n(new Me("Unable to read ".concat(e.name),e))}),s.onload=function(e){t(e.target.result)},r&&(s.onprogress=r),i?s.readAsArrayBuffer(e):s.readAsText(e),o},Ie=function(e,t,r,i,n,s,o){if(e.name)return Re(e,t,r,n,s?function(e){s(void 0,e)}:void 0);var a=e;if(-1!==a.indexOf("file:")){var u=decodeURIComponent(a.substring(5).toLowerCase());0===u.indexOf("./")&&(u=u.substring(2));var h=S.FilesToLoad[u];if(h)return Re(h,t,r,n,s?function(e){return s(void 0,new be(e.message,e.file))}:void 0)}if(De(a)){var c={onCompleteObservable:new _,abort:function(){return function(){}}};try{t(n?Oe(a):we(a))}catch(l){s?s(void 0,l):T.Error(l.message||"Failed to parse the Data URL")}return ye.SetImmediate((function(){c.onCompleteObservable.notifyObservers(c)})),c}return Se(a,(function(e,r){t(e,r?r.responseURL:void 0)}),r,i,n,s?function(e){s(e.request,new be(e.message,e.request))}:void 0,o)},Se=function(e,t,r,i,n,s,o){e=Ee(e),e=xe.PreprocessUrl(e);var a=xe.BaseUrl+e,u=!1,h={onCompleteObservable:new _,abort:function(){return u=!0}},c=function(){var e,i=new R,c=null,l=function(){i&&(r&&i.removeEventListener("progress",r),e&&i.removeEventListener("readystatechange",e),i.removeEventListener("loadend",f))},f=function(){l(),h.onCompleteObservable.notifyObservers(h),h.onCompleteObservable.clear(),r=void 0,e=null,f=null,s=void 0,o=void 0,t=void 0};h.abort=function(){u=!0,f&&f(),i&&i.readyState!==(XMLHttpRequest.DONE||4)&&i.abort(),null!==c&&(clearTimeout(c),c=null),i=null};var d=function(e){var t=e.message||"Unknown error";s&&i?s(new Te(t,i)):T.Error(t)};!function h(p){if(i){if(i.open("GET",a),o)try{o(i)}catch(_){return void d(_)}n&&(i.responseType="arraybuffer"),r&&i.addEventListener("progress",r),f&&i.addEventListener("loadend",f),e=function(){if(!u&&i&&i.readyState===(XMLHttpRequest.DONE||4)){if(e&&i.removeEventListener("readystatechange",e),i.status>=200&&i.status<300||0===i.status&&(!g()||Ce())){try{t&&t(n?i.response:i.responseText,i)}catch(_){d(_)}return}var r=xe.DefaultRetryStrategy;if(r){var o=r(a,i,p);if(-1!==o)return l(),i=new R,void(c=setTimeout((function(){return h(p+1)}),o))}var f=new Te("Error status: "+i.status+" "+i.statusText+" - Unable to load "+a,i);s&&s(f)}},i.addEventListener("readystatechange",e),i.send()}}(0)};if(i&&i.enableSceneOffline){var l=function(e){e&&e.status>400?s&&s(e):c()};i.open((function(){i&&i.loadFile(xe.BaseUrl+e,(function(e){!u&&t&&t(e),h.onCompleteObservable.notifyObservers(h)}),r?function(e){!u&&r&&r(e)}:void 0,l,n)}),l)}else c();return h},Ce=function(){return"undefined"!==typeof location&&"file:"===location.protocol},De=function(e){return ve.test(e)};function Oe(e){return k(e.split(",")[1])}var Fe,we=function(e){return U(e.split(",")[1])};me._FileToolsLoadImage=Pe,me._FileToolsLoadFile=Ie,$._FileToolsLoadFile=Ie;!function(e,t,r,i,n,s,o,a,u,h){Fe={DecodeBase64UrlToBinary:e,DecodeBase64UrlToString:t,DefaultRetryStrategy:r.DefaultRetryStrategy,BaseUrl:r.BaseUrl,CorsBehavior:r.CorsBehavior,PreprocessUrl:r.PreprocessUrl,IsBase64DataUrl:i,IsFileURL:n,LoadFile:s,LoadImage:o,ReadFile:a,RequestFile:u,SetCorsBehavior:h},Object.defineProperty(Fe,"DefaultRetryStrategy",{get:function(){return r.DefaultRetryStrategy},set:function(e){r.DefaultRetryStrategy=e}}),Object.defineProperty(Fe,"BaseUrl",{get:function(){return r.BaseUrl},set:function(e){r.BaseUrl=e}}),Object.defineProperty(Fe,"PreprocessUrl",{get:function(){return r.PreprocessUrl},set:function(e){r.PreprocessUrl=e}}),Object.defineProperty(Fe,"CorsBehavior",{get:function(){return r.CorsBehavior},set:function(e){r.CorsBehavior=e}})}(Oe,we,xe,De,Ce,Ie,Pe,Re,Se,Ae);var Be={};function Le(e,t){Be[e]=t}function Ne(e){return Be[e]}var Ue=function(){function e(){}return e.Instantiate=function(e){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[e])return this.RegisteredExternalClasses[e];var t=Ne(e);if(t)return t;T.Warn(e+" not found, you may have missed an import.");for(var r=e.split("."),i=window||this,n=0,s=r.length;n<s;n++)i=i[r[n]];return"function"!==typeof i?null:i},e.RegisteredExternalClasses={},e}();function ke(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}var Ve=function(){function e(){}return Object.defineProperty(e,"BaseUrl",{get:function(){return xe.BaseUrl},set:function(e){xe.BaseUrl=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DefaultRetryStrategy",{get:function(){return xe.DefaultRetryStrategy},set:function(e){xe.DefaultRetryStrategy=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"CorsBehavior",{get:function(){return xe.CorsBehavior},set:function(e){xe.CorsBehavior=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"UseFallbackTexture",{get:function(){return I.UseFallbackTexture},set:function(e){I.UseFallbackTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RegisteredExternalClasses",{get:function(){return Ue.RegisteredExternalClasses},set:function(e){Ue.RegisteredExternalClasses=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"fallbackTexture",{get:function(){return I.FallbackTexture},set:function(e){I.FallbackTexture=e},enumerable:!1,configurable:!0}),e.FetchToRef=function(e,t,r,i,n,s){var o=4*((Math.abs(e)*r%r|0)+(Math.abs(t)*i%i|0)*r);s.r=n[o]/255,s.g=n[o+1]/255,s.b=n[o+2]/255,s.a=n[o+3]/255},e.Mix=function(e,t,r){return e*(1-r)+t*r},e.Instantiate=function(e){return Ue.Instantiate(e)},e.SetImmediate=function(e){ye.SetImmediate(e)},e.IsExponentOfTwo=function(e){var t=1;do{t*=2}while(t<e);return t===e},e.FloatRound=function(t){return Math.fround?Math.fround(t):(e._TmpFloatArray[0]=t,e._TmpFloatArray[0])},e.GetFilename=function(e){var t=e.lastIndexOf("/");return t<0?e:e.substring(t+1)},e.GetFolderPath=function(e,t){void 0===t&&(t=!1);var r=e.lastIndexOf("/");return r<0?t?e:"":e.substring(0,r+1)},e.ToDegrees=function(e){return 180*e/Math.PI},e.ToRadians=function(e){return e*Math.PI/180},e.MakeArray=function(e,t){return!0===t||void 0!==e&&null!=e?Array.isArray(e)?e:[e]:null},e.GetPointerPrefix=function(e){var t="pointer";return g()&&!window.PointerEvent&&(t="mouse"),!e._badDesktopOS||e._badOS||document&&"ontouchend"in document||(t="mouse"),t},e.SetCorsBehavior=function(e,t){Ae(e,t)},e.SetReferrerPolicyBehavior=function(e,t){t.referrerPolicy=e},e.CleanUrl=function(e){return e=e.replace(/#/gm,"%23")},Object.defineProperty(e,"PreprocessUrl",{get:function(){return xe.PreprocessUrl},set:function(e){xe.PreprocessUrl=e},enumerable:!1,configurable:!0}),e.LoadImage=function(e,t,r,i,n,s){return Pe(e,t,r,i,n,s)},e.LoadFile=function(e,t,r,i,n,s){return Ie(e,t,r,i,n,s)},e.LoadFileAsync=function(e,t){return void 0===t&&(t=!0),new Promise((function(r,i){Ie(e,(function(e){r(e)}),void 0,void 0,t,(function(e,t){i(t)}))}))},e.LoadScript=function(e,t,r,i){if(g()){var n=document.getElementsByTagName("head")[0],s=document.createElement("script");s.setAttribute("type","text/javascript"),s.setAttribute("src",e),i&&(s.id=i),s.onload=function(){t&&t()},s.onerror=function(t){r&&r("Unable to load script \'".concat(e,"\'"),t)},n.appendChild(s)}},e.LoadScriptAsync=function(e){var t=this;return new Promise((function(r,i){t.LoadScript(e,(function(){r()}),(function(e,t){i(t)}))}))},e.ReadFileAsDataURL=function(e,t,r){var i=new FileReader,n={onCompleteObservable:new _,abort:function(){return i.abort()}};return i.onloadend=function(){n.onCompleteObservable.notifyObservers(n)},i.onload=function(e){t(e.target.result)},i.onprogress=r,i.readAsDataURL(e),n},e.ReadFile=function(e,t,r,i,n){return Re(e,t,r,i,n)},e.FileAsURL=function(e){var t=new Blob([e]);return(window.URL||window.webkitURL).createObjectURL(t)},e.Format=function(e,t){return void 0===t&&(t=2),e.toFixed(t)},e.DeepCopy=function(e,t,r,i){x.DeepCopy(e,t,r,i)},e.IsEmpty=function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0},e.RegisterTopRootEvents=function(e,t){for(var r=0;r<t.length;r++){var i=t[r];e.addEventListener(i.name,i.handler,!1);try{window.parent&&window.parent.addEventListener(i.name,i.handler,!1)}catch(n){}}},e.UnregisterTopRootEvents=function(e,t){for(var r=0;r<t.length;r++){var i=t[r];e.removeEventListener(i.name,i.handler);try{e.parent&&e.parent.removeEventListener(i.name,i.handler)}catch(n){}}},e.DumpFramebuffer=function(t,r,i,n,s,o){return void 0===s&&(s="image/png"),l(this,void 0,void 0,(function(){var a,u;return f(this,(function(h){switch(h.label){case 0:return[4,i.readPixels(0,0,t,r)];case 1:return a=h.sent(),u=new Uint8Array(a.buffer),e.DumpData(t,r,u,n,s,o,!0),[2]}}))}))},e.DumpData=function(t,r,i,n,s,o,a,u,h){void 0===s&&(s="image/png"),void 0===a&&(a=!1),void 0===u&&(u=!1),e._ScreenshotCanvas||(e._ScreenshotCanvas=document.createElement("canvas")),e._ScreenshotCanvas.width=t,e._ScreenshotCanvas.height=r;var c=e._ScreenshotCanvas.getContext("2d");if(c){if(i instanceof Float32Array){for(var l=new Uint8Array(i.length),f=i.length;f--;){var d=i[f];l[f]=d<0?0:d>1?1:Math.round(255*d)}i=l}var p=c.createImageData(t,r);p.data.set(i),c.putImageData(p,0,0);var _=e._ScreenshotCanvas;if(a){var g=document.createElement("canvas");g.width=t,g.height=r;var m=g.getContext("2d");if(!m)return;m.translate(0,r),m.scale(1,-1),m.drawImage(e._ScreenshotCanvas,0,0),_=g}u?e.ToBlob(_,(function(e){var t=new FileReader;t.onload=function(e){var t=e.target.result;n&&n(t)},t.readAsArrayBuffer(e)}),s,h):e.EncodeScreenshotCanvasData(n,s,o,_,h)}},e.DumpDataAsync=function(t,r,i,n,s,o,a,u){return void 0===n&&(n="image/png"),void 0===o&&(o=!1),void 0===a&&(a=!1),new Promise((function(h){e.DumpData(t,r,i,(function(e){return h(e)}),n,s,o,a,u)}))},e.ToBlob=function(e,t,r,i){void 0===r&&(r="image/png"),e.toBlob||(e.toBlob=function(e,t,r){var i=this;setTimeout((function(){for(var n=atob(i.toDataURL(t,r).split(",")[1]),s=n.length,o=new Uint8Array(s),a=0;a<s;a++)o[a]=n.charCodeAt(a);e(new Blob([o]))}))}),e.toBlob((function(e){t(e)}),r,i)},e.DownloadBlob=function(t,r){if("download"in document.createElement("a")){if(!r){var i=new Date;r="screenshot_"+((i.getFullYear()+"-"+(i.getMonth()+1)).slice(2)+"-"+i.getDate()+"_"+i.getHours()+"-"+("0"+i.getMinutes()).slice(-2))+".png"}e.Download(t,r)}else if(t){var n=URL.createObjectURL(t),s=window.open("");if(!s)return;var o=s.document.createElement("img");o.onload=function(){URL.revokeObjectURL(n)},o.src=n,s.document.body.appendChild(o)}},e.EncodeScreenshotCanvasData=function(t,r,i,n,s){(void 0===r&&(r="image/png"),t)?t((null!==n&&void 0!==n?n:e._ScreenshotCanvas).toDataURL(r,s)):this.ToBlob(null!==n&&void 0!==n?n:e._ScreenshotCanvas,(function(t){t&&e.DownloadBlob(t,i)}),r,s)},e.Download=function(e,t){if(navigator&&navigator.msSaveBlob)navigator.msSaveBlob(e,t);else{var r=window.URL.createObjectURL(e),i=document.createElement("a");document.body.appendChild(i),i.style.display="none",i.href=r,i.download=t,i.addEventListener("click",(function(){i.parentElement&&i.parentElement.removeChild(i)})),i.click(),window.URL.revokeObjectURL(r)}},e.BackCompatCameraNoPreventDefault=function(e){return"boolean"===typeof e[0]?e[0]:"boolean"===typeof e[1]&&e[1]},e.CreateScreenshot=function(e,t,r,i,n){throw void 0===n&&(n="image/png"),A("ScreenshotTools")},e.CreateScreenshotAsync=function(e,t,r,i){throw void 0===i&&(i="image/png"),A("ScreenshotTools")},e.CreateScreenshotUsingRenderTarget=function(e,t,r,i,n,s,o,a){throw void 0===n&&(n="image/png"),void 0===s&&(s=1),void 0===o&&(o=!1),A("ScreenshotTools")},e.CreateScreenshotUsingRenderTargetAsync=function(e,t,r,i,n,s,o){throw void 0===i&&(i="image/png"),void 0===n&&(n=1),void 0===s&&(s=!1),A("ScreenshotTools")},e.RandomId=function(){return ke()},e.IsBase64=function(e){return De(e)},e.DecodeBase64=function(e){return Oe(e)},Object.defineProperty(e,"errorsCount",{get:function(){return T.errorsCount},enumerable:!1,configurable:!0}),e.Log=function(e){T.Log(e)},e.Warn=function(e){T.Warn(e)},e.Error=function(e){T.Error(e)},Object.defineProperty(e,"LogCache",{get:function(){return T.LogCache},enumerable:!1,configurable:!0}),e.ClearLogCache=function(){T.ClearLogCache()},Object.defineProperty(e,"LogLevels",{set:function(e){T.LogLevels=e},enumerable:!1,configurable:!0}),Object.defineProperty(e,"PerformanceLogLevel",{set:function(t){return(t&e.PerformanceUserMarkLogLevel)===e.PerformanceUserMarkLogLevel?(e.StartPerformanceCounter=e._StartUserMark,void(e.EndPerformanceCounter=e._EndUserMark)):(t&e.PerformanceConsoleLogLevel)===e.PerformanceConsoleLogLevel?(e.StartPerformanceCounter=e._StartPerformanceConsole,void(e.EndPerformanceCounter=e._EndPerformanceConsole)):(e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,void(e.EndPerformanceCounter=e._EndPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),e._StartPerformanceCounterDisabled=function(e,t){},e._EndPerformanceCounterDisabled=function(e,t){},e._StartUserMark=function(t,r){if(void 0===r&&(r=!0),!e._Performance){if(!g())return;e._Performance=window.performance}r&&e._Performance.mark&&e._Performance.mark(t+"-Begin")},e._EndUserMark=function(t,r){void 0===r&&(r=!0),r&&e._Performance.mark&&(e._Performance.mark(t+"-End"),e._Performance.measure(t,t+"-Begin",t+"-End"))},e._StartPerformanceConsole=function(t,r){void 0===r&&(r=!0),r&&(e._StartUserMark(t,r),console.time&&console.time(t))},e._EndPerformanceConsole=function(t,r){void 0===r&&(r=!0),r&&(e._EndUserMark(t,r),console.timeEnd(t))},Object.defineProperty(e,"Now",{get:function(){return E.Now},enumerable:!1,configurable:!0}),e.GetClassName=function(e,t){void 0===t&&(t=!1);var r=null;if(!t&&e.getClassName)r=e.getClassName();else{if(e instanceof Object)r=(t?e:Object.getPrototypeOf(e)).constructor.__bjsclassName__;r||(r=typeof e)}return r},e.First=function(e,t){for(var r=0,i=e;r<i.length;r++){var n=i[r];if(t(n))return n}return null},e.getFullClassName=function(e,t){void 0===t&&(t=!1);var r=null,i=null;if(!t&&e.getClassName)r=e.getClassName();else{if(e instanceof Object){var n=t?e:Object.getPrototypeOf(e);r=n.constructor.__bjsclassName__,i=n.constructor.__bjsmoduleName__}r||(r=typeof e)}return r?(null!=i?i+".":"")+r:null},e.DelayAsync=function(e){return new Promise((function(t){setTimeout((function(){t()}),e)}))},e.IsSafari=function(){return!!m()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},e.UseCustomRequestHeaders=!1,e.CustomRequestHeaders=R.CustomRequestHeaders,e._TmpFloatArray=new Float32Array(1),e.GetDOMTextContent=v,e.GetAbsoluteUrl="object"===typeof document?function(e){var t=document.createElement("a");return t.href=e,t.href}:"function"===typeof URL&&"object"===typeof location?function(e){return new URL(e,location.origin).href}:function(){throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},e.NoneLogLevel=T.NoneLogLevel,e.MessageLogLevel=T.MessageLogLevel,e.WarningLogLevel=T.WarningLogLevel,e.ErrorLogLevel=T.ErrorLogLevel,e.AllLogLevel=T.AllLogLevel,e.IsWindowObjectExist=g,e.PerformanceNoneLogLevel=0,e.PerformanceUserMarkLogLevel=1,e.PerformanceConsoleLogLevel=2,e.StartPerformanceCounter=e._StartPerformanceCounterDisabled,e.EndPerformanceCounter=e._EndPerformanceCounterDisabled,e}();var Ge=function(){function e(e,t,r,i){void 0===i&&(i=0),this.iterations=e,this.index=i-1,this._done=!1,this._fn=t,this._successCallback=r}return e.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},e.prototype.breakLoop=function(){this._done=!0,this._successCallback()},e.Run=function(t,r,i,n){void 0===n&&(n=0);var s=new e(t,r,i,n);return s.executeNext(),s},e.SyncAsyncForLoop=function(t,r,i,n,s,o){return void 0===o&&(o=0),e.Run(Math.ceil(t/r),(function(e){s&&s()?e.breakLoop():setTimeout((function(){for(var n=0;n<r;++n){var o=e.index*r+n;if(o>=t)break;if(i(o),s&&s()){e.breakLoop();break}}e.executeNext()}),o)}),n)},e}();I.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z";var We=function(){function e(){}return e.Eval=function(t,r){return"true"===(t=t.match(/\\([^()]*\\)/g)?t.replace(/\\([^()]*\\)/g,(function(t){return t=t.slice(1,t.length-1),e._HandleParenthesisContent(t,r)})):e._HandleParenthesisContent(t,r))||"false"!==t&&e.Eval(t,r)},e._HandleParenthesisContent=function(t,r){var i;r=r||function(e){return"true"===e};var n=t.split("||");for(var s in n)if(Object.prototype.hasOwnProperty.call(n,s)){var o=e._SimplifyNegation(n[s].trim()),a=o.split("&&");if(a.length>1)for(var u=0;u<a.length;++u){var h=e._SimplifyNegation(a[u].trim());if(!(i="true"!==h&&"false"!==h?"!"===h[0]?!r(h.substring(1)):r(h):"true"===h)){o="false";break}}if(i||"true"===o){i=!0;break}i="true"!==o&&"false"!==o?"!"===o[0]?!r(o.substring(1)):r(o):"true"===o}return i?"true":"false"},e._SimplifyNegation=function(e){return"!true"===(e=(e=e.replace(/^[\\s!]+/,(function(e){return(e=e.replace(/[\\s]/g,(function(){return""}))).length%2?"!":""}))).trim())?e="false":"!false"===e&&(e="true"),e},e}(),ze=function(){function e(){}return e.EnableFor=function(t){t._tags=t._tags||{},t.hasTags=function(){return e.HasTags(t)},t.addTags=function(r){return e.AddTagsTo(t,r)},t.removeTags=function(r){return e.RemoveTagsFrom(t,r)},t.matchesTagsQuery=function(r){return e.MatchesQuery(t,r)}},e.DisableFor=function(e){delete e._tags,delete e.hasTags,delete e.addTags,delete e.removeTags,delete e.matchesTagsQuery},e.HasTags=function(e){if(!e._tags)return!1;var t=e._tags;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))return!0;return!1},e.GetTags=function(e,t){if(void 0===t&&(t=!0),!e._tags)return null;if(t){var r=[];for(var i in e._tags)Object.prototype.hasOwnProperty.call(e._tags,i)&&!0===e._tags[i]&&r.push(i);return r.join(" ")}return e._tags},e.AddTagsTo=function(t,r){r&&("string"===typeof r&&r.split(" ").forEach((function(r){e._AddTagTo(t,r)})))},e._AddTagTo=function(t,r){""!==(r=r.trim())&&"true"!==r&&"false"!==r&&(r.match(/[\\s]/)||r.match(/^([!]|([|]|[&]){2})/)||(e.EnableFor(t),t._tags[r]=!0))},e.RemoveTagsFrom=function(t,r){if(e.HasTags(t)){var i=r.split(" ");for(var n in i)e._RemoveTagFrom(t,i[n])}},e._RemoveTagFrom=function(e,t){delete e._tags[t]},e.MatchesQuery=function(t,r){return void 0===r||(""===r?e.HasTags(t):We.Eval(r,(function(r){return e.HasTags(t)&&t._tags[r]})))},e}();function Ke(e,t,r){try{var i=e.next();i.done?t(i):i.value?i.value.then((function(){i.value=void 0,t(i)}),r):t(i)}catch(n){r(n)}}function je(e,t,r,i,n){!function s(){var o,a=function(e){e.done?r(e.value):void 0===o?o=!0:s()};do{o=void 0,n&&n.aborted?i(new Error("Aborted")):t(e,a,i),void 0===o&&(o=!1)}while(o)}()}function He(e,t){var r;return je(e,Ke,(function(e){return r=e}),(function(e){throw e}),t),r}function Xe(e,t,r){return new Promise((function(i,n){je(e,t,i,n,r)}))}var qe=function(){function e(){}return e.WithinEpsilon=function(e,t,r){return void 0===r&&(r=1401298e-51),Math.abs(e-t)<=r},e.ToHex=function(e){var t=e.toString(16);return e<=15?("0"+t).toUpperCase():t.toUpperCase()},e.Sign=function(e){return 0===(e=+e)||isNaN(e)?e:e>0?1:-1},e.Clamp=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),Math.min(r,Math.max(t,e))},e.Log2=function(e){return Math.log(e)*Math.LOG2E},e.ILog2=function(e){if(Math.log2)return Math.floor(Math.log2(e));if(e<0)return NaN;if(0===e)return-1/0;var t=0;if(e<1){for(;e<1;)t++,e*=2;t=-t}else if(e>1)for(;e>1;)t++,e=Math.floor(e/2);return t},e.Repeat=function(e,t){return e-Math.floor(e/t)*t},e.Normalize=function(e,t,r){return(e-t)/(r-t)},e.Denormalize=function(e,t,r){return e*(r-t)+t},e.DeltaAngle=function(t,r){var i=e.Repeat(r-t,360);return i>180&&(i-=360),i},e.PingPong=function(t,r){var i=e.Repeat(t,2*r);return r-Math.abs(i-r)},e.SmoothStep=function(t,r,i){var n=e.Clamp(i);return r*(n=-2*n*n*n+3*n*n)+t*(1-n)},e.MoveTowards=function(t,r,i){return Math.abs(r-t)<=i?r:t+e.Sign(r-t)*i},e.MoveTowardsAngle=function(t,r,i){var n=e.DeltaAngle(t,r),s=0;return-i<n&&n<i?s=r:(r=t+n,s=e.MoveTowards(t,r,i)),s},e.Lerp=function(e,t,r){return e+(t-e)*r},e.LerpAngle=function(t,r,i){var n=e.Repeat(r-t,360);return n>180&&(n-=360),t+n*e.Clamp(i)},e.InverseLerp=function(t,r,i){return t!=r?e.Clamp((i-t)/(r-t)):0},e.Hermite=function(e,t,r,i,n){var s=n*n,o=n*s;return e*(2*o-3*s+1)+r*(-2*o+3*s)+t*(o-2*s+n)+i*(o-s)},e.Hermite1stDerivative=function(e,t,r,i,n){var s=n*n;return 6*(s-n)*e+(3*s-4*n+1)*t+6*(-s+n)*r+(3*s-2*n)*i},e.RandomRange=function(e,t){return e===t?e:Math.random()*(t-e)+e},e.RangeToPercent=function(e,t,r){return(e-t)/(r-t)},e.PercentToRange=function(e,t,r){return(r-t)*e+t},e.NormalizeRadians=function(t){return t-=e.TwoPi*Math.floor((t+Math.PI)/e.TwoPi)},e.HCF=function(t,r){var i=t%r;return 0===i?r:e.HCF(r,i)},e.TwoPi=2*Math.PI,e}(),Ye=1/2.2,Ze=2.2,Qe=(Math.sqrt(5),.001),Je=function(){function e(){}return e.BuildArray=function(e,t){for(var r=[],i=0;i<e;++i)r.push(t());return r},e.BuildTuple=function(t,r){return e.BuildArray(t,r)},e}(),$e=function(e){return parseInt(e.toString().replace(/\\W/g,""))},et=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y,"}")},e.prototype.getClassName=function(){return"Vector2"},e.prototype.getHashCode=function(){var e=$e(this.x);return e=397*e^$e(this.y)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},e.prototype.copyFromFloats=function(e,t){return this.x=e,this.y=t,this},e.prototype.set=function(e,t){return this.copyFromFloats(e,t)},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},e.prototype.addVector3=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,this},e.prototype.multiplyByFloats=function(t,r){return new e(this.x*t,this.y*r)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},e.prototype.scale=function(t){var r=new e(0,0);return this.scaleToRef(t,r),r},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=Qe),e&&qe.WithinEpsilon(this.x,e.x,t)&&qe.WithinEpsilon(this.y,e.y,t)},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},e.prototype.rotateToRef=function(e,t){var r=Math.cos(e),i=Math.sin(e);return t.x=r*this.x-i*this.y,t.y=i*this.x+r*this.y,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},e.prototype.normalize=function(){return e.NormalizeToRef(this,this),this},e.prototype.clone=function(){return new e(this.x,this.y)},e.Zero=function(){return new e(0,0)},e.One=function(){return new e(1,1)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1])},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1]},e.CatmullRom=function(t,r,i,n,s){var o=s*s,a=s*o;return new e(.5*(2*r.x+(-t.x+i.x)*s+(2*t.x-5*r.x+4*i.x-n.x)*o+(-t.x+3*r.x-3*i.x+n.x)*a),.5*(2*r.y+(-t.y+i.y)*s+(2*t.y-5*r.y+4*i.y-n.y)*o+(-t.y+3*r.y-3*i.y+n.y)*a))},e.Clamp=function(t,r,i){var n=t.x;n=(n=n>i.x?i.x:n)<r.x?r.x:n;var s=t.y;return new e(n,s=(s=s>i.y?i.y:s)<r.y?r.y:s)},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,l=a-o;return new e(t.x*u+i.x*h+r.x*c+n.x*l,t.y*u+i.y*h+r.y*c+n.y*l)},e.Hermite1stDerivative=function(t,r,i,n,s){var o=e.Zero();return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.x=6*(o-n)*e.x+(3*o-4*n+1)*t.x+6*(-o+n)*r.x+(3*o-2*n)*i.x,s.y=6*(o-n)*e.y+(3*o-4*n+1)*t.y+6*(-o+n)*r.y+(3*o-2*n)*i.y},e.Lerp=function(t,r,i){return new e(t.x+(r.x-t.x)*i,t.y+(r.y-t.y)*i)},e.Dot=function(e,t){return e.x*t.x+e.y*t.y},e.Normalize=function(t){var r=e.Zero();return this.NormalizeToRef(t,r),r},e.NormalizeToRef=function(e,t){var r=e.length();0!==r&&(t.x=e.x/r,t.y=e.y/r)},e.Minimize=function(t,r){return new e(t.x<r.x?t.x:r.x,t.y<r.y?t.y:r.y)},e.Maximize=function(t,r){return new e(t.x>r.x?t.x:r.x,t.y>r.y?t.y:r.y)},e.Transform=function(t,r){var i=e.Zero();return e.TransformToRef(t,r,i),i},e.TransformToRef=function(e,t,r){var i=t.m,n=e.x*i[0]+e.y*i[4]+i[12],s=e.x*i[1]+e.y*i[5]+i[13];r.x=n,r.y=s},e.PointInTriangle=function(e,t,r,i){var n=.5*(-r.y*i.x+t.y*(-r.x+i.x)+t.x*(r.y-i.y)+r.x*i.y),s=n<0?-1:1,o=(t.y*i.x-t.x*i.y+(i.y-t.y)*e.x+(t.x-i.x)*e.y)*s,a=(t.x*r.y-t.y*r.x+(t.y-r.y)*e.x+(r.x-t.x)*e.y)*s;return o>0&&a>0&&o+a<2*n*s},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e.x-t.x,i=e.y-t.y;return r*r+i*i},e.Center=function(t,r){return e.CenterToRef(t,r,e.Zero())},e.CenterToRef=function(e,t,r){return r.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2)},e.DistanceOfPointFromSegment=function(t,r,i){var n=e.DistanceSquared(r,i);if(0===n)return e.Distance(t,r);var s=i.subtract(r),o=Math.max(0,Math.min(1,e.Dot(t.subtract(r),s)/n)),a=r.add(s.multiplyByFloats(o,o));return e.Distance(t,a)},e}(),tt=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this._isDirty=!0,this._x=e,this._y=t,this._z=r}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z,"}")},e.prototype.getClassName=function(){return"Vector3"},e.prototype.getHashCode=function(){var e=$e(this._x);return e=397*(e=397*e^$e(this._y))^$e(this._z)},e.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.toQuaternion=function(){return it.RotationYawPitchRoll(this._y,this._x,this._z)},e.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.addInPlaceFromFloats=function(e,t,r){return this.x+=e,this.y+=t,this.z+=r,this},e.prototype.add=function(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z)},e.prototype.addToRef=function(e,t){return t.copyFromFloats(this._x+e._x,this._y+e._y,this._z+e._z)},e.prototype.subtractInPlace=function(e){return this.x-=e._x,this.y-=e._y,this.z-=e._z,this},e.prototype.subtract=function(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z)},e.prototype.subtractToRef=function(e,t){return this.subtractFromFloatsToRef(e._x,e._y,e._z,t)},e.prototype.subtractFromFloats=function(t,r,i){return new e(this._x-t,this._y-r,this._z-i)},e.prototype.subtractFromFloatsToRef=function(e,t,r,i){return i.copyFromFloats(this._x-e,this._y-t,this._z-r)},e.prototype.negate=function(){return new e(-this._x,-this._y,-this._z)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this._x,-1*this._y,-1*this._z)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.prototype.scale=function(t){return new e(this._x*t,this._y*t,this._z*t)},e.prototype.scaleToRef=function(e,t){return t.copyFromFloats(this._x*e,this._y*e,this._z*e)},e.prototype.applyRotationQuaternionToRef=function(e,t){var r=e.w*this.x+e.y*this.z-e.z*this.y,i=e.w*this.y+e.z*this.x-e.x*this.z,n=e.w*this.z+e.x*this.y-e.y*this.x,s=-e.x*this.x-e.y*this.y-e.z*this.z;return t.x=r*e.w+s*-e.x+i*-e.z-n*-e.y,t.y=i*e.w+s*-e.y+n*-e.x-r*-e.z,t.z=n*e.w+s*-e.z+r*-e.y-i*-e.x,t},e.prototype.applyRotationQuaternionInPlace=function(e){return this.applyRotationQuaternionToRef(e,this)},e.prototype.applyRotationQuaternion=function(t){return this.applyRotationQuaternionToRef(t,e.Zero())},e.prototype.scaleAndAddToRef=function(e,t){return t.addInPlaceFromFloats(this._x*e,this._y*e,this._z*e)},e.prototype.projectOnPlane=function(t,r){var i=e.Zero();return this.projectOnPlaneToRef(t,r,i),i},e.prototype.projectOnPlaneToRef=function(t,r,i){var n=st.Vector3[0];t.normal.scaleToRef(-t.d,n);var s=st.Vector3[1];t.normal.negateToRef(s);var o=this,a=o.x,u=o.y,h=o.z,c=e.Dot(s,this);if(c<=1e-6)i.copyFrom(r);else{var l=st.Vector3[2];n.subtractToRef(r,l);var f=e.Dot(l,s)/c;i.set(r.x+a*f,r.y+u*f,r.z+h*f)}},e.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=Qe),e&&qe.WithinEpsilon(this._x,e._x,t)&&qe.WithinEpsilon(this._y,e._y,t)&&qe.WithinEpsilon(this._z,e._z,t)},e.prototype.equalsToFloats=function(e,t,r){return this._x===e&&this._y===t&&this._z===r},e.prototype.multiplyInPlace=function(e){return this.x*=e._x,this.y*=e._y,this.z*=e._z,this},e.prototype.multiply=function(e){return this.multiplyByFloats(e._x,e._y,e._z)},e.prototype.multiplyToRef=function(e,t){return t.copyFromFloats(this._x*e._x,this._y*e._y,this._z*e._z)},e.prototype.multiplyByFloats=function(t,r,i){return new e(this._x*t,this._y*r,this._z*i)},e.prototype.divide=function(t){return new e(this._x/t._x,this._y/t._y,this._z/t._z)},e.prototype.divideToRef=function(e,t){return t.copyFromFloats(this._x/e._x,this._y/e._y,this._z/e._z)},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)},e.prototype.minimizeInPlaceFromFloats=function(e,t,r){return e<this._x&&(this.x=e),t<this._y&&(this.y=t),r<this._z&&(this.z=r),this},e.prototype.maximizeInPlaceFromFloats=function(e,t,r){return e>this._x&&(this.x=e),t>this._y&&(this.y=t),r>this._z&&(this.z=r),this},e.prototype.isNonUniformWithinEpsilon=function(e){var t=Math.abs(this._x),r=Math.abs(this._y);if(!qe.WithinEpsilon(t,r,e))return!0;var i=Math.abs(this._z);return!qe.WithinEpsilon(t,i,e)||!qe.WithinEpsilon(r,i,e)},Object.defineProperty(e.prototype,"isNonUniform",{get:function(){var e=Math.abs(this._x);return e!==Math.abs(this._y)||e!==Math.abs(this._z)},enumerable:!1,configurable:!0}),e.prototype.floor=function(){return new e(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},e.prototype.fract=function(){return new e(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},e.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},e.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},Object.defineProperty(e.prototype,"hasAZeroComponent",{get:function(){return this._x*this._y*this._z===0},enumerable:!1,configurable:!0}),e.prototype.normalize=function(){return this.normalizeFromLength(this.length())},e.prototype.reorderInPlace=function(e){var t=this;return"xyz"===(e=e.toLowerCase())||(st.Vector3[0].copyFrom(this),["x","y","z"].forEach((function(r,i){t[r]=st.Vector3[0][e[i]]}))),this},e.prototype.rotateByQuaternionToRef=function(t,r){return t.toRotationMatrix(st.Matrix[0]),e.TransformCoordinatesToRef(this,st.Matrix[0],r),r},e.prototype.rotateByQuaternionAroundPointToRef=function(e,t,r){return this.subtractToRef(t,st.Vector3[0]),st.Vector3[0].rotateByQuaternionToRef(e,st.Vector3[0]),t.addToRef(st.Vector3[0],r),r},e.prototype.cross=function(t){return e.Cross(this,t)},e.prototype.normalizeFromLength=function(e){return 0===e||1===e?this:this.scaleInPlace(1/e)},e.prototype.normalizeToNew=function(){var t=new e(0,0,0);return this.normalizeToRef(t),t},e.prototype.normalizeToRef=function(e){var t=this.length();return 0===t||1===t?e.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/t,e)},e.prototype.clone=function(){return new e(this._x,this._y,this._z)},e.prototype.copyFrom=function(e){return this.copyFromFloats(e._x,e._y,e._z)},e.prototype.copyFromFloats=function(e,t,r){return this.x=e,this.y=t,this.z=r,this},e.prototype.set=function(e,t,r){return this.copyFromFloats(e,t,r)},e.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},e.GetClipFactor=function(t,r,i,n){var s=e.Dot(t,i)-n;return s/(s-(e.Dot(r,i)-n))},e.GetAngleBetweenVectors=function(t,r,i){var n=t.normalizeToRef(st.Vector3[1]),s=r.normalizeToRef(st.Vector3[2]),o=e.Dot(n,s);o=qe.Clamp(o,-1,1);var a=Math.acos(o),u=st.Vector3[3];return e.CrossToRef(n,s,u),e.Dot(u,i)>0?isNaN(a)?0:a:isNaN(a)?-Math.PI:-Math.acos(o)},e.GetAngleBetweenVectorsOnPlane=function(t,r,i){st.Vector3[0].copyFrom(t);var n=st.Vector3[0];st.Vector3[1].copyFrom(r);var s=st.Vector3[1];st.Vector3[2].copyFrom(i);var o=st.Vector3[2],a=st.Vector3[3],u=st.Vector3[4];n.normalize(),s.normalize(),o.normalize(),e.CrossToRef(o,n,a),e.CrossToRef(a,o,u);var h=Math.atan2(e.Dot(s,a),e.Dot(s,u));return qe.NormalizeRadians(h)},e.SlerpToRef=function(t,r,i,n){i=qe.Clamp(i,0,1);var s=st.Vector3[0],o=st.Vector3[1];s.copyFrom(t);var a=s.length();s.normalizeFromLength(a),o.copyFrom(r);var u=o.length();o.normalizeFromLength(u);var h,c,l=e.Dot(s,o);if(l<.999){var f=Math.acos(l),d=1/Math.sin(f);h=Math.sin((1-i)*f)*d,c=Math.sin(i*f)*d}else h=1-i,c=i;s.scaleInPlace(h),o.scaleInPlace(c),n.copyFrom(s).addInPlace(o),n.scaleInPlace(qe.Lerp(a,u,i))},e.SmoothToRef=function(t,r,i,n,s){e.SlerpToRef(t,r,0===n?1:i/n,s)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2])},e.FromFloatArray=function(t,r){return e.FromArray(t,r)},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2]},e.FromFloatArrayToRef=function(t,r,i){return e.FromArrayToRef(t,r,i)},e.FromFloatsToRef=function(e,t,r,i){i.copyFromFloats(e,t,r)},e.Zero=function(){return new e(0,0,0)},e.One=function(){return new e(1,1,1)},e.Up=function(){return new e(0,1,0)},Object.defineProperty(e,"UpReadOnly",{get:function(){return e._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RightReadOnly",{get:function(){return e._RightReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LeftReadOnly",{get:function(){return e._LeftReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"LeftHandedForwardReadOnly",{get:function(){return e._LeftHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"RightHandedForwardReadOnly",{get:function(){return e._RightHandedForwardReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ZeroReadOnly",{get:function(){return e._ZeroReadOnly},enumerable:!1,configurable:!0}),e.Down=function(){return new e(0,-1,0)},e.Forward=function(t){return void 0===t&&(t=!1),new e(0,0,t?-1:1)},e.Backward=function(t){return void 0===t&&(t=!1),new e(0,0,t?1:-1)},e.Right=function(){return new e(1,0,0)},e.Left=function(){return new e(-1,0,0)},e.TransformCoordinates=function(t,r){var i=e.Zero();return e.TransformCoordinatesToRef(t,r,i),i},e.TransformCoordinatesToRef=function(t,r,i){e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,r,i)},e.TransformCoordinatesFromFloatsToRef=function(e,t,r,i,n){var s=i.m,o=e*s[0]+t*s[4]+r*s[8]+s[12],a=e*s[1]+t*s[5]+r*s[9]+s[13],u=e*s[2]+t*s[6]+r*s[10]+s[14],h=1/(e*s[3]+t*s[7]+r*s[11]+s[15]);n.x=o*h,n.y=a*h,n.z=u*h},e.TransformNormal=function(t,r){var i=e.Zero();return e.TransformNormalToRef(t,r,i),i},e.TransformNormalToRef=function(e,t,r){this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,t,r)},e.TransformNormalFromFloatsToRef=function(e,t,r,i,n){var s=i.m;n.x=e*s[0]+t*s[4]+r*s[8],n.y=e*s[1]+t*s[5]+r*s[9],n.z=e*s[2]+t*s[6]+r*s[10]},e.CatmullRom=function(t,r,i,n,s){var o=s*s,a=s*o;return new e(.5*(2*r._x+(-t._x+i._x)*s+(2*t._x-5*r._x+4*i._x-n._x)*o+(-t._x+3*r._x-3*i._x+n._x)*a),.5*(2*r._y+(-t._y+i._y)*s+(2*t._y-5*r._y+4*i._y-n._y)*o+(-t._y+3*r._y-3*i._y+n._y)*a),.5*(2*r._z+(-t._z+i._z)*s+(2*t._z-5*r._z+4*i._z-n._z)*o+(-t._z+3*r._z-3*i._z+n._z)*a))},e.Clamp=function(t,r,i){var n=new e;return e.ClampToRef(t,r,i,n),n},e.ClampToRef=function(e,t,r,i){var n=e._x;n=(n=n>r._x?r._x:n)<t._x?t._x:n;var s=e._y;s=(s=s>r._y?r._y:s)<t._y?t._y:s;var o=e._z;o=(o=o>r._z?r._z:o)<t._z?t._z:o,i.copyFromFloats(n,s,o)},e.CheckExtends=function(e,t,r){t.minimizeInPlace(e),r.maximizeInPlace(e)},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,l=a-o;return new e(t._x*u+i._x*h+r._x*c+n._x*l,t._y*u+i._y*h+r._y*c+n._y*l,t._z*u+i._z*h+r._z*c+n._z*l)},e.Hermite1stDerivative=function(t,r,i,n,s){var o=e.Zero();return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.x=6*(o-n)*e.x+(3*o-4*n+1)*t.x+6*(-o+n)*r.x+(3*o-2*n)*i.x,s.y=6*(o-n)*e.y+(3*o-4*n+1)*t.y+6*(-o+n)*r.y+(3*o-2*n)*i.y,s.z=6*(o-n)*e.z+(3*o-4*n+1)*t.z+6*(-o+n)*r.z+(3*o-2*n)*i.z},e.Lerp=function(t,r,i){var n=new e(0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.x=e._x+(t._x-e._x)*r,i.y=e._y+(t._y-e._y)*r,i.z=e._z+(t._z-e._z)*r},e.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z},e.Cross=function(t,r){var i=e.Zero();return e.CrossToRef(t,r,i),i},e.CrossToRef=function(e,t,r){var i=e._y*t._z-e._z*t._y,n=e._z*t._x-e._x*t._z,s=e._x*t._y-e._y*t._x;r.copyFromFloats(i,n,s)},e.Normalize=function(t){var r=e.Zero();return e.NormalizeToRef(t,r),r},e.NormalizeToRef=function(e,t){e.normalizeToRef(t)},e.Project=function(t,r,i,n){var s=new e;return e.ProjectToRef(t,r,i,n,s),s},e.ProjectToRef=function(t,r,i,n,s){var o=n.width,a=n.height,u=n.x,h=n.y,c=st.Matrix[1];nt.FromValuesToRef(o/2,0,0,0,0,-a/2,0,0,0,0,.5,0,u+o/2,a/2+h,.5,1,c);var l=st.Matrix[0];return r.multiplyToRef(i,l),l.multiplyToRef(c,l),e.TransformCoordinatesToRef(t,l,s),s},e._UnprojectFromInvertedMatrixToRef=function(t,r,i){e.TransformCoordinatesToRef(t,r,i);var n=r.m,s=t._x*n[3]+t._y*n[7]+t._z*n[11]+n[15];qe.WithinEpsilon(s,1)&&i.scaleInPlace(1/s)},e.UnprojectFromTransform=function(e,t,r,i,n){return this.Unproject(e,t,r,i,n,nt.IdentityReadOnly)},e.Unproject=function(t,r,i,n,s,o){var a=e.Zero();return e.UnprojectToRef(t,r,i,n,s,o,a),a},e.UnprojectToRef=function(t,r,i,n,s,o,a){e.UnprojectFloatsToRef(t._x,t._y,t._z,r,i,n,s,o,a)},e.UnprojectFloatsToRef=function(t,r,i,n,s,o,a,u,h){var c,l=st.Matrix[0];o.multiplyToRef(a,l),l.multiplyToRef(u,l),l.invert();var f=st.Vector3[0];f.x=t/n*2-1,f.y=-(r/s*2-1),(null===(c=I.LastCreatedEngine)||void 0===c?void 0:c.isNDCHalfZRange)?f.z=i:f.z=2*i-1,e._UnprojectFromInvertedMatrixToRef(f,l,h)},e.Minimize=function(e,t){var r=e.clone();return r.minimizeInPlace(t),r},e.Maximize=function(e,t){var r=e.clone();return r.maximizeInPlace(t),r},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e._x-t._x,i=e._y-t._y,n=e._z-t._z;return r*r+i*i+n*n},e.ProjectOnTriangleToRef=function(t,r,i,n,s){var o=st.Vector3[0],a=st.Vector3[1],u=st.Vector3[2],h=st.Vector3[3],c=st.Vector3[4];i.subtractToRef(r,o),n.subtractToRef(r,a),n.subtractToRef(i,u);var l=o.length(),f=a.length(),d=u.length();if(l<Qe||f<Qe||d<Qe)return s.copyFrom(r),e.Distance(t,r);t.subtractToRef(r,c),e.CrossToRef(o,a,h);var p=h.length();if(p<Qe)return s.copyFrom(r),e.Distance(t,r);h.normalizeFromLength(p);var _=c.length();if(_<Qe)return s.copyFrom(r),0;c.normalizeFromLength(_);var g=e.Dot(h,c),m=st.Vector3[5],y=st.Vector3[6];m.copyFrom(h).scaleInPlace(-_*g),y.copyFrom(t).addInPlace(m);var v=st.Vector3[4],b=st.Vector3[5],T=st.Vector3[7],M=st.Vector3[8];v.copyFrom(o).scaleInPlace(1/l),M.copyFrom(a).scaleInPlace(1/f),v.addInPlace(M).scaleInPlace(-1),b.copyFrom(o).scaleInPlace(-1/l),M.copyFrom(u).scaleInPlace(1/d),b.addInPlace(M).scaleInPlace(-1),T.copyFrom(u).scaleInPlace(-1/d),M.copyFrom(a).scaleInPlace(-1/f),T.addInPlace(M).scaleInPlace(-1);var x=st.Vector3[9];x.copyFrom(y).subtractInPlace(r),e.CrossToRef(v,x,M);var E=e.Dot(M,h);x.copyFrom(y).subtractInPlace(i),e.CrossToRef(b,x,M);var A=e.Dot(M,h);x.copyFrom(y).subtractInPlace(n),e.CrossToRef(T,x,M);var P,R,I=e.Dot(M,h),S=st.Vector3[10];E>0&&A<0?(S.copyFrom(o),P=r,R=i):A>0&&I<0?(S.copyFrom(u),P=i,R=n):(S.copyFrom(a).scaleInPlace(-1),P=n,R=r);var C=st.Vector3[9],D=st.Vector3[4];if(P.subtractToRef(y,M),R.subtractToRef(y,C),e.CrossToRef(M,C,D),!(e.Dot(D,h)<0))return s.copyFrom(y),Math.abs(_*g);var O=st.Vector3[5];e.CrossToRef(S,D,O),O.normalize();var F=st.Vector3[9];F.copyFrom(P).subtractInPlace(y);var w=F.length();if(w<Qe)return s.copyFrom(P),e.Distance(t,P);F.normalizeFromLength(w);var B=e.Dot(O,F),L=st.Vector3[7];L.copyFrom(y).addInPlace(O.scaleInPlace(w*B)),M.copyFrom(L).subtractInPlace(P),_=S.length(),S.normalizeFromLength(_);var N=e.Dot(M,S)/Math.max(_,Qe);return N=qe.Clamp(N,0,1),L.copyFrom(P).addInPlace(S.scaleInPlace(N*_)),s.copyFrom(L),e.Distance(t,L)},e.Center=function(t,r){return e.CenterToRef(t,r,e.Zero())},e.CenterToRef=function(e,t,r){return r.copyFromFloats((e._x+t._x)/2,(e._y+t._y)/2,(e._z+t._z)/2)},e.RotationFromAxis=function(t,r,i){var n=e.Zero();return e.RotationFromAxisToRef(t,r,i,n),n},e.RotationFromAxisToRef=function(e,t,r,i){var n=st.Quaternion[0];it.RotationQuaternionFromAxisToRef(e,t,r,n),n.toEulerAnglesToRef(i)},e._UpReadOnly=e.Up(),e._LeftHandedForwardReadOnly=e.Forward(!1),e._RightHandedForwardReadOnly=e.Forward(!0),e._RightReadOnly=e.Right(),e._LeftReadOnly=e.Left(),e._ZeroReadOnly=e.Zero(),e}(),rt=function(){function e(e,t,r,i){this.x=e,this.y=t,this.z=r,this.w=i}return e.prototype.toString=function(){return"{X: ".concat(this.x," Y: ").concat(this.y," Z: ").concat(this.z," W: ").concat(this.w,"}")},e.prototype.getClassName=function(){return"Vector4"},e.prototype.getHashCode=function(){var e=$e(this.x);return e=397*(e=397*(e=397*e^$e(this.y))^$e(this.z))^$e(this.w)},e.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)},e.prototype.addToRef=function(e,t){return t.x=this.x+e.x,t.y=this.y+e.y,t.z=this.z+e.z,t.w=this.w+e.w,this},e.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)},e.prototype.subtractToRef=function(e,t){return t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z,t.w=this.w-e.w,this},e.prototype.subtractFromFloats=function(t,r,i,n){return new e(this.x-t,this.y-r,this.z-i,this.w-n)},e.prototype.subtractFromFloatsToRef=function(e,t,r,i,n){return n.x=this.x-e,n.y=this.y-t,n.z=this.z-r,n.w=this.w-i,this},e.prototype.negate=function(){return new e(-this.x,-this.y,-this.z,-this.w)},e.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},e.prototype.negateToRef=function(e){return e.copyFromFloats(-1*this.x,-1*this.y,-1*this.z,-1*this.w)},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scale=function(t){return new e(this.x*t,this.y*t,this.z*t,this.w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this.x*e,t.y=this.y*e,t.z=this.z*e,t.w=this.w*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this.x*e,t.y+=this.y*e,t.z+=this.z*e,t.w+=this.w*e,this},e.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=Qe),e&&qe.WithinEpsilon(this.x,e.x,t)&&qe.WithinEpsilon(this.y,e.y,t)&&qe.WithinEpsilon(this.z,e.z,t)&&qe.WithinEpsilon(this.w,e.w,t)},e.prototype.equalsToFloats=function(e,t,r,i){return this.x===e&&this.y===t&&this.z===r&&this.w===i},e.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w)},e.prototype.multiplyToRef=function(e,t){return t.x=this.x*e.x,t.y=this.y*e.y,t.z=this.z*e.z,t.w=this.w*e.w,this},e.prototype.multiplyByFloats=function(t,r,i,n){return new e(this.x*t,this.y*r,this.z*i,this.w*n)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w)},e.prototype.divideToRef=function(e,t){return t.x=this.x/e.x,t.y=this.y/e.y,t.z=this.z/e.z,t.w=this.w/e.w,this},e.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},e.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},e.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},e.prototype.fract=function(){return new e(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.prototype.normalize=function(){var e=this.length();return 0===e?this:this.scaleInPlace(1/e)},e.prototype.toVector3=function(){return new tt(this.x,this.y,this.z)},e.prototype.clone=function(){return new e(this.x,this.y,this.z,this.w)},e.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},e.FromArray=function(t,r){return r||(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.w=e[t+3]},e.FromFloatArrayToRef=function(t,r,i){e.FromArrayToRef(t,r,i)},e.FromFloatsToRef=function(e,t,r,i,n){n.x=e,n.y=t,n.z=r,n.w=i},e.Zero=function(){return new e(0,0,0,0)},e.One=function(){return new e(1,1,1,1)},e.Normalize=function(t){var r=e.Zero();return e.NormalizeToRef(t,r),r},e.NormalizeToRef=function(e,t){t.copyFrom(e),t.normalize()},e.Minimize=function(e,t){var r=e.clone();return r.minimizeInPlace(t),r},e.Maximize=function(e,t){var r=e.clone();return r.maximizeInPlace(t),r},e.Distance=function(t,r){return Math.sqrt(e.DistanceSquared(t,r))},e.DistanceSquared=function(e,t){var r=e.x-t.x,i=e.y-t.y,n=e.z-t.z,s=e.w-t.w;return r*r+i*i+n*n+s*s},e.Center=function(t,r){return e.CenterToRef(t,r,e.Zero())},e.CenterToRef=function(e,t,r){return r.copyFromFloats((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2,(e.w+t.w)/2)},e.TransformCoordinates=function(t,r){var i=e.Zero();return e.TransformCoordinatesToRef(t,r,i),i},e.TransformCoordinatesToRef=function(t,r,i){e.TransformCoordinatesFromFloatsToRef(t._x,t._y,t._z,r,i)},e.TransformCoordinatesFromFloatsToRef=function(e,t,r,i,n){var s=i.m,o=e*s[0]+t*s[4]+r*s[8]+s[12],a=e*s[1]+t*s[5]+r*s[9]+s[13],u=e*s[2]+t*s[6]+r*s[10]+s[14],h=e*s[3]+t*s[7]+r*s[11]+s[15];n.x=o,n.y=a,n.z=u,n.w=h},e.TransformNormal=function(t,r){var i=e.Zero();return e.TransformNormalToRef(t,r,i),i},e.TransformNormalToRef=function(e,t,r){var i=t.m,n=e.x*i[0]+e.y*i[4]+e.z*i[8],s=e.x*i[1]+e.y*i[5]+e.z*i[9],o=e.x*i[2]+e.y*i[6]+e.z*i[10];r.x=n,r.y=s,r.z=o,r.w=e.w},e.TransformNormalFromFloatsToRef=function(e,t,r,i,n,s){var o=n.m;s.x=e*o[0]+t*o[4]+r*o[8],s.y=e*o[1]+t*o[5]+r*o[9],s.z=e*o[2]+t*o[6]+r*o[10],s.w=i},e.FromVector3=function(t,r){return void 0===r&&(r=0),new e(t._x,t._y,t._z,r)},e}(),it=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=1),this._isDirty=!0,this._x=e,this._y=t,this._z=r,this._w=i}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"w",{get:function(){return this._w},set:function(e){this._w=e,this._isDirty=!0},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return"{X: ".concat(this._x," Y: ").concat(this._y," Z: ").concat(this._z," W: ").concat(this._w,"}")},e.prototype.getClassName=function(){return"Quaternion"},e.prototype.getHashCode=function(){var e=$e(this._x);return e=397*(e=397*(e=397*e^$e(this._y))^$e(this._z))^$e(this._w)},e.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,this},e.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=Qe),e&&qe.WithinEpsilon(this._x,e._x,t)&&qe.WithinEpsilon(this._y,e._y,t)&&qe.WithinEpsilon(this._z,e._z,t)&&qe.WithinEpsilon(this._w,e._w,t)},e.prototype.clone=function(){return new e(this._x,this._y,this._z,this._w)},e.prototype.copyFrom=function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this.w=e._w,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.add=function(t){return new e(this._x+t._x,this._y+t._y,this._z+t._z,this._w+t._w)},e.prototype.addInPlace=function(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this},e.prototype.subtract=function(t){return new e(this._x-t._x,this._y-t._y,this._z-t._z,this._w-t._w)},e.prototype.subtractInPlace=function(e){return this._x-=e._x,this._y-=e._y,this._z-=e._z,this._w-=e._w,this},e.prototype.scale=function(t){return new e(this._x*t,this._y*t,this._z*t,this._w*t)},e.prototype.scaleToRef=function(e,t){return t.x=this._x*e,t.y=this._y*e,t.z=this._z*e,t.w=this._w*e,this},e.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.x+=this._x*e,t.y+=this._y*e,t.z+=this._z*e,t.w+=this._w*e,this},e.prototype.multiply=function(t){var r=new e(0,0,0,1);return this.multiplyToRef(t,r),r},e.prototype.multiplyToRef=function(e,t){var r=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,i=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,n=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,s=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return t.copyFromFloats(r,i,n,s),this},e.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},e.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},e.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},e.prototype.conjugate=function(){return new e(-this._x,-this._y,-this._z,this._w)},e.prototype.invert=function(){var e=this.conjugate(),t=this.lengthSquared();return 0==t||1==t||e.scaleInPlace(1/t),e},e.prototype.invertInPlace=function(){this.conjugateInPlace();var e=this.lengthSquared();return 0==e||1==e||this.scaleInPlace(1/e),this},e.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},e.prototype.length=function(){return Math.sqrt(this.lengthSquared())},e.prototype.normalize=function(){var e=this.length();if(0===e)return this;var t=1/e;return this.scaleInPlace(t),this},e.prototype.normalizeToNew=function(){var e=this.length();if(0===e)return this.clone();var t=1/e;return this.scale(t)},e.prototype.toEulerAngles=function(){var e=tt.Zero();return this.toEulerAnglesToRef(e),e},e.prototype.toEulerAnglesToRef=function(e){var t=this._z,r=this._x,i=this._y,n=this._w,s=i*t-r*n,o=.4999999;if(s<-o)e.y=2*Math.atan2(i,n),e.x=Math.PI/2,e.z=0;else if(s>o)e.y=2*Math.atan2(i,n),e.x=-Math.PI/2,e.z=0;else{var a=n*n,u=t*t,h=r*r,c=i*i;e.z=Math.atan2(2*(r*i+t*n),-u-h+c+a),e.x=Math.asin(-2*s),e.y=Math.atan2(2*(t*r+i*n),u-h-c+a)}return this},e.prototype.toRotationMatrix=function(e){return nt.FromQuaternionToRef(this,e),this},e.prototype.fromRotationMatrix=function(t){return e.FromRotationMatrixToRef(t,this),this},e.FromRotationMatrix=function(t){var r=new e;return e.FromRotationMatrixToRef(t,r),r},e.FromRotationMatrixToRef=function(e,t){var r,i=e.m,n=i[0],s=i[4],o=i[8],a=i[1],u=i[5],h=i[9],c=i[2],l=i[6],f=i[10],d=n+u+f;d>0?(r=.5/Math.sqrt(d+1),t.w=.25/r,t.x=(l-h)*r,t.y=(o-c)*r,t.z=(a-s)*r):n>u&&n>f?(r=2*Math.sqrt(1+n-u-f),t.w=(l-h)/r,t.x=.25*r,t.y=(s+a)/r,t.z=(o+c)/r):u>f?(r=2*Math.sqrt(1+u-n-f),t.w=(o-c)/r,t.x=(s+a)/r,t.y=.25*r,t.z=(h+l)/r):(r=2*Math.sqrt(1+f-n-u),t.w=(a-s)/r,t.x=(o+c)/r,t.y=(h+l)/r,t.z=.25*r)},e.Dot=function(e,t){return e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w},e.AreClose=function(t,r){return e.Dot(t,r)>=0},e.SmoothToRef=function(t,r,i,n,s){var o=0===n?1:i/n;o=qe.Clamp(o,0,1),e.SlerpToRef(t,r,o,s)},e.Zero=function(){return new e(0,0,0,0)},e.Inverse=function(t){return new e(-t._x,-t._y,-t._z,t._w)},e.InverseToRef=function(e,t){return t.set(-e._x,-e._y,-e._z,e._w),t},e.Identity=function(){return new e(0,0,0,1)},e.IsIdentity=function(e){return e&&0===e._x&&0===e._y&&0===e._z&&1===e._w},e.RotationAxis=function(t,r){return e.RotationAxisToRef(t,r,new e)},e.RotationAxisToRef=function(e,t,r){var i=Math.sin(t/2);return e.normalize(),r.w=Math.cos(t/2),r.x=e._x*i,r.y=e._y*i,r.z=e._z*i,r},e.FromArray=function(t,r){return r||(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromArrayToRef=function(e,t,r){r.x=e[t],r.y=e[t+1],r.z=e[t+2],r.w=e[t+3]},e.FromEulerAngles=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(r,t,i,n),n},e.FromEulerAnglesToRef=function(t,r,i,n){return e.RotationYawPitchRollToRef(r,t,i,n),n},e.FromEulerVector=function(t){var r=new e;return e.RotationYawPitchRollToRef(t._y,t._x,t._z,r),r},e.FromEulerVectorToRef=function(t,r){return e.RotationYawPitchRollToRef(t._y,t._x,t._z,r),r},e.FromUnitVectorsToRef=function(e,t,r){var i=tt.Dot(e,t)+1;return i<Qe?Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0,0):r.set(0,-e.z,e.y,0):(tt.CrossToRef(e,t,ot.Vector3[0]),r.set(ot.Vector3[0].x,ot.Vector3[0].y,ot.Vector3[0].z,i)),r.normalize()},e.RotationYawPitchRoll=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(t,r,i,n),n},e.RotationYawPitchRollToRef=function(e,t,r,i){var n=.5*r,s=.5*t,o=.5*e,a=Math.sin(n),u=Math.cos(n),h=Math.sin(s),c=Math.cos(s),l=Math.sin(o),f=Math.cos(o);i.x=f*h*u+l*c*a,i.y=l*c*u-f*h*a,i.z=f*c*a-l*h*u,i.w=f*c*u+l*h*a},e.RotationAlphaBetaGamma=function(t,r,i){var n=new e;return e.RotationAlphaBetaGammaToRef(t,r,i,n),n},e.RotationAlphaBetaGammaToRef=function(e,t,r,i){var n=.5*(r+e),s=.5*(r-e),o=.5*t;i.x=Math.cos(s)*Math.sin(o),i.y=Math.sin(s)*Math.sin(o),i.z=Math.sin(n)*Math.cos(o),i.w=Math.cos(n)*Math.cos(o)},e.RotationQuaternionFromAxis=function(t,r,i){var n=new e(0,0,0,0);return e.RotationQuaternionFromAxisToRef(t,r,i,n),n},e.RotationQuaternionFromAxisToRef=function(t,r,i,n){var s=st.Matrix[0];nt.FromXYZAxesToRef(t.normalize(),r.normalize(),i.normalize(),s),e.FromRotationMatrixToRef(s,n)},e.FromLookDirectionLH=function(t,r){var i=new e;return e.FromLookDirectionLHToRef(t,r,i),i},e.FromLookDirectionLHToRef=function(t,r,i){var n=st.Matrix[0];nt.LookDirectionLHToRef(t,r,n),e.FromRotationMatrixToRef(n,i)},e.FromLookDirectionRH=function(t,r){var i=new e;return e.FromLookDirectionRHToRef(t,r,i),i},e.FromLookDirectionRHToRef=function(t,r,i){var n=st.Matrix[0];return nt.LookDirectionRHToRef(t,r,n),e.FromRotationMatrixToRef(n,i)},e.Slerp=function(t,r,i){var n=e.Identity();return e.SlerpToRef(t,r,i,n),n},e.SlerpToRef=function(e,t,r,i){var n,s,o=e._x*t._x+e._y*t._y+e._z*t._z+e._w*t._w,a=!1;if(o<0&&(a=!0,o=-o),o>.999999)s=1-r,n=a?-r:r;else{var u=Math.acos(o),h=1/Math.sin(u);s=Math.sin((1-r)*u)*h,n=a?-Math.sin(r*u)*h:Math.sin(r*u)*h}i.x=s*e._x+n*t._x,i.y=s*e._y+n*t._y,i.z=s*e._z+n*t._z,i.w=s*e._w+n*t._w},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,l=a-o;return new e(t._x*u+i._x*h+r._x*c+n._x*l,t._y*u+i._y*h+r._y*c+n._y*l,t._z*u+i._z*h+r._z*c+n._z*l,t._w*u+i._w*h+r._w*c+n._w*l)},e.Hermite1stDerivative=function(t,r,i,n,s){var o=e.Zero();return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.x=6*(o-n)*e.x+(3*o-4*n+1)*t.x+6*(-o+n)*r.x+(3*o-2*n)*i.x,s.y=6*(o-n)*e.y+(3*o-4*n+1)*t.y+6*(-o+n)*r.y+(3*o-2*n)*i.y,s.z=6*(o-n)*e.z+(3*o-4*n+1)*t.z+6*(-o+n)*r.z+(3*o-2*n)*i.z,s.w=6*(o-n)*e.w+(3*o-4*n+1)*t.w+6*(-o+n)*r.w+(3*o-2*n)*i.w},e}(),nt=function(){function e(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,fe.MatrixTrackPrecisionChange&&fe.MatrixTrackedMatrices.push(this),this._m=new fe.MatrixCurrentType(16),this.markAsUpdated()}return Object.defineProperty(e,"Use64Bits",{get:function(){return fe.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),e.prototype.markAsUpdated=function(){this.updateFlag=e._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},e.prototype._updateIdentityStatus=function(e,t,r,i){void 0===t&&(t=!1),void 0===r&&(r=!1),void 0===i&&(i=!0),this._isIdentity=e,this._isIdentity3x2=e||r,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&i},e.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]}return this._isIdentity},e.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this._m[0]||1!==this._m[5]||1!==this._m[15]||0!==this._m[1]||0!==this._m[2]||0!==this._m[3]||0!==this._m[4]||0!==this._m[6]||0!==this._m[7]||0!==this._m[8]||0!==this._m[9]||0!==this._m[10]||0!==this._m[11]||0!==this._m[12]||0!==this._m[13]||0!==this._m[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},e.prototype.determinant=function(){if(!0===this._isIdentity)return 1;var e=this._m,t=e[0],r=e[1],i=e[2],n=e[3],s=e[4],o=e[5],a=e[6],u=e[7],h=e[8],c=e[9],l=e[10],f=e[11],d=e[12],p=e[13],_=e[14],g=e[15],m=l*g-_*f,y=c*g-p*f,v=c*_-p*l,b=h*g-d*f,T=h*_-l*d,M=h*p-d*c;return t*+(o*m-a*y+u*v)+r*-(s*m-a*b+u*T)+i*+(s*y-o*b+u*M)+n*-(s*v-o*T+a*M)},e.prototype.toArray=function(){return this._m},e.prototype.asArray=function(){return this._m},e.prototype.invert=function(){return this.invertToRef(this),this},e.prototype.reset=function(){return e.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},e.prototype.add=function(t){var r=new e;return this.addToRef(t,r),r},e.prototype.addToRef=function(e,t){for(var r=this._m,i=t._m,n=e.m,s=0;s<16;s++)i[s]=r[s]+n[s];return t.markAsUpdated(),this},e.prototype.addToSelf=function(e){for(var t=this._m,r=e.m,i=0;i<16;i++)t[i]+=r[i];return this.markAsUpdated(),this},e.prototype.invertToRef=function(t){if(!0===this._isIdentity)return e.IdentityToRef(t),this;var r=this._m,i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],u=r[5],h=r[6],c=r[7],l=r[8],f=r[9],d=r[10],p=r[11],_=r[12],g=r[13],m=r[14],y=r[15],v=d*y-m*p,b=f*y-g*p,T=f*m-g*d,M=l*y-_*p,x=l*m-d*_,E=l*g-_*f,A=+(u*v-h*b+c*T),P=-(a*v-h*M+c*x),R=+(a*b-u*M+c*E),I=-(a*T-u*x+h*E),S=i*A+n*P+s*R+o*I;if(0===S)return t.copyFrom(this),this;var C=1/S,D=h*y-m*c,O=u*y-g*c,F=u*m-g*h,w=a*y-_*c,B=a*m-_*h,L=a*g-_*u,N=h*p-d*c,U=u*p-f*c,k=u*d-f*h,V=a*p-l*c,G=a*d-l*h,W=a*f-l*u,z=-(n*v-s*b+o*T),K=+(i*v-s*M+o*x),j=-(i*b-n*M+o*E),H=+(i*T-n*x+s*E),X=+(n*D-s*O+o*F),q=-(i*D-s*w+o*B),Y=+(i*O-n*w+o*L),Z=-(i*F-n*B+s*L),Q=-(n*N-s*U+o*k),J=+(i*N-s*V+o*G),$=-(i*U-n*V+o*W),ee=+(i*k-n*G+s*W);return e.FromValuesToRef(A*C,z*C,X*C,Q*C,P*C,K*C,q*C,J*C,R*C,j*C,Y*C,$*C,I*C,H*C,Z*C,ee*C,t),this},e.prototype.addAtIndex=function(e,t){return this._m[e]+=t,this.markAsUpdated(),this},e.prototype.multiplyAtIndex=function(e,t){return this._m[e]*=t,this.markAsUpdated(),this},e.prototype.setTranslationFromFloats=function(e,t,r){return this._m[12]=e,this._m[13]=t,this._m[14]=r,this.markAsUpdated(),this},e.prototype.addTranslationFromFloats=function(e,t,r){return this._m[12]+=e,this._m[13]+=t,this._m[14]+=r,this.markAsUpdated(),this},e.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e._x,e._y,e._z)},e.prototype.getTranslation=function(){return new tt(this._m[12],this._m[13],this._m[14])},e.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},e.prototype.removeRotationAndScaling=function(){var t=this.m;return e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t[12],t[13],t[14],t[15],this),this._updateIdentityStatus(0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]),this},e.prototype.multiply=function(t){var r=new e;return this.multiplyToRef(t,r),r},e.prototype.copyFrom=function(e){e.copyToArray(this._m);var t=e;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this},e.prototype.copyToArray=function(e,t){void 0===t&&(t=0);var r=this._m;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],this},e.prototype.multiplyToRef=function(e,t){return this._isIdentity?(t.copyFrom(e),this):e._isIdentity?(t.copyFrom(this),this):(this.multiplyToArray(e,t._m,0),t.markAsUpdated(),this)},e.prototype.multiplyToArray=function(e,t,r){var i=this._m,n=e.m,s=i[0],o=i[1],a=i[2],u=i[3],h=i[4],c=i[5],l=i[6],f=i[7],d=i[8],p=i[9],_=i[10],g=i[11],m=i[12],y=i[13],v=i[14],b=i[15],T=n[0],M=n[1],x=n[2],E=n[3],A=n[4],P=n[5],R=n[6],I=n[7],S=n[8],C=n[9],D=n[10],O=n[11],F=n[12],w=n[13],B=n[14],L=n[15];return t[r]=s*T+o*A+a*S+u*F,t[r+1]=s*M+o*P+a*C+u*w,t[r+2]=s*x+o*R+a*D+u*B,t[r+3]=s*E+o*I+a*O+u*L,t[r+4]=h*T+c*A+l*S+f*F,t[r+5]=h*M+c*P+l*C+f*w,t[r+6]=h*x+c*R+l*D+f*B,t[r+7]=h*E+c*I+l*O+f*L,t[r+8]=d*T+p*A+_*S+g*F,t[r+9]=d*M+p*P+_*C+g*w,t[r+10]=d*x+p*R+_*D+g*B,t[r+11]=d*E+p*I+_*O+g*L,t[r+12]=m*T+y*A+v*S+b*F,t[r+13]=m*M+y*P+v*C+b*w,t[r+14]=m*x+y*R+v*D+b*B,t[r+15]=m*E+y*I+v*O+b*L,this},e.prototype.equals=function(e){var t=e;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;var r=this.m,i=t.m;return r[0]===i[0]&&r[1]===i[1]&&r[2]===i[2]&&r[3]===i[3]&&r[4]===i[4]&&r[5]===i[5]&&r[6]===i[6]&&r[7]===i[7]&&r[8]===i[8]&&r[9]===i[9]&&r[10]===i[10]&&r[11]===i[11]&&r[12]===i[12]&&r[13]===i[13]&&r[14]===i[14]&&r[15]===i[15]},e.prototype.clone=function(){var t=new e;return t.copyFrom(this),t},e.prototype.getClassName=function(){return"Matrix"},e.prototype.getHashCode=function(){for(var e=$e(this._m[0]),t=1;t<16;t++)e=397*e^$e(this._m[t]);return e},e.prototype.decomposeToTransformNode=function(e){return e.rotationQuaternion=e.rotationQuaternion||new it,this.decompose(e.scaling,e.rotationQuaternion,e.position)},e.prototype.decompose=function(t,r,i,n){if(this._isIdentity)return i&&i.setAll(0),t&&t.setAll(1),r&&r.copyFromFloats(0,0,0,1),!0;var s=this._m;if(i&&i.copyFromFloats(s[12],s[13],s[14]),(t=t||st.Vector3[0]).x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),t.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),t.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),n){var o=n.scaling.x<0?-1:1,a=n.scaling.y<0?-1:1,u=n.scaling.z<0?-1:1;t.x*=o,t.y*=a,t.z*=u}else this.determinant()<=0&&(t.y*=-1);if(0===t._x||0===t._y||0===t._z)return r&&r.copyFromFloats(0,0,0,1),!1;if(r){var h=1/t._x,c=1/t._y,l=1/t._z;e.FromValuesToRef(s[0]*h,s[1]*h,s[2]*h,0,s[4]*c,s[5]*c,s[6]*c,0,s[8]*l,s[9]*l,s[10]*l,0,0,0,0,1,st.Matrix[0]),it.FromRotationMatrixToRef(st.Matrix[0],r)}return!0},e.prototype.getRow=function(e){if(e<0||e>3)return null;var t=4*e;return new rt(this._m[t+0],this._m[t+1],this._m[t+2],this._m[t+3])},e.prototype.setRow=function(e,t){return this.setRowFromFloats(e,t.x,t.y,t.z,t.w)},e.prototype.transpose=function(){return e.Transpose(this)},e.prototype.transposeToRef=function(t){return e.TransposeToRef(this,t),this},e.prototype.setRowFromFloats=function(e,t,r,i,n){if(e<0||e>3)return this;var s=4*e;return this._m[s+0]=t,this._m[s+1]=r,this._m[s+2]=i,this._m[s+3]=n,this.markAsUpdated(),this},e.prototype.scale=function(t){var r=new e;return this.scaleToRef(t,r),r},e.prototype.scaleToRef=function(e,t){for(var r=0;r<16;r++)t._m[r]=this._m[r]*e;return t.markAsUpdated(),this},e.prototype.scaleAndAddToRef=function(e,t){for(var r=0;r<16;r++)t._m[r]+=this._m[r]*e;return t.markAsUpdated(),this},e.prototype.toNormalMatrix=function(t){var r=st.Matrix[0];this.invertToRef(r),r.transposeToRef(t);var i=t._m;e.FromValuesToRef(i[0],i[1],i[2],0,i[4],i[5],i[6],0,i[8],i[9],i[10],0,0,0,0,1,t)},e.prototype.getRotationMatrix=function(){var t=new e;return this.getRotationMatrixToRef(t),t},e.prototype.getRotationMatrixToRef=function(t){var r=st.Vector3[0];if(!this.decompose(r))return e.IdentityToRef(t),this;var i=this._m,n=1/r._x,s=1/r._y,o=1/r._z;return e.FromValuesToRef(i[0]*n,i[1]*n,i[2]*n,0,i[4]*s,i[5]*s,i[6]*s,0,i[8]*o,i[9]*o,i[10]*o,0,0,0,0,1,t),this},e.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this.markAsUpdated()},e.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this.markAsUpdated()},e.FromArray=function(t,r){void 0===r&&(r=0);var i=new e;return e.FromArrayToRef(t,r,i),i},e.FromArrayToRef=function(e,t,r){for(var i=0;i<16;i++)r._m[i]=e[i+t];r.markAsUpdated()},e.FromFloat32ArrayToRefScaled=function(e,t,r,i){for(var n=0;n<16;n++)i._m[n]=e[n+t]*r;i.markAsUpdated()},Object.defineProperty(e,"IdentityReadOnly",{get:function(){return e._IdentityReadOnly},enumerable:!1,configurable:!0}),e.FromValuesToRef=function(e,t,r,i,n,s,o,a,u,h,c,l,f,d,p,_,g){var m=g._m;m[0]=e,m[1]=t,m[2]=r,m[3]=i,m[4]=n,m[5]=s,m[6]=o,m[7]=a,m[8]=u,m[9]=h,m[10]=c,m[11]=l,m[12]=f,m[13]=d,m[14]=p,m[15]=_,g.markAsUpdated()},e.FromValues=function(t,r,i,n,s,o,a,u,h,c,l,f,d,p,_,g){var m=new e,y=m._m;return y[0]=t,y[1]=r,y[2]=i,y[3]=n,y[4]=s,y[5]=o,y[6]=a,y[7]=u,y[8]=h,y[9]=c,y[10]=l,y[11]=f,y[12]=d,y[13]=p,y[14]=_,y[15]=g,m.markAsUpdated(),m},e.Compose=function(t,r,i){var n=new e;return e.ComposeToRef(t,r,i,n),n},e.ComposeToRef=function(e,t,r,i){var n=i._m,s=t._x,o=t._y,a=t._z,u=t._w,h=s+s,c=o+o,l=a+a,f=s*h,d=s*c,p=s*l,_=o*c,g=o*l,m=a*l,y=u*h,v=u*c,b=u*l,T=e._x,M=e._y,x=e._z;n[0]=(1-(_+m))*T,n[1]=(d+b)*T,n[2]=(p-v)*T,n[3]=0,n[4]=(d-b)*M,n[5]=(1-(f+m))*M,n[6]=(g+y)*M,n[7]=0,n[8]=(p+v)*x,n[9]=(g-y)*x,n[10]=(1-(f+_))*x,n[11]=0,n[12]=r._x,n[13]=r._y,n[14]=r._z,n[15]=1,i.markAsUpdated()},e.Identity=function(){var t=e.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return t._updateIdentityStatus(!0),t},e.IdentityToRef=function(t){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(!0)},e.Zero=function(){var t=e.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return t._updateIdentityStatus(!1),t},e.RotationX=function(t){var r=new e;return e.RotationXToRef(t,r),r},e.Invert=function(t){var r=new e;return t.invertToRef(r),r},e.RotationXToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(1,0,0,0,0,n,i,0,0,-i,n,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationY=function(t){var r=new e;return e.RotationYToRef(t,r),r},e.RotationYToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(n,0,-i,0,0,1,0,0,i,0,n,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationZ=function(t){var r=new e;return e.RotationZToRef(t,r),r},e.RotationZToRef=function(t,r){var i=Math.sin(t),n=Math.cos(t);e.FromValuesToRef(n,i,0,0,-i,n,0,0,0,0,1,0,0,0,0,1,r),r._updateIdentityStatus(1===n&&0===i)},e.RotationAxis=function(t,r){var i=new e;return e.RotationAxisToRef(t,r,i),i},e.RotationAxisToRef=function(e,t,r){var i=Math.sin(-t),n=Math.cos(-t),s=1-n;e.normalize();var o=r._m;o[0]=e._x*e._x*s+n,o[1]=e._x*e._y*s-e._z*i,o[2]=e._x*e._z*s+e._y*i,o[3]=0,o[4]=e._y*e._x*s+e._z*i,o[5]=e._y*e._y*s+n,o[6]=e._y*e._z*s-e._x*i,o[7]=0,o[8]=e._z*e._x*s-e._y*i,o[9]=e._z*e._y*s+e._x*i,o[10]=e._z*e._z*s+n,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,r.markAsUpdated()},e.RotationAlignToRef=function(e,t,r){var i=tt.Dot(t,e),n=r._m;if(i<-.999)n[0]=-1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0;else{var s=tt.Cross(t,e),o=1/(1+i);n[0]=s._x*s._x*o+i,n[1]=s._y*s._x*o-s._z,n[2]=s._z*s._x*o+s._y,n[3]=0,n[4]=s._x*s._y*o+s._z,n[5]=s._y*s._y*o+i,n[6]=s._z*s._y*o-s._x,n[7]=0,n[8]=s._x*s._z*o-s._y,n[9]=s._y*s._z*o+s._x,n[10]=s._z*s._z*o+i,n[11]=0}n[12]=0,n[13]=0,n[14]=0,n[15]=1,r.markAsUpdated()},e.RotationYawPitchRoll=function(t,r,i){var n=new e;return e.RotationYawPitchRollToRef(t,r,i,n),n},e.RotationYawPitchRollToRef=function(e,t,r,i){it.RotationYawPitchRollToRef(e,t,r,st.Quaternion[0]),st.Quaternion[0].toRotationMatrix(i)},e.Scaling=function(t,r,i){var n=new e;return e.ScalingToRef(t,r,i,n),n},e.ScalingToRef=function(t,r,i,n){e.FromValuesToRef(t,0,0,0,0,r,0,0,0,0,i,0,0,0,0,1,n),n._updateIdentityStatus(1===t&&1===r&&1===i)},e.Translation=function(t,r,i){var n=new e;return e.TranslationToRef(t,r,i,n),n},e.TranslationToRef=function(t,r,i,n){e.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,t,r,i,1,n),n._updateIdentityStatus(0===t&&0===r&&0===i)},e.Lerp=function(t,r,i){var n=new e;return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){for(var n=i._m,s=e.m,o=t.m,a=0;a<16;a++)n[a]=s[a]*(1-r)+o[a]*r;i.markAsUpdated()},e.DecomposeLerp=function(t,r,i){var n=new e;return e.DecomposeLerpToRef(t,r,i,n),n},e.DecomposeLerpToRef=function(t,r,i,n){var s=st.Vector3[0],o=st.Quaternion[0],a=st.Vector3[1];t.decompose(s,o,a);var u=st.Vector3[2],h=st.Quaternion[1],c=st.Vector3[3];r.decompose(u,h,c);var l=st.Vector3[4];tt.LerpToRef(s,u,i,l);var f=st.Quaternion[2];it.SlerpToRef(o,h,i,f);var d=st.Vector3[5];tt.LerpToRef(a,c,i,d),e.ComposeToRef(l,f,d,n)},e.LookAtLH=function(t,r,i){var n=new e;return e.LookAtLHToRef(t,r,i,n),n},e.LookAtLHToRef=function(t,r,i,n){var s=st.Vector3[0],o=st.Vector3[1],a=st.Vector3[2];r.subtractToRef(t,a),a.normalize(),tt.CrossToRef(i,a,s);var u=s.lengthSquared();0===u?s.x=1:s.normalizeFromLength(Math.sqrt(u)),tt.CrossToRef(a,s,o),o.normalize();var h=-tt.Dot(s,t),c=-tt.Dot(o,t),l=-tt.Dot(a,t);e.FromValuesToRef(s._x,o._x,a._x,0,s._y,o._y,a._y,0,s._z,o._z,a._z,0,h,c,l,1,n)},e.LookAtRH=function(t,r,i){var n=new e;return e.LookAtRHToRef(t,r,i,n),n},e.LookAtRHToRef=function(t,r,i,n){var s=st.Vector3[0],o=st.Vector3[1],a=st.Vector3[2];t.subtractToRef(r,a),a.normalize(),tt.CrossToRef(i,a,s);var u=s.lengthSquared();0===u?s.x=1:s.normalizeFromLength(Math.sqrt(u)),tt.CrossToRef(a,s,o),o.normalize();var h=-tt.Dot(s,t),c=-tt.Dot(o,t),l=-tt.Dot(a,t);e.FromValuesToRef(s._x,o._x,a._x,0,s._y,o._y,a._y,0,s._z,o._z,a._z,0,h,c,l,1,n)},e.LookDirectionLH=function(t,r){var i=new e;return e.LookDirectionLHToRef(t,r,i),i},e.LookDirectionLHToRef=function(t,r,i){var n=st.Vector3[0];n.copyFrom(t),n.scaleInPlace(-1);var s=st.Vector3[1];tt.CrossToRef(r,n,s),e.FromValuesToRef(s._x,s._y,s._z,0,r._x,r._y,r._z,0,n._x,n._y,n._z,0,0,0,0,1,i)},e.LookDirectionRH=function(t,r){var i=new e;return e.LookDirectionRHToRef(t,r,i),i},e.LookDirectionRHToRef=function(t,r,i){var n=st.Vector3[2];tt.CrossToRef(r,t,n),e.FromValuesToRef(n._x,n._y,n._z,0,r._x,r._y,r._z,0,t._x,t._y,t._z,0,0,0,0,1,i)},e.OrthoLH=function(t,r,i,n,s){var o=new e;return e.OrthoLHToRef(t,r,i,n,o,s),o},e.OrthoLHToRef=function(t,r,i,n,s,o){var a=2/t,u=2/r,h=2/(n-i),c=-(n+i)/(n-i);e.FromValuesToRef(a,0,0,0,0,u,0,0,0,0,h,0,0,0,c,1,s),o&&s.multiplyToRef(at,s),s._updateIdentityStatus(1===a&&1===u&&1===h&&0===c)},e.OrthoOffCenterLH=function(t,r,i,n,s,o,a){var u=new e;return e.OrthoOffCenterLHToRef(t,r,i,n,s,o,u,a),u},e.OrthoOffCenterLHToRef=function(t,r,i,n,s,o,a,u){var h=2/(r-t),c=2/(n-i),l=2/(o-s),f=-(o+s)/(o-s),d=(t+r)/(t-r),p=(n+i)/(i-n);e.FromValuesToRef(h,0,0,0,0,c,0,0,0,0,l,0,d,p,f,1,a),u&&a.multiplyToRef(at,a),a.markAsUpdated()},e.OrthoOffCenterRH=function(t,r,i,n,s,o,a){var u=new e;return e.OrthoOffCenterRHToRef(t,r,i,n,s,o,u,a),u},e.OrthoOffCenterRHToRef=function(t,r,i,n,s,o,a,u){e.OrthoOffCenterLHToRef(t,r,i,n,s,o,a,u),a._m[10]*=-1},e.PerspectiveLH=function(t,r,i,n,s,o){void 0===o&&(o=0);var a=new e,u=2*i/t,h=2*i/r,c=(n+i)/(n-i),l=-2*n*i/(n-i),f=Math.tan(o);return e.FromValuesToRef(u,0,0,0,0,h,0,f,0,0,c,1,0,0,l,0,a),s&&a.multiplyToRef(at,a),a._updateIdentityStatus(!1),a},e.PerspectiveFovLH=function(t,r,i,n,s,o,a){void 0===o&&(o=0),void 0===a&&(a=!1);var u=new e;return e.PerspectiveFovLHToRef(t,r,i,n,u,!0,s,o,a),u},e.PerspectiveFovLHToRef=function(t,r,i,n,s,o,a,u,h){void 0===o&&(o=!0),void 0===u&&(u=0),void 0===h&&(h=!1);var c=i,l=n,f=1/Math.tan(.5*t),d=o?f/r:f,p=o?f:f*r,_=h&&0===c?-1:0!==l?(l+c)/(l-c):1,g=h&&0===c?2*l:0!==l?-2*l*c/(l-c):-2*c,m=Math.tan(u);e.FromValuesToRef(d,0,0,0,0,p,0,m,0,0,_,1,0,0,g,0,s),a&&s.multiplyToRef(at,s),s._updateIdentityStatus(!1)},e.PerspectiveFovReverseLHToRef=function(t,r,i,n,s,o,a,u){void 0===o&&(o=!0),void 0===u&&(u=0);var h=1/Math.tan(.5*t),c=o?h/r:h,l=o?h:h*r,f=Math.tan(u);e.FromValuesToRef(c,0,0,0,0,l,0,f,0,0,-i,1,0,0,1,0,s),a&&s.multiplyToRef(at,s),s._updateIdentityStatus(!1)},e.PerspectiveFovRH=function(t,r,i,n,s,o,a){void 0===o&&(o=0),void 0===a&&(a=!1);var u=new e;return e.PerspectiveFovRHToRef(t,r,i,n,u,!0,s,o,a),u},e.PerspectiveFovRHToRef=function(t,r,i,n,s,o,a,u,h){void 0===o&&(o=!0),void 0===u&&(u=0),void 0===h&&(h=!1);var c=i,l=n,f=1/Math.tan(.5*t),d=o?f/r:f,p=o?f:f*r,_=h&&0===c?1:0!==l?-(l+c)/(l-c):-1,g=h&&0===c?2*l:0!==l?-2*l*c/(l-c):-2*c,m=Math.tan(u);e.FromValuesToRef(d,0,0,0,0,p,0,m,0,0,_,-1,0,0,g,0,s),a&&s.multiplyToRef(at,s),s._updateIdentityStatus(!1)},e.PerspectiveFovReverseRHToRef=function(t,r,i,n,s,o,a,u){void 0===o&&(o=!0),void 0===u&&(u=0);var h=1/Math.tan(.5*t),c=o?h/r:h,l=o?h:h*r,f=Math.tan(u);e.FromValuesToRef(c,0,0,0,0,l,0,f,0,0,-i,-1,0,0,-1,0,s),a&&s.multiplyToRef(at,s),s._updateIdentityStatus(!1)},e.PerspectiveFovWebVRToRef=function(e,t,r,i,n,s,o){void 0===n&&(n=!1),void 0===o&&(o=0);var a=n?-1:1,u=Math.tan(e.upDegrees*Math.PI/180),h=Math.tan(e.downDegrees*Math.PI/180),c=Math.tan(e.leftDegrees*Math.PI/180),l=Math.tan(e.rightDegrees*Math.PI/180),f=2/(c+l),d=2/(u+h),p=Math.tan(o),_=i._m;_[0]=f,_[1]=_[2]=_[3]=_[4]=0,_[5]=d,_[6]=0,_[7]=p,_[8]=(c-l)*f*.5,_[9]=-(u-h)*d*.5,_[10]=-r/(t-r),_[11]=1*a,_[12]=_[13]=_[15]=0,_[14]=-2*r*t/(r-t),s&&i.multiplyToRef(at,i),i.markAsUpdated()},e.GetFinalMatrix=function(t,r,i,n,s,o){var a=t.width,u=t.height,h=t.x,c=t.y,l=e.FromValues(a/2,0,0,0,0,-u/2,0,0,0,0,o-s,0,h+a/2,u/2+c,s,1),f=st.Matrix[0];return r.multiplyToRef(i,f),f.multiplyToRef(n,f),f.multiply(l)},e.GetAsMatrix2x2=function(e){var t=e.m,r=[t[0],t[1],t[4],t[5]];return fe.MatrixUse64Bits?r:new Float32Array(r)},e.GetAsMatrix3x3=function(e){var t=e.m,r=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return fe.MatrixUse64Bits?r:new Float32Array(r)},e.Transpose=function(t){var r=new e;return e.TransposeToRef(t,r),r},e.TransposeToRef=function(e,t){var r=t._m,i=e.m;r[0]=i[0],r[1]=i[4],r[2]=i[8],r[3]=i[12],r[4]=i[1],r[5]=i[5],r[6]=i[9],r[7]=i[13],r[8]=i[2],r[9]=i[6],r[10]=i[10],r[11]=i[14],r[12]=i[3],r[13]=i[7],r[14]=i[11],r[15]=i[15],t.markAsUpdated(),t._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},e.Reflection=function(t){var r=new e;return e.ReflectionToRef(t,r),r},e.ReflectionToRef=function(t,r){t.normalize();var i=t.normal.x,n=t.normal.y,s=t.normal.z,o=-2*i,a=-2*n,u=-2*s;e.FromValuesToRef(o*i+1,a*i,u*i,0,o*n,a*n+1,u*n,0,o*s,a*s,u*s+1,0,o*t.d,a*t.d,u*t.d,1,r)},e.FromXYZAxesToRef=function(t,r,i,n){e.FromValuesToRef(t._x,t._y,t._z,0,r._x,r._y,r._z,0,i._x,i._y,i._z,0,0,0,0,1,n)},e.FromQuaternionToRef=function(e,t){var r=e._x*e._x,i=e._y*e._y,n=e._z*e._z,s=e._x*e._y,o=e._z*e._w,a=e._z*e._x,u=e._y*e._w,h=e._y*e._z,c=e._x*e._w;t._m[0]=1-2*(i+n),t._m[1]=2*(s+o),t._m[2]=2*(a-u),t._m[3]=0,t._m[4]=2*(s-o),t._m[5]=1-2*(n+r),t._m[6]=2*(h+c),t._m[7]=0,t._m[8]=2*(a+u),t._m[9]=2*(h-c),t._m[10]=1-2*(i+r),t._m[11]=0,t._m[12]=0,t._m[13]=0,t._m[14]=0,t._m[15]=1,t.markAsUpdated()},e._UpdateFlagSeed=0,e._IdentityReadOnly=e.Identity(),e}(),st=function(){function e(){}return e.Vector3=Je.BuildTuple(11,tt.Zero),e.Matrix=Je.BuildTuple(2,nt.Identity),e.Quaternion=Je.BuildTuple(3,it.Zero),e}(),ot=function(){function e(){}return e.Vector2=Je.BuildTuple(3,et.Zero),e.Vector3=Je.BuildTuple(13,tt.Zero),e.Vector4=Je.BuildTuple(3,rt.Zero),e.Quaternion=Je.BuildTuple(2,it.Zero),e.Matrix=Je.BuildTuple(8,nt.Identity),e}();Le("BABYLON.Vector2",et),Le("BABYLON.Vector3",tt),Le("BABYLON.Vector4",rt),Le("BABYLON.Matrix",nt);var at=nt.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1),ut=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.r=e,this.g=t,this.b=r}return e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},e.prototype.getClassName=function(){return"Color3"},e.prototype.getHashCode=function(){var e=255*this.r|0;return e=397*(e=397*e^(255*this.g|0))^(255*this.b|0)},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.toColor4=function(e){return void 0===e&&(e=1),new ht(this.r,this.g,this.b,e)},e.prototype.asArray=function(){return[this.r,this.g,this.b]},e.prototype.toLuminance=function(){return.3*this.r+.59*this.g+.11*this.b},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b},e.prototype.equalsFloats=function(e,t,r){return this.r===e&&this.g===t&&this.b===r},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,this},e.prototype.clampToRef=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=1),r.r=qe.Clamp(this.r,e,t),r.g=qe.Clamp(this.g,e,t),r.b=qe.Clamp(this.b,e,t),this},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b)},e.prototype.addToRef=function(e,t){return t.r=this.r+e.r,t.g=this.g+e.g,t.b=this.b+e.b,this},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,this},e.prototype.clone=function(){return new e(this.r,this.g,this.b)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},e.prototype.copyFromFloats=function(e,t,r){return this.r=e,this.g=t,this.b=r,this},e.prototype.set=function(e,t,r){return this.copyFromFloats(e,t,r)},e.prototype.toHexString=function(){var e=Math.round(255*this.r),t=Math.round(255*this.g),r=Math.round(255*this.b);return"#"+qe.ToHex(e)+qe.ToHex(t)+qe.ToHex(r)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toHSV=function(){var t=new e;return this.toHSVToRef(t),t},e.prototype.toHSVToRef=function(e){var t=this.r,r=this.g,i=this.b,n=Math.max(t,r,i),s=Math.min(t,r,i),o=0,a=0,u=n,h=n-s;0!==n&&(a=h/n),n!=s&&(n==t?(o=(r-i)/h,r<i&&(o+=6)):n==r?o=(i-t)/h+2:n==i&&(o=(t-r)/h+4),o*=60),e.r=o,e.g=a,e.b=u},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,Ze),e.g=Math.pow(this.g,Ze),e.b=Math.pow(this.b,Ze),this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,Ye),e.g=Math.pow(this.g,Ye),e.b=Math.pow(this.b,Ye),this},e.HSVtoRGBToRef=function(e,t,r,i){var n=r*t,s=e/60,o=n*(1-Math.abs(s%2-1)),a=0,u=0,h=0;s>=0&&s<=1?(a=n,u=o):s>=1&&s<=2?(a=o,u=n):s>=2&&s<=3?(u=n,h=o):s>=3&&s<=4?(u=o,h=n):s>=4&&s<=5?(a=o,h=n):s>=5&&s<=6&&(a=n,h=o);var c=r-n;i.set(a+c,u+c,h+c)},e.FromHexString=function(t){if("#"!==t.substring(0,1)||7!==t.length)return new e(0,0,0);var r=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16);return e.FromInts(r,i,n)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2])},e.FromArrayToRef=function(e,t,r){void 0===t&&(t=0),r.r=e[t],r.g=e[t+1],r.b=e[t+2]},e.FromInts=function(t,r,i){return new e(t/255,r/255,i/255)},e.Lerp=function(t,r,i){var n=new e(0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.r=e.r+(t.r-e.r)*r,i.g=e.g+(t.g-e.g)*r,i.b=e.b+(t.b-e.b)*r},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,l=a-o;return new e(t.r*u+i.r*h+r.r*c+n.r*l,t.g*u+i.g*h+r.g*c+n.g*l,t.b*u+i.b*h+r.b*c+n.b*l)},e.Hermite1stDerivative=function(t,r,i,n,s){var o=e.Black();return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.r=6*(o-n)*e.r+(3*o-4*n+1)*t.r+6*(-o+n)*r.r+(3*o-2*n)*i.r,s.g=6*(o-n)*e.g+(3*o-4*n+1)*t.g+6*(-o+n)*r.g+(3*o-2*n)*i.g,s.b=6*(o-n)*e.b+(3*o-4*n+1)*t.b+6*(-o+n)*r.b+(3*o-2*n)*i.b},e.Red=function(){return new e(1,0,0)},e.Green=function(){return new e(0,1,0)},e.Blue=function(){return new e(0,0,1)},e.Black=function(){return new e(0,0,0)},Object.defineProperty(e,"BlackReadOnly",{get:function(){return e._BlackReadOnly},enumerable:!1,configurable:!0}),e.White=function(){return new e(1,1,1)},e.Purple=function(){return new e(.5,0,.5)},e.Magenta=function(){return new e(1,0,1)},e.Yellow=function(){return new e(1,1,0)},e.Gray=function(){return new e(.5,.5,.5)},e.Teal=function(){return new e(0,1,1)},e.Random=function(){return new e(Math.random(),Math.random(),Math.random())},e._BlackReadOnly=e.Black(),e}(),ht=function(){function e(e,t,r,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=1),this.r=e,this.g=t,this.b=r,this.a=i}return e.prototype.addInPlace=function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this.a+=e.a,this},e.prototype.asArray=function(){return[this.r,this.g,this.b,this.a]},e.prototype.toArray=function(e,t){return void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e[t+3]=this.a,this},e.prototype.fromArray=function(t,r){return void 0===r&&(r=0),e.FromArrayToRef(t,r,this),this},e.prototype.equals=function(e){return e&&this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a},e.prototype.add=function(t){return new e(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)},e.prototype.subtract=function(t){return new e(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)},e.prototype.subtractToRef=function(e,t){return t.r=this.r-e.r,t.g=this.g-e.g,t.b=this.b-e.b,t.a=this.a-e.a,this},e.prototype.scale=function(t){return new e(this.r*t,this.g*t,this.b*t,this.a*t)},e.prototype.scaleToRef=function(e,t){return t.r=this.r*e,t.g=this.g*e,t.b=this.b*e,t.a=this.a*e,this},e.prototype.scaleAndAddToRef=function(e,t){return t.r+=this.r*e,t.g+=this.g*e,t.b+=this.b*e,t.a+=this.a*e,this},e.prototype.clampToRef=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=1),r.r=qe.Clamp(this.r,e,t),r.g=qe.Clamp(this.g,e,t),r.b=qe.Clamp(this.b,e,t),r.a=qe.Clamp(this.a,e,t),this},e.prototype.multiply=function(t){return new e(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)},e.prototype.multiplyToRef=function(e,t){return t.r=this.r*e.r,t.g=this.g*e.g,t.b=this.b*e.b,t.a=this.a*e.a,t},e.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},e.prototype.getClassName=function(){return"Color4"},e.prototype.getHashCode=function(){var e=255*this.r|0;return e=397*(e=397*(e=397*e^(255*this.g|0))^(255*this.b|0))^(255*this.a|0)},e.prototype.clone=function(){return new e(this.r,this.g,this.b,this.a)},e.prototype.copyFrom=function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this.a=e.a,this},e.prototype.copyFromFloats=function(e,t,r,i){return this.r=e,this.g=t,this.b=r,this.a=i,this},e.prototype.set=function(e,t,r,i){return this.copyFromFloats(e,t,r,i)},e.prototype.toHexString=function(e){void 0===e&&(e=!1);var t=Math.round(255*this.r),r=Math.round(255*this.g),i=Math.round(255*this.b);if(e)return"#"+qe.ToHex(t)+qe.ToHex(r)+qe.ToHex(i);var n=Math.round(255*this.a);return"#"+qe.ToHex(t)+qe.ToHex(r)+qe.ToHex(i)+qe.ToHex(n)},e.prototype.toLinearSpace=function(){var t=new e;return this.toLinearSpaceToRef(t),t},e.prototype.toLinearSpaceToRef=function(e){return e.r=Math.pow(this.r,Ze),e.g=Math.pow(this.g,Ze),e.b=Math.pow(this.b,Ze),e.a=this.a,this},e.prototype.toGammaSpace=function(){var t=new e;return this.toGammaSpaceToRef(t),t},e.prototype.toGammaSpaceToRef=function(e){return e.r=Math.pow(this.r,Ye),e.g=Math.pow(this.g,Ye),e.b=Math.pow(this.b,Ye),e.a=this.a,this},e.FromHexString=function(t){if("#"!==t.substring(0,1)||9!==t.length&&7!==t.length)return new e(0,0,0,0);var r=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),n=parseInt(t.substring(5,7),16),s=9===t.length?parseInt(t.substring(7,9),16):255;return e.FromInts(r,i,n,s)},e.Lerp=function(t,r,i){var n=new e(0,0,0,0);return e.LerpToRef(t,r,i,n),n},e.LerpToRef=function(e,t,r,i){i.r=e.r+(t.r-e.r)*r,i.g=e.g+(t.g-e.g)*r,i.b=e.b+(t.b-e.b)*r,i.a=e.a+(t.a-e.a)*r},e.Hermite=function(t,r,i,n,s){var o=s*s,a=s*o,u=2*a-3*o+1,h=-2*a+3*o,c=a-2*o+s,l=a-o;return new e(t.r*u+i.r*h+r.r*c+n.r*l,t.g*u+i.g*h+r.g*c+n.g*l,t.b*u+i.b*h+r.b*c+n.b*l,t.a*u+i.a*h+r.a*c+n.a*l)},e.Hermite1stDerivative=function(t,r,i,n,s){var o=new e;return this.Hermite1stDerivativeToRef(t,r,i,n,s,o),o},e.Hermite1stDerivativeToRef=function(e,t,r,i,n,s){var o=n*n;s.r=6*(o-n)*e.r+(3*o-4*n+1)*t.r+6*(-o+n)*r.r+(3*o-2*n)*i.r,s.g=6*(o-n)*e.g+(3*o-4*n+1)*t.g+6*(-o+n)*r.g+(3*o-2*n)*i.g,s.b=6*(o-n)*e.b+(3*o-4*n+1)*t.b+6*(-o+n)*r.b+(3*o-2*n)*i.b,s.a=6*(o-n)*e.a+(3*o-4*n+1)*t.a+6*(-o+n)*r.a+(3*o-2*n)*i.a},e.FromColor3=function(t,r){return void 0===r&&(r=1),new e(t.r,t.g,t.b,r)},e.FromArray=function(t,r){return void 0===r&&(r=0),new e(t[r],t[r+1],t[r+2],t[r+3])},e.FromArrayToRef=function(e,t,r){void 0===t&&(t=0),r.r=e[t],r.g=e[t+1],r.b=e[t+2],r.a=e[t+3]},e.FromInts=function(t,r,i,n){return new e(t/255,r/255,i/255,n/255)},e.CheckColors4=function(e,t){if(e.length===3*t){for(var r=[],i=0;i<e.length;i+=3){var n=i/3*4;r[n]=e[i],r[n+1]=e[i+1],r[n+2]=e[i+2],r[n+3]=1}return r}return e},e}(),ct=function(){function e(){}return e.Color3=Je.BuildArray(3,ut.Black),e.Color4=Je.BuildArray(3,(function(){return new ht(0,0,0,0)})),e}();Le("BABYLON.Color3",ut),Le("BABYLON.Color4",ht);var lt={},ft={},dt=function(e,t,r){var i=e();ze&&ze.AddTagsTo(i,t.tags);var n=pt(i);for(var s in n){var o=n[s],a=t[s],u=o.type;if(void 0!==a&&null!==a&&("uniqueId"!==s||Mt.AllowLoadingUniqueId))switch(u){case 0:case 6:case 11:i[s]=a;break;case 1:i[s]=r||a.isRenderTarget?a:a.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:i[s]=r?a:a.clone()}}return i};function pt(e){var t=e.getClassName();if(ft[t])return ft[t];ft[t]={};for(var r=ft[t],i=e,n=t;n;){var s=lt[n];for(var o in s)r[o]=s[o];var a=void 0,u=!1;do{if(!(a=Object.getPrototypeOf(i)).getClassName){u=!0;break}if(a.getClassName()!==n)break;i=a}while(a);if(u)break;n=a.getClassName(),i=a}return r}function _t(e,t){return function(r,i){var n=function(e){var t=e.getClassName();return lt[t]||(lt[t]={}),lt[t]}(r);n[i]||(n[i]={type:e,sourceName:t})}}function gt(e,t){return void 0===t&&(t=null),function(e,t){return void 0===t&&(t=null),function(r,i){var n=t||"_"+i;Object.defineProperty(r,i,{get:function(){return this[n]},set:function(t){"function"===typeof this.equals&&this.equals(t)||this[n]!==t&&(this[n]=t,r[e].apply(this))},enumerable:!0,configurable:!0})}}(e,t)}function mt(e){return _t(0,e)}function yt(e){return _t(1,e)}function vt(e){return _t(2,e)}function bt(e){return _t(5,e)}function Tt(e){return _t(8,e)}var Mt=function(){function e(){}return e.AppendSerializedAnimations=function(e,t){if(e.animations){t.animations=[];for(var r=0;r<e.animations.length;r++){var i=e.animations[r];t.animations.push(i.serialize())}}},e.Serialize=function(t,r){r||(r={}),ze&&(r.tags=ze.GetTags(t));var i=pt(t);for(var n in i){var s=i[n],o=s.sourceName||n,a=s.type,u=t[n];if(void 0!==u&&null!==u&&("uniqueId"!==n||e.AllowLoadingUniqueId))switch(a){case 0:r[o]=u;break;case 1:case 3:case 7:case 9:r[o]=u.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:r[o]=u.asArray();break;case 6:case 11:r[o]=u.id}}return r},e.Parse=function(t,r,i,n){void 0===n&&(n=null);var s=t();n||(n=""),ze&&ze.AddTagsTo(s,r.tags);var o=pt(s);for(var a in o){var u=o[a],h=r[u.sourceName||a],c=u.type;if(void 0!==h&&null!==h&&("uniqueId"!==a||e.AllowLoadingUniqueId)){var l=s;switch(c){case 0:l[a]=h;break;case 1:i&&(l[a]=e._TextureParser(h,i,n));break;case 2:l[a]=ut.FromArray(h);break;case 3:l[a]=e._FresnelParametersParser(h);break;case 4:l[a]=et.FromArray(h);break;case 5:l[a]=tt.FromArray(h);break;case 6:i&&(l[a]=i.getLastMeshById(h));break;case 7:l[a]=e._ColorCurvesParser(h);break;case 8:l[a]=ht.FromArray(h);break;case 9:l[a]=e._ImageProcessingConfigurationParser(h);break;case 10:l[a]=it.FromArray(h);break;case 11:i&&(l[a]=i.getCameraById(h));break;case 12:l[a]=nt.FromArray(h)}}}return s},e.Clone=function(e,t){return dt(e,t,!1)},e.Instanciate=function(e,t){return dt(e,t,!0)},e.AllowLoadingUniqueId=!1,e._ImageProcessingConfigurationParser=function(e){throw A("ImageProcessingConfiguration")},e._FresnelParametersParser=function(e){throw A("FresnelParameters")},e._ColorCurvesParser=function(e){throw A("ColorCurves")},e._TextureParser=function(e,t,r){throw A("Texture")},e}();function xt(e,t,r,i){var n=r.value;r.value=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var o=n;if("undefined"!==typeof _native&&_native[t]){var a=_native[t];o=i?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.apply(void 0,e)?a.apply(void 0,e):n.apply(void 0,e)}:a}return e[t]=o,o.apply(void 0,r)}}xt.filter=function(e){return function(t,r,i){return xt(t,r,i,e)}};var Et=function(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new _,this._onClonedObservable=new _},At=function(){function e(e,t){void 0===t&&(t=null),this._isDirty=!1,this._nodeDataStorage=new Et,this.state="",this.metadata=null,this.reservedDataStore=null,this._parentContainer=null,this.animations=new Array,this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=nt.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new _,this._onDisposeObserver=null,this._behaviors=new Array,this.name=e,this.id=e,this._scene=t||I.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return e.AddNodeConstructor=function(e,t){this._NodeConstructors[e]=t},e.Construct=function(e,t,r,i){var n=this._NodeConstructors[e];return n?n(t,r,i):null},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize},set:function(e){this._nodeDataStorage._doNotSerialize=e},enumerable:!1,configurable:!0}),e.prototype.isDisposed=function(){return this._nodeDataStorage._isDisposed},Object.defineProperty(e.prototype,"parent",{get:function(){return this._parentNode},set:function(e){if(this._parentNode!==e){var t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){var r=this._parentNode._children.indexOf(this);-1!==r&&this._parentNode._children.splice(r,1),e||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=e,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),e.prototype._serializeAsParent=function(e){e.parentId=this.uniqueId},e.prototype._addToSceneRootNodes=function(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},e.prototype._removeFromSceneRootNodes=function(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){var e=this._scene.rootNodes,t=e.length-1;e[this._nodeDataStorage._sceneRootNodesIndex]=e[t],e[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}},Object.defineProperty(e.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"Node"},Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onEnabledStateChangedObservable",{get:function(){return this._nodeDataStorage._onEnabledStateChangedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onClonedObservable",{get:function(){return this._nodeDataStorage._onClonedObservable},enumerable:!1,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._scene.getEngine()},e.prototype.addBehavior=function(e,t){var r=this;return void 0===t&&(t=!1),-1!==this._behaviors.indexOf(e)||(e.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((function(){e.attach(r)})):e.attach(this),this._behaviors.push(e)),this},e.prototype.removeBehavior=function(e){var t=this._behaviors.indexOf(e);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this},Object.defineProperty(e.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),e.prototype.getBehaviorByName=function(e){for(var t=0,r=this._behaviors;t<r.length;t++){var i=r[t];if(i.name===e)return i}return null},e.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},e.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(e.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),e.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},e.prototype.updateCache=function(e){!e&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},e.prototype._getActionManagerForTrigger=function(e,t){return void 0===t&&(t=!0),this.parent?this.parent._getActionManagerForTrigger(e,!1):null},e.prototype._updateCache=function(e){},e.prototype._isSynchronized=function(){return!0},e.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},e.prototype.isSynchronizedWithParent=function(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()},e.prototype.isSynchronized=function(){return this._cache.parent!==this._parentNode?(this._cache.parent=this._parentNode,!1):!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()},e.prototype.isReady=function(e){return void 0===e&&(e=!1),this._nodeDataStorage._isReady},e.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},e.prototype.isEnabled=function(e){return void 0===e&&(e=!0),!1===e?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled},e.prototype._syncParentEnabledState=function(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((function(e){e._syncParentEnabledState()}))},e.prototype.setEnabled=function(e){this._nodeDataStorage._isEnabled!==e&&(this._nodeDataStorage._isEnabled=e,this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(e),this._syncParentEnabledState())},e.prototype.isDescendantOf=function(e){return!!this.parent&&(this.parent===e||this.parent.isDescendantOf(e))},e.prototype._getDescendants=function(e,t,r){if(void 0===t&&(t=!1),this._children)for(var i=0;i<this._children.length;i++){var n=this._children[i];r&&!r(n)||e.push(n),t||n._getDescendants(e,!1,r)}},e.prototype.getDescendants=function(e,t){var r=new Array;return this._getDescendants(r,e,t),r},e.prototype.getChildMeshes=function(e,t){var r=[];return this._getDescendants(r,e,(function(e){return(!t||t(e))&&void 0!==e.cullingStrategy})),r},e.prototype.getChildren=function(e,t){return void 0===t&&(t=!0),this.getDescendants(t,e)},e.prototype._setReady=function(e){e!==this._nodeDataStorage._isReady&&(e?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)},e.prototype.getAnimationByName=function(e){for(var t=0;t<this.animations.length;t++){var r=this.animations[t];if(r.name===e)return r}return null},e.prototype.createAnimationRange=function(t,r,i){if(!this._ranges[t]){this._ranges[t]=e._AnimationRangeFactory(t,r,i);for(var n=0,s=this.animations.length;n<s;n++)this.animations[n]&&this.animations[n].createRange(t,r,i)}},e.prototype.deleteAnimationRange=function(e,t){void 0===t&&(t=!0);for(var r=0,i=this.animations.length;r<i;r++)this.animations[r]&&this.animations[r].deleteRange(e,t);this._ranges[e]=null},e.prototype.getAnimationRange=function(e){return this._ranges[e]||null},e.prototype.getAnimationRanges=function(){var e,t=[];for(e in this._ranges)t.push(this._ranges[e]);return t},e.prototype.beginAnimation=function(e,t,r,i){var n=this.getAnimationRange(e);return n?this._scene.beginAnimation(this,n.from,n.to,t,r,i):null},e.prototype.serializeAnimationRanges=function(){var e=[];for(var t in this._ranges){var r=this._ranges[t];if(r){var i={};i.name=t,i.from=r.from,i.to=r.to,e.push(i)}}return e},e.prototype.computeWorldMatrix=function(e){return this._worldMatrix||(this._worldMatrix=nt.Identity()),this._worldMatrix},e.prototype.dispose=function(e,t){if(void 0===t&&(t=!1),this._nodeDataStorage._isDisposed=!0,!e)for(var r=0,i=this.getDescendants(!0);r<i.length;r++){i[r].dispose(e,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(var n=0,s=this._behaviors;n<s.length;n++){s[n].detach()}this._behaviors=[],this.metadata=null},e.ParseAnimationRanges=function(e,t,r){if(t.ranges)for(var i=0;i<t.ranges.length;i++){var n=t.ranges[i];e.createAnimationRange(n.name,n.from,n.to)}},e.prototype.getHierarchyBoundingVectors=function(e,t){var r,i;void 0===e&&(e=!0),void 0===t&&(t=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var n=this;if(n.getBoundingInfo&&n.subMeshes){var s=n.getBoundingInfo();r=s.boundingBox.minimumWorld.clone(),i=s.boundingBox.maximumWorld.clone()}else r=new tt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i=new tt(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e)for(var o=0,a=this.getDescendants(!1);o<a.length;o++){var u=a[o];if(u.computeWorldMatrix(!0),(!t||t(u))&&u.getBoundingInfo&&0!==u.getTotalVertices()){var h=u.getBoundingInfo().boundingBox,c=h.minimumWorld,l=h.maximumWorld;tt.CheckExtends(c,r,i),tt.CheckExtends(l,r,i)}}return{min:r,max:i}},e._AnimationRangeFactory=function(e,t,r){throw A("AnimationRange")},e._NodeConstructors={},c([mt()],e.prototype,"name",void 0),c([mt()],e.prototype,"id",void 0),c([mt()],e.prototype,"uniqueId",void 0),c([mt()],e.prototype,"state",void 0),c([mt()],e.prototype,"metadata",void 0),e}(),Pt=function(){function e(e,t,r,i,n,s,o,a){void 0===i&&(i=0),void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===o&&(o=!1),this._isAlreadyOwned=!1,e.getScene?this._engine=e.getScene().getEngine():this._engine=e,this._updatable=r,this._instanced=s,this._divisor=a||1,t instanceof he?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=o?i:i*Float32Array.BYTES_PER_ELEMENT,n||this.create()}return e.prototype.createVertexBuffer=function(e,t,r,i,n,s,o){void 0===s&&(s=!1);var a=s?t:t*Float32Array.BYTES_PER_ELEMENT,u=i?s?i:i*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Rt(this._engine,this,e,this._updatable,!0,u,void 0===n?this._instanced:n,a,r,void 0,void 0,!0,this._divisor||o)},e.prototype.isUpdatable=function(){return this._updatable},e.prototype.getData=function(){return this._data},e.prototype.getBuffer=function(){return this._buffer},e.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},e.prototype.create=function(e){void 0===e&&(e=null),!e&&this._buffer||(e=e||this._data)&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e),this._data=e):this._buffer=this._engine.createVertexBuffer(e))},e.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},e.prototype.update=function(e){this.create(e)},e.prototype.updateDirectly=function(e,t,r,i){void 0===i&&(i=!1),this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,i?t:t*Float32Array.BYTES_PER_ELEMENT,r?r*this.byteStride:void 0),this._data=0===t&&void 0===r?e:null)},e.prototype._increaseReferences=function(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)},e.prototype.dispose=function(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null,this._data=null)},e}(),Rt=function(){function e(t,r,i,n,s,o,a,u,h,c,l,f,d,p){if(void 0===l&&(l=!1),void 0===f&&(f=!1),void 0===d&&(d=1),void 0===p&&(p=!1),r instanceof Pt?(this._buffer=r,this._ownsBuffer=p):(this._buffer=new Pt(t,r,n,o,s,a,f),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=i,void 0==c){var _=this.getData();this.type=e.FLOAT,_ instanceof Int8Array?this.type=e.BYTE:_ instanceof Uint8Array?this.type=e.UNSIGNED_BYTE:_ instanceof Int16Array?this.type=e.SHORT:_ instanceof Uint16Array?this.type=e.UNSIGNED_SHORT:_ instanceof Int32Array?this.type=e.INT:_ instanceof Uint32Array&&(this.type=e.UNSIGNED_INT)}else this.type=c;var g=e.GetTypeByteLength(this.type);f?(this._size=h||(o?o/g:e.DeduceStride(i)),this.byteStride=o||this._buffer.byteStride||this._size*g,this.byteOffset=u||0):(this._size=h||o||e.DeduceStride(i),this.byteStride=o?o*g:this._buffer.byteStride||this._size*g,this.byteOffset=(u||0)*g),this.normalized=l,this._instanced=void 0!==a&&a,this._instanceDivisor=a?d:0,this._computeHashCode()}return Object.defineProperty(e.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(e){this._instanceDivisor=e,this._instanced=0!=e,this._computeHashCode()},enumerable:!1,configurable:!0}),e.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},e.prototype._rebuild=function(){this._buffer&&this._buffer._rebuild()},e.prototype.getKind=function(){return this._kind},e.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},e.prototype.getData=function(){return this._buffer.getData()},e.prototype.getFloatData=function(t,r){var i=this.getData();if(!i)return null;var n=this.getSize()*e.GetTypeByteLength(this.type),s=t*this.getSize();if(this.type!==e.FLOAT||this.byteStride!==n){var o=new Float32Array(s);return this.forEach(s,(function(e,t){return o[t]=e})),o}if(!(i instanceof Array||i instanceof Float32Array)||0!==this.byteOffset||i.length!==s){if(i instanceof Array){var a=this.byteOffset/4;return i.slice(a,a+s)}if(i instanceof ArrayBuffer)return new Float32Array(i,this.byteOffset,s);a=i.byteOffset+this.byteOffset;if(r){var u=new Float32Array(s),h=new Float32Array(i.buffer,a,s);return u.set(h),u}var c=a%4;return c&&(a=Math.max(0,a-c)),new Float32Array(i.buffer,a,s)}return r?i.slice():i},e.prototype.getBuffer=function(){return this._buffer.getBuffer()},e.prototype.getStrideSize=function(){return this.byteStride/e.GetTypeByteLength(this.type)},e.prototype.getOffset=function(){return this.byteOffset/e.GetTypeByteLength(this.type)},e.prototype.getSize=function(t){return void 0===t&&(t=!1),t?this._size*e.GetTypeByteLength(this.type):this._size},e.prototype.getIsInstanced=function(){return this._instanced},e.prototype.getInstanceDivisor=function(){return this._instanceDivisor},e.prototype.create=function(e){this._buffer.create(e)},e.prototype.update=function(e){this._buffer.update(e)},e.prototype.updateDirectly=function(e,t,r){void 0===r&&(r=!1),this._buffer.updateDirectly(e,t,void 0,r)},e.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},e.prototype.forEach=function(t,r){e.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,r)},e.DeduceStride=function(t){switch(t){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind \'"+t+"\'")}},e.GetTypeByteLength=function(t){switch(t){case e.BYTE:case e.UNSIGNED_BYTE:return 1;case e.SHORT:case e.UNSIGNED_SHORT:return 2;case e.INT:case e.UNSIGNED_INT:case e.FLOAT:return 4;default:throw new Error("Invalid type \'".concat(t,"\'"))}},e.ForEach=function(t,r,i,n,s,o,a,u){if(t instanceof Array)for(var h=r/4,c=i/4,l=0;l<o;l+=n){for(var f=0;f<n;f++)u(t[h+f],l+f);h+=c}else{var d=t instanceof ArrayBuffer?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),p=e.GetTypeByteLength(s);for(l=0;l<o;l+=n){var _=r;for(f=0;f<n;f++){u(e._GetFloatValue(d,s,_,a),l+f),_+=p}r+=i}}},e._GetFloatValue=function(t,r,i,n){switch(r){case e.BYTE:var s=t.getInt8(i);return n&&(s=Math.max(s/127,-1)),s;case e.UNSIGNED_BYTE:s=t.getUint8(i);return n&&(s/=255),s;case e.SHORT:s=t.getInt16(i,!0);return n&&(s=Math.max(s/32767,-1)),s;case e.UNSIGNED_SHORT:s=t.getUint16(i,!0);return n&&(s/=65535),s;case e.INT:return t.getInt32(i,!0);case e.UNSIGNED_INT:return t.getUint32(i,!0);case e.FLOAT:return t.getFloat32(i,!0);default:throw new Error("Invalid component type ".concat(r))}},e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra",e}(),It=function(){function e(){var e,t;this._applyTo=(e=this._applyToCoroutine.bind(this),function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return He(e.apply(void 0,r),t)})}return e.prototype.set=function(e,t){switch(e.length||T.Warn("Setting vertex data kind \'".concat(t,"\' with an empty array")),t){case Rt.PositionKind:this.positions=e;break;case Rt.NormalKind:this.normals=e;break;case Rt.TangentKind:this.tangents=e;break;case Rt.UVKind:this.uvs=e;break;case Rt.UV2Kind:this.uvs2=e;break;case Rt.UV3Kind:this.uvs3=e;break;case Rt.UV4Kind:this.uvs4=e;break;case Rt.UV5Kind:this.uvs5=e;break;case Rt.UV6Kind:this.uvs6=e;break;case Rt.ColorKind:this.colors=e;break;case Rt.MatricesIndicesKind:this.matricesIndices=e;break;case Rt.MatricesWeightsKind:this.matricesWeights=e;break;case Rt.MatricesIndicesExtraKind:this.matricesIndicesExtra=e;break;case Rt.MatricesWeightsExtraKind:this.matricesWeightsExtra=e}},e.prototype.applyToMesh=function(e,t){return this._applyTo(e,t,!1),this},e.prototype.applyToGeometry=function(e,t){return this._applyTo(e,t,!1),this},e.prototype.updateMesh=function(e){return this._update(e),this},e.prototype.updateGeometry=function(e){return this._update(e),this},e.prototype._applyToCoroutine=function(e,t,r){return void 0===t&&(t=!1),f(this,(function(i){switch(i.label){case 0:return this.positions?(e.setVerticesData(Rt.PositionKind,this.positions,t),r?[4]:[3,2]):[3,2];case 1:i.sent(),i.label=2;case 2:return this.normals?(e.setVerticesData(Rt.NormalKind,this.normals,t),r?[4]:[3,4]):[3,4];case 3:i.sent(),i.label=4;case 4:return this.tangents?(e.setVerticesData(Rt.TangentKind,this.tangents,t),r?[4]:[3,6]):[3,6];case 5:i.sent(),i.label=6;case 6:return this.uvs?(e.setVerticesData(Rt.UVKind,this.uvs,t),r?[4]:[3,8]):[3,8];case 7:i.sent(),i.label=8;case 8:return this.uvs2?(e.setVerticesData(Rt.UV2Kind,this.uvs2,t),r?[4]:[3,10]):[3,10];case 9:i.sent(),i.label=10;case 10:return this.uvs3?(e.setVerticesData(Rt.UV3Kind,this.uvs3,t),r?[4]:[3,12]):[3,12];case 11:i.sent(),i.label=12;case 12:return this.uvs4?(e.setVerticesData(Rt.UV4Kind,this.uvs4,t),r?[4]:[3,14]):[3,14];case 13:i.sent(),i.label=14;case 14:return this.uvs5?(e.setVerticesData(Rt.UV5Kind,this.uvs5,t),r?[4]:[3,16]):[3,16];case 15:i.sent(),i.label=16;case 16:return this.uvs6?(e.setVerticesData(Rt.UV6Kind,this.uvs6,t),r?[4]:[3,18]):[3,18];case 17:i.sent(),i.label=18;case 18:return this.colors?(e.setVerticesData(Rt.ColorKind,this.colors,t),r?[4]:[3,20]):[3,20];case 19:i.sent(),i.label=20;case 20:return this.matricesIndices?(e.setVerticesData(Rt.MatricesIndicesKind,this.matricesIndices,t),r?[4]:[3,22]):[3,22];case 21:i.sent(),i.label=22;case 22:return this.matricesWeights?(e.setVerticesData(Rt.MatricesWeightsKind,this.matricesWeights,t),r?[4]:[3,24]):[3,24];case 23:i.sent(),i.label=24;case 24:return this.matricesIndicesExtra?(e.setVerticesData(Rt.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),r?[4]:[3,26]):[3,26];case 25:i.sent(),i.label=26;case 26:return this.matricesWeightsExtra?(e.setVerticesData(Rt.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),r?[4]:[3,28]):[3,28];case 27:i.sent(),i.label=28;case 28:return this.indices?(e.setIndices(this.indices,null,t),r?[4]:[3,30]):[3,31];case 29:i.sent(),i.label=30;case 30:return[3,32];case 31:e.setIndices([],null),i.label=32;case 32:return[2,this]}}))},e.prototype._update=function(e,t,r){return this.positions&&e.updateVerticesData(Rt.PositionKind,this.positions,t,r),this.normals&&e.updateVerticesData(Rt.NormalKind,this.normals,t,r),this.tangents&&e.updateVerticesData(Rt.TangentKind,this.tangents,t,r),this.uvs&&e.updateVerticesData(Rt.UVKind,this.uvs,t,r),this.uvs2&&e.updateVerticesData(Rt.UV2Kind,this.uvs2,t,r),this.uvs3&&e.updateVerticesData(Rt.UV3Kind,this.uvs3,t,r),this.uvs4&&e.updateVerticesData(Rt.UV4Kind,this.uvs4,t,r),this.uvs5&&e.updateVerticesData(Rt.UV5Kind,this.uvs5,t,r),this.uvs6&&e.updateVerticesData(Rt.UV6Kind,this.uvs6,t,r),this.colors&&e.updateVerticesData(Rt.ColorKind,this.colors,t,r),this.matricesIndices&&e.updateVerticesData(Rt.MatricesIndicesKind,this.matricesIndices,t,r),this.matricesWeights&&e.updateVerticesData(Rt.MatricesWeightsKind,this.matricesWeights,t,r),this.matricesIndicesExtra&&e.updateVerticesData(Rt.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,r),this.matricesWeightsExtra&&e.updateVerticesData(Rt.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,r),this.indices&&e.setIndices(this.indices,null),this},e._TransformVector3Coordinates=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=e.length);for(var n=ot.Vector3[0],s=ot.Vector3[1],o=r;o<r+i;o+=3)tt.FromArrayToRef(e,o,n),tt.TransformCoordinatesToRef(n,t,s),e[o]=s.x,e[o+1]=s.y,e[o+2]=s.z},e._TransformVector3Normals=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=e.length);for(var n=ot.Vector3[0],s=ot.Vector3[1],o=r;o<r+i;o+=3)tt.FromArrayToRef(e,o,n),tt.TransformNormalToRef(n,t,s),e[o]=s.x,e[o+1]=s.y,e[o+2]=s.z},e._TransformVector4Normals=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=e.length);for(var n=ot.Vector4[0],s=ot.Vector4[1],o=r;o<r+i;o+=4)rt.FromArrayToRef(e,o,n),rt.TransformNormalToRef(n,t,s),e[o]=s.x,e[o+1]=s.y,e[o+2]=s.z,e[o+3]=s.w},e._FlipFaces=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);for(var i=t;i<t+r;i+=3){var n=e[i+1];e[i+1]=e[i+2],e[i+2]=n}},e.prototype.transform=function(t){var r=t.determinant()<0;return this.positions&&e._TransformVector3Coordinates(this.positions,t),this.normals&&e._TransformVector3Normals(this.normals,t),this.tangents&&e._TransformVector4Normals(this.tangents,t),r&&this.indices&&e._FlipFaces(this.indices),this},e.prototype.merge=function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!1);var i=Array.isArray(e)?e.map((function(e){return[e,void 0]})):[[e,void 0]];return He(this._mergeCoroutine(void 0,i,t,!1,r))},e.prototype._mergeCoroutine=function(t,r,i,n,s){var o,a,u,h,c,l,d,p,_,g,m,y,v,b,T,M,x,E,A,P=this;return void 0===i&&(i=!1),f(this,(function(f){switch(f.label){case 0:for(this._validate(),o=r.map((function(e){return e[0]})),a=0,u=o;a<u.length;a++)if((v=u[a])._validate(),!this.normals!==!v.normals||!this.tangents!==!v.tangents||!this.uvs!==!v.uvs||!this.uvs2!==!v.uvs2||!this.uvs3!==!v.uvs3||!this.uvs4!==!v.uvs4||!this.uvs5!==!v.uvs5||!this.uvs6!==!v.uvs6||!this.colors!==!v.colors||!this.matricesIndices!==!v.matricesIndices||!this.matricesWeights!==!v.matricesWeights||!this.matricesIndicesExtra!==!v.matricesIndicesExtra||!this.matricesWeightsExtra!==!v.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(h=o.reduce((function(e,t){var r,i;return e+(null!==(i=null===(r=t.indices)||void 0===r?void 0:r.length)&&void 0!==i?i:0)}),null!==(x=null===(M=this.indices)||void 0===M?void 0:M.length)&&void 0!==x?x:0),c=s||o.some((function(e){return e.indices===P.indices})),l=c?null===(E=this.indices)||void 0===E?void 0:E.slice():this.indices,!(h>0))return[3,4];d=null!==(A=null===l||void 0===l?void 0:l.length)&&void 0!==A?A:0,l||(l=new Array(h)),l.length!==h&&(Array.isArray(l)?l.length=h:((p=i||l instanceof Uint32Array?new Uint32Array(h):new Uint16Array(h)).set(l),l=p),t&&t.determinant()<0&&e._FlipFaces(l,0,d)),_=this.positions?this.positions.length/3:0,g=0,m=r,f.label=1;case 1:if(!(g<m.length))return[3,4];if(y=m[g],v=y[0],b=y[1],!v.indices)return[3,3];for(T=0;T<v.indices.length;T++)l[d+T]=v.indices[T]+_;return b&&b.determinant()<0&&e._FlipFaces(l,d,v.indices.length),_+=v.positions.length/3,d+=v.indices.length,n?[4]:[3,3];case 2:f.sent(),f.label=3;case 3:return g++,[3,1];case 4:return this.indices=l,this.positions=e._MergeElement(Rt.PositionKind,this.positions,t,r.map((function(e){return[e[0].positions,e[1]]}))),n?[4]:[3,6];case 5:f.sent(),f.label=6;case 6:return this.normals=e._MergeElement(Rt.NormalKind,this.normals,t,r.map((function(e){return[e[0].normals,e[1]]}))),n?[4]:[3,8];case 7:f.sent(),f.label=8;case 8:return this.tangents=e._MergeElement(Rt.TangentKind,this.tangents,t,r.map((function(e){return[e[0].tangents,e[1]]}))),n?[4]:[3,10];case 9:f.sent(),f.label=10;case 10:return this.uvs=e._MergeElement(Rt.UVKind,this.uvs,t,r.map((function(e){return[e[0].uvs,e[1]]}))),n?[4]:[3,12];case 11:f.sent(),f.label=12;case 12:return this.uvs2=e._MergeElement(Rt.UV2Kind,this.uvs2,t,r.map((function(e){return[e[0].uvs2,e[1]]}))),n?[4]:[3,14];case 13:f.sent(),f.label=14;case 14:return this.uvs3=e._MergeElement(Rt.UV3Kind,this.uvs3,t,r.map((function(e){return[e[0].uvs3,e[1]]}))),n?[4]:[3,16];case 15:f.sent(),f.label=16;case 16:return this.uvs4=e._MergeElement(Rt.UV4Kind,this.uvs4,t,r.map((function(e){return[e[0].uvs4,e[1]]}))),n?[4]:[3,18];case 17:f.sent(),f.label=18;case 18:return this.uvs5=e._MergeElement(Rt.UV5Kind,this.uvs5,t,r.map((function(e){return[e[0].uvs5,e[1]]}))),n?[4]:[3,20];case 19:f.sent(),f.label=20;case 20:return this.uvs6=e._MergeElement(Rt.UV6Kind,this.uvs6,t,r.map((function(e){return[e[0].uvs6,e[1]]}))),n?[4]:[3,22];case 21:f.sent(),f.label=22;case 22:return this.colors=e._MergeElement(Rt.ColorKind,this.colors,t,r.map((function(e){return[e[0].colors,e[1]]}))),n?[4]:[3,24];case 23:f.sent(),f.label=24;case 24:return this.matricesIndices=e._MergeElement(Rt.MatricesIndicesKind,this.matricesIndices,t,r.map((function(e){return[e[0].matricesIndices,e[1]]}))),n?[4]:[3,26];case 25:f.sent(),f.label=26;case 26:return this.matricesWeights=e._MergeElement(Rt.MatricesWeightsKind,this.matricesWeights,t,r.map((function(e){return[e[0].matricesWeights,e[1]]}))),n?[4]:[3,28];case 27:f.sent(),f.label=28;case 28:return this.matricesIndicesExtra=e._MergeElement(Rt.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,r.map((function(e){return[e[0].matricesIndicesExtra,e[1]]}))),n?[4]:[3,30];case 29:f.sent(),f.label=30;case 30:return this.matricesWeightsExtra=e._MergeElement(Rt.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,r.map((function(e){return[e[0].matricesWeightsExtra,e[1]]}))),[2,this]}}))},e._MergeElement=function(t,r,i,n){var s=n.filter((function(e){return null!==e[0]&&void 0!==e[0]}));if(!r&&0==s.length)return r;if(!r)return this._MergeElement(t,s[0][0],s[0][1],s.slice(1));var o=s.reduce((function(e,t){return e+t[0].length}),r.length),a=t===Rt.PositionKind?e._TransformVector3Coordinates:t===Rt.NormalKind?e._TransformVector3Normals:t===Rt.TangentKind?e._TransformVector4Normals:function(){};if(r instanceof Float32Array){var u=new Float32Array(o);u.set(r),i&&a(u,i,0,r.length);for(var h=r.length,c=0,l=s;c<l.length;c++){var f=l[c],d=f[0],p=f[1];u.set(d,h),p&&a(u,p,h,d.length),h+=d.length}return u}for(var _=new Array(o),g=0;g<r.length;g++)_[g]=r[g];i&&a(_,i,0,r.length);h=r.length;for(var m=0,y=s;m<y.length;m++){var v=y[m],b=(d=v[0],v[1]);for(g=0;g<d.length;g++)_[h+g]=d[g];b&&a(_,b,h,d.length),h+=d.length}return _},e.prototype._validate=function(){if(!this.positions)throw new L("Positions are required",O);var e=function(e,t){var r=Rt.DeduceStride(e);if(t.length%r!==0)throw new Error("The "+e+"s array count must be a multiple of "+r);return t.length/r},t=e(Rt.PositionKind,this.positions),r=function(r,i){var n=e(r,i);if(n!==t)throw new Error("The "+r+"s element count ("+n+") does not match the positions count ("+t+")")};this.normals&&r(Rt.NormalKind,this.normals),this.tangents&&r(Rt.TangentKind,this.tangents),this.uvs&&r(Rt.UVKind,this.uvs),this.uvs2&&r(Rt.UV2Kind,this.uvs2),this.uvs3&&r(Rt.UV3Kind,this.uvs3),this.uvs4&&r(Rt.UV4Kind,this.uvs4),this.uvs5&&r(Rt.UV5Kind,this.uvs5),this.uvs6&&r(Rt.UV6Kind,this.uvs6),this.colors&&r(Rt.ColorKind,this.colors),this.matricesIndices&&r(Rt.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&r(Rt.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&r(Rt.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&r(Rt.MatricesWeightsExtraKind,this.matricesWeightsExtra)},e.prototype.serialize=function(){var e={};return this.positions&&(e.positions=this.positions),this.normals&&(e.normals=this.normals),this.tangents&&(e.tangents=this.tangents),this.uvs&&(e.uvs=this.uvs),this.uvs2&&(e.uvs2=this.uvs2),this.uvs3&&(e.uvs3=this.uvs3),this.uvs4&&(e.uvs4=this.uvs4),this.uvs5&&(e.uvs5=this.uvs5),this.uvs6&&(e.uvs6=this.uvs6),this.colors&&(e.colors=this.colors),this.matricesIndices&&(e.matricesIndices=this.matricesIndices,e.matricesIndices._isExpanded=!0),this.matricesWeights&&(e.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra,e.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra),e.indices=this.indices,e},e.ExtractFromMesh=function(t,r,i){return e._ExtractFrom(t,r,i)},e.ExtractFromGeometry=function(t,r,i){return e._ExtractFrom(t,r,i)},e._ExtractFrom=function(t,r,i){var n=new e;return t.isVerticesDataPresent(Rt.PositionKind)&&(n.positions=t.getVerticesData(Rt.PositionKind,r,i)),t.isVerticesDataPresent(Rt.NormalKind)&&(n.normals=t.getVerticesData(Rt.NormalKind,r,i)),t.isVerticesDataPresent(Rt.TangentKind)&&(n.tangents=t.getVerticesData(Rt.TangentKind,r,i)),t.isVerticesDataPresent(Rt.UVKind)&&(n.uvs=t.getVerticesData(Rt.UVKind,r,i)),t.isVerticesDataPresent(Rt.UV2Kind)&&(n.uvs2=t.getVerticesData(Rt.UV2Kind,r,i)),t.isVerticesDataPresent(Rt.UV3Kind)&&(n.uvs3=t.getVerticesData(Rt.UV3Kind,r,i)),t.isVerticesDataPresent(Rt.UV4Kind)&&(n.uvs4=t.getVerticesData(Rt.UV4Kind,r,i)),t.isVerticesDataPresent(Rt.UV5Kind)&&(n.uvs5=t.getVerticesData(Rt.UV5Kind,r,i)),t.isVerticesDataPresent(Rt.UV6Kind)&&(n.uvs6=t.getVerticesData(Rt.UV6Kind,r,i)),t.isVerticesDataPresent(Rt.ColorKind)&&(n.colors=t.getVerticesData(Rt.ColorKind,r,i)),t.isVerticesDataPresent(Rt.MatricesIndicesKind)&&(n.matricesIndices=t.getVerticesData(Rt.MatricesIndicesKind,r,i)),t.isVerticesDataPresent(Rt.MatricesWeightsKind)&&(n.matricesWeights=t.getVerticesData(Rt.MatricesWeightsKind,r,i)),t.isVerticesDataPresent(Rt.MatricesIndicesExtraKind)&&(n.matricesIndicesExtra=t.getVerticesData(Rt.MatricesIndicesExtraKind,r,i)),t.isVerticesDataPresent(Rt.MatricesWeightsExtraKind)&&(n.matricesWeightsExtra=t.getVerticesData(Rt.MatricesWeightsExtraKind,r,i)),n.indices=t.getIndices(r,i),n},e.CreateRibbon=function(e){throw A("ribbonBuilder")},e.CreateBox=function(e){throw A("boxBuilder")},e.CreateTiledBox=function(e){throw A("tiledBoxBuilder")},e.CreateTiledPlane=function(e){throw A("tiledPlaneBuilder")},e.CreateSphere=function(e){throw A("sphereBuilder")},e.CreateCylinder=function(e){throw A("cylinderBuilder")},e.CreateTorus=function(e){throw A("torusBuilder")},e.CreateLineSystem=function(e){throw A("linesBuilder")},e.CreateDashedLines=function(e){throw A("linesBuilder")},e.CreateGround=function(e){throw A("groundBuilder")},e.CreateTiledGround=function(e){throw A("groundBuilder")},e.CreateGroundFromHeightMap=function(e){throw A("groundBuilder")},e.CreatePlane=function(e){throw A("planeBuilder")},e.CreateDisc=function(e){throw A("discBuilder")},e.CreatePolygon=function(e,t,r,i,n,s,o){throw A("polygonBuilder")},e.CreateIcoSphere=function(e){throw A("icoSphereBuilder")},e.CreatePolyhedron=function(e){throw A("polyhedronBuilder")},e.CreateCapsule=function(e){throw void 0===e&&(e={orientation:tt.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),A("capsuleBuilder")},e.CreateTorusKnot=function(e){throw A("torusKnotBuilder")},e.ComputeNormals=function(e,t,r,i){var n=0,s=0,o=0,a=0,u=0,h=0,c=0,l=0,f=0,d=0,p=0,_=0,g=0,m=0,y=0,v=0,b=0,T=0,M=0,x=0,E=!1,A=!1,P=!1,R=!1,I=1,S=0,C=null;i&&(E=!!i.facetNormals,A=!!i.facetPositions,P=!!i.facetPartitioning,I=!0===i.useRightHandedSystem?-1:1,S=i.ratio||0,R=!!i.depthSort,C=i.distanceTo,R&&void 0===C&&(C=tt.Zero()));var D=0,O=0,F=0,w=0;for(P&&i&&i.bbSize&&(D=i.subDiv.X*S/i.bbSize.x,O=i.subDiv.Y*S/i.bbSize.y,F=i.subDiv.Z*S/i.bbSize.z,w=i.subDiv.max*i.subDiv.max,i.facetPartitioning.length=0),n=0;n<e.length;n++)r[n]=0;var B=t.length/3|0;for(n=0;n<B;n++){if(g=(_=3*t[3*n])+1,m=_+2,v=(y=3*t[3*n+1])+1,b=y+2,M=(T=3*t[3*n+2])+1,x=T+2,s=e[_]-e[y],o=e[g]-e[v],a=e[m]-e[b],u=e[T]-e[y],h=e[M]-e[v],l=I*(o*(c=e[x]-e[b])-a*h),f=I*(a*u-s*c),d=I*(s*h-o*u),l/=p=0===(p=Math.sqrt(l*l+f*f+d*d))?1:p,f/=p,d/=p,E&&i&&(i.facetNormals[n].x=l,i.facetNormals[n].y=f,i.facetNormals[n].z=d),A&&i&&(i.facetPositions[n].x=(e[_]+e[y]+e[T])/3,i.facetPositions[n].y=(e[g]+e[v]+e[M])/3,i.facetPositions[n].z=(e[m]+e[b]+e[x])/3),P&&i){var L=Math.floor((i.facetPositions[n].x-i.bInfo.minimum.x*S)*D),N=Math.floor((i.facetPositions[n].y-i.bInfo.minimum.y*S)*O),U=Math.floor((i.facetPositions[n].z-i.bInfo.minimum.z*S)*F),k=Math.floor((e[_]-i.bInfo.minimum.x*S)*D),V=Math.floor((e[g]-i.bInfo.minimum.y*S)*O),G=Math.floor((e[m]-i.bInfo.minimum.z*S)*F),W=Math.floor((e[y]-i.bInfo.minimum.x*S)*D),z=Math.floor((e[v]-i.bInfo.minimum.y*S)*O),K=Math.floor((e[b]-i.bInfo.minimum.z*S)*F),j=Math.floor((e[T]-i.bInfo.minimum.x*S)*D),H=Math.floor((e[M]-i.bInfo.minimum.y*S)*O),X=Math.floor((e[x]-i.bInfo.minimum.z*S)*F),q=k+i.subDiv.max*V+w*G,Y=W+i.subDiv.max*z+w*K,Z=j+i.subDiv.max*H+w*X,Q=L+i.subDiv.max*N+w*U;i.facetPartitioning[Q]=i.facetPartitioning[Q]?i.facetPartitioning[Q]:new Array,i.facetPartitioning[q]=i.facetPartitioning[q]?i.facetPartitioning[q]:new Array,i.facetPartitioning[Y]=i.facetPartitioning[Y]?i.facetPartitioning[Y]:new Array,i.facetPartitioning[Z]=i.facetPartitioning[Z]?i.facetPartitioning[Z]:new Array,i.facetPartitioning[q].push(n),Y!=q&&i.facetPartitioning[Y].push(n),Z!=Y&&Z!=q&&i.facetPartitioning[Z].push(n),Q!=q&&Q!=Y&&Q!=Z&&i.facetPartitioning[Q].push(n)}if(R&&i&&i.facetPositions){var J=i.depthSortedFacets[n];J.ind=3*n,J.sqDistance=tt.DistanceSquared(i.facetPositions[n],C)}r[_]+=l,r[g]+=f,r[m]+=d,r[y]+=l,r[v]+=f,r[b]+=d,r[T]+=l,r[M]+=f,r[x]+=d}for(n=0;n<r.length/3;n++)l=r[3*n],f=r[3*n+1],d=r[3*n+2],l/=p=0===(p=Math.sqrt(l*l+f*f+d*d))?1:p,f/=p,d/=p,r[3*n]=l,r[3*n+1]=f,r[3*n+2]=d},e._ComputeSides=function(t,r,i,n,s,o,a){var u,h,c=i.length,l=n.length;switch(t=t||e.DEFAULTSIDE){case e.FRONTSIDE:break;case e.BACKSIDE:for(u=0;u<c;u+=3){var f=i[u];i[u]=i[u+2],i[u+2]=f}for(h=0;h<l;h++)n[h]=-n[h];break;case e.DOUBLESIDE:for(var d=r.length,p=d/3,_=0;_<d;_++)r[d+_]=r[_];for(u=0;u<c;u+=3)i[u+c]=i[u+2]+p,i[u+1+c]=i[u+1]+p,i[u+2+c]=i[u]+p;for(h=0;h<l;h++)n[l+h]=-n[h];var g=s.length,m=0;for(m=0;m<g;m++)s[m+g]=s[m];for(o=o||new rt(0,0,1,1),a=a||new rt(0,0,1,1),m=0,u=0;u<g/2;u++)s[m]=o.x+(o.z-o.x)*s[m],s[m+1]=o.y+(o.w-o.y)*s[m+1],s[m+g]=a.x+(a.z-a.x)*s[m+g],s[m+g+1]=a.y+(a.w-a.y)*s[m+g+1],m+=2}},e.ImportVertexData=function(t,r){var i=new e,n=t.positions;n&&i.set(n,Rt.PositionKind);var s=t.normals;s&&i.set(s,Rt.NormalKind);var o=t.tangents;o&&i.set(o,Rt.TangentKind);var a=t.uvs;a&&i.set(a,Rt.UVKind);var u=t.uv2s;u&&i.set(u,Rt.UV2Kind);var h=t.uv3s;h&&i.set(h,Rt.UV3Kind);var c=t.uv4s;c&&i.set(c,Rt.UV4Kind);var l=t.uv5s;l&&i.set(l,Rt.UV5Kind);var f=t.uv6s;f&&i.set(f,Rt.UV6Kind);var d=t.colors;d&&i.set(ht.CheckColors4(d,n.length/3),Rt.ColorKind);var p=t.matricesIndices;p&&i.set(p,Rt.MatricesIndicesKind);var _=t.matricesWeights;_&&i.set(_,Rt.MatricesWeightsKind);var g=t.indices;g&&(i.indices=g),r.setAllVerticesData(i,t.updatable)},e.FRONTSIDE=0,e.BACKSIDE=1,e.DOUBLESIDE=2,e.DEFAULTSIDE=0,c([xt.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)}))],e,"_TransformVector3Coordinates",null),c([xt.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)}))],e,"_TransformVector3Normals",null),c([xt.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)}))],e,"_TransformVector4Normals",null),c([xt.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)}))],e,"_FlipFaces",null),e}(),St=function(e,t,r){this.bu=e,this.bv=t,this.distance=r,this.faceId=0,this.subMeshId=0},Ct=function(){function e(e,t,r){this.vectors=Je.BuildArray(8,tt.Zero),this.center=tt.Zero(),this.centerWorld=tt.Zero(),this.extendSize=tt.Zero(),this.extendSizeWorld=tt.Zero(),this.directions=Je.BuildArray(3,tt.Zero),this.vectorsWorld=Je.BuildArray(8,tt.Zero),this.minimumWorld=tt.Zero(),this.maximumWorld=tt.Zero(),this.minimum=tt.Zero(),this.maximum=tt.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(e,t,r)}return e.prototype.reConstruct=function(e,t,r){var i=e.x,n=e.y,s=e.z,o=t.x,a=t.y,u=t.z,h=this.vectors;this.minimum.copyFromFloats(i,n,s),this.maximum.copyFromFloats(o,a,u),h[0].copyFromFloats(i,n,s),h[1].copyFromFloats(o,a,u),h[2].copyFromFloats(o,n,s),h[3].copyFromFloats(i,a,s),h[4].copyFromFloats(i,n,u),h[5].copyFromFloats(o,a,s),h[6].copyFromFloats(i,a,u),h[7].copyFromFloats(o,n,u),t.addToRef(e,this.center).scaleInPlace(.5),t.subtractToRef(e,this.extendSize).scaleInPlace(.5),this._worldMatrix=r||nt.IdentityReadOnly,this._update(this._worldMatrix)},e.prototype.scale=function(t){var r=e._TmpVector3,i=this.maximum.subtractToRef(this.minimum,r[0]),n=i.length();i.normalizeFromLength(n);var s=n*t,o=i.scaleInPlace(.5*s),a=this.center.subtractToRef(o,r[1]),u=this.center.addToRef(o,r[2]);return this.reConstruct(a,u,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(e){var t=this.minimumWorld,r=this.maximumWorld,i=this.directions,n=this.vectorsWorld,s=this.vectors;if(e.isIdentity()){t.copyFrom(this.minimum),r.copyFrom(this.maximum);for(o=0;o<8;++o)n[o].copyFrom(s[o]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{t.setAll(Number.MAX_VALUE),r.setAll(-Number.MAX_VALUE);for(var o=0;o<8;++o){var a=n[o];tt.TransformCoordinatesToRef(s[o],e,a),t.minimizeInPlace(a),r.maximizeInPlace(a)}r.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),r.addToRef(t,this.centerWorld).scaleInPlace(.5)}tt.FromArrayToRef(e.m,0,i[0]),tt.FromArrayToRef(e.m,4,i[1]),tt.FromArrayToRef(e.m,8,i[2]),this._worldMatrix=e},e.prototype.isInFrustum=function(t){return e.IsInFrustum(this.vectorsWorld,t)},e.prototype.isCompletelyInFrustum=function(t){return e.IsCompletelyInFrustum(this.vectorsWorld,t)},e.prototype.intersectsPoint=function(e){var t=this.minimumWorld,r=this.maximumWorld,i=t.x,n=t.y,s=t.z,o=r.x,a=r.y,u=r.z,h=e.x,c=e.y,l=e.z,f=-.001;return!(o-h<f||f>h-i)&&(!(a-c<f||f>c-n)&&!(u-l<f||f>l-s))},e.prototype.intersectsSphere=function(t){return e.IntersectsSphere(this.minimumWorld,this.maximumWorld,t.centerWorld,t.radiusWorld)},e.prototype.intersectsMinMax=function(e,t){var r=this.minimumWorld,i=this.maximumWorld,n=r.x,s=r.y,o=r.z,a=i.x,u=i.y,h=i.z,c=e.x,l=e.y,f=e.z,d=t.x,p=t.y,_=t.z;return!(a<c||n>d)&&(!(u<l||s>p)&&!(h<f||o>_))},e.prototype.dispose=function(){var e,t;null===(e=this._drawWrapperFront)||void 0===e||e.dispose(),null===(t=this._drawWrapperBack)||void 0===t||t.dispose()},e.Intersects=function(e,t){return e.intersectsMinMax(t.minimumWorld,t.maximumWorld)},e.IntersectsSphere=function(t,r,i,n){var s=e._TmpVector3[0];return tt.ClampToRef(i,t,r,s),tt.DistanceSquared(i,s)<=n*n},e.IsCompletelyInFrustum=function(e,t){for(var r=0;r<6;++r)for(var i=t[r],n=0;n<8;++n)if(i.dotCoordinate(e[n])<0)return!1;return!0},e.IsInFrustum=function(e,t){for(var r=0;r<6;++r){for(var i=!0,n=t[r],s=0;s<8;++s)if(n.dotCoordinate(e[s])>=0){i=!1;break}if(i)return!1}return!0},e._TmpVector3=Je.BuildArray(3,tt.Zero),e}(),Dt=function(){function e(e,t,r){this.center=tt.Zero(),this.centerWorld=tt.Zero(),this.minimum=tt.Zero(),this.maximum=tt.Zero(),this.reConstruct(e,t,r)}return e.prototype.reConstruct=function(e,t,r){this.minimum.copyFrom(e),this.maximum.copyFrom(t);var i=tt.Distance(e,t);t.addToRef(e,this.center).scaleInPlace(.5),this.radius=.5*i,this._update(r||nt.IdentityReadOnly)},e.prototype.scale=function(t){var r=this.radius*t,i=e._TmpVector3,n=i[0].setAll(r),s=this.center.subtractToRef(n,i[1]),o=this.center.addToRef(n,i[2]);return this.reConstruct(s,o,this._worldMatrix),this},e.prototype.getWorldMatrix=function(){return this._worldMatrix},e.prototype._update=function(t){if(t.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{tt.TransformCoordinatesToRef(this.center,t,this.centerWorld);var r=e._TmpVector3[0];tt.TransformNormalFromFloatsToRef(1,1,1,t,r),this.radiusWorld=Math.max(Math.abs(r.x),Math.abs(r.y),Math.abs(r.z))*this.radius}},e.prototype.isInFrustum=function(e){for(var t=this.centerWorld,r=this.radiusWorld,i=0;i<6;i++)if(e[i].dotCoordinate(t)<=-r)return!1;return!0},e.prototype.isCenterInFrustum=function(e){for(var t=this.centerWorld,r=0;r<6;r++)if(e[r].dotCoordinate(t)<0)return!1;return!0},e.prototype.intersectsPoint=function(e){var t=tt.DistanceSquared(this.centerWorld,e);return!(this.radiusWorld*this.radiusWorld<t)},e.Intersects=function(e,t){var r=tt.DistanceSquared(e.centerWorld,t.centerWorld),i=e.radiusWorld+t.radiusWorld;return!(i*i<r)},e.CreateFromCenterAndRadius=function(t,r,i){this._TmpVector3[0].copyFrom(t),this._TmpVector3[1].copyFromFloats(0,0,r),this._TmpVector3[2].copyFrom(t),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].subtractInPlace(this._TmpVector3[1]);var n=new e(this._TmpVector3[0],this._TmpVector3[2]);return n._worldMatrix=i||nt.Identity(),n},e._TmpVector3=Je.BuildArray(3,tt.Zero),e}(),Ot={min:0,max:0},Ft={min:0,max:0},wt=function(e,t,r){var i=tt.Dot(t.centerWorld,e),n=Math.abs(tt.Dot(t.directions[0],e))*t.extendSize.x+Math.abs(tt.Dot(t.directions[1],e))*t.extendSize.y+Math.abs(tt.Dot(t.directions[2],e))*t.extendSize.z;r.min=i-n,r.max=i+n},Bt=function(e,t,r){return wt(e,t,Ot),wt(e,r,Ft),!(Ot.min>Ft.max||Ft.min>Ot.max)},Lt=function(){function e(e,t,r){this._isLocked=!1,this.boundingBox=new Ct(e,t,r),this.boundingSphere=new Dt(e,t,r)}return e.prototype.reConstruct=function(e,t,r){this.boundingBox.reConstruct(e,t,r),this.boundingSphere.reConstruct(e,t,r)},Object.defineProperty(e.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLocked",{get:function(){return this._isLocked},set:function(e){this._isLocked=e},enumerable:!1,configurable:!0}),e.prototype.update=function(e){this._isLocked||(this.boundingBox._update(e),this.boundingSphere._update(e))},e.prototype.centerOn=function(t,r){var i=e._TmpVector3[0].copyFrom(t).subtractInPlace(r),n=e._TmpVector3[1].copyFrom(t).addInPlace(r);return this.boundingBox.reConstruct(i,n,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(i,n,this.boundingBox.getWorldMatrix()),this},e.prototype.encapsulate=function(e){var t=tt.Minimize(this.minimum,e),r=tt.Maximize(this.maximum,e);return this.reConstruct(t,r,this.boundingBox.getWorldMatrix()),this},e.prototype.encapsulateBoundingInfo=function(e){return this.encapsulate(e.boundingBox.centerWorld.subtract(e.boundingBox.extendSizeWorld)),this.encapsulate(e.boundingBox.centerWorld.add(e.boundingBox.extendSizeWorld)),this},e.prototype.scale=function(e){return this.boundingBox.scale(e),this.boundingSphere.scale(e),this},e.prototype.isInFrustum=function(e,t){return void 0===t&&(t=0),!(2!==t&&3!==t||!this.boundingSphere.isCenterInFrustum(e))||!!this.boundingSphere.isInFrustum(e)&&(!(1!==t&&3!==t)||this.boundingBox.isInFrustum(e))},Object.defineProperty(e.prototype,"diagonalLength",{get:function(){var t=this.boundingBox;return t.maximumWorld.subtractToRef(t.minimumWorld,e._TmpVector3[0]).length()},enumerable:!1,configurable:!0}),e.prototype.isCompletelyInFrustum=function(e){return this.boundingBox.isCompletelyInFrustum(e)},e.prototype._checkCollision=function(e){return e._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},e.prototype.intersectsPoint=function(e){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(e)&&!!this.boundingBox.intersectsPoint(e))},e.prototype.intersects=function(e,t){if(!Dt.Intersects(this.boundingSphere,e.boundingSphere))return!1;if(!Ct.Intersects(this.boundingBox,e.boundingBox))return!1;if(!t)return!0;var r=this.boundingBox,i=e.boundingBox;return!!Bt(r.directions[0],r,i)&&(!!Bt(r.directions[1],r,i)&&(!!Bt(r.directions[2],r,i)&&(!!Bt(i.directions[0],r,i)&&(!!Bt(i.directions[1],r,i)&&(!!Bt(i.directions[2],r,i)&&(!!Bt(tt.Cross(r.directions[0],i.directions[0]),r,i)&&(!!Bt(tt.Cross(r.directions[0],i.directions[1]),r,i)&&(!!Bt(tt.Cross(r.directions[0],i.directions[2]),r,i)&&(!!Bt(tt.Cross(r.directions[1],i.directions[0]),r,i)&&(!!Bt(tt.Cross(r.directions[1],i.directions[1]),r,i)&&(!!Bt(tt.Cross(r.directions[1],i.directions[2]),r,i)&&(!!Bt(tt.Cross(r.directions[2],i.directions[0]),r,i)&&(!!Bt(tt.Cross(r.directions[2],i.directions[1]),r,i)&&!!Bt(tt.Cross(r.directions[2],i.directions[2]),r,i))))))))))))))},e._TmpVector3=Je.BuildArray(2,tt.Zero),e}(),Nt=function(){function e(){}return e.extractMinAndMaxIndexed=function(e,t,r,i,n,s){for(var o=r;o<r+i;o++){var a=3*t[o],u=e[a],h=e[a+1],c=e[a+2];n.minimizeInPlaceFromFloats(u,h,c),s.maximizeInPlaceFromFloats(u,h,c)}},e.extractMinAndMax=function(e,t,r,i,n,s){for(var o=t,a=t*i;o<t+r;o++,a+=i){var u=e[a],h=e[a+1],c=e[a+2];n.minimizeInPlaceFromFloats(u,h,c),s.maximizeInPlaceFromFloats(u,h,c)}},c([xt.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e[1];return!Array.isArray(r)&&!Array.isArray(i)}))],e,"extractMinAndMaxIndexed",null),c([xt.filter((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0];return!Array.isArray(r)}))],e,"extractMinAndMax",null),e}();function Ut(e,t,r,i,n){void 0===i&&(i=null);var s=new tt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new tt(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return n||(n=3),Nt.extractMinAndMax(e,t,r,n,s,o),i&&(s.x-=s.x*i.x+i.y,s.y-=s.y*i.x+i.y,s.z-=s.z*i.x+i.y,o.x+=o.x*i.x+i.y,o.y+=o.y*i.x+i.y,o.z+=o.z*i.x+i.y),{minimum:s,maximum:o}}var kt=function(){function e(e,t,r,i,n,s,o,a,u){void 0===a&&(a=!0),void 0===u&&(u=!0),this.materialIndex=e,this.verticesStart=t,this.verticesCount=r,this.indexStart=i,this.indexCount=n,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=o||s,u&&s.subMeshes.push(this),this._engine=this._mesh.getScene().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=s.subMeshes.length-1,a&&(this.refreshBoundingInfo(),s.computeWorldMatrix(!0))}return Object.defineProperty(e.prototype,"materialDefines",{get:function(){var e;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(e=this._getDrawWrapper())||void 0===e?void 0:e.defines},set:function(e){var t;(null!==(t=this._mainDrawWrapperOverride)&&void 0!==t?t:this._getDrawWrapper(void 0,!0)).defines=e},enumerable:!1,configurable:!0}),e.prototype._getDrawWrapper=function(e,t){void 0===t&&(t=!1),e=null!==e&&void 0!==e?e:this._engine.currentRenderPassId;var r=this._drawWrappers[e];return!r&&t&&(this._drawWrappers[e]=r=new pe(this._mesh.getScene().getEngine())),r},e.prototype._removeDrawWrapper=function(e,t){var r;void 0===t&&(t=!0),t&&(null===(r=this._drawWrappers[e])||void 0===r||r.dispose()),this._drawWrappers[e]=void 0},Object.defineProperty(e.prototype,"effect",{get:function(){var e,t;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:null!==(t=null===(e=this._getDrawWrapper())||void 0===e?void 0:e.effect)&&void 0!==t?t:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_drawWrapper",{get:function(){var e;return null!==(e=this._mainDrawWrapperOverride)&&void 0!==e?e:this._getDrawWrapper(void 0,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_drawWrapperOverride",{get:function(){return this._mainDrawWrapperOverride},enumerable:!1,configurable:!0}),e.prototype._setMainDrawWrapperOverride=function(e){this._mainDrawWrapperOverride=e},e.prototype.setEffect=function(e,t,r,i){void 0===t&&(t=null),void 0===i&&(i=!0);var n=this._drawWrapper;n.setEffect(e,t,i),void 0!==r&&(n.materialContext=r),e||(n.defines=null,n.materialContext=void 0)},e.prototype.resetDrawCache=function(e){if(this._drawWrappers){if(void 0!==e)return void this._removeDrawWrapper(e);for(var t=0,r=this._drawWrappers;t<r.length;t++){var i=r[t];null===i||void 0===i||i.dispose()}}this._drawWrappers=[]},e.AddToMesh=function(t,r,i,n,s,o,a,u){return void 0===u&&(u=!0),new e(t,r,i,n,s,o,a,u)},Object.defineProperty(e.prototype,"IsGlobal",{get:function(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()},enumerable:!1,configurable:!0}),e.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},e.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},e.prototype.getMesh=function(){return this._mesh},e.prototype.getRenderingMesh=function(){return this._renderingMesh},e.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},e.prototype.getEffectiveMesh=function(){var e=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return e||this._renderingMesh},e.prototype.getMaterial=function(e){var t;void 0===e&&(e=!0);var r=null!==(t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId))&&void 0!==t?t:this._renderingMesh.material;if(!r)return e?this._mesh.getScene().defaultMaterial:null;if(this._isMultiMaterial(r)){var i=r.getSubMaterial(this.materialIndex);return this._currentMaterial!==i&&(this._currentMaterial=i,this.resetDrawCache()),i}return r},e.prototype._isMultiMaterial=function(e){return void 0!==e.getSubMaterial},e.prototype.refreshBoundingInfo=function(e){if(void 0===e&&(e=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(e||(e=this._renderingMesh.getVerticesData(Rt.PositionKind)),!e)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var t,r=this._renderingMesh.getIndices();if(0===this.indexStart&&this.indexCount===r.length){var i=this._renderingMesh.getBoundingInfo();t={minimum:i.minimum.clone(),maximum:i.maximum.clone()}}else t=function(e,t,r,i,n){void 0===n&&(n=null);var s=new tt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),o=new tt(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return Nt.extractMinAndMaxIndexed(e,t,r,i,s,o),n&&(s.x-=s.x*n.x+n.y,s.y-=s.y*n.x+n.y,s.z-=s.z*n.x+n.y,o.x+=o.x*n.x+n.y,o.y+=o.y*n.x+n.y,o.z+=o.z*n.x+n.y),{minimum:s,maximum:o}}(e,r,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(t.minimum,t.maximum):this._boundingInfo=new Lt(t.minimum,t.maximum),this},e.prototype._checkCollision=function(e){return this.getBoundingInfo()._checkCollision(e)},e.prototype.updateBoundingInfo=function(e){var t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(e),this},e.prototype.isInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isInFrustum(e,this._mesh.cullingStrategy)},e.prototype.isCompletelyInFrustum=function(e){var t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(e)},e.prototype.render=function(e){return this._renderingMesh.render(this,e,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},e.prototype._getLinesIndexBuffer=function(e,t){if(!this._linesIndexBuffer){for(var r=[],i=this.indexStart;i<this.indexStart+this.indexCount;i+=3)r.push(e[i],e[i+1],e[i+1],e[i+2],e[i+2],e[i]);this._linesIndexBuffer=t.createIndexBuffer(r),this._linesIndexCount=r.length}return this._linesIndexBuffer},e.prototype.canIntersects=function(e){var t=this.getBoundingInfo();return!!t&&e.intersectsBox(t.boundingBox)},e.prototype.intersects=function(e,t,r,i,n){var s=this.getMaterial();if(!s)return null;var o=3,a=!1;switch(s.fillMode){case 3:case 5:case 6:case 8:return null;case 7:o=1,a=!0}return 4===s.fillMode?r.length?this._intersectLines(e,t,r,this._mesh.intersectionThreshold,i):this._intersectUnIndexedLines(e,t,r,this._mesh.intersectionThreshold,i):!r.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(e,t,r,i,n):this._intersectTriangles(e,t,r,o,a,i,n)},e.prototype._intersectLines=function(e,t,r,i,n){for(var s=null,o=this.indexStart;o<this.indexStart+this.indexCount;o+=2){var a=t[r[o]],u=t[r[o+1]],h=e.intersectionSegment(a,u,i);if(!(h<0)&&((n||!s||h<s.distance)&&((s=new St(null,null,h)).faceId=o/2,n)))break}return s},e.prototype._intersectUnIndexedLines=function(e,t,r,i,n){for(var s=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=2){var a=t[o],u=t[o+1],h=e.intersectionSegment(a,u,i);if(!(h<0)&&((n||!s||h<s.distance)&&((s=new St(null,null,h)).faceId=o/2,n)))break}return s},e.prototype._intersectTriangles=function(e,t,r,i,n,s,o){for(var a=null,u=-1,h=this.indexStart;h<this.indexStart+this.indexCount-(3-i);h+=i){u++;var c=r[h],l=r[h+1],f=r[h+2];if(n&&4294967295===f)h+=2;else{var d=t[c],p=t[l],_=t[f];if(d&&p&&_&&(!o||o(d,p,_,e))){var g=e.intersectsTriangle(d,p,_);if(g){if(g.distance<0)continue;if((s||!a||g.distance<a.distance)&&((a=g).faceId=u,s))break}}}}return a},e.prototype._intersectUnIndexedTriangles=function(e,t,r,i,n){for(var s=null,o=this.verticesStart;o<this.verticesStart+this.verticesCount;o+=3){var a=t[o],u=t[o+1],h=t[o+2];if(!n||n(a,u,h,e)){var c=e.intersectsTriangle(a,u,h);if(c){if(c.distance<0)continue;if((i||!s||c.distance<s.distance)&&((s=c).faceId=o/3,i))break}}}return s},e.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},e.prototype.clone=function(t,r){var i=new e(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,t,r,!1);if(!this.IsGlobal){var n=this.getBoundingInfo();if(!n)return i;i._boundingInfo=new Lt(n.minimum,n.maximum)}return i},e.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var e=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(e,1),this.resetDrawCache()},e.prototype.getClassName=function(){return"SubMesh"},e.CreateFromIndices=function(t,r,i,n,s,o){void 0===o&&(o=!0);for(var a=Number.MAX_VALUE,u=-Number.MAX_VALUE,h=(s||n).getIndices(),c=r;c<r+i;c++){var l=h[c];l<a&&(a=l),l>u&&(u=l)}return new e(t,a,u-a+1,r,i,n,s,o)},e}(),Vt=function(){function e(){}return Object.defineProperty(e,"ForceFullSceneLoadingForIncremental",{get:function(){return e._ForceFullSceneLoadingForIncremental},set:function(t){e._ForceFullSceneLoadingForIncremental=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"ShowLoadingScreen",{get:function(){return e._ShowLoadingScreen},set:function(t){e._ShowLoadingScreen=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"loggingLevel",{get:function(){return e._LoggingLevel},set:function(t){e._LoggingLevel=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"CleanBoneMatrixWeights",{get:function(){return e._CleanBoneMatrixWeights},set:function(t){e._CleanBoneMatrixWeights=t},enumerable:!1,configurable:!0}),e._ForceFullSceneLoadingForIncremental=!1,e._ShowLoadingScreen=!0,e._CleanBoneMatrixWeights=!1,e._LoggingLevel=0,e}(),Gt=function(){function e(){}return e.UseOpenGLOrientationForUV=!1,e}(),Wt=function(){function e(e,t,r,i,n){void 0===i&&(i=!1),void 0===n&&(n=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||I.LastCreatedScene,this._scene&&(this.id=e,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=i,r?this.setAllVerticesData(r,i):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),n&&(this.applyToMesh(n),n.computeWorldMatrix(!0)))}return Object.defineProperty(e.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(e){this._boundingBias?this._boundingBias.copyFrom(e):this._boundingBias=e.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),e.CreateGeometryForMesh=function(t){var r=new e(e.RandomId(),t.getScene());return r.applyToMesh(t),r},Object.defineProperty(e.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),e.prototype.getScene=function(){return this._scene},e.prototype.getEngine=function(){return this._engine},e.prototype.isReady=function(){return 1===this.delayLoadState||0===this.delayLoadState},Object.defineProperty(e.prototype,"doNotSerialize",{get:function(){for(var e=0;e<this._meshes.length;e++)if(!this._meshes[e].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),e.prototype._rebuild=function(){for(var e in this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),this._vertexBuffers){this._vertexBuffers[e]._rebuild()}},e.prototype.setAllVerticesData=function(e,t){e.applyToGeometry(this,t),this._notifyUpdate()},e.prototype.setVerticesData=function(e,t,r,i){void 0===r&&(r=!1),r&&Array.isArray(t)&&(t=new Float32Array(t));var n=new Rt(this._engine,t,e,r,0===this._meshes.length,i);this.setVerticesBuffer(n)},e.prototype.removeVerticesData=function(e){this._vertexBuffers[e]&&(this._vertexBuffers[e].dispose(),delete this._vertexBuffers[e]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()},e.prototype.setVerticesBuffer=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!0);var i=e.getKind();this._vertexBuffers[i]&&r&&this._vertexBuffers[i].dispose(),e._buffer&&e._buffer._increaseReferences(),this._vertexBuffers[i]=e;var n=this._meshes,s=n.length;if(i===Rt.PositionKind){var o=e.getData();null!=t?this._totalVertices=t:null!=o&&(this._totalVertices=o.length/(e.type===Rt.BYTE?e.byteStride:e.byteStride/4)),this._updateExtend(o),this._resetPointsArrayCache();for(var a=0;a<s;a++){var u=n[a];u.buildBoundingInfo(this._extend.minimum,this._extend.maximum),u._createGlobalSubMesh(u.isUnIndexed),u.computeWorldMatrix(!0),u.synchronizeInstances()}}this._notifyUpdate(i)},e.prototype.updateVerticesDataDirectly=function(e,t,r,i){void 0===i&&(i=!1);var n=this.getVertexBuffer(e);n&&(n.updateDirectly(t,r,i),this._notifyUpdate(e))},e.prototype.updateVerticesData=function(e,t,r){void 0===r&&(r=!1);var i=this.getVertexBuffer(e);i&&(i.update(t),e===Rt.PositionKind&&this._updateBoundingInfo(r,t),this._notifyUpdate(e))},e.prototype._updateBoundingInfo=function(e,t){if(e&&this._updateExtend(t),this._resetPointsArrayCache(),e)for(var r=0,i=this._meshes;r<i.length;r++){var n=i[r];n.hasBoundingInfo?n.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):n.buildBoundingInfo(this._extend.minimum,this._extend.maximum);for(var s=0,o=n.subMeshes;s<o.length;s++){o[s].refreshBoundingInfo()}}},e.prototype._bind=function(e,t,r,i){if(e){void 0===t&&(t=this._indexBuffer);var n=this.getVertexBuffers();if(n)if(t==this._indexBuffer&&(this._vertexArrayObjects||i)){var s=i||this._vertexArrayObjects;s[e.key]||(s[e.key]=this._engine.recordVertexArrayObject(n,t,e,r)),this._engine.bindVertexArrayObject(s[e.key],t)}else this._engine.bindBuffers(n,t,e,r)}},e.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},e.prototype.getVerticesData=function(e,t,r){var i=this.getVertexBuffer(e);return i?i.getFloatData(this._totalVertices,r||t&&1!==this._meshes.length):null},e.prototype.isVertexBufferUpdatable=function(e){var t=this._vertexBuffers[e];return!!t&&t.isUpdatable()},e.prototype.getVertexBuffer=function(e){return this.isReady()?this._vertexBuffers[e]:null},e.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},e.prototype.isVerticesDataPresent=function(e){return this._vertexBuffers?void 0!==this._vertexBuffers[e]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},e.prototype.getVerticesDataKinds=function(){var e,t=[];if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},e.prototype.updateIndices=function(e,t,r){if(void 0===r&&(r=!1),this._indexBuffer)if(this._indexBufferIsUpdatable){var i=e.length!==this._indices.length;if(r||(this._indices=e.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,e,t),i)for(var n=0,s=this._meshes;n<s.length;n++){s[n]._createGlobalSubMesh(!0)}}else this.setIndices(e,null,!0)},e.prototype.setIndices=function(e,t,r){void 0===t&&(t=null),void 0===r&&(r=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=e,this._indexBufferIsUpdatable=r,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,r)),void 0!=t&&(this._totalVertices=t);for(var i=0,n=this._meshes;i<n.length;i++){var s=n[i];s._createGlobalSubMesh(!0),s.synchronizeInstances()}this._notifyUpdate()},e.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},e.prototype.getIndices=function(e,t){if(!this.isReady())return null;var r=this._indices;return t||e&&1!==this._meshes.length?r.slice():r},e.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},e.prototype._releaseVertexArrayObject=function(e){void 0===e&&(e=null),e&&this._vertexArrayObjects&&this._vertexArrayObjects[e.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e.key]),delete this._vertexArrayObjects[e.key])},e.prototype.releaseForMesh=function(e,t){var r=this._meshes,i=r.indexOf(e);-1!==i&&(r.splice(i,1),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject(),e._geometry=null,0===r.length&&t&&this.dispose())},e.prototype.applyToMesh=function(e){if(e._geometry!==this){var t=e._geometry;t&&t.releaseForMesh(e),this._vertexArrayObjects&&e._invalidateInstanceVertexArrayObject();var r=this._meshes;e._geometry=this,e._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),r.push(e),this.isReady()?this._applyToMesh(e):this._boundingInfo&&e.setBoundingInfo(this._boundingInfo)}},e.prototype._updateExtend=function(e){if(void 0===e&&(e=null),this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!e&&!(e=this.getVerticesData(Rt.PositionKind)))return;this._extend=Ut(e,0,this._totalVertices,this.boundingBias,3)}},e.prototype._applyToMesh=function(e){var t=this._meshes.length;for(var r in this._vertexBuffers)1===t&&this._vertexBuffers[r].create(),r===Rt.PositionKind&&(this._extend||this._updateExtend(),e.buildBoundingInfo(this._extend.minimum,this._extend.maximum),e._createGlobalSubMesh(e.isUnIndexed),e._updateBoundingInfo());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),e._syncGeometryWithMorphTargetManager(),e.synchronizeInstances()},e.prototype._notifyUpdate=function(e){this.onGeometryUpdated&&this.onGeometryUpdated(this,e),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(var t=0,r=this._meshes;t<r.length;t++){r[t]._markSubMeshesAsAttributesDirty()}},e.prototype.load=function(e,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(e,t)))},e.prototype._queueLoad=function(e,t){var r=this;this.delayLoadingFile&&(e._addPendingData(this),e._loadFile(this.delayLoadingFile,(function(i){if(r._delayLoadingFunction){r._delayLoadingFunction(JSON.parse(i),r),r.delayLoadState=1,r._delayInfo=[],e._removePendingData(r);for(var n=r._meshes,s=n.length,o=0;o<s;o++)r._applyToMesh(n[o]);t&&t()}}),void 0,!0))},e.prototype.toLeftHanded=function(){var e=this.getIndices(!1);if(null!=e&&e.length>0){for(var t=0;t<e.length;t+=3){var r=e[t+0];e[t+0]=e[t+2],e[t+2]=r}this.setIndices(e)}var i=this.getVerticesData(Rt.PositionKind,!1);if(null!=i&&i.length>0){for(t=0;t<i.length;t+=3)i[t+2]=-i[t+2];this.setVerticesData(Rt.PositionKind,i,!1)}var n=this.getVerticesData(Rt.NormalKind,!1);if(null!=n&&n.length>0){for(t=0;t<n.length;t+=3)n[t+2]=-n[t+2];this.setVerticesData(Rt.NormalKind,n,!1)}},e.prototype._resetPointsArrayCache=function(){this._positions=null},e.prototype._generatePointsArray=function(){if(this._positions)return!0;var e=this.getVerticesData(Rt.PositionKind);if(!e||0===e.length)return!1;for(var t=3*this._positionsCache.length,r=this._positionsCache.length;t<e.length;t+=3,++r)this._positionsCache[r]=tt.FromArray(e,t);for(t=0,r=0;t<e.length;t+=3,++r)this._positionsCache[r].set(e[0+t],e[1+t],e[2+t]);return this._positionsCache.length=e.length/3,this._positions=this._positionsCache,!0},e.prototype.isDisposed=function(){return this._isDisposed},e.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};for(var t=this._meshes,r=t.length,i=0;i<r;i++)t[i]._invalidateInstanceVertexArrayObject()}},e.prototype.dispose=function(){var e,t=this._meshes,r=t.length;for(e=0;e<r;e++)this.releaseForMesh(t[e]);for(var i in this._meshes=[],this._disposeVertexArrayObjects(),this._vertexBuffers)this._vertexBuffers[i].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){var n=this._parentContainer.geometries.indexOf(this);n>-1&&this._parentContainer.geometries.splice(n,1),this._parentContainer=null}this._isDisposed=!0},e.prototype.copy=function(t){var r=new It;r.indices=[];var i=this.getIndices();if(i)for(var n=0;n<i.length;n++)r.indices.push(i[n]);var s,o=!1,a=!1;for(s in this._vertexBuffers){var u=this.getVerticesData(s);if(u&&(u instanceof Float32Array?r.set(new Float32Array(u),s):r.set(u.slice(0),s),!a)){var h=this.getVertexBuffer(s);h&&(a=!(o=h.isUpdatable()))}}var c=new e(t,this._scene,r,o);for(s in c.delayLoadState=this.delayLoadState,c.delayLoadingFile=this.delayLoadingFile,c._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)c._delayInfo=c._delayInfo||[],c._delayInfo.push(s);return c._boundingInfo=new Lt(this._extend.minimum,this._extend.maximum),c},e.prototype.serialize=function(){var e={};return e.id=this.id,e.uniqueId=this.uniqueId,e.updatable=this._updatable,ze&&ze.HasTags(this)&&(e.tags=ze.GetTags(this)),e},e.prototype._toNumberArray=function(e){return Array.isArray(e)?e:Array.prototype.slice.call(e)},e.prototype.clearCachedData=function(){for(var e in this._indices=[],this._resetPointsArrayCache(),this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,e)&&(this._vertexBuffers[e]._buffer._data=null)},e.prototype.serializeVerticeData=function(){var e=this.serialize();return this.isVerticesDataPresent(Rt.PositionKind)&&(e.positions=this._toNumberArray(this.getVerticesData(Rt.PositionKind)),this.isVertexBufferUpdatable(Rt.PositionKind)&&(e.positions._updatable=!0)),this.isVerticesDataPresent(Rt.NormalKind)&&(e.normals=this._toNumberArray(this.getVerticesData(Rt.NormalKind)),this.isVertexBufferUpdatable(Rt.NormalKind)&&(e.normals._updatable=!0)),this.isVerticesDataPresent(Rt.TangentKind)&&(e.tangents=this._toNumberArray(this.getVerticesData(Rt.TangentKind)),this.isVertexBufferUpdatable(Rt.TangentKind)&&(e.tangents._updatable=!0)),this.isVerticesDataPresent(Rt.UVKind)&&(e.uvs=this._toNumberArray(this.getVerticesData(Rt.UVKind)),this.isVertexBufferUpdatable(Rt.UVKind)&&(e.uvs._updatable=!0)),this.isVerticesDataPresent(Rt.UV2Kind)&&(e.uv2s=this._toNumberArray(this.getVerticesData(Rt.UV2Kind)),this.isVertexBufferUpdatable(Rt.UV2Kind)&&(e.uv2s._updatable=!0)),this.isVerticesDataPresent(Rt.UV3Kind)&&(e.uv3s=this._toNumberArray(this.getVerticesData(Rt.UV3Kind)),this.isVertexBufferUpdatable(Rt.UV3Kind)&&(e.uv3s._updatable=!0)),this.isVerticesDataPresent(Rt.UV4Kind)&&(e.uv4s=this._toNumberArray(this.getVerticesData(Rt.UV4Kind)),this.isVertexBufferUpdatable(Rt.UV4Kind)&&(e.uv4s._updatable=!0)),this.isVerticesDataPresent(Rt.UV5Kind)&&(e.uv5s=this._toNumberArray(this.getVerticesData(Rt.UV5Kind)),this.isVertexBufferUpdatable(Rt.UV5Kind)&&(e.uv5s._updatable=!0)),this.isVerticesDataPresent(Rt.UV6Kind)&&(e.uv6s=this._toNumberArray(this.getVerticesData(Rt.UV6Kind)),this.isVertexBufferUpdatable(Rt.UV6Kind)&&(e.uv6s._updatable=!0)),this.isVerticesDataPresent(Rt.ColorKind)&&(e.colors=this._toNumberArray(this.getVerticesData(Rt.ColorKind)),this.isVertexBufferUpdatable(Rt.ColorKind)&&(e.colors._updatable=!0)),this.isVerticesDataPresent(Rt.MatricesIndicesKind)&&(e.matricesIndices=this._toNumberArray(this.getVerticesData(Rt.MatricesIndicesKind)),e.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(Rt.MatricesIndicesKind)&&(e.matricesIndices._updatable=!0)),this.isVerticesDataPresent(Rt.MatricesWeightsKind)&&(e.matricesWeights=this._toNumberArray(this.getVerticesData(Rt.MatricesWeightsKind)),this.isVertexBufferUpdatable(Rt.MatricesWeightsKind)&&(e.matricesWeights._updatable=!0)),e.indices=this._toNumberArray(this.getIndices()),e},e.ExtractFromMesh=function(e,t){var r=e._geometry;return r?r.copy(t):null},e.RandomId=function(){return Ve.RandomId()},e._GetGeometryByLoadedUniqueId=function(e,t){for(var r=0;r<t.geometries.length;r++)if(t.geometries[r]._loadedUniqueId===e)return t.geometries[r];return null},e._ImportGeometry=function(t,r){var i=r.getScene(),n=t.geometryUniqueId,s=t.geometryId;if(n||s){var o=n?this._GetGeometryByLoadedUniqueId(n,i):i.getGeometryById(s);o&&o.applyToMesh(r)}else if(t instanceof ArrayBuffer){var a=r._binaryInfo;if(a.positionsAttrDesc&&a.positionsAttrDesc.count>0){var u=new Float32Array(t,a.positionsAttrDesc.offset,a.positionsAttrDesc.count);r.setVerticesData(Rt.PositionKind,u,!1)}if(a.normalsAttrDesc&&a.normalsAttrDesc.count>0){var h=new Float32Array(t,a.normalsAttrDesc.offset,a.normalsAttrDesc.count);r.setVerticesData(Rt.NormalKind,h,!1)}if(a.tangetsAttrDesc&&a.tangetsAttrDesc.count>0){var c=new Float32Array(t,a.tangetsAttrDesc.offset,a.tangetsAttrDesc.count);r.setVerticesData(Rt.TangentKind,c,!1)}if(a.uvsAttrDesc&&a.uvsAttrDesc.count>0){var l=new Float32Array(t,a.uvsAttrDesc.offset,a.uvsAttrDesc.count);if(Gt.UseOpenGLOrientationForUV)for(var f=1;f<l.length;f+=2)l[f]=1-l[f];r.setVerticesData(Rt.UVKind,l,!1)}if(a.uvs2AttrDesc&&a.uvs2AttrDesc.count>0){var d=new Float32Array(t,a.uvs2AttrDesc.offset,a.uvs2AttrDesc.count);if(Gt.UseOpenGLOrientationForUV)for(f=1;f<d.length;f+=2)d[f]=1-d[f];r.setVerticesData(Rt.UV2Kind,d,!1)}if(a.uvs3AttrDesc&&a.uvs3AttrDesc.count>0){var p=new Float32Array(t,a.uvs3AttrDesc.offset,a.uvs3AttrDesc.count);if(Gt.UseOpenGLOrientationForUV)for(f=1;f<p.length;f+=2)p[f]=1-p[f];r.setVerticesData(Rt.UV3Kind,p,!1)}if(a.uvs4AttrDesc&&a.uvs4AttrDesc.count>0){var _=new Float32Array(t,a.uvs4AttrDesc.offset,a.uvs4AttrDesc.count);if(Gt.UseOpenGLOrientationForUV)for(f=1;f<_.length;f+=2)_[f]=1-_[f];r.setVerticesData(Rt.UV4Kind,_,!1)}if(a.uvs5AttrDesc&&a.uvs5AttrDesc.count>0){var g=new Float32Array(t,a.uvs5AttrDesc.offset,a.uvs5AttrDesc.count);if(Gt.UseOpenGLOrientationForUV)for(f=1;f<g.length;f+=2)g[f]=1-g[f];r.setVerticesData(Rt.UV5Kind,g,!1)}if(a.uvs6AttrDesc&&a.uvs6AttrDesc.count>0){var m=new Float32Array(t,a.uvs6AttrDesc.offset,a.uvs6AttrDesc.count);if(Gt.UseOpenGLOrientationForUV)for(f=1;f<m.length;f+=2)m[f]=1-m[f];r.setVerticesData(Rt.UV6Kind,m,!1)}if(a.colorsAttrDesc&&a.colorsAttrDesc.count>0){var y=new Float32Array(t,a.colorsAttrDesc.offset,a.colorsAttrDesc.count);r.setVerticesData(Rt.ColorKind,y,!1,a.colorsAttrDesc.stride)}if(a.matricesIndicesAttrDesc&&a.matricesIndicesAttrDesc.count>0){for(var v=new Int32Array(t,a.matricesIndicesAttrDesc.offset,a.matricesIndicesAttrDesc.count),b=[],T=0;T<v.length;T++){f=v[T];b.push(255&f),b.push((65280&f)>>8),b.push((16711680&f)>>16),b.push(f>>24&255)}r.setVerticesData(Rt.MatricesIndicesKind,b,!1)}if(a.matricesIndicesExtraAttrDesc&&a.matricesIndicesExtraAttrDesc.count>0){for(v=new Int32Array(t,a.matricesIndicesExtraAttrDesc.offset,a.matricesIndicesExtraAttrDesc.count),b=[],T=0;T<v.length;T++){f=v[T];b.push(255&f),b.push((65280&f)>>8),b.push((16711680&f)>>16),b.push(f>>24&255)}r.setVerticesData(Rt.MatricesIndicesExtraKind,b,!1)}if(a.matricesWeightsAttrDesc&&a.matricesWeightsAttrDesc.count>0){var M=new Float32Array(t,a.matricesWeightsAttrDesc.offset,a.matricesWeightsAttrDesc.count);r.setVerticesData(Rt.MatricesWeightsKind,M,!1)}if(a.indicesAttrDesc&&a.indicesAttrDesc.count>0){var x=new Int32Array(t,a.indicesAttrDesc.offset,a.indicesAttrDesc.count);r.setIndices(x,null)}if(a.subMeshesAttrDesc&&a.subMeshesAttrDesc.count>0){var E=new Int32Array(t,a.subMeshesAttrDesc.offset,5*a.subMeshesAttrDesc.count);r.subMeshes=[];for(T=0;T<a.subMeshesAttrDesc.count;T++){var A=E[5*T+0],P=E[5*T+1],R=E[5*T+2],I=E[5*T+3],S=E[5*T+4];kt.AddToMesh(A,P,R,I,S,r)}}}else if(t.positions&&t.normals&&t.indices){if(r.setVerticesData(Rt.PositionKind,t.positions,t.positions._updatable),r.setVerticesData(Rt.NormalKind,t.normals,t.normals._updatable),t.tangents&&r.setVerticesData(Rt.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&r.setVerticesData(Rt.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&r.setVerticesData(Rt.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&r.setVerticesData(Rt.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&r.setVerticesData(Rt.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&r.setVerticesData(Rt.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&r.setVerticesData(Rt.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&r.setVerticesData(Rt.ColorKind,ht.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,r.setVerticesData(Rt.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(b=[],T=0;T<t.matricesIndices.length;T++){var C=t.matricesIndices[T];b.push(255&C),b.push((65280&C)>>8),b.push((16711680&C)>>16),b.push(C>>24&255)}r.setVerticesData(Rt.MatricesIndicesKind,b,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,r.setVerticesData(Rt.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(b=[],T=0;T<t.matricesIndicesExtra.length;T++){C=t.matricesIndicesExtra[T];b.push(255&C),b.push((65280&C)>>8),b.push((16711680&C)>>16),b.push(C>>24&255)}r.setVerticesData(Rt.MatricesIndicesExtraKind,b,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(e._CleanMatricesWeights(t,r),r.setVerticesData(Rt.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&r.setVerticesData(Rt.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),r.setIndices(t.indices,null)}if(t.subMeshes){r.subMeshes=[];for(var D=0;D<t.subMeshes.length;D++){var O=t.subMeshes[D];kt.AddToMesh(O.materialIndex,O.verticesStart,O.verticesCount,O.indexStart,O.indexCount,r)}}r._shouldGenerateFlatShading&&(r.convertToFlatShadedMesh(),r._shouldGenerateFlatShading=!1),r.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(r)},e._CleanMatricesWeights=function(e,t){var r=.001;if(Vt.CleanBoneMatrixWeights){var i=0;if(e.skeletonId>-1){var n=t.getScene().getLastSkeletonById(e.skeletonId);if(n){i=n.bones.length;for(var s=t.getVerticesData(Rt.MatricesIndicesKind),o=t.getVerticesData(Rt.MatricesIndicesExtraKind),a=e.matricesWeights,u=e.matricesWeightsExtra,h=e.numBoneInfluencer,c=a.length,l=0;l<c;l+=4){for(var f=0,d=-1,p=0;p<4;p++){f+=_=a[l+p],_<r&&d<0&&(d=p)}if(u)for(p=0;p<4;p++){var _;f+=_=u[l+p],_<r&&d<0&&(d=p+4)}if((d<0||d>h-1)&&(d=h-1),f>r){var g=1/f;for(p=0;p<4;p++)a[l+p]*=g;if(u)for(p=0;p<4;p++)u[l+p]*=g}else d>=4?(u[l+d-4]=1-f,o[l+d-4]=i):(a[l+d]=1-f,s[l+d]=i)}t.setVerticesData(Rt.MatricesIndicesKind,s),e.matricesWeightsExtra&&t.setVerticesData(Rt.MatricesIndicesExtraKind,o)}}}},e.Parse=function(t,r,i){var n=new e(t.id,r,void 0,t.updatable);return n._loadedUniqueId=t.uniqueId,ze&&ze.AddTagsTo(n,t.tags),t.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=i+t.delayLoadingFile,n._boundingInfo=new Lt(tt.FromArray(t.boundingBoxMinimum),tt.FromArray(t.boundingBoxMaximum)),n._delayInfo=[],t.hasUVs&&n._delayInfo.push(Rt.UVKind),t.hasUVs2&&n._delayInfo.push(Rt.UV2Kind),t.hasUVs3&&n._delayInfo.push(Rt.UV3Kind),t.hasUVs4&&n._delayInfo.push(Rt.UV4Kind),t.hasUVs5&&n._delayInfo.push(Rt.UV5Kind),t.hasUVs6&&n._delayInfo.push(Rt.UV6Kind),t.hasColors&&n._delayInfo.push(Rt.ColorKind),t.hasMatricesIndices&&n._delayInfo.push(Rt.MatricesIndicesKind),t.hasMatricesWeights&&n._delayInfo.push(Rt.MatricesWeightsKind),n._delayLoadingFunction=It.ImportVertexData):It.ImportVertexData(t,n),r.pushGeometry(n,!0),n},e}(),zt=function(){function e(e){void 0===e&&(e=30),this._enabled=!0,this._rollingFrameTime=new Kt(e)}return e.prototype.sampleFrame=function(e){if(void 0===e&&(e=E.Now),this._enabled){if(null!=this._lastFrameTimeMs){var t=e-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=e}},Object.defineProperty(e.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"instantaneousFPS",{get:function(){var e=this._rollingFrameTime.history(0);return 0===e?0:1e3/e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),e.prototype.enable=function(){this._enabled=!0},e.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},e}(),Kt=function(){function e(e){this._samples=new Array(e),this.reset()}return e.prototype.add=function(e){var t;if(this.isSaturated()){var r=this._samples[this._pos];t=r-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(r-this.average)}else this._sampleCount++;t=e-this.average,this.average+=t/this._sampleCount,this._m2+=t*(e-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=e,this._pos++,this._pos%=this._samples.length},e.prototype.history=function(e){if(e>=this._sampleCount||e>=this._samples.length)return 0;var t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-e)]},e.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},e.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},e.prototype._wrapPosition=function(e){var t=this._samples.length;return(e%t+t)%t},e}(),jt=function(){function e(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(e.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),e.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},e.prototype.addCount=function(t,r){e.Enabled&&(this._current+=t,r&&this._fetchResult())},e.prototype.beginMonitoring=function(){e.Enabled&&(this._startMonitoringTime=E.Now)},e.prototype.endMonitoring=function(t){if(void 0===t&&(t=!0),e.Enabled){t&&this.fetchNewFrame();var r=E.Now;this._current=r-this._startMonitoringTime,t&&this._fetchResult()}},e.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var e=E.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)},e.Enabled=!0,e}();me.prototype.setAlphaConstants=function(e,t,r,i){this._alphaState.setAlphaBlendConstants(e,t,r,i)},me.prototype.setAlphaMode=function(e,t){if(void 0===t&&(t=!1),this._alphaMode!==e){switch(e){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===e),this._alphaMode=e}},me.prototype.getAlphaMode=function(){return this._alphaMode},me.prototype.setAlphaEquation=function(e){if(this._alphaEquation!==e){switch(e){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=e}},me.prototype.getAlphaEquation=function(){return this._alphaEquation},me.prototype._readTexturePixelsSync=function(e,t,r,i,n,s,o,a,u,h){var c,l;void 0===i&&(i=-1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===h&&(h=0);var f=this._gl;if(!f)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var d=f.createFramebuffer();if(!d)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=d}f.bindFramebuffer(f.FRAMEBUFFER,this._dummyFramebuffer),i>-1?f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_CUBE_MAP_POSITIVE_X+i,null===(c=e._hardwareTexture)||void 0===c?void 0:c.underlyingResource,n):f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,null===(l=e._hardwareTexture)||void 0===l?void 0:l.underlyingResource,n);var p=void 0!==e.type?this._getWebGLTextureType(e.type):f.UNSIGNED_BYTE;if(a)s||(s=function(e,t,r,i){switch(void 0===r&&(r=!1),e){case 3:var n=(ArrayBuffer,new Int8Array(t));return i&&n.set(new Int8Array(i)),n;case 0:var s=(ArrayBuffer,new Uint8Array(t));return i&&s.set(new Uint8Array(i)),s;case 4:var o=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(r?t/2:t);return i&&o.set(new Int16Array(i)),o;case 5:case 8:case 9:case 10:case 2:var a=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(r?t/2:t);return i&&a.set(new Uint16Array(i)),a;case 6:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(r?t/4:t);return i&&u.set(new Int32Array(i)),u;case 7:case 11:case 12:case 13:case 14:case 15:var h=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(r?t/4:t);return i&&h.set(new Uint32Array(i)),h;case 1:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(r?t/4:t);return i&&c.set(new Float32Array(i)),c}var l=(ArrayBuffer,new Uint8Array(t));return i&&l.set(new Uint8Array(i)),l}(e.type,4*t*r));else if(p===f.UNSIGNED_BYTE)s||(s=new Uint8Array(4*t*r)),p=f.UNSIGNED_BYTE;else s||(s=new Float32Array(4*t*r)),p=f.FLOAT;return o&&this.flushFramebuffer(),f.readPixels(u,h,t,r,f.RGBA,p,s),f.bindFramebuffer(f.FRAMEBUFFER,this._currentFramebuffer),s},me.prototype._readTexturePixels=function(e,t,r,i,n,s,o,a,u,h){return void 0===i&&(i=-1),void 0===n&&(n=0),void 0===s&&(s=null),void 0===o&&(o=!0),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===h&&(h=0),Promise.resolve(this._readTexturePixelsSync(e,t,r,i,n,s,o,a,u,h))},me.prototype.updateDynamicIndexBuffer=function(e,t,r){var i;void 0===r&&(r=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(e),i=e.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},me.prototype.updateDynamicVertexBuffer=function(e,t,r,i){this.bindArrayBuffer(e),void 0===r&&(r=0);var n=t.byteLength||t.length;void 0===i||i>=n&&0===r?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,r,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(r,r+i)):(t=t instanceof ArrayBuffer?new Uint8Array(t,r,i):new Uint8Array(t.buffer,t.byteOffset+r,i),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()};var Ht,Xt=function(e){function t(r,i,n,s){void 0===s&&(s=!1);var o=e.call(this,r,i,n,s)||this;if(o.enableOfflineSupport=!1,o.disableManifestCheck=!1,o.disableContextMenu=!0,o.scenes=new Array,o._virtualScenes=new Array,o.onNewSceneAddedObservable=new _,o.postProcesses=new Array,o.isPointerLock=!1,o.onResizeObservable=new _,o.onCanvasBlurObservable=new _,o.onCanvasFocusObservable=new _,o.onCanvasPointerOutObservable=new _,o.onBeginFrameObservable=new _,o.customAnimationFrameRequester=null,o.onEndFrameObservable=new _,o.onBeforeShaderCompilationObservable=new _,o.onAfterShaderCompilationObservable=new _,o._deterministicLockstep=!1,o._lockstepMaxSteps=4,o._timeStep=1/60,o._fps=60,o._deltaTime=0,o._drawCalls=new jt,o.canvasTabIndex=1,o.disablePerformanceMonitorInBackground=!1,o._performanceMonitor=new zt,o._compatibilityMode=!0,o.currentRenderPassId=0,o._renderPassNames=["main"],t.Instances.push(o),!r)return o;if(o._features.supportRenderPasses=!0,n=o._creationOptions,r.getContext){var a=r;if(o._sharedInit(a,!!n.doNotHandleTouchAction,n.audioEngine),g()){var u=document;o._onFullscreenChange=function(){void 0!==u.fullscreen?o.isFullscreen=u.fullscreen:void 0!==u.mozFullScreen?o.isFullscreen=u.mozFullScreen:void 0!==u.webkitIsFullScreen?o.isFullscreen=u.webkitIsFullScreen:void 0!==u.msIsFullScreen&&(o.isFullscreen=u.msIsFullScreen),o.isFullscreen&&o._pointerLockRequested&&a&&t._RequestPointerlock(a)},document.addEventListener("fullscreenchange",o._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",o._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",o._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",o._onFullscreenChange,!1),o._onPointerLockChange=function(){o.isPointerLock=u.mozPointerLockElement===a||u.webkitPointerLockElement===a||u.msPointerLockElement===a||u.pointerLockElement===a},document.addEventListener("pointerlockchange",o._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",o._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",o._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",o._onPointerLockChange,!1),!t.audioEngine&&n.audioEngine&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(o.getRenderingCanvas(),o.getAudioContext(),o.getAudioDestination()))}o._connectVREvents(),o.enableOfflineSupport=void 0!==t.OfflineProviderFactory,o._deterministicLockstep=!!n.deterministicLockstep,o._lockstepMaxSteps=n.lockstepMaxSteps||0,o._timeStep=n.timeStep||1/60}return o._prepareVRComponent(),n.autoEnableWebVR&&o.initWebVR(),o}return u(t,e),Object.defineProperty(t,"NpmPackage",{get:function(){return me.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Version",{get:function(){return me.Version},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Instances",{get:function(){return I.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedEngine",{get:function(){return I.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LastCreatedScene",{get:function(){return I.LastCreatedScene},enumerable:!1,configurable:!0}),t.prototype._createImageBitmapFromSource=function(e,t){var r=this;return new Promise((function(i,n){var s=new Image;s.onload=function(){s.decode().then((function(){r.createImageBitmap(s,t).then((function(e){i(e)}))}))},s.onerror=function(){n("Error loading image ".concat(s.src))},s.src=e}))},t.prototype.createImageBitmap=function(e,t){return createImageBitmap(e,t)},t.prototype.resizeImageBitmap=function(e,t,r){var i=this.createCanvas(t,r).getContext("2d");if(!i)throw new Error("Unable to get 2d context for resizeImageBitmap");return i.drawImage(e,0,0),i.getImageData(0,0,t,r).data},t.MarkAllMaterialsAsDirty=function(e,r){for(var i=0;i<t.Instances.length;i++)for(var n=t.Instances[i],s=0;s<n.scenes.length;s++)n.scenes[s].markAllMaterialsAsDirty(e,r)},t.DefaultLoadingScreenFactory=function(e){throw A("LoadingScreen")},Object.defineProperty(t.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!t._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"compatibilityMode",{get:function(){return this._compatibilityMode},set:function(e){this._compatibilityMode=!0},enumerable:!1,configurable:!0}),t.prototype.getInputElement=function(){return this._renderingCanvas},t.prototype._sharedInit=function(r,i,n){var s=this;if(e.prototype._sharedInit.call(this,r,i,n),this._onCanvasFocus=function(){s.onCanvasFocusObservable.notifyObservers(s)},this._onCanvasBlur=function(){s.onCanvasBlurObservable.notifyObservers(s)},this._onCanvasContextMenu=function(e){s.disableContextMenu&&e.preventDefault()},r.addEventListener("focus",this._onCanvasFocus),r.addEventListener("blur",this._onCanvasBlur),r.addEventListener("contextmenu",this._onCanvasContextMenu),this._onBlur=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.disable(),s._windowIsBackground=!0},this._onFocus=function(){s.disablePerformanceMonitorInBackground&&s._performanceMonitor.enable(),s._windowIsBackground=!1},this._onCanvasPointerOut=function(e){document.elementFromPoint(e.clientX,e.clientY)!==r&&s.onCanvasPointerOutObservable.notifyObservers(e)},g()){var o=this.getHostWindow();o&&(o.addEventListener("blur",this._onBlur),o.addEventListener("focus",this._onFocus))}r.addEventListener("pointerout",this._onCanvasPointerOut),i||this._disableTouchAction(),!t.audioEngine&&n&&t.AudioEngineFactory&&(t.audioEngine=t.AudioEngineFactory(this.getRenderingCanvas(),this.getAudioContext(),this.getAudioDestination()))},t.prototype.getAspectRatio=function(e,t){void 0===t&&(t=!1);var r=e.viewport;return this.getRenderWidth(t)*r.width/(this.getRenderHeight(t)*r.height)},t.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},t.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},t.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},t.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},t.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},t.prototype.getTimeStep=function(){return 1e3*this._timeStep},t.prototype.generateMipMapsForCubemap=function(e,t){if(void 0===t&&(t=!0),e.generateMipMaps){var r=this._gl;this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,e,!0),r.generateMipmap(r.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,null)}},t.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},t.prototype.setDepthBuffer=function(e){this._depthCullingState.depthTest=e},t.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},t.prototype.setDepthWrite=function(e){this._depthCullingState.depthMask=e},t.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},t.prototype.setStencilBuffer=function(e){this._stencilState.stencilTest=e},t.prototype.getStencilMask=function(){return this._stencilState.stencilMask},t.prototype.setStencilMask=function(e){this._stencilState.stencilMask=e},t.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},t.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},t.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},t.prototype.setStencilFunction=function(e){this._stencilState.stencilFunc=e},t.prototype.setStencilFunctionReference=function(e){this._stencilState.stencilFuncRef=e},t.prototype.setStencilFunctionMask=function(e){this._stencilState.stencilFuncMask=e},t.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},t.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},t.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},t.prototype.setStencilOperationFail=function(e){this._stencilState.stencilOpStencilFail=e},t.prototype.setStencilOperationDepthFail=function(e){this._stencilState.stencilOpDepthFail=e},t.prototype.setStencilOperationPass=function(e){this._stencilState.stencilOpStencilDepthPass=e},t.prototype.setDitheringState=function(e){e?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},t.prototype.setRasterizerState=function(e){e?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},t.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},t.prototype.setDepthFunction=function(e){this._depthCullingState.depthFunc=e},t.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},t.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},t.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},t.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},t.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},t.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},t.prototype.setDirectViewport=function(e,t,r,i){var n=this._cachedViewport;return this._cachedViewport=null,this._viewport(e,t,r,i),n},t.prototype.scissorClear=function(e,t,r,i,n){this.enableScissor(e,t,r,i),this.clear(n,!0,!0,!0),this.disableScissor()},t.prototype.enableScissor=function(e,t,r,i){var n=this._gl;n.enable(n.SCISSOR_TEST),n.scissor(e,t,r,i)},t.prototype.disableScissor=function(){var e=this._gl;e.disable(e.SCISSOR_TEST)},t.prototype._reportDrawCall=function(e){void 0===e&&(e=1),this._drawCalls.addCount(e,!1)},t.prototype.initWebVR=function(){throw A("WebVRCamera")},t.prototype._prepareVRComponent=function(){},t.prototype._connectVREvents=function(e,t){},t.prototype._submitVRFrame=function(){},t.prototype.disableVR=function(){},t.prototype.isVRPresenting=function(){return!1},t.prototype._requestVRFrame=function(){},t.prototype._loadFileAsync=function(e,t,r){var i=this;return new Promise((function(n,s){i._loadFile(e,(function(e){n(e)}),void 0,t,r,(function(e,t){s(t)}))}))},t.prototype.getVertexShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[0]):null},t.prototype.getFragmentShaderSource=function(e){var t=this._gl.getAttachedShaders(e);return t?this._gl.getShaderSource(t[1]):null},t.prototype.setDepthStencilTexture=function(e,t,r,i){void 0!==e&&(t&&(this._boundUniforms[e]=t),r&&r.depthStencilTexture?this._setTexture(e,r,!1,!0,i):this._setTexture(e,null,void 0,void 0,i))},t.prototype.setTextureFromPostProcess=function(e,t,r){var i,n=null;t&&(t._textures.data[t._currentRenderTextureInd]?n=t._textures.data[t._currentRenderTextureInd]:t._forcedOutputTexture&&(n=t._forcedOutputTexture)),this._bindTexture(e,null!==(i=null===n||void 0===n?void 0:n.texture)&&void 0!==i?i:null,r)},t.prototype.setTextureFromPostProcessOutput=function(e,t,r){var i,n;this._bindTexture(e,null!==(n=null===(i=null===t||void 0===t?void 0:t._outputTexture)||void 0===i?void 0:i.texture)&&void 0!==n?n:null,r)},t.prototype._rebuildBuffers=function(){for(var t=0,r=this.scenes;t<r.length;t++){(s=r[t]).resetCachedMaterial(),s._rebuildGeometries(),s._rebuildTextures()}for(var i=0,n=this._virtualScenes;i<n.length;i++){var s;(s=n[i]).resetCachedMaterial(),s._rebuildGeometries(),s._rebuildTextures()}e.prototype._rebuildBuffers.call(this)},t.prototype._renderFrame=function(){for(var e=0;e<this._activeRenderLoops.length;e++){(0,this._activeRenderLoops[e])()}},t.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},t.prototype._renderViews=function(){return!1},t.prototype.switchFullscreen=function(e){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(e)},t.prototype.enterFullscreen=function(e){this.isFullscreen||(this._pointerLockRequested=e,this._renderingCanvas&&t._RequestFullscreen(this._renderingCanvas))},t.prototype.exitFullscreen=function(){this.isFullscreen&&t._ExitFullscreen()},t.prototype.enterPointerlock=function(){this._renderingCanvas&&t._RequestPointerlock(this._renderingCanvas)},t.prototype.exitPointerlock=function(){t._ExitPointerlock()},t.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),e.prototype.beginFrame.call(this)},t.prototype.endFrame=function(){e.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},t.prototype.resize=function(t){void 0===t&&(t=!1),this.isVRPresenting()||e.prototype.resize.call(this,t)},t.prototype.setSize=function(t,r,i){if(void 0===i&&(i=!1),!this._renderingCanvas)return!1;if(!e.prototype.setSize.call(this,t,r,i))return!1;if(this.scenes){for(var n=0;n<this.scenes.length;n++)for(var s=this.scenes[n],o=0;o<s.cameras.length;o++){s.cameras[o]._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},t.prototype._deletePipelineContext=function(t){var r=t;r&&r.program&&r.transformFeedback&&(this.deleteTransformFeedback(r.transformFeedback),r.transformFeedback=null),e.prototype._deletePipelineContext.call(this,t)},t.prototype.createShaderProgram=function(t,r,i,n,s,o){void 0===o&&(o=null),s=s||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var a=e.prototype.createShaderProgram.call(this,t,r,i,n,s,o);return this.onAfterShaderCompilationObservable.notifyObservers(this),a},t.prototype._createShaderProgram=function(e,t,r,i,n){void 0===n&&(n=null);var s=i.createProgram();if(e.program=s,!s)throw new Error("Unable to create program");if(i.attachShader(s,t),i.attachShader(s,r),this.webGLVersion>1&&n){var o=this.createTransformFeedback();this.bindTransformFeedback(o),this.setTranformFeedbackVaryings(s,n),e.transformFeedback=o}return i.linkProgram(s),this.webGLVersion>1&&n&&this.bindTransformFeedback(null),e.context=i,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),s},t.prototype._releaseTexture=function(t){e.prototype._releaseTexture.call(this,t)},t.prototype._releaseRenderTargetWrapper=function(t){e.prototype._releaseRenderTargetWrapper.call(this,t),this.scenes.forEach((function(e){e.postProcesses.forEach((function(e){e._outputTexture===t&&(e._outputTexture=null)})),e.cameras.forEach((function(e){e._postProcesses.forEach((function(e){e&&e._outputTexture===t&&(e._outputTexture=null)}))}))}))},t.prototype.getRenderPassNames=function(){return this._renderPassNames},t.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},t.prototype.createRenderPassId=function(e){var r=++t._RenderPassIdCounter;return this._renderPassNames[r]=null!==e&&void 0!==e?e:"NONAME",r},t.prototype.releaseRenderPassId=function(e){this._renderPassNames[e]=void 0;for(var t=0;t<this.scenes.length;++t)for(var r=this.scenes[t],i=0;i<r.meshes.length;++i){var n=r.meshes[i];if(n.subMeshes)for(var s=0;s<n.subMeshes.length;++s){n.subMeshes[s]._removeDrawWrapper(e)}}},t.prototype._rescaleTexture=function(e,r,i,n,s){var o=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var a=this.createRenderTargetTexture({width:r.width,height:r.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&t._RescalePostProcessFactory&&(this._rescalePostProcess=t._RescalePostProcessFactory(this)),this._rescalePostProcess.externalTextureSamplerBinding=!0,this._rescalePostProcess.getEffect().executeWhenCompiled((function(){o._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",e)};var t=i;t||(t=o.scenes[o.scenes.length-1]),t.postProcessManager.directRender([o._rescalePostProcess],a,!0),o._bindTextureDirectly(o._gl.TEXTURE_2D,r,!0),o._gl.copyTexImage2D(o._gl.TEXTURE_2D,0,n,0,0,r.width,r.height,0),o.unBindFramebuffer(a),a.dispose(),s&&s()}))},t.prototype.getFps=function(){return this._fps},t.prototype.getDeltaTime=function(){return this._deltaTime},t.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},t.prototype.wrapWebGLTexture=function(e){var t=new de(e,this._gl),r=new oe(this,Y.Unknown,!0);return r._hardwareTexture=t,r.isReady=!0,r},t.prototype._uploadImageToTexture=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=0);var n=this._gl,s=this._getWebGLTextureType(e.type),o=this._getInternalFormat(e.format),a=this._getRGBABufferInternalSizedFormat(e.type,o),u=e.isCube?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D;this._bindTextureDirectly(u,e,!0),this._unpackFlipY(e.invertY);var h=n.TEXTURE_2D;e.isCube&&(h=n.TEXTURE_CUBE_MAP_POSITIVE_X+r),n.texImage2D(h,i,a,o,s,t),this._bindTextureDirectly(u,null,!0)},t.prototype.updateTextureComparisonFunction=function(e,t){if(1!==this.webGLVersion){var r=this._gl;e.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,e,!0),0===t?(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_CUBE_MAP,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,e,!0),0===t?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,515),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.NONE)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_FUNC,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),e._comparisonFunction=t}else T.Error("WebGL 1 does not support texture comparison.")},t.prototype.createInstancesBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");var r=new ce(t);return r.capacity=e,this.bindArrayBuffer(r),this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),r.references=1,r},t.prototype.deleteInstancesBuffer=function(e){this._gl.deleteBuffer(e)},t.prototype._clientWaitAsync=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=10);var i=this._gl;return new Promise((function(n,s){!function o(){var a=i.clientWaitSync(e,t,0);a!=i.WAIT_FAILED?a!=i.TIMEOUT_EXPIRED?n():setTimeout(o,r):s()}()}))},t.prototype._readPixelsAsync=function(e,t,r,i,n,s,o){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var a=this._gl,u=a.createBuffer();a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.bufferData(a.PIXEL_PACK_BUFFER,o.byteLength,a.STREAM_READ),a.readPixels(e,t,r,i,n,s,0),a.bindBuffer(a.PIXEL_PACK_BUFFER,null);var h=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);return h?(a.flush(),this._clientWaitAsync(h,0,10).then((function(){return a.deleteSync(h),a.bindBuffer(a.PIXEL_PACK_BUFFER,u),a.getBufferSubData(a.PIXEL_PACK_BUFFER,0,o),a.bindBuffer(a.PIXEL_PACK_BUFFER,null),a.deleteBuffer(u),o}))):null},t.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();1===t.Instances.length&&t.audioEngine&&(t.audioEngine.dispose(),t.audioEngine=null),this.disableVR(),g()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut),this._renderingCanvas.removeEventListener("contextmenu",this._onCanvasContextMenu)),y()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),e.prototype.dispose.call(this);var r=t.Instances.indexOf(this);r>=0&&t.Instances.splice(r,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},t.prototype._disableTouchAction=function(){this._renderingCanvas&&this._renderingCanvas.setAttribute&&(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none",this._renderingCanvas.style.webkitTapHighlightColor="transparent")},t.prototype.displayLoadingUI=function(){if(g()){var e=this.loadingScreen;e&&e.displayLoadingUI()}},t.prototype.hideLoadingUI=function(){if(g()){var e=this._loadingScreen;e&&e.hideLoadingUI()}},Object.defineProperty(t.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=t.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(e){this._loadingScreen=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIText",{set:function(e){this.loadingScreen.loadingUIText=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loadingUIBackgroundColor",{set:function(e){this.loadingScreen.loadingUIBackgroundColor=e},enumerable:!1,configurable:!0}),t.prototype.createVideoElement=function(e){return document.createElement("video")},t._RequestPointerlock=function(e){e.requestPointerLock=e.requestPointerLock||e.msRequestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock&&(e.requestPointerLock(),e.focus())},t._ExitPointerlock=function(){var e=document;document.exitPointerLock=document.exitPointerLock||e.msExitPointerLock||e.mozExitPointerLock||e.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},t._RequestFullscreen=function(e){var t=e.requestFullscreen||e.msRequestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen;t&&t.call(e)},t._ExitFullscreen=function(){var e=document;document.exitFullscreen?document.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.msCancelFullScreen&&e.msCancelFullScreen()},t.prototype.getFontOffset=function(e){var t=document.createElement("span");t.innerHTML="Hg",t.setAttribute("style","font: ".concat(e," !important"));var r=document.createElement("div");r.style.display="inline-block",r.style.width="1px",r.style.height="0px",r.style.verticalAlign="bottom";var i=document.createElement("div");i.style.whiteSpace="nowrap",i.appendChild(t),i.appendChild(r),document.body.appendChild(i);var n=0,s=0;try{s=r.getBoundingClientRect().top-t.getBoundingClientRect().top,r.style.verticalAlign="baseline",n=r.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(i)}return{ascent:n,height:s,descent:s-n}},t.ALPHA_DISABLE=0,t.ALPHA_ADD=1,t.ALPHA_COMBINE=2,t.ALPHA_SUBTRACT=3,t.ALPHA_MULTIPLY=4,t.ALPHA_MAXIMIZED=5,t.ALPHA_ONEONE=6,t.ALPHA_PREMULTIPLIED=7,t.ALPHA_PREMULTIPLIED_PORTERDUFF=8,t.ALPHA_INTERPOLATE=9,t.ALPHA_SCREENMODE=10,t.DELAYLOADSTATE_NONE=0,t.DELAYLOADSTATE_LOADED=1,t.DELAYLOADSTATE_LOADING=2,t.DELAYLOADSTATE_NOTLOADED=4,t.NEVER=512,t.ALWAYS=519,t.LESS=513,t.EQUAL=514,t.LEQUAL=515,t.GREATER=516,t.GEQUAL=518,t.NOTEQUAL=517,t.KEEP=7680,t.REPLACE=7681,t.INCR=7682,t.DECR=7683,t.INVERT=5386,t.INCR_WRAP=34055,t.DECR_WRAP=34056,t.TEXTURE_CLAMP_ADDRESSMODE=0,t.TEXTURE_WRAP_ADDRESSMODE=1,t.TEXTURE_MIRROR_ADDRESSMODE=2,t.TEXTUREFORMAT_ALPHA=0,t.TEXTUREFORMAT_LUMINANCE=1,t.TEXTUREFORMAT_LUMINANCE_ALPHA=2,t.TEXTUREFORMAT_RGB=4,t.TEXTUREFORMAT_RGBA=5,t.TEXTUREFORMAT_RED=6,t.TEXTUREFORMAT_R=6,t.TEXTUREFORMAT_RG=7,t.TEXTUREFORMAT_RED_INTEGER=8,t.TEXTUREFORMAT_R_INTEGER=8,t.TEXTUREFORMAT_RG_INTEGER=9,t.TEXTUREFORMAT_RGB_INTEGER=10,t.TEXTUREFORMAT_RGBA_INTEGER=11,t.TEXTURETYPE_UNSIGNED_BYTE=0,t.TEXTURETYPE_UNSIGNED_INT=0,t.TEXTURETYPE_FLOAT=1,t.TEXTURETYPE_HALF_FLOAT=2,t.TEXTURETYPE_BYTE=3,t.TEXTURETYPE_SHORT=4,t.TEXTURETYPE_UNSIGNED_SHORT=5,t.TEXTURETYPE_INT=6,t.TEXTURETYPE_UNSIGNED_INTEGER=7,t.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,t.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,t.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,t.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,t.TEXTURETYPE_UNSIGNED_INT_24_8=12,t.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,t.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,t.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,t.TEXTURE_NEAREST_SAMPLINGMODE=1,t.TEXTURE_BILINEAR_SAMPLINGMODE=2,t.TEXTURE_TRILINEAR_SAMPLINGMODE=3,t.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,t.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,t.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,t.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,t.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,t.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,t.TEXTURE_NEAREST_LINEAR=7,t.TEXTURE_NEAREST_NEAREST=1,t.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,t.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,t.TEXTURE_LINEAR_LINEAR=2,t.TEXTURE_LINEAR_NEAREST=12,t.TEXTURE_EXPLICIT_MODE=0,t.TEXTURE_SPHERICAL_MODE=1,t.TEXTURE_PLANAR_MODE=2,t.TEXTURE_CUBIC_MODE=3,t.TEXTURE_PROJECTION_MODE=4,t.TEXTURE_SKYBOX_MODE=5,t.TEXTURE_INVCUBIC_MODE=6,t.TEXTURE_EQUIRECTANGULAR_MODE=7,t.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,t.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,t.SCALEMODE_FLOOR=1,t.SCALEMODE_NEAREST=2,t.SCALEMODE_CEILING=3,t._RescalePostProcessFactory=null,t._RenderPassIdCounter=0,t}(me);!function(e){e[e.LOCAL=0]="LOCAL",e[e.WORLD=1]="WORLD",e[e.BONE=2]="BONE"}(Ht||(Ht={}));var qt,Yt=function(){function e(){}return e.X=new tt(1,0,0),e.Y=new tt(0,1,0),e.Z=new tt(0,0,1),e}();!function(e){e[e.X=0]="X",e[e.Y=1]="Y",e[e.Z=2]="Z"}(qt||(qt={}));var Zt=function(e){function t(r,i,n){void 0===i&&(i=null),void 0===n&&(n=!0);var s=e.call(this,r,i)||this;return s._forward=new tt(0,0,1),s._up=new tt(0,1,0),s._right=new tt(1,0,0),s._position=tt.Zero(),s._rotation=tt.Zero(),s._rotationQuaternion=null,s._scaling=tt.One(),s._transformToBoneReferal=null,s._isAbsoluteSynced=!1,s._billboardMode=t.BILLBOARDMODE_NONE,s._preserveParentRotationForBillboard=!1,s.scalingDeterminant=1,s._infiniteDistance=!1,s.ignoreNonUniformScaling=!1,s.reIntegrateRotationIntoRotationQuaternion=!1,s._poseMatrix=null,s._localMatrix=nt.Zero(),s._usePivotMatrix=!1,s._absolutePosition=tt.Zero(),s._absoluteScaling=tt.Zero(),s._absoluteRotationQuaternion=it.Identity(),s._pivotMatrix=nt.Identity(),s._postMultiplyPivotMatrix=!1,s._isWorldMatrixFrozen=!1,s._indexInSceneTransformNodesArray=-1,s.onAfterWorldMatrixUpdateObservable=new _,s._nonUniformScaling=!1,n&&s.getScene().addTransformNode(s),s}var r;return u(t,e),Object.defineProperty(t.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(e){this._billboardMode!==e&&(this._billboardMode=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(e){e!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(e){this._infiniteDistance!==e&&(this._infiniteDistance=e)},enumerable:!1,configurable:!0}),t.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e,this._isDirty=!0},enumerable:!1,configurable:!0}),t.prototype.isUsingPivotMatrix=function(){return this._usePivotMatrix},Object.defineProperty(t.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation=e,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaling",{get:function(){return this._scaling},set:function(e){this._scaling=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(e){this._rotationQuaternion=e,e&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forward",{get:function(){return tt.TransformNormalFromFloatsToRef(0,0,this.getScene().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return tt.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return tt.TransformNormalFromFloatsToRef(this.getScene().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()},enumerable:!1,configurable:!0}),t.prototype.updatePoseMatrix=function(e){return this._poseMatrix?(this._poseMatrix.copyFrom(e),this):(this._poseMatrix=e.clone(),this)},t.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=nt.Identity()),this._poseMatrix},t.prototype._isSynchronized=function(){var e=this._cache;return this._billboardMode===e.billboardMode&&this._billboardMode===t.BILLBOARDMODE_NONE&&(!e.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))},t.prototype._initCache=function(){e.prototype._initCache.call(this);var t=this._cache;t.localMatrixUpdated=!1,t.billboardMode=-1,t.infiniteDistance=!1},Object.defineProperty(t.prototype,"absolutePosition",{get:function(){return this.getAbsolutePosition()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),t.prototype.setPreTransformMatrix=function(e){return this.setPivotMatrix(e,!1)},t.prototype.setPivotMatrix=function(e,t){return void 0===t&&(t=!0),this._pivotMatrix.copyFrom(e),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=nt.Invert(this._pivotMatrix)),this},t.prototype.getPivotMatrix=function(){return this._pivotMatrix},t.prototype.instantiateHierarchy=function(e,t,r){void 0===e&&(e=null);var i=this.clone("Clone of "+(this.name||this.id),e||this.parent,!0);i&&r&&r(this,i);for(var n=0,s=this.getChildTransformNodes(!0);n<s.length;n++){s[n].instantiateHierarchy(i,t,r)}return i},t.prototype.freezeWorldMatrix=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),e?t?(this._rotation.setAll(0),this._rotationQuaternion=this._rotationQuaternion||it.Identity(),e.decompose(this._scaling,this._rotationQuaternion,this._position),this.computeWorldMatrix(!0)):(this._worldMatrix=e,this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},t.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(t.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),t.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},t.prototype.setAbsolutePosition=function(e){if(!e)return this;var t,r,i;if(void 0===e.x){if(arguments.length<3)return this;t=arguments[0],r=arguments[1],i=arguments[2]}else t=e.x,r=e.y,i=e.z;if(this.parent){var n=ot.Matrix[0];this.parent.getWorldMatrix().invertToRef(n),tt.TransformCoordinatesFromFloatsToRef(t,r,i,n,this.position)}else this.position.x=t,this.position.y=r,this.position.z=i;return this._absolutePosition.copyFrom(e),this},t.prototype.setPositionWithLocalVector=function(e){return this.computeWorldMatrix(),this.position=tt.TransformNormal(e,this._localMatrix),this},t.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var e=ot.Matrix[0];return this._localMatrix.invertToRef(e),tt.TransformNormal(this.position,e)},t.prototype.locallyTranslate=function(e){return this.computeWorldMatrix(!0),this.position=tt.TransformCoordinates(e,this._localMatrix),this},t.prototype.lookAt=function(e,r,i,n,s){void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=Ht.LOCAL);var o=t._LookAtVectorCache,a=s===Ht.LOCAL?this.position:this.getAbsolutePosition();if(e.subtractToRef(a,o),this.setDirection(o,r,i,n),s===Ht.WORLD&&this.parent)if(this.rotationQuaternion){var u=ot.Matrix[0];this.rotationQuaternion.toRotationMatrix(u);var h=ot.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),u.multiplyToRef(h,u),this.rotationQuaternion.fromRotationMatrix(u)}else{var c=ot.Quaternion[0];it.FromEulerVectorToRef(this.rotation,c);u=ot.Matrix[0];c.toRotationMatrix(u);h=ot.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(h),h.invert(),u.multiplyToRef(h,u),c.fromRotationMatrix(u),c.toEulerAnglesToRef(this.rotation)}return this},t.prototype.getDirection=function(e){var t=tt.Zero();return this.getDirectionToRef(e,t),t},t.prototype.getDirectionToRef=function(e,t){return tt.TransformNormalToRef(e,this.getWorldMatrix(),t),this},t.prototype.setDirection=function(e,t,r,i){void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0);var n=-Math.atan2(e.z,e.x)+Math.PI/2,s=Math.sqrt(e.x*e.x+e.z*e.z),o=-Math.atan2(e.y,s);return this.rotationQuaternion?it.RotationYawPitchRollToRef(n+t,o+r,i,this.rotationQuaternion):(this.rotation.x=o+r,this.rotation.y=n+t,this.rotation.z=i),this},t.prototype.setPivotPoint=function(e,t){void 0===t&&(t=Ht.LOCAL),0==this.getScene().getRenderId()&&this.computeWorldMatrix(!0);var r=this.getWorldMatrix();if(t==Ht.WORLD){var i=ot.Matrix[0];r.invertToRef(i),e=tt.TransformCoordinates(e,i)}return this.setPivotMatrix(nt.Translation(-e.x,-e.y,-e.z),!0)},t.prototype.getPivotPoint=function(){var e=tt.Zero();return this.getPivotPointToRef(e),e},t.prototype.getPivotPointToRef=function(e){return e.x=-this._pivotMatrix.m[12],e.y=-this._pivotMatrix.m[13],e.z=-this._pivotMatrix.m[14],this},t.prototype.getAbsolutePivotPoint=function(){var e=tt.Zero();return this.getAbsolutePivotPointToRef(e),e},t.prototype.getAbsolutePivotPointToRef=function(e){return this.getPivotPointToRef(e),tt.TransformCoordinatesToRef(e,this.getWorldMatrix(),e),this},t.prototype.markAsDirty=function(t){if(this._children)for(var r=0,i=this._children;r<i.length;r++){i[r].markAsDirty(t)}return e.prototype.markAsDirty.call(this,t)},t.prototype.setParent=function(e,r){if(void 0===r&&(r=!1),!e&&!this.parent)return this;var i=ot.Quaternion[0],n=ot.Vector3[0],s=ot.Vector3[1],o=ot.Matrix[1];nt.IdentityToRef(o);var a=ot.Matrix[0];this.computeWorldMatrix(!0);var u=this.rotationQuaternion;return u||(u=t._TmpRotation,it.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,u)),nt.ComposeToRef(this.scaling,u,this.position,a),this.parent&&a.multiplyToRef(this.parent.computeWorldMatrix(!0),a),e&&(e.computeWorldMatrix(!0).invertToRef(o),a.multiplyToRef(o,a)),a.decompose(s,i,n,r?this:void 0),this.rotationQuaternion?this.rotationQuaternion.copyFrom(i):i.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(s),this.position.copyFrom(n),this.parent=e,this},Object.defineProperty(t.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),t.prototype._updateNonUniformScalingState=function(e){return this._nonUniformScaling!==e&&(this._nonUniformScaling=e,!0)},t.prototype.attachToBone=function(e,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=e,e.getSkeleton().prepare(),e.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},t.prototype.detachFromBone=function(e){return void 0===e&&(e=!1),this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=e?this._currentParentWhenAttachingToBone:null,this):(e&&(this.parent=this._currentParentWhenAttachingToBone),this)},t.prototype.rotate=function(e,r,i){var n;if(e.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0)),i&&i!==Ht.LOCAL){if(this.parent){var s=ot.Matrix[0];this.parent.getWorldMatrix().invertToRef(s),e=tt.TransformNormal(e,s)}(n=it.RotationAxisToRef(e,r,t._RotationAxisCache)).multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else n=it.RotationAxisToRef(e,r,t._RotationAxisCache),this.rotationQuaternion.multiplyToRef(n,this.rotationQuaternion);return this},t.prototype.rotateAround=function(e,t,r){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=it.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var i=ot.Vector3[0],n=ot.Vector3[1],s=ot.Vector3[2],o=ot.Quaternion[0],a=ot.Matrix[0],u=ot.Matrix[1],h=ot.Matrix[2],c=ot.Matrix[3];return e.subtractToRef(this.position,i),nt.TranslationToRef(i.x,i.y,i.z,a),nt.TranslationToRef(-i.x,-i.y,-i.z,u),nt.RotationAxisToRef(t,r,h),u.multiplyToRef(h,c),c.multiplyToRef(a,c),c.decompose(n,o,s),this.position.addInPlace(s),o.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},t.prototype.translate=function(e,t,r){var i=e.scale(t);if(r&&r!==Ht.LOCAL)this.setAbsolutePosition(this.getAbsolutePosition().add(i));else{var n=this.getPositionExpressedInLocalSpace().add(i);this.setPositionWithLocalVector(n)}return this},t.prototype.addRotation=function(e,t,r){var i;this.rotationQuaternion?i=this.rotationQuaternion:(i=ot.Quaternion[1],it.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,i));var n=ot.Quaternion[0];return it.RotationYawPitchRollToRef(t,e,r,n),i.multiplyInPlace(n),this.rotationQuaternion||i.toEulerAnglesToRef(this.rotation),this},t.prototype._getEffectiveParent=function(){return this.parent},t.prototype.computeWorldMatrix=function(e){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var r=this.getScene().getRenderId();if(!this._isDirty&&!e&&(this._currentRenderId===r||this.isSynchronized()))return this._currentRenderId=r,this._worldMatrix;var i=this.getScene().activeCamera,n=0!==(this._billboardMode&t.BILLBOARDMODE_USE_POSITION),s=this._billboardMode!==t.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;this._updateCache();var o=this._cache;o.pivotMatrixUpdated=!1,o.billboardMode=this.billboardMode,o.infiniteDistance=this.infiniteDistance,o.parent=this._parentNode,this._currentRenderId=r,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var a,u=this._getEffectiveParent(),h=t._TmpScaling,c=this._position;if(this._infiniteDistance&&!this.parent&&i){var l=i.getWorldMatrix(),f=new tt(l.m[12],l.m[13],l.m[14]);(c=t._TmpTranslation).copyFromFloats(this._position.x+f.x,this._position.y+f.y,this._position.z+f.z)}(h.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion)?(this._rotationQuaternion._isDirty=!1,a=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion&&(M=this.rotation.lengthSquared())&&(this._rotationQuaternion.multiplyInPlace(it.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))):(a=t._TmpRotation,it.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,a));if(this._usePivotMatrix){var d=ot.Matrix[1];nt.ScalingToRef(h.x,h.y,h.z,d);var p=ot.Matrix[0];a.toRotationMatrix(p),this._pivotMatrix.multiplyToRef(d,ot.Matrix[4]),ot.Matrix[4].multiplyToRef(p,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(c.x,c.y,c.z)}else nt.ComposeToRef(h,a,c,this._localMatrix);if(u&&u.getWorldMatrix){if(e&&u.computeWorldMatrix(e),s){this._transformToBoneReferal?u.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),ot.Matrix[7]):ot.Matrix[7].copyFrom(u.getWorldMatrix());var _=ot.Vector3[5],g=ot.Vector3[6];ot.Matrix[7].decompose(g,void 0,_),nt.ScalingToRef(g.x,g.y,g.z,ot.Matrix[7]),ot.Matrix[7].setTranslation(_),this._localMatrix.multiplyToRef(ot.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(u.getWorldMatrix(),ot.Matrix[6]),ot.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(u.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(s&&i&&this.billboardMode&&!n){var m=ot.Vector3[0];if(this._worldMatrix.getTranslationToRef(m),ot.Matrix[1].copyFrom(i.getViewMatrix()),ot.Matrix[1].setTranslationFromFloats(0,0,0),ot.Matrix[1].invertToRef(ot.Matrix[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){ot.Matrix[0].decompose(void 0,ot.Quaternion[0],void 0);var y=ot.Vector3[1];ot.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(y.z=0),nt.RotationYawPitchRollToRef(y.y,y.x,y.z,ot.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(ot.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(ot.Vector3[0])}else if(s&&i&&this.billboardMode&&n){m=ot.Vector3[0];this._worldMatrix.getTranslationToRef(m);var v=i.globalPosition;this._worldMatrix.invertToRef(ot.Matrix[1]);var b=ot.Vector3[1];tt.TransformCoordinatesToRef(v,ot.Matrix[1],b),b.normalize();var T=-Math.atan2(b.z,b.x)+Math.PI/2,M=Math.sqrt(b.x*b.x+b.z*b.z),x=-Math.atan2(b.y,M);if(it.RotationYawPitchRollToRef(T,x,0,ot.Quaternion[0]),(this.billboardMode&t.BILLBOARDMODE_ALL)!==t.BILLBOARDMODE_ALL){y=ot.Vector3[1];ot.Quaternion[0].toEulerAnglesToRef(y),(this.billboardMode&t.BILLBOARDMODE_X)!==t.BILLBOARDMODE_X&&(y.x=0),(this.billboardMode&t.BILLBOARDMODE_Y)!==t.BILLBOARDMODE_Y&&(y.y=0),(this.billboardMode&t.BILLBOARDMODE_Z)!==t.BILLBOARDMODE_Z&&(y.z=0),nt.RotationYawPitchRollToRef(y.y,y.x,y.z,ot.Matrix[0])}else nt.FromQuaternionToRef(ot.Quaternion[0],ot.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(ot.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(ot.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):u&&u._nonUniformScaling?this._updateNonUniformScalingState(u._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=nt.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},t.prototype.resetLocalMatrix=function(e){if(void 0===e&&(e=!0),this.computeWorldMatrix(),e)for(var t=this.getChildren(),r=0;r<t.length;++r){var i=t[r];if(i){i.computeWorldMatrix();var n=ot.Matrix[0];i._localMatrix.multiplyToRef(this._localMatrix,n);var s=ot.Quaternion[0];n.decompose(i.scaling,s,i.position),i.rotationQuaternion?i.rotationQuaternion.copyFrom(s):s.toEulerAnglesToRef(i.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=it.Identity()),this._worldMatrix=nt.Identity()},t.prototype._afterComputeWorldMatrix=function(){},t.prototype.registerAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.add(e),this},t.prototype.unregisterAfterWorldMatrixUpdate=function(e){return this.onAfterWorldMatrixUpdateObservable.removeCallback(e),this},t.prototype.getPositionInCameraSpace=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),tt.TransformCoordinates(this.getAbsolutePosition(),e.getViewMatrix())},t.prototype.getDistanceToCamera=function(e){return void 0===e&&(e=null),e||(e=this.getScene().activeCamera),this.getAbsolutePosition().subtract(e.globalPosition).length()},t.prototype.clone=function(e,r,i){var n=this,s=Mt.Clone((function(){return new t(e,n.getScene())}),this);if(s.name=e,s.id=e,r&&(s.parent=r),!i)for(var o=this.getDescendants(!0),a=0;a<o.length;a++){var u=o[a];u.clone&&u.clone(e+"."+u.name,s)}return s},t.prototype.serialize=function(e){var t=Mt.Serialize(this,e);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().asArray(),t.isEnabled=this.isEnabled(),t},t.Parse=function(e,r,i){var n=Mt.Parse((function(){return new t(e.name,r)}),e,r,i);return e.localMatrix?n.setPreTransformMatrix(nt.FromArray(e.localMatrix)):e.pivotMatrix&&n.setPivotMatrix(nt.FromArray(e.pivotMatrix)),n.setEnabled(e.isEnabled),void 0!==e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(n._waitingParentInstanceIndex=e.parentInstanceIndex),n},t.prototype.getChildTransformNodes=function(e,r){var i=[];return this._getDescendants(i,e,(function(e){return(!r||r(e))&&e instanceof t})),i},t.prototype.dispose=function(t,r){if(void 0===r&&(r=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this._parentContainer){var i=this._parentContainer.transformNodes.indexOf(this);i>-1&&this._parentContainer.transformNodes.splice(i,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),t)for(var n=0,s=this.getChildTransformNodes(!0);n<s.length;n++){var o=s[n];o.parent=null,o.computeWorldMatrix(!0)}e.prototype.dispose.call(this,t,r)},t.prototype.normalizeToUnitCube=function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!1);var i=null,n=null;t&&(this.rotationQuaternion?(n=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(i=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var s=this.getHierarchyBoundingVectors(e,r),o=s.max.subtract(s.min),a=Math.max(o.x,o.y,o.z);if(0===a)return this;var u=1/a;return this.scaling.scaleInPlace(u),t&&(this.rotationQuaternion&&n?this.rotationQuaternion.copyFrom(n):this.rotation&&i&&this.rotation.copyFrom(i)),this},t.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},t.BILLBOARDMODE_NONE=0,t.BILLBOARDMODE_X=1,t.BILLBOARDMODE_Y=2,t.BILLBOARDMODE_Z=4,t.BILLBOARDMODE_ALL=7,t.BILLBOARDMODE_USE_POSITION=128,t._TmpRotation=it.Zero(),t._TmpScaling=tt.Zero(),t._TmpTranslation=tt.Zero(),t._LookAtVectorCache=new tt(0,0,0),t._RotationAxisCache=new it,c([bt("position")],t.prototype,"_position",void 0),c([bt("rotation")],t.prototype,"_rotation",void 0),c([(r="rotationQuaternion",_t(10,r))],t.prototype,"_rotationQuaternion",void 0),c([bt("scaling")],t.prototype,"_scaling",void 0),c([mt("billboardMode")],t.prototype,"_billboardMode",void 0),c([mt()],t.prototype,"scalingDeterminant",void 0),c([mt("infiniteDistance")],t.prototype,"_infiniteDistance",void 0),c([mt()],t.prototype,"ignoreNonUniformScaling",void 0),c([mt()],t.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),t}(At),Qt=function(){function e(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}return e.prototype.getNormal=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Rt.NormalKind))return null;var r,i=this.pickedMesh.getIndices();if(!i)return null;if(t){var n=this.pickedMesh.getVerticesData(Rt.NormalKind),s=tt.FromArray(n,3*i[3*this.faceId]),o=tt.FromArray(n,3*i[3*this.faceId+1]),a=tt.FromArray(n,3*i[3*this.faceId+2]);s=s.scale(this.bu),o=o.scale(this.bv),a=a.scale(1-this.bu-this.bv),r=new tt(s.x+o.x+a.x,s.y+o.y+a.y,s.z+o.z+a.z)}else{var u=this.pickedMesh.getVerticesData(Rt.PositionKind),h=tt.FromArray(u,3*i[3*this.faceId]),c=tt.FromArray(u,3*i[3*this.faceId+1]),l=tt.FromArray(u,3*i[3*this.faceId+2]),f=h.subtract(c),d=l.subtract(c);r=tt.Cross(f,d)}if(e){var p=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(ot.Matrix[0].copyFrom(p),(p=ot.Matrix[0]).setTranslationFromFloats(0,0,0),p.invert(),p.transposeToRef(ot.Matrix[1]),p=ot.Matrix[1]),r=tt.TransformNormal(r,p)}return r.normalize(),r},e.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(Rt.UVKind))return null;var e=this.pickedMesh.getIndices();if(!e)return null;var t=this.pickedMesh.getVerticesData(Rt.UVKind);if(!t)return null;var r=et.FromArray(t,2*e[3*this.faceId]),i=et.FromArray(t,2*e[3*this.faceId+1]),n=et.FromArray(t,2*e[3*this.faceId+2]);return r=r.scale(this.bu),i=i.scale(this.bv),n=n.scale(1-this.bu-this.bv),new et(r.x+i.x+n.x,r.y+i.y+n.y)},e}();me.prototype.createUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create uniform buffer");var r=new ce(t);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},me.prototype.createDynamicUniformBuffer=function(e){var t=this._gl.createBuffer();if(!t)throw new Error("Unable to create dynamic uniform buffer");var r=new ce(t);return this.bindUniformBuffer(r),e instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,e,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(e),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),r.references=1,r},me.prototype.updateUniformBuffer=function(e,t,r,i){this.bindUniformBuffer(e),void 0===r&&(r=0),void 0===i?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,r,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(r,r+i)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(r,r+i)),this.bindUniformBuffer(null)},me.prototype.bindUniformBuffer=function(e){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,e?e.underlyingResource:null)},me.prototype.bindUniformBufferBase=function(e,t,r){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,e?e.underlyingResource:null)},me.prototype.bindUniformBlock=function(e,t,r){var i=e.program,n=this._gl.getUniformBlockIndex(i,t);4294967295!==n&&this._gl.uniformBlockBinding(i,n,r)};var Jt=function(){function e(e,t,r,i,n){void 0===n&&(n=!1),this._valueCache={},this._engine=e,this._noUBO=!e.supportsUniformBuffers||n,this._dynamic=r,this._name=null!==i&&void 0!==i?i:"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return Object.defineProperty(e.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),e.prototype.isDynamic=function(){return void 0!==this._dynamic},e.prototype.getData=function(){return this._bufferData},e.prototype.getBuffer=function(){return this._buffer},e.prototype._fillAlignment=function(e){var t;if(t=e<=2?e:4,this._uniformLocationPointer%t!==0){var r=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;for(var i=this._uniformLocationPointer-r,n=0;n<i;n++)this._data.push(0)}},e.prototype.addUniform=function(e,t,r){if(void 0===r&&(r=0),!this._noUBO&&void 0===this._uniformLocations[e]){var i;if(r>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+e;if(this._fillAlignment(4),this._uniformArraySizes[e]={strideSize:t,arraySize:r},16==t)t*=r;else t=t*r+(4-t)*r;i=[];for(var n=0;n<t;n++)i.push(0)}else{if(t instanceof Array)t=(i=t).length;else{t=t,i=[];for(n=0;n<t;n++)i.push(0)}this._fillAlignment(t)}this._uniformSizes[e]=t,this._uniformLocations[e]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(n=0;n<t;n++)this._data.push(i[n]);this._needSync=!0}},e.prototype.addMatrix=function(e,t){this.addUniform(e,Array.prototype.slice.call(t.toArray()))},e.prototype.addFloat2=function(e,t,r){var i=[t,r];this.addUniform(e,i)},e.prototype.addFloat3=function(e,t,r,i){var n=[t,r,i];this.addUniform(e,n)},e.prototype.addColor3=function(e,t){var r=[t.r,t.g,t.b];this.addUniform(e,r)},e.prototype.addColor4=function(e,t,r){var i=[t.r,t.g,t.b,r];this.addUniform(e,i)},e.prototype.addVector3=function(e,t){var r=[t.x,t.y,t.z];this.addUniform(e,r)},e.prototype.addMatrix3x3=function(e){this.addUniform(e,12)},e.prototype.addMatrix2x2=function(e){this.addUniform(e,8)},e.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},e.prototype._rebuild=function(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(e.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype._buffersEqual=function(e,t){for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0},e.prototype._copyBuffer=function(e,t){for(var r=0;r<e.length;++r)t[r]=e[r]},e.prototype.update=function(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(e._UpdatedUbosInFrame[this._name]||(e._UpdatedUbosInFrame[this._name]=0),e._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()},e.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()},e.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)},e.prototype.updateUniform=function(e,t,r){this._checkNewFrame();var i=this._uniformLocations[e];if(void 0===i){if(this._buffer)return void T.Error("Cannot add an uniform after UBO has been created.");this.addUniform(e,r),i=this._uniformLocations[e]}if(this._buffer||this.create(),this._dynamic)for(s=0;s<r;s++)this._bufferData[i+s]=t[s];else{for(var n=!1,s=0;s<r;s++)(16===r&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[i+s]!==Ve.FloatRound(t[s]))&&(n=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[i+s]=t[s]);this._needSync=this._needSync||n}},e.prototype.updateUniformArray=function(e,t,r){this._checkNewFrame();var i=this._uniformLocations[e];if(void 0!==i){this._buffer||this.create();var n=this._uniformArraySizes[e];if(this._dynamic)for(u=0;u<r;u++)this._bufferData[i+u]=t[u];else{for(var s=!1,o=0,a=0,u=0;u<r;u++)if(this._bufferData[i+4*a+o]!==Ve.FloatRound(t[u])&&(s=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[i+4*a+o]=t[u]),++o===n.strideSize){for(;o<4;o++)this._bufferData[i+4*a+o]=0;o=0,a++}this._needSync=this._needSync||s}}else T.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.")},e.prototype._cacheMatrix=function(e,t){this._checkNewFrame();var r=this._valueCache[e],i=t.updateFlag;return(void 0===r||r!==i)&&(this._valueCache[e]=i,!0)},e.prototype._updateMatrix3x3ForUniform=function(t,r){for(var i=0;i<3;i++)e._TempBuffer[4*i]=r[3*i],e._TempBuffer[4*i+1]=r[3*i+1],e._TempBuffer[4*i+2]=r[3*i+2],e._TempBuffer[4*i+3]=0;this.updateUniform(t,e._TempBuffer,12)},e.prototype._updateMatrix3x3ForEffect=function(e,t){this._currentEffect.setMatrix3x3(e,t)},e.prototype._updateMatrix2x2ForEffect=function(e,t){this._currentEffect.setMatrix2x2(e,t)},e.prototype._updateMatrix2x2ForUniform=function(t,r){for(var i=0;i<2;i++)e._TempBuffer[4*i]=r[2*i],e._TempBuffer[4*i+1]=r[2*i+1],e._TempBuffer[4*i+2]=0,e._TempBuffer[4*i+3]=0;this.updateUniform(t,e._TempBuffer,8)},e.prototype._updateFloatForEffect=function(e,t){this._currentEffect.setFloat(e,t)},e.prototype._updateFloatForUniform=function(t,r){e._TempBuffer[0]=r,this.updateUniform(t,e._TempBuffer,1)},e.prototype._updateFloat2ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setFloat2(e+i,t,r)},e.prototype._updateFloat2ForUniform=function(t,r,i){e._TempBuffer[0]=r,e._TempBuffer[1]=i,this.updateUniform(t,e._TempBuffer,2)},e.prototype._updateFloat3ForEffect=function(e,t,r,i,n){void 0===n&&(n=""),this._currentEffect.setFloat3(e+n,t,r,i)},e.prototype._updateFloat3ForUniform=function(t,r,i,n){e._TempBuffer[0]=r,e._TempBuffer[1]=i,e._TempBuffer[2]=n,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateFloat4ForEffect=function(e,t,r,i,n,s){void 0===s&&(s=""),this._currentEffect.setFloat4(e+s,t,r,i,n)},e.prototype._updateFloat4ForUniform=function(t,r,i,n,s){e._TempBuffer[0]=r,e._TempBuffer[1]=i,e._TempBuffer[2]=n,e._TempBuffer[3]=s,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateFloatArrayForEffect=function(e,t){this._currentEffect.setFloatArray(e,t)},e.prototype._updateFloatArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},e.prototype._updateArrayForEffect=function(e,t){this._currentEffect.setArray(e,t)},e.prototype._updateArrayForUniform=function(e,t){this.updateUniformArray(e,t,t.length)},e.prototype._updateIntArrayForEffect=function(e,t){this._currentEffect.setIntArray(e,t)},e.prototype._updateIntArrayForUniform=function(t,r){e._TempBufferInt32View.set(r),this.updateUniformArray(t,e._TempBuffer,r.length)},e.prototype._updateMatrixForEffect=function(e,t){this._currentEffect.setMatrix(e,t)},e.prototype._updateMatrixForUniform=function(e,t){this._cacheMatrix(e,t)&&this.updateUniform(e,t.toArray(),16)},e.prototype._updateMatricesForEffect=function(e,t){this._currentEffect.setMatrices(e,t)},e.prototype._updateMatricesForUniform=function(e,t){this.updateUniform(e,t,t.length)},e.prototype._updateVector3ForEffect=function(e,t){this._currentEffect.setVector3(e,t)},e.prototype._updateVector3ForUniform=function(t,r){e._TempBuffer[0]=r.x,e._TempBuffer[1]=r.y,e._TempBuffer[2]=r.z,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateVector4ForEffect=function(e,t){this._currentEffect.setVector4(e,t)},e.prototype._updateVector4ForUniform=function(t,r){e._TempBuffer[0]=r.x,e._TempBuffer[1]=r.y,e._TempBuffer[2]=r.z,e._TempBuffer[3]=r.w,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateColor3ForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setColor3(e+r,t)},e.prototype._updateColor3ForUniform=function(t,r){e._TempBuffer[0]=r.r,e._TempBuffer[1]=r.g,e._TempBuffer[2]=r.b,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateColor4ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setColor4(e+i,t,r)},e.prototype._updateDirectColor4ForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setDirectColor4(e+r,t)},e.prototype._updateColor4ForUniform=function(t,r,i){e._TempBuffer[0]=r.r,e._TempBuffer[1]=r.g,e._TempBuffer[2]=r.b,e._TempBuffer[3]=i,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateDirectColor4ForUniform=function(t,r){e._TempBuffer[0]=r.r,e._TempBuffer[1]=r.g,e._TempBuffer[2]=r.b,e._TempBuffer[3]=r.a,this.updateUniform(t,e._TempBuffer,4)},e.prototype._updateIntForEffect=function(e,t,r){void 0===r&&(r=""),this._currentEffect.setInt(e+r,t)},e.prototype._updateIntForUniform=function(t,r){e._TempBufferInt32View[0]=r,this.updateUniform(t,e._TempBuffer,1)},e.prototype._updateInt2ForEffect=function(e,t,r,i){void 0===i&&(i=""),this._currentEffect.setInt2(e+i,t,r)},e.prototype._updateInt2ForUniform=function(t,r,i){e._TempBufferInt32View[0]=r,e._TempBufferInt32View[1]=i,this.updateUniform(t,e._TempBuffer,2)},e.prototype._updateInt3ForEffect=function(e,t,r,i,n){void 0===n&&(n=""),this._currentEffect.setInt3(e+n,t,r,i)},e.prototype._updateInt3ForUniform=function(t,r,i,n){e._TempBufferInt32View[0]=r,e._TempBufferInt32View[1]=i,e._TempBufferInt32View[2]=n,this.updateUniform(t,e._TempBuffer,3)},e.prototype._updateInt4ForEffect=function(e,t,r,i,n,s){void 0===s&&(s=""),this._currentEffect.setInt4(e+s,t,r,i,n)},e.prototype._updateInt4ForUniform=function(t,r,i,n,s){e._TempBufferInt32View[0]=r,e._TempBufferInt32View[1]=i,e._TempBufferInt32View[2]=n,e._TempBufferInt32View[3]=s,this.updateUniform(t,e._TempBuffer,4)},e.prototype.setTexture=function(e,t){this._currentEffect.setTexture(e,t)},e.prototype.updateUniformDirectly=function(e,t){this.updateUniform(e,t,t.length),this.update()},e.prototype.bindToEffect=function(e,t){this._currentEffect=e,this._currentEffectName=t},e.prototype.bindUniformBuffer=function(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},e.prototype.unbindEffect=function(){this._currentEffect=void 0,this._currentEffectName=void 0},e.prototype.setDataBuffer=function(e){if(!this._buffers)return this._buffer===e;for(var t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===e)return this._bufferIndex=t,this._buffer=e,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1},e.prototype.dispose=function(){if(!this._noUBO){var e=this._engine._uniformBuffers,t=e.indexOf(this);if(-1!==t&&(e[t]=e[e.length-1],e.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var r=0;r<this._buffers.length;++r){var i=this._buffers[r][0];this._engine._releaseBuffer(i)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},e._UpdatedUbosInFrame={},e._MAX_UNIFORM_SIZE=256,e._TempBuffer=new Float32Array(e._MAX_UNIFORM_SIZE),e._TempBufferInt32View=new Uint32Array(e._TempBuffer.buffer),e}(),$t=function(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new tt(0,0,0),this._diffPositionForCollisions=new tt(0,0,0),this._collisionResponse=!0},er=function(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=tt.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1},tr=function(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new er,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._meshCollisionData=new $t,this._enableDistantPicking=!1},rr=function(e){function t(r,i){void 0===i&&(i=null);var n=e.call(this,r,i,!1)||this;return n._internalAbstractMeshDataInfo=new tr,n._waitingMaterialId=null,n.cullingStrategy=t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,n.onCollideObservable=new _,n.onCollisionPositionChangeObservable=new _,n.onMaterialChangedObservable=new _,n.definedFacingForward=!0,n._occlusionQuery=null,n._renderingGroup=null,n.alphaIndex=Number.MAX_VALUE,n.isVisible=!0,n.isPickable=!0,n.isNearPickable=!1,n.isNearGrabbable=!1,n.showSubMeshesBoundingBox=!1,n.isBlocker=!1,n.enablePointerMoveEvents=!1,n.outlineColor=ut.Red(),n.outlineWidth=.02,n.overlayColor=ut.Red(),n.overlayAlpha=.5,n.useOctreeForRenderingSelection=!0,n.useOctreeForPicking=!0,n.useOctreeForCollisions=!0,n.alwaysSelectAsActiveMesh=!1,n.doNotSyncBoundingInfo=!1,n.actionManager=null,n.ellipsoid=new tt(.5,1,.5),n.ellipsoidOffset=new tt(0,0,0),n.edgesWidth=1,n.edgesColor=new ht(1,0,0,1),n._edgesRenderer=null,n._masterMesh=null,n._boundingInfo=null,n._boundingInfoIsDirty=!0,n._renderId=0,n._intersectionsInProgress=new Array,n._unIndexed=!1,n._lightSources=new Array,n._waitingData={lods:null,actions:null,freezeWorldMatrix:null},n._bonesTransformMatrices=null,n._transformMatrixTexture=null,n.onRebuildObservable=new _,n._onCollisionPositionChange=function(e,t,r){void 0===r&&(r=null),t.subtractToRef(n._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,n._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),n._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>Xt.CollisionsEpsilon&&n.position.addInPlace(n._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),r&&n.onCollideObservable.notifyObservers(r),n.onCollisionPositionChangeObservable.notifyObservers(n.position)},n.getScene().addMesh(n),n._resyncLightSources(),n._uniformBuffer=new Jt(n.getScene().getEngine(),void 0,void 0,r,!n.getScene().getEngine().isWebGPU),n._buildUniformLayout(),n}return u(t,e),Object.defineProperty(t,"BILLBOARDMODE_NONE",{get:function(){return Zt.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_X",{get:function(){return Zt.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Y",{get:function(){return Zt.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_Z",{get:function(){return Zt.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_ALL",{get:function(){return Zt.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(t,"BILLBOARDMODE_USE_POSITION",{get:function(){return Zt.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(e){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(e){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionRetryCount",{get:function(){return this._internalAbstractMeshDataInfo._collisionRetryCount},set:function(e){this._internalAbstractMeshDataInfo._collisionRetryCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"morphTargetManager",{get:function(){return this._internalAbstractMeshDataInfo._morphTargetManager},set:function(e){this._internalAbstractMeshDataInfo._morphTargetManager!==e&&(this._internalAbstractMeshDataInfo._morphTargetManager=e,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bakedVertexAnimationManager",{get:function(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager},set:function(e){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==e&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),t.prototype._syncGeometryWithMorphTargetManager=function(){},t.prototype._updateNonUniformScalingState=function(t){return!!e.prototype._updateNonUniformScalingState.call(this,t)&&(this._markSubMeshesAsMiscDirty(),!0)},Object.defineProperty(t.prototype,"onCollide",{set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onCollisionPositionChange",{set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(e){if(this._internalAbstractMeshDataInfo._visibility!==e){var t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=e,(1===t&&1!==e||1!==t&&1===e)&&this._markSubMeshesAsMiscDirty()}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderingGroupId",{get:function(){return this._internalAbstractMeshDataInfo._renderingGroupId},set:function(e){this._internalAbstractMeshDataInfo._renderingGroupId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this._internalAbstractMeshDataInfo._material},set:function(e){this._internalAbstractMeshDataInfo._material!==e&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=e,e&&e.meshMap&&(e.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.subMeshes&&(this.resetDrawCache(),this._unBindEffect()))},enumerable:!1,configurable:!0}),t.prototype.getMaterialForRenderPass=function(e){var t;return null===(t=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===t?void 0:t[e]},t.prototype.setMaterialForRenderPass=function(e,t){this.resetDrawCache(e),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[e]=t},Object.defineProperty(t.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(e){this._internalAbstractMeshDataInfo._receiveShadows!==e&&(this._internalAbstractMeshDataInfo._receiveShadows=e,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(e){this._internalAbstractMeshDataInfo._hasVertexAlpha!==e&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=e,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(e){this._internalAbstractMeshDataInfo._useVertexColors!==e&&(this._internalAbstractMeshDataInfo._useVertexColors=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(e){this._internalAbstractMeshDataInfo._numBoneInfluencers!==e&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(e){this._internalAbstractMeshDataInfo._applyFog!==e&&(this._internalAbstractMeshDataInfo._applyFog=e,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableDistantPicking",{get:function(){return this._internalAbstractMeshDataInfo._enableDistantPicking},set:function(e){this._internalAbstractMeshDataInfo._enableDistantPicking=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(e){e!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=e,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionMask",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionResponse",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionGroup",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(e)?-1:e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"surroundingMeshes",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(e){var t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),e&&e.needInitialSkinMatrix&&e._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=e,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),t.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()},t.prototype.transferToEffect=function(e){var t=this._uniformBuffer;t.updateMatrix("world",e),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()},t.prototype.getMeshUniformBuffer=function(){return this._uniformBuffer},t.prototype.getClassName=function(){return"AbstractMesh"},t.prototype.toString=function(e){var t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var r=this._internalAbstractMeshDataInfo._skeleton;return r&&(t+=", skeleton: "+r.name),e&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),t},t.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==Zt.BILLBOARDMODE_NONE?this._masterMesh:e.prototype._getEffectiveParent.call(this)},t.prototype._getActionManagerForTrigger=function(e,t){if(void 0===t&&(t=!0),this.actionManager&&(t||this.actionManager.isRecursive)){if(!e)return this.actionManager;if(this.actionManager.hasSpecificTrigger(e))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(e,!1):null},t.prototype._rebuild=function(e){if(void 0===e&&(e=!1),this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.subMeshes)for(var t=0,r=this.subMeshes;t<r.length;t++){r[t]._rebuild()}},t.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var e=0,t=this.getScene().lights;e<t.length;e++){var r=t[e];r.isEnabled()&&(r.canAffectMesh(this)&&this._lightSources.push(r))}this._markSubMeshesAsLightDirty()},t.prototype._resyncLightSource=function(e){var t=e.isEnabled()&&e.canAffectMesh(this),r=this._lightSources.indexOf(e),i=!1;if(-1===r){if(!t)return;this._lightSources.push(e)}else{if(t)return;i=!0,this._lightSources.splice(r,1)}this._markSubMeshesAsLightDirty(i)},t.prototype._unBindEffect=function(){for(var e=0,t=this.subMeshes;e<t.length;e++){t[e].setEffect(null)}},t.prototype._removeLightSource=function(e,t){var r=this._lightSources.indexOf(e);-1!==r&&(this._lightSources.splice(r,1),this._markSubMeshesAsLightDirty(t))},t.prototype._markSubMeshesAsDirty=function(e){if(this.subMeshes)for(var t=0,r=this.subMeshes;t<r.length;t++)for(var i=r[t],n=0;n<i._drawWrappers.length;++n){var s=i._drawWrappers[n];s&&s.defines&&s.defines.markAllAsDirty&&e(s.defines)}},t.prototype._markSubMeshesAsLightDirty=function(e){void 0===e&&(e=!1),this._markSubMeshesAsDirty((function(t){return t.markAsLightDirty(e)}))},t.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty((function(e){return e.markAsAttributesDirty()}))},t.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty((function(e){return e.markAsMiscDirty()}))},t.prototype.markAsDirty=function(e){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},t.prototype.resetDrawCache=function(e){if(this.subMeshes)for(var t=0,r=this.subMeshes;t<r.length;t++){r[t].resetDrawCache(e)}},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.getLOD=function(e){return this},t.prototype.getTotalVertices=function(){return 0},t.prototype.getTotalIndices=function(){return 0},t.prototype.getIndices=function(){return null},t.prototype.getVerticesData=function(e){return null},t.prototype.setVerticesData=function(e,t,r,i){return this},t.prototype.updateVerticesData=function(e,t,r,i){return this},t.prototype.setIndices=function(e,t){return this},t.prototype.isVerticesDataPresent=function(e){return!1},t.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this._updateBoundingInfo()),this._boundingInfo)},t.prototype.setBoundingInfo=function(e){return this._boundingInfo=e,this},Object.defineProperty(t.prototype,"hasBoundingInfo",{get:function(){return null!==this._boundingInfo},enumerable:!1,configurable:!0}),t.prototype.buildBoundingInfo=function(e,t,r){return this._boundingInfo=new Lt(e,t,r),this._boundingInfo},t.prototype.normalizeToUnitCube=function(t,r,i){return void 0===t&&(t=!0),void 0===r&&(r=!1),e.prototype.normalizeToUnitCube.call(this,t,r,i)},Object.defineProperty(t.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(Rt.MatricesIndicesKind)&&this.isVerticesDataPresent(Rt.MatricesWeightsKind)},enumerable:!1,configurable:!0}),t.prototype._preActivate=function(){},t.prototype._preActivateForIntermediateRendering=function(e){},t.prototype._activate=function(e,t){return this._renderId=e,!0},t.prototype._postActivate=function(){},t.prototype._freeze=function(){},t.prototype._unFreeze=function(){},t.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===Zt.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():e.prototype.getWorldMatrix.call(this)},t.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():e.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(t.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),t.prototype.movePOV=function(e,t,r){return this.position.addInPlace(this.calcMovePOV(e,t,r)),this},t.prototype.calcMovePOV=function(e,t,r){var i=new nt;(this.rotationQuaternion?this.rotationQuaternion:it.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(i);var n=tt.Zero(),s=this.definedFacingForward?-1:1;return tt.TransformCoordinatesFromFloatsToRef(e*s,t,r*s,i,n),n},t.prototype.rotatePOV=function(e,t,r){return this.rotation.addInPlace(this.calcRotatePOV(e,t,r)),this},t.prototype.calcRotatePOV=function(e,t,r){var i=this.definedFacingForward?1:-1;return new tt(e*i,t,r*i)},t.prototype.refreshBoundingInfo=function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),this._boundingInfo&&this._boundingInfo.isLocked||this._refreshBoundingInfo(this._getPositionData(e,t),null),this},t.prototype._refreshBoundingInfo=function(e,t){if(e){var r=Ut(e,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(r.minimum,r.maximum):this._boundingInfo=new Lt(r.minimum,r.maximum)}if(this.subMeshes)for(var i=0;i<this.subMeshes.length;i++)this.subMeshes[i].refreshBoundingInfo(e);this._updateBoundingInfo()},t.prototype._getData=function(e,t,r,i){if(void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===i&&(i=Rt.PositionKind),(r=null!==r&&void 0!==r?r:this.getVerticesData(i).slice())&&t&&this.morphTargetManager)for(var n=0,s=0,o=0;o<r.length;o++){for(var a=0;a<this.morphTargetManager.numTargets;a++){var u=this.morphTargetManager.getTarget(a),h=u.influence;if(h>0){var c=u.getPositions();c&&(r[o]+=(c[o]-r[o])*h)}}if(n++,i===Rt.PositionKind&&this._positions&&3===n){n=0;var l=3*s;this._positions[s++].copyFromFloats(r[l],r[l+1],r[l+2])}}if(r&&e&&this.skeleton){var f=this.getVerticesData(Rt.MatricesIndicesKind),d=this.getVerticesData(Rt.MatricesWeightsKind);if(d&&f){var p=this.numBoneInfluencers>4,_=p?this.getVerticesData(Rt.MatricesIndicesExtraKind):null,g=p?this.getVerticesData(Rt.MatricesWeightsExtraKind):null,m=this.skeleton.getTransformMatrices(this),y=ot.Vector3[0],v=ot.Matrix[0],b=ot.Matrix[1],T=0;for(l=0;l<r.length;l+=3,T+=4){v.reset();var M=void 0,x=void 0;for(M=0;M<4;M++)(x=d[T+M])>0&&(nt.FromFloat32ArrayToRefScaled(m,Math.floor(16*f[T+M]),x,b),v.addToSelf(b));if(p)for(M=0;M<4;M++)(x=g[T+M])>0&&(nt.FromFloat32ArrayToRefScaled(m,Math.floor(16*_[T+M]),x,b),v.addToSelf(b));i===Rt.NormalKind?tt.TransformNormalFromFloatsToRef(r[l],r[l+1],r[l+2],v,y):tt.TransformCoordinatesFromFloatsToRef(r[l],r[l+1],r[l+2],v,y),y.toArray(r,l),i===Rt.PositionKind&&this._positions&&this._positions[l/3].copyFrom(y)}}}return r},t.prototype.getNormalsData=function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),this._getData(e,t,null,Rt.NormalKind)},t.prototype.getPositionData=function(e,t,r){return void 0===e&&(e=!1),void 0===t&&(t=!1),this._getData(e,t,r,Rt.PositionKind)},t.prototype._getPositionData=function(e,t){var r,i=this.getVerticesData(Rt.PositionKind);if(this._internalAbstractMeshDataInfo._positions&&(this._internalAbstractMeshDataInfo._positions=null),i&&(e&&this.skeleton||t&&this.morphTargetManager)){if(i=i.slice(),this._generatePointsArray(),this._positions){var n=this._positions;this._internalAbstractMeshDataInfo._positions=new Array(n.length);for(var s=0;s<n.length;s++)this._internalAbstractMeshDataInfo._positions[s]=(null===(r=n[s])||void 0===r?void 0:r.clone())||new tt}return this.getPositionData(e,t,i)}return i},t.prototype._updateBoundingInfo=function(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new Lt(tt.Zero(),tt.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this},t.prototype._updateSubMeshesBoundingInfo=function(e){if(!this.subMeshes)return this;for(var t=this.subMeshes.length,r=0;r<t;r++){var i=this.subMeshes[r];(t>1||!i.IsGlobal)&&i.updateBoundingInfo(e)}return this},t.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||(this._boundingInfoIsDirty=!0)},t.prototype.isInFrustum=function(e){return this.getBoundingInfo().isInFrustum(e,this.cullingStrategy)},t.prototype.isCompletelyInFrustum=function(e){return this.getBoundingInfo().isCompletelyInFrustum(e)},t.prototype.intersectsMesh=function(e,t,r){void 0===t&&(t=!1);var i=this.getBoundingInfo(),n=e.getBoundingInfo();if(i.intersects(n,t))return!0;if(r)for(var s=0,o=this.getChildMeshes();s<o.length;s++){if(o[s].intersectsMesh(e,t,!0))return!0}return!1},t.prototype.intersectsPoint=function(e){return this.getBoundingInfo().intersectsPoint(e)},Object.defineProperty(t.prototype,"checkCollisions",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions},set:function(e){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collider",{get:function(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider},enumerable:!1,configurable:!0}),t.prototype.moveWithCollisions=function(e){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);var t=this.getScene().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,e,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this},t.prototype._collideForSubMesh=function(e,t,r){var i;if(this._generatePointsArray(),!this._positions)return this;if(!e._lastColliderWorldVertices||!e._lastColliderTransformMatrix.equals(t)){e._lastColliderTransformMatrix=t.clone(),e._lastColliderWorldVertices=[],e._trianglePlanes=[];for(var n=e.verticesStart,s=e.verticesStart+e.verticesCount,o=n;o<s;o++)e._lastColliderWorldVertices.push(tt.TransformCoordinates(this._positions[o],t))}return r._collide(e._trianglePlanes,e._lastColliderWorldVertices,this.getIndices(),e.indexStart,e.indexStart+e.indexCount,e.verticesStart,!!e.getMaterial(),this,this._shouldConvertRHS(),7===(null===(i=e.getMaterial())||void 0===i?void 0:i.fillMode)),this},t.prototype._processCollisionsForSubMeshes=function(e,t){for(var r=this._scene.getCollidingSubMeshCandidates(this,e),i=r.length,n=0;n<i;n++){var s=r.data[n];i>1&&!s._checkCollision(e)||this._collideForSubMesh(s,t,e)}return this},t.prototype._shouldConvertRHS=function(){return!1},t.prototype._checkCollision=function(e){if(!this.getBoundingInfo()._checkCollision(e))return this;var t=ot.Matrix[0],r=ot.Matrix[1];return nt.ScalingToRef(1/e._radius.x,1/e._radius.y,1/e._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,r),this._processCollisionsForSubMeshes(e,r),this},t.prototype._generatePointsArray=function(){return!1},t.prototype.intersects=function(e,t,r,i,n,s){void 0===i&&(i=!1),void 0===s&&(s=!1);var o=new Qt,a="InstancedLinesMesh"===this.getClassName()||"LinesMesh"===this.getClassName()?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.subMeshes)return o;if(!s&&(!e.intersectsSphere(u.boundingSphere,a)||!e.intersectsBox(u.boundingBox,a)))return o;if(i)return o.hit=!s,o.pickedMesh=s?null:this,o.distance=s?0:tt.Distance(e.origin,u.boundingSphere.center),o.subMeshId=0,o;if(!this._generatePointsArray())return o;for(var h=null,c=this._scene.getIntersectingSubMeshCandidates(this,e),l=c.length,f=!1,d=0;d<l;d++){var p=(_=c.data[d]).getMaterial();if(p&&(7==p.fillMode||0==p.fillMode||1==p.fillMode||2==p.fillMode||4==p.fillMode)){f=!0;break}}if(!f)return o.hit=!0,o.pickedMesh=this,o.distance=tt.Distance(e.origin,u.boundingSphere.center),o.subMeshId=-1,o;for(d=0;d<l;d++){var _=c.data[d];if(!(l>1)||_.canIntersects(e)){var g=_.intersects(e,this._positions,this.getIndices(),t,r);if(g&&(t||!h||g.distance<h.distance)&&((h=g).subMeshId=d,t))break}}if(h){var m=null!==n&&void 0!==n?n:this.getWorldMatrix(),y=ot.Vector3[0],v=ot.Vector3[1];tt.TransformCoordinatesToRef(e.origin,m,y),e.direction.scaleToRef(h.distance,v);var b=tt.TransformNormal(v,m).addInPlace(y);return o.hit=!0,o.distance=tt.Distance(y,b),o.pickedPoint=b,o.pickedMesh=this,o.bu=h.bu||0,o.bv=h.bv||0,o.subMeshFaceId=h.faceId,o.faceId=h.faceId+c.data[h.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),o.subMeshId=h.subMeshId,o}return o},t.prototype.clone=function(e,t,r){return null},t.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},t.prototype.dispose=function(t,r){var i,n=this;for(void 0===r&&(r=!1),this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),i=0;i<this._intersectionsInProgress.length;i++){var s=this._intersectionsInProgress[i],o=s._intersectionsInProgress.indexOf(this);s._intersectionsInProgress.splice(o,1)}this._intersectionsInProgress=[],this.getScene().lights.forEach((function(e){var t=e.includedOnlyMeshes.indexOf(n);-1!==t&&e.includedOnlyMeshes.splice(t,1),-1!==(t=e.excludedMeshes.indexOf(n))&&e.excludedMeshes.splice(t,1);var r=e.getShadowGenerator();if(r){var i=r.getShadowMap();i&&i.renderList&&-1!==(t=i.renderList.indexOf(n))&&i.renderList.splice(t,1)}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();var a=this.getScene().getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,a.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),a.wipeCaches(),this.getScene().removeMesh(this),this._parentContainer){var u=this._parentContainer.meshes.indexOf(this);u>-1&&this._parentContainer.meshes.splice(u,1),this._parentContainer=null}if(r&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!t)for(i=0;i<this.getScene().particleSystems.length;i++)this.getScene().particleSystems[i].emitter===this&&(this.getScene().particleSystems[i].dispose(),i--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),e.prototype.dispose.call(this,t,r)},t.prototype.addChild=function(e,t){return void 0===t&&(t=!1),e.setParent(this,t),this},t.prototype.removeChild=function(e,t){return void 0===t&&(t=!1),e.setParent(null,t),this},t.prototype._initFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetNormals||(e.facetNormals=new Array),e.facetPositions||(e.facetPositions=new Array),e.facetPartitioning||(e.facetPartitioning=new Array),e.facetNb=this.getIndices().length/3|0,e.partitioningSubdivisions=e.partitioningSubdivisions?e.partitioningSubdivisions:10,e.partitioningBBoxRatio=e.partitioningBBoxRatio?e.partitioningBBoxRatio:1.01;for(var t=0;t<e.facetNb;t++)e.facetNormals[t]=tt.Zero(),e.facetPositions[t]=tt.Zero();return e.facetDataEnabled=!0,this},t.prototype.updateFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;e.facetDataEnabled||this._initFacetData();var t=this.getVerticesData(Rt.PositionKind),r=this.getIndices(),i=this.getVerticesData(Rt.NormalKind),n=this.getBoundingInfo();if(e.facetDepthSort&&!e.facetDepthSortEnabled){if(e.facetDepthSortEnabled=!0,r instanceof Uint16Array)e.depthSortedIndices=new Uint16Array(r);else if(r instanceof Uint32Array)e.depthSortedIndices=new Uint32Array(r);else{for(var s=!1,o=0;o<r.length;o++)if(r[o]>65535){s=!0;break}e.depthSortedIndices=s?new Uint32Array(r):new Uint16Array(r)}if(e.facetDepthSortFunction=function(e,t){return t.sqDistance-e.sqDistance},!e.facetDepthSortFrom){var a=this.getScene().activeCamera;e.facetDepthSortFrom=a?a.position:tt.Zero()}e.depthSortedFacets=[];for(var u=0;u<e.facetNb;u++){var h={ind:3*u,sqDistance:0};e.depthSortedFacets.push(h)}e.invertedMatrix=nt.Identity(),e.facetDepthSortOrigin=tt.Zero()}e.bbSize.x=n.maximum.x-n.minimum.x>Qe?n.maximum.x-n.minimum.x:Qe,e.bbSize.y=n.maximum.y-n.minimum.y>Qe?n.maximum.y-n.minimum.y:Qe,e.bbSize.z=n.maximum.z-n.minimum.z>Qe?n.maximum.z-n.minimum.z:Qe;var c=e.bbSize.x>e.bbSize.y?e.bbSize.x:e.bbSize.y;if(c=c>e.bbSize.z?c:e.bbSize.z,e.subDiv.max=e.partitioningSubdivisions,e.subDiv.X=Math.floor(e.subDiv.max*e.bbSize.x/c),e.subDiv.Y=Math.floor(e.subDiv.max*e.bbSize.y/c),e.subDiv.Z=Math.floor(e.subDiv.max*e.bbSize.z/c),e.subDiv.X=e.subDiv.X<1?1:e.subDiv.X,e.subDiv.Y=e.subDiv.Y<1?1:e.subDiv.Y,e.subDiv.Z=e.subDiv.Z<1?1:e.subDiv.Z,e.facetParameters.facetNormals=this.getFacetLocalNormals(),e.facetParameters.facetPositions=this.getFacetLocalPositions(),e.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),e.facetParameters.bInfo=n,e.facetParameters.bbSize=e.bbSize,e.facetParameters.subDiv=e.subDiv,e.facetParameters.ratio=this.partitioningBBoxRatio,e.facetParameters.depthSort=e.facetDepthSort,e.facetDepthSort&&e.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(e.invertedMatrix),tt.TransformCoordinatesToRef(e.facetDepthSortFrom,e.invertedMatrix,e.facetDepthSortOrigin),e.facetParameters.distanceTo=e.facetDepthSortOrigin),e.facetParameters.depthSortedFacets=e.depthSortedFacets,i&&It.ComputeNormals(t,r,i,e.facetParameters),e.facetDepthSort&&e.facetDepthSortEnabled){e.depthSortedFacets.sort(e.facetDepthSortFunction);var l=e.depthSortedIndices.length/3|0;for(u=0;u<l;u++){var f=e.depthSortedFacets[u].ind;e.depthSortedIndices[3*u]=r[f],e.depthSortedIndices[3*u+1]=r[f+1],e.depthSortedIndices[3*u+2]=r[f+2]}this.updateIndices(e.depthSortedIndices,void 0,!0)}return this},t.prototype.getFacetLocalNormals=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetNormals||this.updateFacetData(),e.facetNormals},t.prototype.getFacetLocalPositions=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPositions||this.updateFacetData(),e.facetPositions},t.prototype.getFacetLocalPartitioning=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetPartitioning||this.updateFacetData(),e.facetPartitioning},t.prototype.getFacetPosition=function(e){var t=tt.Zero();return this.getFacetPositionToRef(e,t),t},t.prototype.getFacetPositionToRef=function(e,t){var r=this.getFacetLocalPositions()[e],i=this.getWorldMatrix();return tt.TransformCoordinatesToRef(r,i,t),this},t.prototype.getFacetNormal=function(e){var t=tt.Zero();return this.getFacetNormalToRef(e,t),t},t.prototype.getFacetNormalToRef=function(e,t){var r=this.getFacetLocalNormals()[e];return tt.TransformNormalToRef(r,this.getWorldMatrix(),t),this},t.prototype.getFacetsAtLocalCoordinates=function(e,t,r){var i=this.getBoundingInfo(),n=this._internalAbstractMeshDataInfo._facetData,s=Math.floor((e-i.minimum.x*n.partitioningBBoxRatio)*n.subDiv.X*n.partitioningBBoxRatio/n.bbSize.x),o=Math.floor((t-i.minimum.y*n.partitioningBBoxRatio)*n.subDiv.Y*n.partitioningBBoxRatio/n.bbSize.y),a=Math.floor((r-i.minimum.z*n.partitioningBBoxRatio)*n.subDiv.Z*n.partitioningBBoxRatio/n.bbSize.z);return s<0||s>n.subDiv.max||o<0||o>n.subDiv.max||a<0||a>n.subDiv.max?null:n.facetPartitioning[s+n.subDiv.max*o+n.subDiv.max*n.subDiv.max*a]},t.prototype.getClosestFacetAtCoordinates=function(e,t,r,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=!0);var o=this.getWorldMatrix(),a=ot.Matrix[5];o.invertToRef(a);var u=ot.Vector3[8];tt.TransformCoordinatesFromFloatsToRef(e,t,r,a,u);var h=this.getClosestFacetAtLocalCoordinates(u.x,u.y,u.z,i,n,s);return i&&tt.TransformCoordinatesFromFloatsToRef(i.x,i.y,i.z,o,i),h},t.prototype.getClosestFacetAtLocalCoordinates=function(e,t,r,i,n,s){void 0===n&&(n=!1),void 0===s&&(s=!0);var o=null,a=0,u=0,h=0,c=0,l=0,f=0,d=0,p=0,_=this.getFacetLocalPositions(),g=this.getFacetLocalNormals(),m=this.getFacetsAtLocalCoordinates(e,t,r);if(!m)return null;for(var y,v,b,T=Number.MAX_VALUE,M=T,x=0;x<m.length;x++)v=g[y=m[x]],c=(e-(b=_[y]).x)*v.x+(t-b.y)*v.y+(r-b.z)*v.z,(!n||n&&s&&c>=0||n&&!s&&c<=0)&&(c=v.x*b.x+v.y*b.y+v.z*b.z,l=-(v.x*e+v.y*t+v.z*r-c)/(v.x*v.x+v.y*v.y+v.z*v.z),(M=(a=(f=e+v.x*l)-e)*a+(u=(d=t+v.y*l)-t)*u+(h=(p=r+v.z*l)-r)*h)<T&&(T=M,o=y,i&&(i.x=f,i.y=d,i.z=p)));return o},t.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},t.prototype.disableFacetData=function(){var e=this._internalAbstractMeshDataInfo._facetData;return e.facetDataEnabled&&(e.facetDataEnabled=!1,e.facetPositions=new Array,e.facetNormals=new Array,e.facetPartitioning=new Array,e.facetParameters=null,e.depthSortedIndices=new Uint32Array(0)),this},t.prototype.updateIndices=function(e,t,r){return void 0===r&&(r=!1),this},t.prototype.createNormals=function(e){var t,r=this.getVerticesData(Rt.PositionKind),i=this.getIndices();return t=this.isVerticesDataPresent(Rt.NormalKind)?this.getVerticesData(Rt.NormalKind):[],It.ComputeNormals(r,i,t,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(Rt.NormalKind,t,e),this},t.prototype.alignWithNormal=function(e,t){t||(t=Yt.Y);var r=ot.Vector3[0],i=ot.Vector3[1];return tt.CrossToRef(t,e,i),tt.CrossToRef(e,i,r),this.rotationQuaternion?it.RotationQuaternionFromAxisToRef(r,e,i,this.rotationQuaternion):tt.RotationFromAxisToRef(r,e,i,this.rotation),this},t.prototype._checkOcclusionQuery=function(){return!1},t.prototype.disableEdgesRendering=function(){throw A("EdgesRenderer")},t.prototype.enableEdgesRendering=function(e,t,r){throw A("EdgesRenderer")},t.prototype.getConnectedParticleSystems=function(){var e=this;return this._scene.particleSystems.filter((function(t){return t.emitter===e}))},t.OCCLUSION_TYPE_NONE=0,t.OCCLUSION_TYPE_OPTIMISTIC=1,t.OCCLUSION_TYPE_STRICT=2,t.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,t.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,t.CULLINGSTRATEGY_STANDARD=0,t.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,t.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,t}(Zt);Le("BABYLON.AbstractMesh",rr);var ir=function(){function e(e,t,r,i){this.normal=new tt(e,t,r),this.d=i}return e.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},e.prototype.clone=function(){return new e(this.normal.x,this.normal.y,this.normal.z,this.d)},e.prototype.getClassName=function(){return"Plane"},e.prototype.getHashCode=function(){var e=this.normal.getHashCode();return e=397*e^(0|this.d)},e.prototype.normalize=function(){var e=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),t=0;return 0!==e&&(t=1/e),this.normal.x*=t,this.normal.y*=t,this.normal.z*=t,this.d*=t,this},e.prototype.transform=function(t){var r=e._TmpMatrix;t.invertToRef(r);var i=r.m,n=this.normal.x,s=this.normal.y,o=this.normal.z,a=this.d;return new e(n*i[0]+s*i[1]+o*i[2]+a*i[3],n*i[4]+s*i[5]+o*i[6]+a*i[7],n*i[8]+s*i[9]+o*i[10]+a*i[11],n*i[12]+s*i[13]+o*i[14]+a*i[15])},e.prototype.dotCoordinate=function(e){return this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z+this.d},e.prototype.copyFromPoints=function(e,t,r){var i,n=t.x-e.x,s=t.y-e.y,o=t.z-e.z,a=r.x-e.x,u=r.y-e.y,h=r.z-e.z,c=s*h-o*u,l=o*a-n*h,f=n*u-s*a,d=Math.sqrt(c*c+l*l+f*f);return i=0!==d?1/d:0,this.normal.x=c*i,this.normal.y=l*i,this.normal.z=f*i,this.d=-(this.normal.x*e.x+this.normal.y*e.y+this.normal.z*e.z),this},e.prototype.isFrontFacingTo=function(e,t){return tt.Dot(this.normal,e)<=t},e.prototype.signedDistanceTo=function(e){return tt.Dot(e,this.normal)+this.d},e.FromArray=function(t){return new e(t[0],t[1],t[2],t[3])},e.FromPoints=function(t,r,i){var n=new e(0,0,0,0);return n.copyFromPoints(t,r,i),n},e.FromPositionAndNormal=function(t,r){var i=new e(0,0,0,0);return r.normalize(),i.normal=r,i.d=-(r.x*t.x+r.y*t.y+r.z*t.z),i},e.SignedDistanceToPlaneFromPositionAndNormal=function(e,t,r){var i=-(t.x*e.x+t.y*e.y+t.z*e.z);return tt.Dot(r,t)+i},e._TmpMatrix=nt.Identity(),e}(),nr=function(){function e(t){this.length=0,this.data=new Array(t),this._id=e._GlobalId++}return e.prototype.push=function(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)},e.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e(this.data[t])},e.prototype.sort=function(e){this.data.sort(e)},e.prototype.reset=function(){this.length=0},e.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},e.prototype.concat=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++)this.data[this.length++]=(e.data||e)[t]}},e.prototype.indexOf=function(e){var t=this.data.indexOf(e);return t>=this.length?-1:t},e.prototype.contains=function(e){return-1!==this.indexOf(e)},e._GlobalId=0,e}(),sr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._duplicateId=0,t}return u(t,e),t.prototype.push=function(t){e.prototype.push.call(this,t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId},t.prototype.pushNoDuplicate=function(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)},t.prototype.reset=function(){e.prototype.reset.call(this),this._duplicateId++},t.prototype.concatWithNoDuplicate=function(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(var t=0;t<e.length;t++){var r=(e.data||e)[t];this.pushNoDuplicate(r)}}},t}(nr),or=function(){function e(e,t,r,i){this.x=e,this.y=t,this.width=r,this.height=i}return e.prototype.toGlobal=function(t,r){return new e(this.x*t,this.y*r,this.width*t,this.height*r)},e.prototype.toGlobalToRef=function(e,t,r){return r.x=this.x*e,r.y=this.y*t,r.width=this.width*e,r.height=this.height*t,this},e.prototype.clone=function(){return new e(this.x,this.y,this.width,this.height)},e}(),ar=function(){function e(){}return e.GetPlanes=function(t){for(var r=[],i=0;i<6;i++)r.push(new ir(0,0,0,0));return e.GetPlanesToRef(t,r),r},e.GetNearPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]+r[2],t.normal.y=r[7]+r[6],t.normal.z=r[11]+r[10],t.d=r[15]+r[14],t.normalize()},e.GetFarPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]-r[2],t.normal.y=r[7]-r[6],t.normal.z=r[11]-r[10],t.d=r[15]-r[14],t.normalize()},e.GetLeftPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]+r[0],t.normal.y=r[7]+r[4],t.normal.z=r[11]+r[8],t.d=r[15]+r[12],t.normalize()},e.GetRightPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]-r[0],t.normal.y=r[7]-r[4],t.normal.z=r[11]-r[8],t.d=r[15]-r[12],t.normalize()},e.GetTopPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]-r[1],t.normal.y=r[7]-r[5],t.normal.z=r[11]-r[9],t.d=r[15]-r[13],t.normalize()},e.GetBottomPlaneToRef=function(e,t){var r=e.m;t.normal.x=r[3]+r[1],t.normal.y=r[7]+r[5],t.normal.z=r[11]+r[9],t.d=r[15]+r[13],t.normalize()},e.GetPlanesToRef=function(t,r){e.GetNearPlaneToRef(t,r[0]),e.GetFarPlaneToRef(t,r[1]),e.GetLeftPlaneToRef(t,r[2]),e.GetRightPlaneToRef(t,r[3]),e.GetTopPlaneToRef(t,r[4]),e.GetBottomPlaneToRef(t,r[5])},e}(),ur=function(e){function t(r,i,n,s){void 0===s&&(s=!0);var o=e.call(this,r,n)||this;return o._position=tt.Zero(),o._upVector=tt.Up(),o.orthoLeft=null,o.orthoRight=null,o.orthoBottom=null,o.orthoTop=null,o.fov=.8,o.projectionPlaneTilt=0,o.minZ=1,o.maxZ=1e4,o.inertia=.9,o.mode=t.PERSPECTIVE_CAMERA,o.isIntermediate=!1,o.viewport=new or(0,0,1,1),o.layerMask=268435455,o.fovMode=t.FOVMODE_VERTICAL_FIXED,o.cameraRigMode=t.RIG_MODE_NONE,o.customRenderTargets=new Array,o.outputRenderTarget=null,o.onViewMatrixChangedObservable=new _,o.onProjectionMatrixChangedObservable=new _,o.onAfterCheckInputsObservable=new _,o.onRestoreStateObservable=new _,o.isRigCamera=!1,o._rigCameras=new Array,o._webvrViewMatrix=nt.Identity(),o._skipRendering=!1,o._projectionMatrix=new nt,o._postProcesses=new Array,o._activeMeshes=new nr(256),o._globalPosition=tt.Zero(),o._computedViewMatrix=nt.Identity(),o._doNotComputeProjectionMatrix=!1,o._transformMatrix=nt.Zero(),o._refreshFrustumPlanes=!0,o._absoluteRotation=it.Identity(),o._isCamera=!0,o._isLeftCamera=!1,o._isRightCamera=!1,o.getScene().addCamera(o),s&&!o.getScene().activeCamera&&(o.getScene().activeCamera=o),o.position=i,o.renderPassId=o.getScene().getEngine().createRenderPassId("Camera ".concat(r)),o}return u(t,e),Object.defineProperty(t.prototype,"position",{get:function(){return this._position},set:function(e){this._position=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"upVector",{get:function(){return this._upVector},set:function(e){this._upVector=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"screenArea",{get:function(){var e,r,i,n,s=0,o=0;if(this.mode===t.PERSPECTIVE_CAMERA)this.fovMode===t.FOVMODE_VERTICAL_FIXED?(o=2*this.minZ*Math.tan(this.fov/2),s=this.getEngine().getAspectRatio(this)*o):o=(s=2*this.minZ*Math.tan(this.fov/2))/this.getEngine().getAspectRatio(this);else{var a=this.getEngine().getRenderWidth()/2,u=this.getEngine().getRenderHeight()/2;s=(null!==(e=this.orthoRight)&&void 0!==e?e:a)-(null!==(r=this.orthoLeft)&&void 0!==r?r:-a),o=(null!==(i=this.orthoTop)&&void 0!==i?i:u)-(null!==(n=this.orthoBottom)&&void 0!==n?n:-u)}return s*o},enumerable:!1,configurable:!0}),t.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},t.prototype._restoreStateValues=function(){return!!this._stateStored&&(this.fov=this._storedFov,!0)},t.prototype.restoreState=function(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)},t.prototype.getClassName=function(){return"Camera"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(var r=0;r<this.animations.length;r++)t+=", animation[0]: "+this.animations[r].toString(e);return t},t.prototype.applyVerticalCorrection=function(){var e=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-e.x:e.x},Object.defineProperty(t.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},t.prototype.isReady=function(t){if(void 0===t&&(t=!1),t)for(var r=0,i=this._postProcesses;r<i.length;r++){var n=i[r];if(n&&!n.isReady())return!1}return e.prototype.isReady.call(this,t)},t.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=new tt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new tt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},t.prototype._updateCache=function(t){t||e.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},t.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},t.prototype._isSynchronizedViewMatrix=function(){return!!e.prototype._isSynchronized.call(this)&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())},t.prototype._isSynchronizedProjectionMatrix=function(){var e=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!e)return!1;var r=this.getEngine();return e=this.mode===t.PERSPECTIVE_CAMERA?this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===r.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===r.getRenderWidth()&&this._cache.renderHeight===r.getRenderHeight()},t.prototype.attachControl=function(e,t){},t.prototype.detachControl=function(e){},t.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==t.RIG_MODE_NONE&&this._updateRigCameras()},t.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(t.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),t.prototype._getFirstPostProcess=function(){for(var e=0;e<this._postProcesses.length;e++)if(null!==this._postProcesses[e])return this._postProcesses[e];return null},t.prototype._cascadePostProcessesToRigCams=function(){var e=this._getFirstPostProcess();e&&e.markTextureDirty();for(var t=0,r=this._rigCameras.length;t<r;t++){var i=this._rigCameras[t],n=i._rigPostProcess;if(n)"pass"===n.getEffectName()&&(i.isIntermediate=0===this._postProcesses.length),i._postProcesses=this._postProcesses.slice(0).concat(n),n.markTextureDirty();else i._postProcesses=this._postProcesses.slice(0)}},t.prototype.attachPostProcess=function(e,t){return void 0===t&&(t=null),!e.isReusable()&&this._postProcesses.indexOf(e)>-1?(T.Error("You\'re trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(e):null===this._postProcesses[t]?this._postProcesses[t]=e:this._postProcesses.splice(t,0,e),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(e))},t.prototype.detachPostProcess=function(e){var t=this._postProcesses.indexOf(e);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},t.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix},t.prototype._getViewMatrix=function(){return nt.Identity()},t.prototype.getViewMatrix=function(e){return!e&&this._isSynchronizedViewMatrix()||(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix},t.prototype.freezeProjectionMatrix=function(e){this._doNotComputeProjectionMatrix=!0,void 0!==e&&(this._projectionMatrix=e)},t.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},t.prototype.getProjectionMatrix=function(e){var r,i,n,s,o,a,u,h;if(this._doNotComputeProjectionMatrix||!e&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var c=this.getEngine(),l=this.getScene();if(this.mode===t.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=c.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.minZ<=0&&(this.minZ=.1);var f=c.useReverseDepthBuffer;(l.useRightHandedSystem?nt.PerspectiveFovRHToRef:nt.PerspectiveFovLHToRef)(this.fov,c.getAspectRatio(this),f?this.maxZ:this.minZ,f?this.minZ:this.maxZ,this._projectionMatrix,this.fovMode===t.FOVMODE_VERTICAL_FIXED,c.isNDCHalfZRange,this.projectionPlaneTilt,c.useReverseDepthBuffer)}else{var d=c.getRenderWidth()/2,p=c.getRenderHeight()/2;l.useRightHandedSystem?nt.OrthoOffCenterRHToRef(null!==(r=this.orthoLeft)&&void 0!==r?r:-d,null!==(i=this.orthoRight)&&void 0!==i?i:d,null!==(n=this.orthoBottom)&&void 0!==n?n:-p,null!==(s=this.orthoTop)&&void 0!==s?s:p,this.minZ,this.maxZ,this._projectionMatrix,c.isNDCHalfZRange):nt.OrthoOffCenterLHToRef(null!==(o=this.orthoLeft)&&void 0!==o?o:-d,null!==(a=this.orthoRight)&&void 0!==a?a:d,null!==(u=this.orthoBottom)&&void 0!==u?u:-p,null!==(h=this.orthoTop)&&void 0!==h?h:p,this.minZ,this.maxZ,this._projectionMatrix,c.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=c.getRenderWidth(),this._cache.renderHeight=c.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},t.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},t.prototype._updateFrustumPlanes=function(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?ar.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=ar.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},t.prototype.isInFrustum=function(e,t){if(void 0===t&&(t=!1),this._updateFrustumPlanes(),t&&this.rigCameras.length>0){var r=!1;return this.rigCameras.forEach((function(t){t._updateFrustumPlanes(),r=r||e.isInFrustum(t._frustumPlanes)})),r}return e.isInFrustum(this._frustumPlanes)},t.prototype.isCompletelyInFrustum=function(e){return this._updateFrustumPlanes(),e.isCompletelyInFrustum(this._frustumPlanes)},t.prototype.getForwardRay=function(e,t,r){throw void 0===e&&(e=100),A("Ray")},t.prototype.getForwardRayToRef=function(e,t,r,i){throw void 0===t&&(t=100),A("Ray")},t.prototype.dispose=function(r,i){for(void 0===i&&(i=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var n=this._rigCameras.pop();n&&n.dispose()}if(this._parentContainer){var s=this._parentContainer.cameras.indexOf(this);s>-1&&this._parentContainer.cameras.splice(s,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==t.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var o=this._postProcesses.length;--o>=0;){var a=this._postProcesses[o];a&&a.dispose(this)}for(var u=this.customRenderTargets.length;--u>=0;)this.customRenderTargets[u].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),this.getScene().getEngine().releaseRenderPassId(this.renderPassId),e.prototype.dispose.call(this,r,i)},Object.defineProperty(t.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),t.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},t.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},t.prototype.setCameraRigMode=function(e,r){if(this.cameraRigMode!==e){for(;this._rigCameras.length>0;){var i=this._rigCameras.pop();i&&i.dispose()}if(this.cameraRigMode=e,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=r.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=Ve.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==t.RIG_MODE_NONE){var n=this.createRigCamera(this.name+"_L",0);n&&(n._isLeftCamera=!0);var s=this.createRigCamera(this.name+"_R",1);s&&(s._isRightCamera=!0),n&&s&&(this._rigCameras.push(n),this._rigCameras.push(s))}this._setRigMode(r),this._cascadePostProcessesToRigCams(),this.update()}},t.prototype._setRigMode=function(e){},t.prototype._getVRProjectionMatrix=function(){return nt.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},t.prototype._updateCameraRotationMatrix=function(){},t.prototype._updateWebVRCameraRotationMatrix=function(){},t.prototype._getWebVRProjectionMatrix=function(){return nt.Identity()},t.prototype._getWebVRViewMatrix=function(){return nt.Identity()},t.prototype.setCameraRigParameter=function(e,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[e]=t,"interaxialDistance"===e&&(this._cameraRigParams.stereoHalfAngle=Ve.ToRadians(t/.0637))},t.prototype.createRigCamera=function(e,t){return null},t.prototype._updateRigCameras=function(){for(var e=0;e<this._rigCameras.length;e++)this._rigCameras[e].minZ=this.minZ,this._rigCameras[e].maxZ=this.maxZ,this._rigCameras[e].fov=this.fov,this._rigCameras[e].upVector.copyFrom(this.upVector);this.cameraRigMode===t.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},t.prototype._setupInputs=function(){},t.prototype.serialize=function(){var e=Mt.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(e),this.inputs&&this.inputs.serialize(e),Mt.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e},t.prototype.clone=function(e,r){void 0===r&&(r=null);var i=Mt.Clone(t.GetConstructorFromName(this.getClassName(),e,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return i.name=e,i.parent=r,this.onClonedObservable.notifyObservers(i),i},t.prototype.getDirection=function(e){var t=tt.Zero();return this.getDirectionToRef(e,t),t},Object.defineProperty(t.prototype,"absoluteRotation",{get:function(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation},enumerable:!1,configurable:!0}),t.prototype.getDirectionToRef=function(e,t){tt.TransformNormalToRef(e,this.getWorldMatrix(),t)},t.GetConstructorFromName=function(e,r,i,n,s){void 0===n&&(n=0),void 0===s&&(s=!0);var o=At.Construct(e,r,i,{interaxial_distance:n,isStereoscopicSideBySide:s});return o||function(){return t._CreateDefaultParsedCamera(r,i)}},t.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},t.Parse=function(e,r){var i=e.type,n=t.GetConstructorFromName(i,e.name,r,e.interaxial_distance,e.isStereoscopicSideBySide),s=Mt.Parse(n,e,r);if(void 0!==e.parentId&&(s._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(s._waitingParentInstanceIndex=e.parentInstanceIndex),s.inputs&&(s.inputs.parse(e),s._setupInputs()),e.upVector&&(s.upVector=tt.FromArray(e.upVector)),s.setPosition&&(s.position.copyFromFloats(0,0,0),s.setPosition(tt.FromArray(e.position))),e.target&&s.setTarget&&s.setTarget(tt.FromArray(e.target)),e.cameraRigMode){var o=e.interaxial_distance?{interaxialDistance:e.interaxial_distance}:{};s.setCameraRigMode(e.cameraRigMode,o)}if(e.animations){for(var a=0;a<e.animations.length;a++){var u=e.animations[a],h=Ne("BABYLON.Animation");h&&s.animations.push(h.Parse(u))}At.ParseAnimationRanges(s,e,r)}return e.autoAnimate&&r.beginAnimation(s,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&s.setEnabled(e.isEnabled),s},t._CreateDefaultParsedCamera=function(e,t){throw A("UniversalCamera")},t.PERSPECTIVE_CAMERA=0,t.ORTHOGRAPHIC_CAMERA=1,t.FOVMODE_VERTICAL_FIXED=0,t.FOVMODE_HORIZONTAL_FIXED=1,t.RIG_MODE_NONE=0,t.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,t.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,t.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,t.RIG_MODE_STEREOSCOPIC_INTERLACED=14,t.RIG_MODE_VR=20,t.RIG_MODE_WEBVR=21,t.RIG_MODE_CUSTOM=22,t.ForceAttachControlToAlwaysPreventDefault=!1,c([bt("position")],t.prototype,"_position",void 0),c([bt("upVector")],t.prototype,"_upVector",void 0),c([mt()],t.prototype,"orthoLeft",void 0),c([mt()],t.prototype,"orthoRight",void 0),c([mt()],t.prototype,"orthoBottom",void 0),c([mt()],t.prototype,"orthoTop",void 0),c([mt()],t.prototype,"fov",void 0),c([mt()],t.prototype,"projectionPlaneTilt",void 0),c([mt()],t.prototype,"minZ",void 0),c([mt()],t.prototype,"maxZ",void 0),c([mt()],t.prototype,"inertia",void 0),c([mt()],t.prototype,"mode",void 0),c([mt()],t.prototype,"layerMask",void 0),c([mt()],t.prototype,"fovMode",void 0),c([mt()],t.prototype,"cameraRigMode",void 0),c([mt()],t.prototype,"interaxialDistance",void 0),c([mt()],t.prototype,"isStereoscopicSideBySide",void 0),t}(At),hr=function(){function e(){this._count=0,this._data={}}return e.prototype.copyFrom=function(e){var t=this;this.clear(),e.forEach((function(e,r){return t.add(e,r)}))},e.prototype.get=function(e){var t=this._data[e];if(void 0!==t)return t},e.prototype.getOrAddWithFactory=function(e,t){var r=this.get(e);return void 0!==r||(r=t(e))&&this.add(e,r),r},e.prototype.getOrAdd=function(e,t){var r=this.get(e);return void 0!==r?r:(this.add(e,t),t)},e.prototype.contains=function(e){return void 0!==this._data[e]},e.prototype.add=function(e,t){return void 0===this._data[e]&&(this._data[e]=t,++this._count,!0)},e.prototype.set=function(e,t){return void 0!==this._data[e]&&(this._data[e]=t,!0)},e.prototype.getAndRemove=function(e){var t=this.get(e);return void 0!==t?(delete this._data[e],--this._count,t):null},e.prototype.remove=function(e){return!!this.contains(e)&&(delete this._data[e],--this._count,!0)},e.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),e.prototype.forEach=function(e){for(var t in this._data){e(t,this._data[t])}},e.prototype.first=function(e){for(var t in this._data){var r=e(t,this._data[t]);if(r)return r}return null},e}(),cr=function(){function e(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return e.AddParser=function(e,t){this._BabylonFileParsers[e]=t},e.GetParser=function(e){return this._BabylonFileParsers[e]?this._BabylonFileParsers[e]:null},e.AddIndividualParser=function(e,t){this._IndividualBabylonFileParsers[e]=t},e.GetIndividualParser=function(e){return this._IndividualBabylonFileParsers[e]?this._IndividualBabylonFileParsers[e]:null},e.Parse=function(e,t,r,i){for(var n in this._BabylonFileParsers)Object.prototype.hasOwnProperty.call(this._BabylonFileParsers,n)&&this._BabylonFileParsers[n](e,t,r,i)},Object.defineProperty(e.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture=e},enumerable:!1,configurable:!0}),e.prototype.getNodes=function(){var e=new Array;return e=(e=(e=(e=e.concat(this.meshes)).concat(this.lights)).concat(this.cameras)).concat(this.transformNodes),this.skeletons.forEach((function(t){return e=e.concat(t.bones)})),e},e._BabylonFileParsers={},e._IndividualBabylonFileParsers={},e}(),lr=function(){function e(e){if(this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=e,e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&this._setDefaultValue(t)}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),e.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},e.prototype.markAsUnprocessed=function(){this._isDirty=!0},e.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},e.prototype.markAsLightDirty=function(e){void 0===e&&(e=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||e,this._isDirty=!0},e.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},e.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},e.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},e.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},e.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},e.prototype.rebuild=function(){this._keys=[];for(var e=0,t=Object.keys(this);e<t.length;e++){var r=t[e];"_"!==r[0]&&this._keys.push(r)}if(this._externalProperties)for(var i in this._externalProperties)-1===this._keys.indexOf(i)&&this._keys.push(i)},e.prototype.isEqual=function(e){if(this._keys.length!==e._keys.length)return!1;for(var t=0;t<this._keys.length;t++){var r=this._keys[t];if(this[r]!==e[r])return!1}return!0},e.prototype.cloneTo=function(e){this._keys.length!==e._keys.length&&(e._keys=this._keys.slice(0));for(var t=0;t<this._keys.length;t++){var r=this._keys[t];e[r]=this[r]}},e.prototype.reset=function(){var e=this;this._keys.forEach((function(t){return e._setDefaultValue(t)}))},e.prototype._setDefaultValue=function(e){var t,r,i,n,s,o=null!==(i=null===(r=null===(t=this._externalProperties)||void 0===t?void 0:t[e])||void 0===r?void 0:r.type)&&void 0!==i?i:typeof this[e],a=null===(s=null===(n=this._externalProperties)||void 0===n?void 0:n[e])||void 0===s?void 0:s.default;switch(o){case"number":this[e]=null!==a&&void 0!==a?a:0;break;case"string":this[e]=null!==a&&void 0!==a?a:"";break;default:this[e]=null!==a&&void 0!==a&&a}},e.prototype.toString=function(){for(var e="",t=0;t<this._keys.length;t++){var r=this._keys[t],i=this[r];switch(typeof i){case"number":case"string":e+="#define "+r+" "+i+"\\n";break;default:i&&(e+="#define "+r+"\\n")}}return e},e}(),fr=function(){function e(){this._dirty=!0,this._tempColor=new ht(0,0,0,0),this._globalCurve=new ht(0,0,0,0),this._highlightsCurve=new ht(0,0,0,0),this._midtonesCurve=new ht(0,0,0,0),this._shadowsCurve=new ht(0,0,0,0),this._positiveCurve=new ht(0,0,0,0),this._negativeCurve=new ht(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(e.prototype,"globalHue",{get:function(){return this._globalHue},set:function(e){this._globalHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(e){this._globalDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(e){this._globalSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(e){this._globalExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(e){this._highlightsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(e){this._highlightsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(e){this._highlightsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(e){this._highlightsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(e){this._midtonesHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(e){this._midtonesDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(e){this._midtonesSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(e){this._midtonesExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(e){this._shadowsHue=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(e){this._shadowsDensity=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(e){this._shadowsSaturation=e,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(e){this._shadowsExposure=e,this._dirty=!0},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"ColorCurves"},e.Bind=function(e,t,r,i,n){void 0===r&&(r="vCameraColorCurvePositive"),void 0===i&&(i="vCameraColorCurveNeutral"),void 0===n&&(n="vCameraColorCurveNegative"),e._dirty&&(e._dirty=!1,e._getColorGradingDataToRef(e._globalHue,e._globalDensity,e._globalSaturation,e._globalExposure,e._globalCurve),e._getColorGradingDataToRef(e._highlightsHue,e._highlightsDensity,e._highlightsSaturation,e._highlightsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._highlightsCurve),e._getColorGradingDataToRef(e._midtonesHue,e._midtonesDensity,e._midtonesSaturation,e._midtonesExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._midtonesCurve),e._getColorGradingDataToRef(e._shadowsHue,e._shadowsDensity,e._shadowsSaturation,e._shadowsExposure,e._tempColor),e._tempColor.multiplyToRef(e._globalCurve,e._shadowsCurve),e._highlightsCurve.subtractToRef(e._midtonesCurve,e._positiveCurve),e._midtonesCurve.subtractToRef(e._shadowsCurve,e._negativeCurve)),t&&(t.setFloat4(r,e._positiveCurve.r,e._positiveCurve.g,e._positiveCurve.b,e._positiveCurve.a),t.setFloat4(i,e._midtonesCurve.r,e._midtonesCurve.g,e._midtonesCurve.b,e._midtonesCurve.a),t.setFloat4(n,e._negativeCurve.r,e._negativeCurve.g,e._negativeCurve.b,e._negativeCurve.a))},e.PrepareUniforms=function(e){e.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},e.prototype._getColorGradingDataToRef=function(t,r,i,n,s){null!=t&&(t=e._Clamp(t,0,360),r=e._Clamp(r,-100,100),i=e._Clamp(i,-100,100),n=e._Clamp(n,-100,100),r=e._ApplyColorGradingSliderNonlinear(r),r*=.5,n=e._ApplyColorGradingSliderNonlinear(n),r<0&&(r*=-1,t=(t+180)%360),e._FromHSBToRef(t,r,50+.25*n,s),s.scaleToRef(2,s),s.a=1+.01*i)},e._ApplyColorGradingSliderNonlinear=function(e){e/=100;var t=Math.abs(e);return t=Math.pow(t,2),e<0&&(t*=-1),t*=100},e._FromHSBToRef=function(t,r,i,n){var s=e._Clamp(t,0,360),o=e._Clamp(r/100,0,1),a=e._Clamp(i/100,0,1);if(0===o)n.r=a,n.g=a,n.b=a;else{s/=60;var u=Math.floor(s),h=s-u,c=a*(1-o),l=a*(1-o*h),f=a*(1-o*(1-h));switch(u){case 0:n.r=a,n.g=f,n.b=c;break;case 1:n.r=l,n.g=a,n.b=c;break;case 2:n.r=c,n.g=a,n.b=f;break;case 3:n.r=c,n.g=l,n.b=a;break;case 4:n.r=f,n.g=c,n.b=a;break;default:n.r=a,n.g=c,n.b=l}}n.a=1},e._Clamp=function(e,t,r){return Math.min(Math.max(e,t),r)},e.prototype.clone=function(){return Mt.Clone((function(){return new e}),this)},e.prototype.serialize=function(){return Mt.Serialize(this)},e.Parse=function(t){return Mt.Parse((function(){return new e}),t,null,null)},c([mt()],e.prototype,"_globalHue",void 0),c([mt()],e.prototype,"_globalDensity",void 0),c([mt()],e.prototype,"_globalSaturation",void 0),c([mt()],e.prototype,"_globalExposure",void 0),c([mt()],e.prototype,"_highlightsHue",void 0),c([mt()],e.prototype,"_highlightsDensity",void 0),c([mt()],e.prototype,"_highlightsSaturation",void 0),c([mt()],e.prototype,"_highlightsExposure",void 0),c([mt()],e.prototype,"_midtonesHue",void 0),c([mt()],e.prototype,"_midtonesDensity",void 0),c([mt()],e.prototype,"_midtonesSaturation",void 0),c([mt()],e.prototype,"_midtonesExposure",void 0),e}();Mt._ColorCurvesParser=fr.Parse;!function(e){function t(){var t=e.call(this)||this;return t.IMAGEPROCESSING=!1,t.VIGNETTE=!1,t.VIGNETTEBLENDMODEMULTIPLY=!1,t.VIGNETTEBLENDMODEOPAQUE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=!1,t.SAMPLER3DBGRMAP=!1,t.IMAGEPROCESSINGPOSTPROCESS=!1,t.EXPOSURE=!1,t.SKIPFINALCOLORCLAMP=!1,t.rebuild(),t}u(t,e)}(lr);var dr=function(){function e(){this.colorCurves=new fr,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=e.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new ht(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=e.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new _}var t;return Object.defineProperty(e.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(e){this._colorCurvesEnabled!==e&&(this._colorCurvesEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(e){this._colorGradingTexture!==e&&(this._colorGradingTexture=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(e){this._colorGradingEnabled!==e&&(this._colorGradingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(e){this._colorGradingWithGreenDepth!==e&&(this._colorGradingWithGreenDepth=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(e){this._colorGradingBGR!==e&&(this._colorGradingBGR=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exposure",{get:function(){return this._exposure},set:function(e){this._exposure!==e&&(this._exposure=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(e){this._toneMappingEnabled!==e&&(this._toneMappingEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(e){this._toneMappingType!==e&&(this._toneMappingType=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contrast",{get:function(){return this._contrast},set:function(e){this._contrast!==e&&(this._contrast=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(e){this._vignetteBlendMode!==e&&(this._vignetteBlendMode=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(e){this._vignetteEnabled!==e&&(this._vignetteEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skipFinalColorClamp",{get:function(){return this._skipFinalColorClamp},set:function(e){this._skipFinalColorClamp!==e&&(this._skipFinalColorClamp=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(e){this._applyByPostProcess!==e&&(this._applyByPostProcess=e,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(e){this._isEnabled!==e&&(this._isEnabled=e,this._updateParameters())},enumerable:!1,configurable:!0}),e.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},e.prototype.getClassName=function(){return"ImageProcessingConfiguration"},e.PrepareUniforms=function(e,t){t.EXPOSURE&&e.push("exposureLinear"),t.CONTRAST&&e.push("contrast"),t.COLORGRADING&&e.push("colorTransformSettings"),t.VIGNETTE&&(e.push("vInverseScreenSize"),e.push("vignetteSettings1"),e.push("vignetteSettings2")),t.COLORCURVES&&fr.PrepareUniforms(e)},e.PrepareSamplers=function(e,t){t.COLORGRADING&&e.push("txColorTransform")},e.prototype.prepareDefines=function(t,r){if(void 0===r&&(r=!1),r!==this.applyByPostProcess||!this._isEnabled)return t.VIGNETTE=!1,t.TONEMAPPING=!1,t.TONEMAPPING_ACES=!1,t.CONTRAST=!1,t.EXPOSURE=!1,t.COLORCURVES=!1,t.COLORGRADING=!1,t.COLORGRADING3D=!1,t.IMAGEPROCESSING=!1,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(t.VIGNETTE=this.vignetteEnabled,t.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===e._VIGNETTEMODE_MULTIPLY,t.VIGNETTEBLENDMODEOPAQUE=!t.VIGNETTEBLENDMODEMULTIPLY,t.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType===e.TONEMAPPING_ACES)t.TONEMAPPING_ACES=!0;else t.TONEMAPPING_ACES=!1;t.CONTRAST=1!==this.contrast,t.EXPOSURE=1!==this.exposure,t.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,t.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,t.COLORGRADING?t.COLORGRADING3D=this.colorGradingTexture.is3D:t.COLORGRADING3D=!1,t.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,t.SAMPLER3DBGRMAP=this.colorGradingBGR,t.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,t.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,t.IMAGEPROCESSING=t.VIGNETTE||t.TONEMAPPING||t.CONTRAST||t.EXPOSURE||t.COLORCURVES||t.COLORGRADING},e.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},e.prototype.bind=function(e,t){if(this._colorCurvesEnabled&&this.colorCurves&&fr.Bind(this.colorCurves,e),this._vignetteEnabled){var r=1/e.getEngine().getRenderWidth(),i=1/e.getEngine().getRenderHeight();e.setFloat2("vInverseScreenSize",r,i);var n=null!=t?t:i/r,s=Math.tan(.5*this.vignetteCameraFov),o=s*n,a=Math.sqrt(o*s);o=Ve.Mix(o,a,this.vignetteStretch),s=Ve.Mix(s,a,this.vignetteStretch),e.setFloat4("vignetteSettings1",o,s,-o*this.vignetteCentreX,-s*this.vignetteCentreY);var u=-2*this.vignetteWeight;e.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,u)}if(e.setFloat("exposureLinear",this.exposure),e.setFloat("contrast",this.contrast),this.colorGradingTexture){e.setTexture("txColorTransform",this.colorGradingTexture);var h=this.colorGradingTexture.getSize().height;e.setFloat4("colorTransformSettings",(h-1)/h,.5/h,h,this.colorGradingTexture.level)}},e.prototype.clone=function(){return Mt.Clone((function(){return new e}),this)},e.prototype.serialize=function(){return Mt.Serialize(this)},e.Parse=function(t){return Mt.Parse((function(){return new e}),t,null,null)},Object.defineProperty(e,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(e,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),e.TONEMAPPING_STANDARD=0,e.TONEMAPPING_ACES=1,e._VIGNETTEMODE_MULTIPLY=0,e._VIGNETTEMODE_OPAQUE=1,c([_t(7,t)],e.prototype,"colorCurves",void 0),c([mt()],e.prototype,"_colorCurvesEnabled",void 0),c([yt("colorGradingTexture")],e.prototype,"_colorGradingTexture",void 0),c([mt()],e.prototype,"_colorGradingEnabled",void 0),c([mt()],e.prototype,"_colorGradingWithGreenDepth",void 0),c([mt()],e.prototype,"_colorGradingBGR",void 0),c([mt()],e.prototype,"_exposure",void 0),c([mt()],e.prototype,"_toneMappingEnabled",void 0),c([mt()],e.prototype,"_toneMappingType",void 0),c([mt()],e.prototype,"_contrast",void 0),c([mt()],e.prototype,"vignetteStretch",void 0),c([mt()],e.prototype,"vignetteCentreX",void 0),c([mt()],e.prototype,"vignetteCentreY",void 0),c([mt()],e.prototype,"vignetteWeight",void 0),c([Tt()],e.prototype,"vignetteColor",void 0),c([mt()],e.prototype,"vignetteCameraFov",void 0),c([mt()],e.prototype,"_vignetteBlendMode",void 0),c([mt()],e.prototype,"_vignetteEnabled",void 0),c([mt()],e.prototype,"_skipFinalColorClamp",void 0),c([mt()],e.prototype,"_applyByPostProcess",void 0),c([mt()],e.prototype,"_isEnabled",void 0),e}();Mt._ImageProcessingConfigurationParser=dr.Parse;var pr,_r,gr,mr,yr,vr,br,Tr,Mr=function(){function e(e,t,r,i,n,s){this.source=e,this.pointerX=t,this.pointerY=r,this.meshUnderPointer=i,this.sourceEvent=n,this.additionalData=s}return e.CreateNew=function(t,r,i){var n=t.getScene();return new e(t,n.pointerX,n.pointerY,n.meshUnderPointer||t,r,i)},e.CreateNewFromSprite=function(t,r,i,n){return new e(t,r.pointerX,r.pointerY,r.meshUnderPointer,i,n)},e.CreateNewFromScene=function(t,r){return new e(null,t.pointerX,t.pointerY,t.meshUnderPointer,r)},e.CreateNewFromPrimitive=function(t,r,i,n){return new e(t,r.x,r.y,null,i,n)},e}(),xr=function(){function e(e){this._vertexBuffers={},this._scene=e}return e.prototype._prepareBuffers=function(){if(!this._vertexBuffers[Rt.PositionKind]){var e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[Rt.PositionKind]=new Rt(this._scene.getEngine(),e,Rt.PositionKind,!1,!1,2),this._buildIndexBuffer()}},e.prototype._buildIndexBuffer=function(){var e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)},e.prototype._rebuild=function(){var e=this._vertexBuffers[Rt.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())},e.prototype._prepareFrame=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var r=this._scene.activeCamera;return!!r&&(!(!(t=t||r._postProcesses.filter((function(e){return null!=e})))||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(r,e,null!==t&&void 0!==t),!0))},e.prototype.directRender=function(e,t,r,i,n,s){var o;void 0===t&&(t=null),void 0===r&&(r=!1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=!1);for(var a=this._scene.getEngine(),u=0;u<e.length;u++){u<e.length-1?e[u+1].activate(this._scene.activeCamera,null===t||void 0===t?void 0:t.texture):(t?a.bindFramebuffer(t,i,void 0,void 0,r,n):s||a.restoreDefaultFramebuffer(),null===(o=a._debugInsertMarker)||void 0===o||o.call(a,"post process ".concat(e[u].name," output")));var h=e[u],c=h.apply();c&&(h.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,c),a.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(c))}a.setDepthBuffer(!0),a.setDepthWrite(!0)},e.prototype._finalizeFrame=function(e,t,r,i,n){var s;void 0===n&&(n=!1);var o=this._scene.activeCamera;if(o&&(i=i||o._postProcesses.filter((function(e){return null!=e})),0!==i.length&&this._scene.postProcessesEnabled)){for(var a=this._scene.getEngine(),u=0,h=i.length;u<h;u++){var c=i[u];if(u<h-1?c._outputTexture=i[u+1].activate(o,null===t||void 0===t?void 0:t.texture):(t?(a.bindFramebuffer(t,r,void 0,void 0,n),c._outputTexture=t):(a.restoreDefaultFramebuffer(),c._outputTexture=null),null===(s=a._debugInsertMarker)||void 0===s||s.call(a,"post process ".concat(i[u].name," output"))),e)break;var l=c.apply();l&&(c.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,l),a.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(l))}a.setDepthBuffer(!0),a.setDepthWrite(!0),a.setAlphaMode(0)}},e.prototype.dispose=function(){var e=this._vertexBuffers[Rt.PositionKind];e&&(e.dispose(),this._vertexBuffers[Rt.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},e}(),Er=function(){function e(e,t,r,i,n){void 0===r&&(r=null),void 0===i&&(i=null),void 0===n&&(n=null),this.index=e,this._opaqueSubMeshes=new nr(256),this._transparentSubMeshes=new nr(256),this._alphaTestSubMeshes=new nr(256),this._depthOnlySubMeshes=new nr(256),this._particleSystems=new nr(256),this._spriteManagers=new nr(256),this._empty=!0,this._edgesRenderers=new sr(16),this._scene=t,this.opaqueSortCompareFn=r,this.alphaTestSortCompareFn=i,this.transparentSortCompareFn=n}return Object.defineProperty(e.prototype,"opaqueSortCompareFn",{set:function(t){this._opaqueSortCompareFn=t||e.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaTestSortCompareFn",{set:function(t){this._alphaTestSortCompareFn=t||e.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transparentSortCompareFn",{set:function(t){this._transparentSortCompareFn=t||e.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted},enumerable:!1,configurable:!0}),e.prototype.render=function(e,t,r,i){if(e)e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);else{var n=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(n.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),n.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);var s=n.getStencilBuffer();if(n.setStencilBuffer(!1),t&&this._renderSprites(),r&&this._renderParticles(i),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(n.setStencilBuffer(s),this._scene.useOrderIndependentTransparency){var o=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);o.length&&this._renderTransparent(o)}else this._renderTransparent(this._transparentSubMeshes);n.setAlphaMode(0)}if(n.setStencilBuffer(!1),this._edgesRenderers.length){for(var a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();n.setAlphaMode(0)}n.setStencilBuffer(s)}},e.prototype._renderOpaqueSorted=function(t){return e._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},e.prototype._renderAlphaTestSorted=function(t){return e._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},e.prototype._renderTransparentSorted=function(t){return e._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)},e._RenderSorted=function(t,r,i,n){var s,o=0,a=i?i.globalPosition:e._ZeroVector;if(n)for(;o<t.length;o++)(s=t.data[o])._alphaIndex=s.getMesh().alphaIndex,s._distanceToCamera=tt.Distance(s.getBoundingInfo().boundingSphere.centerWorld,a);var u=t.length===t.data.length?t.data:t.data.slice(0,t.length);r&&u.sort(r);var h=u[0].getMesh().getScene();for(o=0;o<u.length;o++)if(s=u[o],!h._activeMeshesFrozenButKeepClipping||s.isInFrustum(h._frustumPlanes)){if(n){var c=s.getMaterial();if(c&&c.needDepthPrePass){var l=c.getScene().getEngine();l.setColorWrite(!1),l.setAlphaMode(0),s.render(!1),l.setColorWrite(!0)}}s.render(n)}},e.defaultTransparentSortCompare=function(t,r){return t._alphaIndex>r._alphaIndex?1:t._alphaIndex<r._alphaIndex?-1:e.backToFrontSortCompare(t,r)},e.backToFrontSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?1:e._distanceToCamera>t._distanceToCamera?-1:0},e.frontToBackSortCompare=function(e,t){return e._distanceToCamera<t._distanceToCamera?-1:e._distanceToCamera>t._distanceToCamera?1:0},e.PainterSortCompare=function(e,t){var r=e.getMesh(),i=t.getMesh();return r.material&&i.material?r.material.uniqueId-i.material.uniqueId:r.uniqueId-i.uniqueId},e.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset(),this._empty=!0},e.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},e.prototype.dispatch=function(e,t,r){void 0===t&&(t=e.getMesh()),void 0===r&&(r=e.getMaterial()),null!==r&&void 0!==r&&(r.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(e):r.needAlphaTesting()?(r.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(r.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),t._renderingGroup=this,t._edgesRenderer&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)},e.prototype.dispatchSprites=function(e){this._spriteManagers.push(e),this._empty=!1},e.prototype.dispatchParticles=function(e){this._particleSystems.push(e),this._empty=!1},e.prototype._renderParticles=function(e){if(0!==this._particleSystems.length){var t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var r=0;r<this._particleSystems.length;r++){var i=this._particleSystems.data[r];if(0!==(t&&t.layerMask&i.layerMask)){var n=i.emitter;n.position&&e&&-1===e.indexOf(n)||this._scene._activeParticles.addCount(i.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},e.prototype._renderSprites=function(){if(this._scene.spritesEnabled&&0!==this._spriteManagers.length){var e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var t=0;t<this._spriteManagers.length;t++){var r=this._spriteManagers.data[t];0!==(e&&e.layerMask&r.layerMask)&&r.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},e._ZeroVector=tt.Zero(),e}(),Ar=function(){},Pr=function(){function e(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Ar,this._scene=t;for(var r=e.MIN_RENDERINGGROUPS;r<e.MAX_RENDERINGGROUPS;r++)this._autoClearDepthStencil[r]={autoClear:!0,depth:!0,stencil:!0}}return e.prototype._clearDepthStencilBuffer=function(e,t){void 0===e&&(e=!0),void 0===t&&(t=!0),this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,t),this._depthStencilBufferAlreadyCleaned=!0)},e.prototype.render=function(t,r,i,n){var s=this._renderingGroupInfo;if(s.scene=this._scene,s.camera=this._scene.activeCamera,this._scene.spriteManagers&&n)for(var o=0;o<this._scene.spriteManagers.length;o++){var a=this._scene.spriteManagers[o];this.dispatchSprites(a)}for(o=e.MIN_RENDERINGGROUPS;o<e.MAX_RENDERINGGROUPS;o++){this._depthStencilBufferAlreadyCleaned=o===e.MIN_RENDERINGGROUPS;var u=this._renderingGroups[o];if(u&&!u._empty){var h=Math.pow(2,o);if(s.renderingGroupId=o,this._scene.onBeforeRenderingGroupObservable.notifyObservers(s,h),e.AUTOCLEAR){var c=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(o):this._autoClearDepthStencil[o];c&&c.autoClear&&this._clearDepthStencilBuffer(c.depth,c.stencil)}for(var l=0,f=this._scene._beforeRenderingGroupDrawStage;l<f.length;l++){f[l].action(o)}u.render(t,n,i,r);for(var d=0,p=this._scene._afterRenderingGroupDrawStage;d<p.length;d++){p[d].action(o)}this._scene.onAfterRenderingGroupObservable.notifyObservers(s,h)}}},e.prototype.reset=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var r=this._renderingGroups[t];r&&r.prepare()}},e.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},e.prototype.freeRenderingGroups=function(){for(var t=e.MIN_RENDERINGGROUPS;t<e.MAX_RENDERINGGROUPS;t++){var r=this._renderingGroups[t];r&&r.dispose()}},e.prototype._prepareRenderingGroup=function(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new Er(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))},e.prototype.dispatchSprites=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchSprites(e)},e.prototype.dispatchParticles=function(e){var t=e.renderingGroupId||0;this._prepareRenderingGroup(t),this._renderingGroups[t].dispatchParticles(e)},e.prototype.dispatch=function(e,t,r){void 0===t&&(t=e.getMesh());var i=t.renderingGroupId||0;this._prepareRenderingGroup(i),this._renderingGroups[i].dispatch(e,t,r)},e.prototype.setRenderingOrder=function(e,t,r,i){if(void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._customOpaqueSortCompareFn[e]=t,this._customAlphaTestSortCompareFn[e]=r,this._customTransparentSortCompareFn[e]=i,this._renderingGroups[e]){var n=this._renderingGroups[e];n.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],n.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],n.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}},e.prototype.setRenderingAutoClearDepthStencil=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0),this._autoClearDepthStencil[e]={autoClear:t,depth:r,stencil:i}},e.prototype.getAutoClearDepthStencilSetup=function(e){return this._autoClearDepthStencil[e]},e.MAX_RENDERINGGROUPS=4,e.MIN_RENDERINGGROUPS=0,e.AUTOCLEAR=!0,e}(),Rr=function(){function e(){}return e.NAME_EFFECTLAYER="EffectLayer",e.NAME_LAYER="Layer",e.NAME_LENSFLARESYSTEM="LensFlareSystem",e.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",e.NAME_PARTICLESYSTEM="ParticleSystem",e.NAME_GAMEPAD="Gamepad",e.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",e.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",e.NAME_PREPASSRENDERER="PrePassRenderer",e.NAME_DEPTHRENDERER="DepthRenderer",e.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",e.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",e.NAME_SPRITE="Sprite",e.NAME_SUBSURFACE="SubSurface",e.NAME_OUTLINERENDERER="Outline",e.NAME_PROCEDURALTEXTURE="ProceduralTexture",e.NAME_SHADOWGENERATOR="ShadowGenerator",e.NAME_OCTREE="Octree",e.NAME_PHYSICSENGINE="PhysicsEngine",e.NAME_AUDIO="Audio",e.STEP_ISREADYFORMESH_EFFECTLAYER=0,e.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,e.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,e.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,e.STEP_BEFORECAMERADRAW_PREPASS=0,e.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,e.STEP_BEFORECAMERADRAW_LAYER=2,e.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,e.STEP_BEFORERENDERTARGETDRAW_LAYER=1,e.STEP_BEFORERENDERINGMESH_PREPASS=0,e.STEP_BEFORERENDERINGMESH_OUTLINE=1,e.STEP_AFTERRENDERINGMESH_PREPASS=0,e.STEP_AFTERRENDERINGMESH_OUTLINE=1,e.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,e.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,e.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,e.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,e.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,e.STEP_BEFORECLEAR_PREPASS=1,e.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,e.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,e.STEP_AFTERRENDERTARGETDRAW_LAYER=1,e.STEP_AFTERCAMERADRAW_PREPASS=0,e.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,e.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,e.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,e.STEP_AFTERCAMERADRAW_LAYER=4,e.STEP_AFTERRENDER_AUDIO=0,e.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,e.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,e.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,e.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,e.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,e.STEP_POINTERMOVE_SPRITE=0,e.STEP_POINTERDOWN_SPRITE=0,e.STEP_POINTERUP_SPRITE=0,e}(),Ir=function(e){function t(t){return e.apply(this,t)||this}return u(t,e),t.Create=function(){return Object.create(t.prototype)},t.prototype.registerStep=function(e,t,r){var i=0;for(Number.MAX_VALUE;i<this.length;i++){if(e<this[i].index)break}this.splice(i,0,{index:e,component:t,action:r.bind(t)})},t.prototype.clear=function(){this.length=0},t}(Array),Sr=function(){function e(){}return e.POINTERDOWN=1,e.POINTERUP=2,e.POINTERMOVE=4,e.POINTERWHEEL=8,e.POINTERPICK=16,e.POINTERTAP=32,e.POINTERDOUBLETAP=64,e}(),Cr=function(e,t){this.type=e,this.event=t},Dr=function(e){function t(t,r,i,n){var s=e.call(this,t,r)||this;return s.ray=null,s.skipOnPointerObservable=!1,s.localPosition=new et(i,n),s}return u(t,e),t}(Cr),Or=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.pickInfo=i,n}return u(t,e),t}(Cr),Fr=function(){function e(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(e,"HasTriggers",{get:function(){for(var t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e,"HasPickTriggers",{get:function(){for(var t in e.Triggers)if(Object.prototype.hasOwnProperty.call(e.Triggers,t)){var r=parseInt(t);if(r>=1&&r<=7)return!0}return!1},enumerable:!1,configurable:!0}),e.HasSpecificTrigger=function(t){for(var r in e.Triggers){if(Object.prototype.hasOwnProperty.call(e.Triggers,r))if(parseInt(r)===t)return!0}return!1},e.Triggers={},e}(),wr=function(){function e(){}return e.KEYDOWN=1,e.KEYUP=2,e}(),Br=function(e,t){this.type=e,this.event=t},Lr=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.type=t,i.event=r,i.skipOnKeyboardObservable=!1,i}return u(t,e),Object.defineProperty(t.prototype,"skipOnPointerObservable",{get:function(){return this.skipOnKeyboardObservable},set:function(e){this.skipOnKeyboardObservable=e},enumerable:!1,configurable:!0}),t}(Br);!function(e){e[e.Generic=0]="Generic",e[e.Keyboard=1]="Keyboard",e[e.Mouse=2]="Mouse",e[e.Touch=3]="Touch",e[e.DualShock=4]="DualShock",e[e.Xbox=5]="Xbox",e[e.Switch=6]="Switch",e[e.DualSense=7]="DualSense"}(pr||(pr={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.Move=12]="Move"}(_r||(_r={})),function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.LeftClick=2]="LeftClick",e[e.MiddleClick=3]="MiddleClick",e[e.RightClick=4]="RightClick",e[e.BrowserBack=5]="BrowserBack",e[e.BrowserForward=6]="BrowserForward",e[e.MouseWheelX=7]="MouseWheelX",e[e.MouseWheelY=8]="MouseWheelY",e[e.MouseWheelZ=9]="MouseWheelZ",e[e.DeltaHorizontal=10]="DeltaHorizontal",e[e.DeltaVertical=11]="DeltaVertical"}(gr||(gr={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Share=8]="Share",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(mr||(mr={})),function(e){e[e.Cross=0]="Cross",e[e.Circle=1]="Circle",e[e.Square=2]="Square",e[e.Triangle=3]="Triangle",e[e.L1=4]="L1",e[e.R1=5]="R1",e[e.L2=6]="L2",e[e.R2=7]="R2",e[e.Create=8]="Create",e[e.Options=9]="Options",e[e.L3=10]="L3",e[e.R3=11]="R3",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.TouchPad=17]="TouchPad",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(yr||(yr={})),function(e){e[e.A=0]="A",e[e.B=1]="B",e[e.X=2]="X",e[e.Y=3]="Y",e[e.LB=4]="LB",e[e.RB=5]="RB",e[e.LT=6]="LT",e[e.RT=7]="RT",e[e.Back=8]="Back",e[e.Start=9]="Start",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.LStickXAxis=17]="LStickXAxis",e[e.LStickYAxis=18]="LStickYAxis",e[e.RStickXAxis=19]="RStickXAxis",e[e.RStickYAxis=20]="RStickYAxis"}(vr||(vr={})),function(e){e[e.B=0]="B",e[e.A=1]="A",e[e.Y=2]="Y",e[e.X=3]="X",e[e.L=4]="L",e[e.R=5]="R",e[e.ZL=6]="ZL",e[e.ZR=7]="ZR",e[e.Minus=8]="Minus",e[e.Plus=9]="Plus",e[e.LS=10]="LS",e[e.RS=11]="RS",e[e.DPadUp=12]="DPadUp",e[e.DPadDown=13]="DPadDown",e[e.DPadLeft=14]="DPadLeft",e[e.DPadRight=15]="DPadRight",e[e.Home=16]="Home",e[e.Capture=17]="Capture",e[e.LStickXAxis=18]="LStickXAxis",e[e.LStickYAxis=19]="LStickYAxis",e[e.RStickXAxis=20]="RStickXAxis",e[e.RStickYAxis=21]="RStickYAxis"}(br||(br={})),function(e){e[e.PointerMove=0]="PointerMove",e[e.PointerDown=1]="PointerDown",e[e.PointerUp=2]="PointerUp"}(Tr||(Tr={}));var Nr=function(){function e(){}return e.DOM_DELTA_PIXEL=0,e.DOM_DELTA_LINE=1,e.DOM_DELTA_PAGE=2,e}(),Ur=function(){function e(){}return e.CreateDeviceEvent=function(e,t,r,i,n,s){switch(e){case pr.Keyboard:return this._CreateKeyboardEvent(r,i,n,s);case pr.Mouse:if(r===_r.MouseWheelX||r===_r.MouseWheelY||r===_r.MouseWheelZ)return this._CreateWheelEvent(e,t,r,i,n,s);case pr.Touch:return this._CreatePointerEvent(e,t,r,i,n,s);default:throw"Unable to generate event for device ".concat(pr[e])}},e._CreatePointerEvent=function(e,t,r,i,n,s){var o=this._CreateMouseEvent(e,t,r,i,n,s);return e===pr.Mouse?(o.deviceType=pr.Mouse,o.pointerId=1,o.pointerType="mouse"):(o.deviceType=pr.Touch,o.pointerId=t,o.pointerType="touch"),r===_r.Move?o.type="pointermove":r>=_r.LeftClick&&r<=_r.RightClick&&(o.type=1===i?"pointerdown":"pointerup",o.button=r-2),o},e._CreateWheelEvent=function(e,t,r,i,n,s){var o=this._CreateMouseEvent(e,t,r,i,n,s);switch(o.type="wheel",o.deltaMode=Nr.DOM_DELTA_PIXEL,o.deltaX=0,o.deltaY=0,o.deltaZ=0,r){case _r.MouseWheelX:o.deltaX=i;break;case _r.MouseWheelY:o.deltaY=i;break;case _r.MouseWheelZ:o.deltaZ=i}return o},e._CreateMouseEvent=function(e,t,r,i,n,s){var o=this._CreateEvent(s),a=n.pollInput(e,t,_r.Horizontal),u=n.pollInput(e,t,_r.Vertical);return s?(o.movementX=0,o.movementY=0,o.offsetX=o.movementX-s.getBoundingClientRect().x,o.offsetY=o.movementY-s.getBoundingClientRect().y):(o.movementX=n.pollInput(e,t,gr.DeltaHorizontal),o.movementY=n.pollInput(e,t,gr.DeltaVertical),o.offsetX=0,o.offsetY=0),this._CheckNonCharacterKeys(o,n),o.clientX=a,o.clientY=u,o.x=a,o.y=u,o.deviceType=e,o.deviceSlot=t,o.inputIndex=r,o},e._CreateKeyboardEvent=function(e,t,r,i){var n=this._CreateEvent(i);return this._CheckNonCharacterKeys(n,r),n.deviceType=pr.Keyboard,n.deviceSlot=0,n.inputIndex=e,n.type=1===t?"keydown":"keyup",n.key=String.fromCharCode(e),n.keyCode=e,n},e._CheckNonCharacterKeys=function(e,t){var r=t.isDeviceAvailable(pr.Keyboard),i=r&&1===t.pollInput(pr.Keyboard,0,18),n=r&&1===t.pollInput(pr.Keyboard,0,17),s=r&&(1===t.pollInput(pr.Keyboard,0,91)||1===t.pollInput(pr.Keyboard,0,92)||1===t.pollInput(pr.Keyboard,0,93)),o=r&&1===t.pollInput(pr.Keyboard,0,16);e.altKey=i,e.ctrlKey=n,e.metaKey=s,e.shiftKey=o},e._CreateEvent=function(e){var t={preventDefault:function(){}};return t.target=e,t},e}(),kr=function(){function e(e,t,r){var i=this;this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(e,t,(function(e,t,n,s){var o=Ur.CreateDeviceEvent(e,t,n,s,i);r(e,t,o)})):this._createDummyNativeInput()}return e.prototype.pollInput=function(e,t,r){return this._nativeInput.pollInput(e,t,r)},e.prototype.isDeviceAvailable=function(e){return e===pr.Mouse||e===pr.Touch},e.prototype.dispose=function(){this._nativeInput.dispose()},e.prototype._createDummyNativeInput=function(){return{pollInput:function(){return 0},isDeviceAvailable:function(){return!1},dispose:function(){}}},e}(),Vr=Object.keys(_r).length/2,Gr=function(){function e(e,t,r,i){var n=this;this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=Ve.IsSafari(),this._usingMacOS=/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=function(e){},this._keyboardUpEvent=function(e){},this._keyboardBlurEvent=function(e){},this._pointerMoveEvent=function(e){},this._pointerDownEvent=function(e){},this._pointerUpEvent=function(e){},this._pointerCancelEvent=function(e){},this._pointerWheelEvent=function(e){},this._pointerBlurEvent=function(e){},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=b.IsNavigatorAvailable()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=function(e){},this._gamepadDisconnectedEvent=function(e){},this._eventPrefix=Ve.GetPointerPrefix(e),this._engine=e,this._onDeviceConnected=t,this._onDeviceDisconnected=r,this._onInputChanged=i,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=function(){n._enableEvents()})}return e.prototype.pollInput=function(e,t,r){var i=this._inputs[e][t];if(!i)throw"Unable to find device ".concat(pr[e]);e>=pr.DualShock&&e<=pr.DualSense&&this._updateDevice(e,t,r);var n=i[r];if(void 0===n)throw"Unable to find input ".concat(r," for device ").concat(pr[e]," in slot ").concat(t);return r===_r.Move&&Ve.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),n},e.prototype.isDeviceAvailable=function(e){return void 0!==this._inputs[e]},e.prototype.dispose=function(){this._onDeviceConnected=function(){},this._onDeviceDisconnected=function(){},this._onInputChanged=function(){},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()},e.prototype._enableEvents=function(){var e=null===this||void 0===this?void 0:this._engine.getInputElement();if(e&&(!this._eventsAttached||this._elementToAttachTo!==e)){if(this._disableEvents(),this._inputs)for(var t=0,r=this._inputs;t<r.length;t++){var i=r[t];if(i)for(var n in i){var s=i[+n];if(s)for(var o=0;o<s.length;o++)s[o]=0}}this._elementToAttachTo=e,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}},e.prototype._disableEvents=function(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1},e.prototype._checkForConnectedDevices=function(){if(navigator.getGamepads)for(var e=0,t=navigator.getGamepads();e<t.length;e++){var r=t[e];r&&this._addGamePad(r)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(pr.Mouse,0,0,0)},e.prototype._addGamePad=function(e){var t=this._getGamepadDeviceType(e.id),r=e.index;this._gamepads=this._gamepads||new Array(e.index+1),this._registerDevice(t,r,e.buttons.length+e.axes.length),this._gamepads[r]=t},e.prototype._addPointerDevice=function(e,t,r,i){this._pointerActive||(this._pointerActive=!0),this._registerDevice(e,t,Vr);var n=this._inputs[e][t];n[0]=r,n[1]=i},e.prototype._registerDevice=function(e,t,r){if(void 0===t)throw"Unable to register device ".concat(pr[e]," to undefined slot.");if(this._inputs[e]||(this._inputs[e]={}),!this._inputs[e][t]){for(var i=new Array(r),n=0;n<r;n++)i[n]=0;this._inputs[e][t]=i,this._onDeviceConnected(e,t)}},e.prototype._unregisterDevice=function(e,t){this._inputs[e][t]&&(delete this._inputs[e][t],this._onDeviceDisconnected(e,t))},e.prototype._handleKeyActions=function(){var e=this;this._keyboardDownEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(pr.Keyboard,0,255));var r=e._inputs[pr.Keyboard][0];if(r){r[t.keyCode]=1;var i=t;i.inputIndex=t.keyCode,e._usingMacOS&&t.metaKey&&"Meta"!==t.key&&(e._metaKeys.includes(t.keyCode)||e._metaKeys.push(t.keyCode)),e._onInputChanged(pr.Keyboard,0,i)}},this._keyboardUpEvent=function(t){e._keyboardActive||(e._keyboardActive=!0,e._registerDevice(pr.Keyboard,0,255));var r=e._inputs[pr.Keyboard][0];if(r){r[t.keyCode]=0;var i=t;if(i.inputIndex=t.keyCode,e._usingMacOS&&"Meta"===t.key&&e._metaKeys.length>0){for(var n=0,s=e._metaKeys;n<s.length;n++){var o=s[n],a=Ur.CreateDeviceEvent(pr.Keyboard,0,o,0,e,e._elementToAttachTo);r[o]=0,e._onInputChanged(pr.Keyboard,0,a)}e._metaKeys.splice(0,e._metaKeys.length)}e._onInputChanged(pr.Keyboard,0,i)}},this._keyboardBlurEvent=function(){if(e._keyboardActive){for(var t=e._inputs[pr.Keyboard][0],r=0;r<t.length;r++)if(0!==t[r]){t[r]=0;var i=Ur.CreateDeviceEvent(pr.Keyboard,0,r,0,e,e._elementToAttachTo);e._onInputChanged(pr.Keyboard,0,i)}e._usingMacOS&&e._metaKeys.splice(0,e._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},e.prototype._handlePointerActions=function(){var e=this;this._maxTouchPoints=b.IsNavigatorAvailable()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(var t=0;t<this._maxTouchPoints;t++)this._activeTouchIds[t]=-1;this._pointerMoveEvent=function(t){var r=e._getPointerType(t),i=r===pr.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);e._inputs[r]||(e._inputs[r]={}),e._inputs[r][i]||e._addPointerDevice(r,i,t.clientX,t.clientY);var n=e._inputs[r][i];if(n){n[_r.Horizontal]=t.clientX,n[_r.Vertical]=t.clientY;var s=t;s.inputIndex=_r.Move,e._onInputChanged(r,i,s),e._usingSafari||-1===t.button||(s.inputIndex=t.button+2,n[t.button+2]=n[t.button+2]?0:1,e._onInputChanged(r,i,s))}},this._pointerDownEvent=function(t){var r=e._getPointerType(t),i=r===pr.Mouse?0:t.pointerId;if(r===pr.Touch){var n=e._activeTouchIds.indexOf(-1);if(!(n>=0))return void Ve.Warn("Max number of touches exceeded.  Ignoring touches in excess of ".concat(e._maxTouchPoints));i=n,e._activeTouchIds[n]=t.pointerId}e._inputs[r]||(e._inputs[r]={}),e._inputs[r][i]?r===pr.Touch&&e._onDeviceConnected(r,i):e._addPointerDevice(r,i,t.clientX,t.clientY);var s=e._inputs[r][i];if(s){var o=s[_r.Horizontal],a=s[_r.Vertical];if(r===pr.Mouse){if(-1===e._mouseId&&(void 0===t.pointerId?e._mouseId=e._isUsingFirefox?0:1:e._mouseId=t.pointerId),!document.pointerLockElement)try{e._elementToAttachTo.setPointerCapture(e._mouseId)}catch(h){}}else if(t.pointerId&&!document.pointerLockElement)try{e._elementToAttachTo.setPointerCapture(t.pointerId)}catch(h){}s[_r.Horizontal]=t.clientX,s[_r.Vertical]=t.clientY,s[t.button+2]=1;var u=t;u.inputIndex=t.button+2,e._onInputChanged(r,i,u),o===t.clientX&&a===t.clientY||(u.inputIndex=_r.Move,e._onInputChanged(r,i,u))}},this._pointerUpEvent=function(t){var r,i,n,s,o,a=e._getPointerType(t),u=a===pr.Mouse?0:e._activeTouchIds.indexOf(t.pointerId);if(a===pr.Touch){if(-1===u)return;e._activeTouchIds[u]=-1}var h=null===(r=e._inputs[a])||void 0===r?void 0:r[u];if(h&&0!==h[t.button+2]){var c=h[_r.Horizontal],l=h[_r.Vertical];h[_r.Horizontal]=t.clientX,h[_r.Vertical]=t.clientY,h[t.button+2]=0;var f=t;c===t.clientX&&l===t.clientY||(f.inputIndex=_r.Move,e._onInputChanged(a,u,f)),f.inputIndex=t.button+2,a===pr.Mouse&&e._mouseId>=0&&(null===(n=(i=e._elementToAttachTo).hasPointerCapture)||void 0===n?void 0:n.call(i,e._mouseId))?e._elementToAttachTo.releasePointerCapture(e._mouseId):t.pointerId&&(null===(o=(s=e._elementToAttachTo).hasPointerCapture)||void 0===o?void 0:o.call(s,t.pointerId))&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._onInputChanged(a,u,f),a===pr.Touch&&e._onDeviceDisconnected(a,u)}},this._pointerCancelEvent=function(t){var r,i,n,s;if("mouse"===t.pointerType){var o=e._inputs[pr.Mouse][0];e._mouseId>=0&&(null===(i=(r=e._elementToAttachTo).hasPointerCapture)||void 0===i?void 0:i.call(r,e._mouseId))&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var a=_r.LeftClick;a<=_r.BrowserForward;a++)if(1===o[a]){o[a]=0;var u=Ur.CreateDeviceEvent(pr.Mouse,0,a,0,e,e._elementToAttachTo);e._onInputChanged(pr.Mouse,0,u)}}else{var h=e._activeTouchIds.indexOf(t.pointerId);(null===(s=(n=e._elementToAttachTo).hasPointerCapture)||void 0===s?void 0:s.call(n,t.pointerId))&&e._elementToAttachTo.releasePointerCapture(t.pointerId),e._inputs[pr.Touch][h][_r.LeftClick]=0;u=Ur.CreateDeviceEvent(pr.Touch,h,_r.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(pr.Touch,h,u),e._activeTouchIds[h]=-1,e._onDeviceDisconnected(pr.Touch,h)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";var r=!1,i=function(){};try{var n=Object.defineProperty({},"passive",{get:function(){r=!0}});this._elementToAttachTo.addEventListener("test",i,n),this._elementToAttachTo.removeEventListener("test",i,n)}catch(s){}this._pointerBlurEvent=function(){var t,r,i,n,s;if(e.isDeviceAvailable(pr.Mouse)){var o=e._inputs[pr.Mouse][0];e._mouseId>=0&&(null===(r=(t=e._elementToAttachTo).hasPointerCapture)||void 0===r?void 0:r.call(t,e._mouseId))&&e._elementToAttachTo.releasePointerCapture(e._mouseId);for(var a=_r.LeftClick;a<=_r.BrowserForward;a++)if(1===o[a]){o[a]=0;var u=Ur.CreateDeviceEvent(pr.Mouse,0,a,0,e,e._elementToAttachTo);e._onInputChanged(pr.Mouse,0,u)}}if(e.isDeviceAvailable(pr.Touch)){o=e._inputs[pr.Touch];for(var h=0;h<e._activeTouchIds.length;h++){var c=e._activeTouchIds[h];if((null===(n=(i=e._elementToAttachTo).hasPointerCapture)||void 0===n?void 0:n.call(i,c))&&e._elementToAttachTo.releasePointerCapture(c),-1!==c&&1===(null===(s=o[h])||void 0===s?void 0:s[_r.LeftClick])){o[h][_r.LeftClick]=0;u=Ur.CreateDeviceEvent(pr.Touch,h,_r.LeftClick,0,e,e._elementToAttachTo);e._onInputChanged(pr.Touch,h,u),e._activeTouchIds[h]=-1,e._onDeviceDisconnected(pr.Touch,h)}}}},this._pointerWheelEvent=function(t){var r=pr.Mouse;e._inputs[r]||(e._inputs[r]=[]),e._inputs[r][0]||(e._pointerActive=!0,e._registerDevice(r,0,Vr));var i=e._inputs[r][0];if(i){i[_r.MouseWheelX]=t.deltaX||0,i[_r.MouseWheelY]=t.deltaY||t.wheelDelta||0,i[_r.MouseWheelZ]=t.deltaZ||0;var n=t;0!==i[_r.MouseWheelX]&&(n.inputIndex=_r.MouseWheelX,e._onInputChanged(r,0,n)),0!==i[_r.MouseWheelY]&&(n.inputIndex=_r.MouseWheelY,e._onInputChanged(r,0,n)),0!==i[_r.MouseWheelZ]&&(n.inputIndex=_r.MouseWheelZ,e._onInputChanged(r,0,n))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!r&&{passive:!0}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((function(){if(e.isDeviceAvailable(pr.Mouse)){var t=e._inputs[pr.Mouse][0];t[_r.MouseWheelX]=0,t[_r.MouseWheelY]=0,t[_r.MouseWheelZ]=0}}))},e.prototype._handleGamepadActions=function(){var e=this;this._gamepadConnectedEvent=function(t){e._addGamePad(t.gamepad)},this._gamepadDisconnectedEvent=function(t){if(e._gamepads){var r=e._getGamepadDeviceType(t.gamepad.id),i=t.gamepad.index;e._unregisterDevice(r,i),delete e._gamepads[i]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},e.prototype._updateDevice=function(e,t,r){var i=navigator.getGamepads()[t];if(i&&e===this._gamepads[t]){var n=this._inputs[e][t];r>=i.buttons.length?n[r]=i.axes[r-i.buttons.length].valueOf():n[r]=i.buttons[r].value}},e.prototype._getGamepadDeviceType=function(e){return-1!==e.indexOf("054c")?-1!==e.indexOf("0ce6")?pr.DualSense:pr.DualShock:-1!==e.indexOf("Xbox One")||-1!==e.search("Xbox 360")||-1!==e.search("xinput")?pr.Xbox:-1!==e.indexOf("057e")?pr.Switch:pr.Generic},e.prototype._getPointerType=function(e){var t=pr.Mouse;return("touch"===e.pointerType||"pen"===e.pointerType||e.touches)&&(t=pr.Touch),t},e}(),Wr=function(){function e(e,t,r){void 0===r&&(r=0),this.deviceType=t,this.deviceSlot=r,this.onInputChangedObservable=new _,this._deviceInputSystem=e}return e.prototype.getInput=function(e){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,e)},e}(),zr=function(){function e(e){var t=this;this._registeredManagers=new Array,this._refCount=0,this.registerManager=function(e){for(var r=0;r<t._devices.length;r++){var i=t._devices[r];for(var n in i){var s=+n;e._addDevice(new Wr(t._deviceInputSystem,r,s))}}t._registeredManagers.push(e)},this.unregisterManager=function(e){var r=t._registeredManagers.indexOf(e);r>-1&&t._registeredManagers.splice(r,1)};var r=Object.keys(pr).length/2;this._devices=new Array(r);var i=function(e,r){t._devices[e]||(t._devices[e]=new Array),t._devices[e][r]||(t._devices[e][r]=r);for(var i=0,n=t._registeredManagers;i<n.length;i++){var s=n[i],o=new Wr(t._deviceInputSystem,e,r);s._addDevice(o)}},n=function(e,r){var i;(null===(i=t._devices[e])||void 0===i?void 0:i[r])&&delete t._devices[e][r];for(var n=0,s=t._registeredManagers;n<s.length;n++){s[n]._removeDevice(e,r)}},s=function(e,r,i){if(i)for(var n=0,s=t._registeredManagers;n<s.length;n++){s[n]._onInputChanged(e,r,i)}};"undefined"!==typeof _native?this._deviceInputSystem=new kr(i,n,s):this._deviceInputSystem=new Gr(e,i,n,s)}return e.prototype.dispose=function(){this._deviceInputSystem.dispose()},e}(),Kr=function(){function e(e){var t=this,r=Object.keys(pr).length/2;this._devices=new Array(r),this._firstDevice=new Array(r),this._engine=e,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new zr(e)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new _((function(e){for(var r=0,i=t._devices;r<i.length;r++){var n=i[r];if(n)for(var s=0,o=n;s<o.length;s++){var a=o[s];a&&t.onDeviceConnectedObservable.notifyObserver(e,a)}}})),this.onDeviceDisconnectedObservable=new _,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=e.onDisposeObservable.add((function(){t.dispose()}))}return e.prototype.getDeviceSource=function(e,t){if(void 0===t){if(void 0===this._firstDevice[e])return null;t=this._firstDevice[e]}return this._devices[e]&&void 0!==this._devices[e][t]?this._devices[e][t]:null},e.prototype.getDeviceSources=function(e){return this._devices[e].filter((function(e){return!!e}))},e.prototype.dispose=function(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.onDisposeObservable.remove(this._onDisposeObserver)},e.prototype._addDevice=function(e){this._devices[e.deviceType]||(this._devices[e.deviceType]=new Array),this._devices[e.deviceType][e.deviceSlot]||(this._devices[e.deviceType][e.deviceSlot]=e,this._updateFirstDevices(e.deviceType)),this.onDeviceConnectedObservable.notifyObservers(e)},e.prototype._removeDevice=function(e,t){var r,i,n=null===(r=this._devices[e])||void 0===r?void 0:r[t];this.onDeviceDisconnectedObservable.notifyObservers(n),(null===(i=this._devices[e])||void 0===i?void 0:i[t])&&delete this._devices[e][t],this._updateFirstDevices(e)},e.prototype._onInputChanged=function(e,t,r){var i,n;null===(n=null===(i=this._devices[e])||void 0===i?void 0:i[t])||void 0===n||n.onInputChangedObservable.notifyObservers(r)},e.prototype._updateFirstDevices=function(e){switch(e){case pr.Keyboard:case pr.Mouse:this._firstDevice[e]=0;break;case pr.Touch:case pr.DualSense:case pr.DualShock:case pr.Xbox:case pr.Switch:case pr.Generic:delete this._firstDevice[e];var t=this._devices[e];if(t)for(var r=0;r<t.length;r++)if(t[r]){this._firstDevice[e]=r;break}}},e}(),jr=function(){function e(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(e.prototype,"singleClick",{get:function(){return this._singleClick},set:function(e){this._singleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(e){this._doubleClick=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(e){this._hasSwiped=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ignore",{get:function(){return this._ignore},set:function(e){this._ignore=e},enumerable:!1,configurable:!0}),e}(),Hr=function(){function e(e){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new et(0,0),this._previousStartingPointerPosition=new et(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._deviceSourceManager=null,this._scene=e||I.LastCreatedScene,this._scene}return Object.defineProperty(e.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),e.prototype.getMeshUnderPointerByPointerId=function(e){return this._meshUnderPointerId[e]||null},Object.defineProperty(e.prototype,"unTranslatedPointer",{get:function(){return new et(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerX",{get:function(){return this._pointerX},set:function(e){this._pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerY",{get:function(){return this._pointerY},set:function(e){this._pointerY=e},enumerable:!1,configurable:!0}),e.prototype._updatePointerPosition=function(e){var t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=e.clientX-t.left,this._pointerY=e.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},e.prototype._processPointerMove=function(e,t){var r=this._scene,i=r.getEngine(),n=i.getInputElement();n&&(n.tabIndex=i.canvasTabIndex,r.doNotHandleCursors||(n.style.cursor=r.defaultCursor));var s=!!(e&&e.hit&&e.pickedMesh);if(s){if(r.setPointerOverMesh(e.pickedMesh,t.pointerId,e),!r.doNotHandleCursors&&n&&this._pointerOverMesh){var o=this._pointerOverMesh._getActionManagerForTrigger();o&&o.hasPointerTriggers&&(n.style.cursor=o.hoverCursor||r.hoverCursor)}}else r.setPointerOverMesh(null,t.pointerId,e);for(var a=0,u=r._pointerMoveStage;a<u.length;a++){e=u[a].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,s,n)}if(e){var h="wheel"===t.type||"mousewheel"===t.type||"DOMMouseScroll"===t.type?Sr.POINTERWHEEL:Sr.POINTERMOVE;if(r.onPointerMove&&r.onPointerMove(t,e,h),r.onPointerObservable.hasObservers()){var c=new Or(h,t,e);this._setRayOnPointerInfo(c),r.onPointerObservable.notifyObservers(c,h)}}},e.prototype._setRayOnPointerInfo=function(e){var t=this._scene;e.pickInfo&&!e.pickInfo._pickingUnavailable&&(e.pickInfo.ray||(e.pickInfo.ray=t.createPickingRay(e.event.offsetX,e.event.offsetY,nt.Identity(),t.activeCamera)))},e.prototype._checkPrePointerObservable=function(e,t,r){var i=this._scene,n=new Dr(r,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return e&&(n.ray=e.ray,e.originMesh&&(n.nearInteractionPickingInfo=e)),i.onPrePointerObservable.notifyObservers(n,r),!!n.skipOnPointerObservable},e.prototype.simulatePointerMove=function(e,t){var r=new PointerEvent("pointermove",t);r.inputIndex=_r.Move,this._checkPrePointerObservable(e,r,Sr.POINTERMOVE)||this._processPointerMove(e,r)},e.prototype.simulatePointerDown=function(e,t){var r=new PointerEvent("pointerdown",t);r.inputIndex=r.button+2,this._checkPrePointerObservable(e,r,Sr.POINTERDOWN)||this._processPointerDown(e,r)},e.prototype._processPointerDown=function(t,r){var i=this,n=this._scene;if(t&&t.hit&&t.pickedMesh){this._pickedDownMesh=t.pickedMesh;var s=t.pickedMesh._getActionManagerForTrigger();if(s){if(s.hasPickTriggers)switch(s.processTrigger(5,Mr.CreateNew(t.pickedMesh,r)),r.button){case 0:s.processTrigger(2,Mr.CreateNew(t.pickedMesh,r));break;case 1:s.processTrigger(4,Mr.CreateNew(t.pickedMesh,r));break;case 2:s.processTrigger(3,Mr.CreateNew(t.pickedMesh,r))}s.hasSpecificTrigger(8)&&window.setTimeout((function(){var t=n.pick(i._unTranslatedPointerX,i._unTranslatedPointerY,(function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.actionManager&&e.actionManager.hasSpecificTrigger(8)&&e===i._pickedDownMesh}),!1,n.cameraToUseForPointers);t&&t.hit&&t.pickedMesh&&s&&0!==i._totalPointersPressed&&Date.now()-i._startingPointerTime>e.LongPressDelay&&!i._isPointerSwiping()&&(i._startingPointerTime=0,s.processTrigger(8,Mr.CreateNew(t.pickedMesh,r)))}),e.LongPressDelay)}}else for(var o=0,a=n._pointerDownStage;o<a.length;o++){t=a[o].action(this._unTranslatedPointerX,this._unTranslatedPointerY,t,r)}if(t){var u=Sr.POINTERDOWN;if(n.onPointerDown&&n.onPointerDown(r,t,u),n.onPointerObservable.hasObservers()){var h=new Or(u,r,t);this._setRayOnPointerInfo(h),n.onPointerObservable.notifyObservers(h,u)}}},e.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>e.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>e.DragMovementThreshold},e.prototype.simulatePointerUp=function(e,t,r){var i=new PointerEvent("pointerup",t);i.inputIndex=_r.Move;var n=new jr;r?n.doubleClick=!0:n.singleClick=!0,this._checkPrePointerObservable(e,i,Sr.POINTERUP)||this._processPointerUp(e,i,n)},e.prototype._processPointerUp=function(e,t,r){var i=this._scene;if(e&&e.hit&&e.pickedMesh){if(this._pickedUpMesh=e.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(i.onPointerPick&&i.onPointerPick(t,e),r.singleClick&&!r.ignore&&i.onPointerObservable.hasObservers())){var n=Sr.POINTERPICK,s=new Or(n,t,e);this._setRayOnPointerInfo(s),i.onPointerObservable.notifyObservers(s,n)}var o=e.pickedMesh._getActionManagerForTrigger();if(o&&!r.ignore){o.processTrigger(7,Mr.CreateNew(e.pickedMesh,t,e)),!r.hasSwiped&&r.singleClick&&o.processTrigger(1,Mr.CreateNew(e.pickedMesh,t,e));var a=e.pickedMesh._getActionManagerForTrigger(6);r.doubleClick&&a&&a.processTrigger(6,Mr.CreateNew(e.pickedMesh,t,e))}}else if(!r.ignore)for(var u=0,h=i._pointerUpStage;u<h.length;u++){e=h[u].action(this._unTranslatedPointerX,this._unTranslatedPointerY,e,t)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var c=this._pickedDownMesh._getActionManagerForTrigger(16);c&&c.processTrigger(16,Mr.CreateNew(this._pickedDownMesh,t))}var l=0;if(i.onPointerObservable.hasObservers()){if(!r.ignore&&!r.hasSwiped&&(r.singleClick&&i.onPointerObservable.hasSpecificMask(Sr.POINTERTAP)?l=Sr.POINTERTAP:r.doubleClick&&i.onPointerObservable.hasSpecificMask(Sr.POINTERDOUBLETAP)&&(l=Sr.POINTERDOUBLETAP),l)){s=new Or(l,t,e);this._setRayOnPointerInfo(s),i.onPointerObservable.notifyObservers(s,l)}if(!r.ignore){l=Sr.POINTERUP;s=new Or(l,t,e);this._setRayOnPointerInfo(s),i.onPointerObservable.notifyObservers(s,l)}}i.onPointerUp&&!r.ignore&&i.onPointerUp(t,e,l)},e.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._pointerCaptures[e]},e.prototype.attachControl=function(t,r,i,n){var s=this;void 0===t&&(t=!0),void 0===r&&(r=!0),void 0===i&&(i=!0),void 0===n&&(n=null);var o=this._scene,a=o.getEngine();n||(n=a.getInputElement()),this._alreadyAttached&&this.detachControl(),n&&(this._alreadyAttachedTo=n),this._deviceSourceManager=new Kr(a),this._initActionManager=function(e){if(!s._meshPickProceed){var t=o.skipPointerUpPicking?null:o.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,o.pointerUpPredicate,!1,o.cameraToUseForPointers);s._currentPickResult=t,t&&(e=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),s._meshPickProceed=!0}return e},this._delayedSimpleClick=function(t,r,i){(Date.now()-s._previousStartingPointerTime>e.DoubleClickDelay&&!s._doubleClickOccured||t!==s._previousButtonPressed)&&(s._doubleClickOccured=!1,r.singleClick=!0,r.ignore=!1,i(r,s._currentPickResult))},this._initClickEvent=function(t,r,i,n){var o=new jr;s._currentPickResult=null;var a=null,u=t.hasSpecificMask(Sr.POINTERPICK)||r.hasSpecificMask(Sr.POINTERPICK)||t.hasSpecificMask(Sr.POINTERTAP)||r.hasSpecificMask(Sr.POINTERTAP)||t.hasSpecificMask(Sr.POINTERDOUBLETAP)||r.hasSpecificMask(Sr.POINTERDOUBLETAP);!u&&Fr&&(a=s._initActionManager(a,o))&&(u=a.hasPickTriggers);var h=!1;if(u){var c=i.button;if(o.hasSwiped=s._isPointerSwiping(),!o.hasSwiped){var l=!e.ExclusiveDoubleClickMode;l||(l=!t.hasSpecificMask(Sr.POINTERDOUBLETAP)&&!r.hasSpecificMask(Sr.POINTERDOUBLETAP))&&!Fr.HasSpecificTrigger(6)&&(a=s._initActionManager(a,o))&&(l=!a.hasSpecificTrigger(6)),l?(Date.now()-s._previousStartingPointerTime>e.DoubleClickDelay||c!==s._previousButtonPressed)&&(o.singleClick=!0,n(o,s._currentPickResult),h=!0):(s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,s._delayedSimpleClickTimeout=window.setTimeout(s._delayedSimpleClick.bind(s,c,o,n),e.DoubleClickDelay));var f=t.hasSpecificMask(Sr.POINTERDOUBLETAP)||r.hasSpecificMask(Sr.POINTERDOUBLETAP);!f&&Fr.HasSpecificTrigger(6)&&(a=s._initActionManager(a,o))&&(f=a.hasSpecificTrigger(6)),f&&(c===s._previousButtonPressed&&Date.now()-s._previousStartingPointerTime<e.DoubleClickDelay&&!s._doubleClickOccured?(o.hasSwiped||s._isPointerSwiping()?(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=c,e.ExclusiveDoubleClickMode?(s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,n(o,s._previousPickResult)):n(o,s._currentPickResult)):(s._previousStartingPointerTime=0,s._doubleClickOccured=!0,o.doubleClick=!0,o.ignore=!1,e.ExclusiveDoubleClickMode&&s._previousDelayedSimpleClickTimeout&&clearTimeout(s._previousDelayedSimpleClickTimeout),s._previousDelayedSimpleClickTimeout=s._delayedSimpleClickTimeout,n(o,s._currentPickResult)),h=!0):(s._doubleClickOccured=!1,s._previousStartingPointerTime=s._startingPointerTime,s._previousStartingPointerPosition.x=s._startingPointerPosition.x,s._previousStartingPointerPosition.y=s._startingPointerPosition.y,s._previousButtonPressed=c))}}h||n(o,s._currentPickResult)},this._onPointerMove=function(e){if(void 0===e.pointerId&&(e.pointerId=0),s._updatePointerPosition(e),!s._checkPrePointerObservable(null,e,"wheel"===e.type||"mousewheel"===e.type||"DOMMouseScroll"===e.type?Sr.POINTERWHEEL:Sr.POINTERMOVE)&&(o.cameraToUseForPointers||o.activeCamera))if(o.skipPointerMovePicking)s._processPointerMove(new Qt,e);else{o.pointerMovePredicate||(o.pointerMovePredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(e.enablePointerMoveEvents||o.constantlyUpdateMeshUnderPointer||null!==e._getActionManagerForTrigger())&&(!o.cameraToUseForPointers||0!==(o.cameraToUseForPointers.layerMask&e.layerMask))});var t=o.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,o.pointerMovePredicate,!1,o.cameraToUseForPointers,o.pointerMoveTrianglePredicate);s._processPointerMove(t,e)}},this._onPointerDown=function(e){var t;(s._totalPointersPressed++,s._pickedDownMesh=null,s._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),s._updatePointerPosition(e),o.preventDefaultOnPointerDown&&n&&(e.preventDefault(),n.focus()),s._startingPointerPosition.x=s._pointerX,s._startingPointerPosition.y=s._pointerY,s._startingPointerTime=Date.now(),s._checkPrePointerObservable(null,e,Sr.POINTERDOWN))||(o.cameraToUseForPointers||o.activeCamera)&&(s._pointerCaptures[e.pointerId]=!0,o.pointerDownPredicate||(o.pointerDownPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!o.cameraToUseForPointers||0!==(o.cameraToUseForPointers.layerMask&e.layerMask))}),s._pickedDownMesh=null,t=o.skipPointerDownPicking?new Qt:o.pick(s._unTranslatedPointerX,s._unTranslatedPointerY,o.pointerDownPredicate,!1,o.cameraToUseForPointers),s._processPointerDown(t,e))},this._onPointerUp=function(e){0!==s._totalPointersPressed&&(s._totalPointersPressed--,s._pickedUpMesh=null,s._meshPickProceed=!1,void 0===e.pointerId&&(e.pointerId=0),s._updatePointerPosition(e),o.preventDefaultOnPointerUp&&n&&(e.preventDefault(),n.focus()),s._initClickEvent(o.onPrePointerObservable,o.onPointerObservable,e,(function(t,r){if(o.onPrePointerObservable.hasObservers()&&!t.ignore){if(!t.hasSwiped){if(t.singleClick&&o.onPrePointerObservable.hasSpecificMask(Sr.POINTERTAP)&&s._checkPrePointerObservable(null,e,Sr.POINTERTAP))return;if(t.doubleClick&&o.onPrePointerObservable.hasSpecificMask(Sr.POINTERDOUBLETAP)&&s._checkPrePointerObservable(null,e,Sr.POINTERDOUBLETAP))return}if(s._checkPrePointerObservable(null,e,Sr.POINTERUP))return}!s._pointerCaptures[e.pointerId]&&e.buttons>0||(s._pointerCaptures[e.pointerId]=!1,(o.cameraToUseForPointers||o.activeCamera)&&(o.pointerUpPredicate||(o.pointerUpPredicate=function(e){return e.isPickable&&e.isVisible&&e.isReady()&&e.isEnabled()&&(!o.cameraToUseForPointers||0!==(o.cameraToUseForPointers.layerMask&e.layerMask))}),!s._meshPickProceed&&(Fr&&Fr.HasTriggers||o.onPointerObservable.hasObservers())&&s._initActionManager(null,t),r||(r=s._currentPickResult),s._processPointerUp(r,e,t),s._previousPickResult=s._currentPickResult))})))},this._onKeyDown=function(e){var t=wr.KEYDOWN;if(o.onPreKeyboardObservable.hasObservers()){var r=new Lr(t,e);if(o.onPreKeyboardObservable.notifyObservers(r,t),r.skipOnKeyboardObservable)return}if(o.onKeyboardObservable.hasObservers()){r=new Br(t,e);o.onKeyboardObservable.notifyObservers(r,t)}o.actionManager&&o.actionManager.processTrigger(14,Mr.CreateNewFromScene(o,e))},this._onKeyUp=function(e){var t=wr.KEYUP;if(o.onPreKeyboardObservable.hasObservers()){var r=new Lr(t,e);if(o.onPreKeyboardObservable.notifyObservers(r,t),r.skipOnKeyboardObservable)return}if(o.onKeyboardObservable.hasObservers()){r=new Br(t,e);o.onKeyboardObservable.notifyObservers(r,t)}o.actionManager&&o.actionManager.processTrigger(15,Mr.CreateNewFromScene(o,e))},this._deviceSourceManager.onDeviceConnectedObservable.add((function(e){e.deviceType===pr.Mouse?e.onInputChangedObservable.add((function(n){n.inputIndex===_r.LeftClick||n.inputIndex===_r.MiddleClick||n.inputIndex===_r.RightClick?r&&1===e.getInput(n.inputIndex)?s._onPointerDown(n):t&&0===e.getInput(n.inputIndex)&&s._onPointerUp(n):i&&(n.inputIndex===_r.Move?s._onPointerMove(n):n.inputIndex!==_r.MouseWheelX&&n.inputIndex!==_r.MouseWheelY&&n.inputIndex!==_r.MouseWheelZ||s._onPointerMove(n))})):e.deviceType===pr.Touch?e.onInputChangedObservable.add((function(n){n.inputIndex===_r.LeftClick&&(r&&1===e.getInput(n.inputIndex)?s._onPointerDown(n):t&&0===e.getInput(n.inputIndex)&&s._onPointerUp(n)),i&&n.inputIndex===_r.Move&&s._onPointerMove(n)})):e.deviceType===pr.Keyboard&&e.onInputChangedObservable.add((function(e){"keydown"===e.type?s._onKeyDown(e):"keyup"===e.type&&s._onKeyUp(e)}))})),this._alreadyAttached=!0},e.prototype.detachControl=function(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)},e.prototype.setPointerOverMesh=function(e,t,r){if(void 0===t&&(t=0),this._meshUnderPointerId[t]!==e){var i,n=this._meshUnderPointerId[t];n&&(i=n._getActionManagerForTrigger(10))&&i.processTrigger(10,Mr.CreateNew(n,void 0,{pointerId:t})),e?(this._meshUnderPointerId[t]=e,this._pointerOverMesh=e,(i=e._getActionManagerForTrigger(9))&&i.processTrigger(9,Mr.CreateNew(e,void 0,{pointerId:t,pickResult:r}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}},e.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},e.prototype._invalidateMesh=function(e){for(var t in this._pointerOverMesh===e&&(this._pointerOverMesh=null),this._pickedDownMesh===e&&(this._pickedDownMesh=null),this._pickedUpMesh===e&&(this._pickedUpMesh=null),this._meshUnderPointerId)this._meshUnderPointerId[t]===e&&delete this._meshUnderPointerId[t]},e.DragMovementThreshold=10,e.LongPressDelay=500,e.DoubleClickDelay=300,e.ExclusiveDoubleClickMode=!1,e}(),Xr=function(){function e(){}return Object.defineProperty(e,"UniqueId",{get:function(){var e=this._UniqueIdCounter;return this._UniqueIdCounter++,e},enumerable:!1,configurable:!0}),e._UniqueIdCounter=1,e}(),qr=function(){function e(){}return e.CompareLightsPriority=function(e,t){return e.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(e.shadowEnabled?1:0):t.renderPriority-e.renderPriority},e.FALLOFF_DEFAULT=0,e.FALLOFF_PHYSICAL=1,e.FALLOFF_GLTF=2,e.FALLOFF_STANDARD=3,e.LIGHTMAP_DEFAULT=0,e.LIGHTMAP_SPECULAR=1,e.LIGHTMAP_SHADOWSONLY=2,e.INTENSITYMODE_AUTOMATIC=0,e.INTENSITYMODE_LUMINOUSPOWER=1,e.INTENSITYMODE_LUMINOUSINTENSITY=2,e.INTENSITYMODE_ILLUMINANCE=3,e.INTENSITYMODE_LUMINANCE=4,e.LIGHTTYPEID_POINTLIGHT=0,e.LIGHTTYPEID_DIRECTIONALLIGHT=1,e.LIGHTTYPEID_SPOTLIGHT=2,e.LIGHTTYPEID_HEMISPHERICLIGHT=3,e}(),Yr=function(){function e(t,r){e.IsAvailable&&(this._observer=new window.ComputePressureObserver(t,r))}return Object.defineProperty(e,"IsAvailable",{get:function(){return g()&&"ComputePressureObserver"in window},enumerable:!1,configurable:!0}),e.prototype.observe=function(){var e,t;(null===(e=this._observer)||void 0===e?void 0:e.observe)&&(null===(t=this._observer)||void 0===t||t.observe().catch((function(){})))},e.prototype.unobserve=function(){var e,t;(null===(e=this._observer)||void 0===e?void 0:e.unobserve)&&(null===(t=this._observer)||void 0===t||t.unobserve())},e}(),Zr=function(e){function t(r,i){var n=e.call(this)||this;n._inputManager=new Hr(n),n.cameraToUseForPointers=null,n._isScene=!0,n._blockEntityCollection=!1,n.autoClear=!0,n.autoClearDepthAndStencil=!0,n.clearColor=new ht(.2,.2,.3,1),n.ambientColor=new ut(0,0,0),n.environmentIntensity=1,n._forceWireframe=!1,n._skipFrustumClipping=!1,n._forcePointsCloud=!1,n.animationsEnabled=!0,n._animationPropertiesOverride=null,n.useConstantAnimationDeltaTime=!1,n.constantlyUpdateMeshUnderPointer=!1,n.hoverCursor="pointer",n.defaultCursor="",n.doNotHandleCursors=!1,n.preventDefaultOnPointerDown=!0,n.preventDefaultOnPointerUp=!0,n.metadata=null,n.reservedDataStore=null,n.disableOfflineSupportExceptionRules=new Array,n.onDisposeObservable=new _,n._onDisposeObserver=null,n.onBeforeRenderObservable=new _,n._onBeforeRenderObserver=null,n.onAfterRenderObservable=new _,n.onAfterRenderCameraObservable=new _,n._onAfterRenderObserver=null,n.onBeforeAnimationsObservable=new _,n.onAfterAnimationsObservable=new _,n.onBeforeDrawPhaseObservable=new _,n.onAfterDrawPhaseObservable=new _,n.onReadyObservable=new _,n.onBeforeCameraRenderObservable=new _,n._onBeforeCameraRenderObserver=null,n.onAfterCameraRenderObservable=new _,n._onAfterCameraRenderObserver=null,n.onBeforeActiveMeshesEvaluationObservable=new _,n.onAfterActiveMeshesEvaluationObservable=new _,n.onBeforeParticlesRenderingObservable=new _,n.onAfterParticlesRenderingObservable=new _,n.onDataLoadedObservable=new _,n.onNewCameraAddedObservable=new _,n.onCameraRemovedObservable=new _,n.onNewLightAddedObservable=new _,n.onLightRemovedObservable=new _,n.onNewGeometryAddedObservable=new _,n.onGeometryRemovedObservable=new _,n.onNewTransformNodeAddedObservable=new _,n.onTransformNodeRemovedObservable=new _,n.onNewMeshAddedObservable=new _,n.onMeshRemovedObservable=new _,n.onNewSkeletonAddedObservable=new _,n.onSkeletonRemovedObservable=new _,n.onNewMaterialAddedObservable=new _,n.onNewMultiMaterialAddedObservable=new _,n.onMaterialRemovedObservable=new _,n.onMultiMaterialRemovedObservable=new _,n.onNewTextureAddedObservable=new _,n.onTextureRemovedObservable=new _,n.onBeforeRenderTargetsRenderObservable=new _,n.onAfterRenderTargetsRenderObservable=new _,n.onBeforeStepObservable=new _,n.onAfterStepObservable=new _,n.onActiveCameraChanged=new _,n.onBeforeRenderingGroupObservable=new _,n.onAfterRenderingGroupObservable=new _,n.onMeshImportedObservable=new _,n.onAnimationFileImportedObservable=new _,n._registeredForLateAnimationBindings=new sr(256),n.skipPointerMovePicking=!1,n.skipPointerDownPicking=!1,n.skipPointerUpPicking=!1,n.onPrePointerObservable=new _,n.onPointerObservable=new _,n.onPreKeyboardObservable=new _,n.onKeyboardObservable=new _,n._useRightHandedSystem=!1,n._timeAccumulator=0,n._currentStepId=0,n._currentInternalStep=0,n._fogEnabled=!0,n._fogMode=t.FOGMODE_NONE,n.fogColor=new ut(.2,.2,.3),n.fogDensity=.1,n.fogStart=0,n.fogEnd=1e3,n.needsPreviousWorldMatrices=!1,n._shadowsEnabled=!0,n._lightsEnabled=!0,n.activeCameras=new Array,n._texturesEnabled=!0,n.physicsEnabled=!0,n.particlesEnabled=!0,n.spritesEnabled=!0,n._skeletonsEnabled=!0,n.lensFlaresEnabled=!0,n.collisionsEnabled=!0,n.gravity=new tt(0,-9.807,0),n.postProcessesEnabled=!0,n.renderTargetsEnabled=!0,n.dumpNextRenderTargets=!1,n.customRenderTargets=new Array,n.importedMeshesFiles=new Array,n.probesEnabled=!0,n._meshesForIntersections=new sr(256),n.proceduralTexturesEnabled=!0,n._totalVertices=new jt,n._activeIndices=new jt,n._activeParticles=new jt,n._activeBones=new jt,n._animationTime=0,n.animationTimeScale=1,n._renderId=0,n._frameId=0,n._executeWhenReadyTimeoutId=null,n._intermediateRendering=!1,n._defaultFrameBufferCleared=!1,n._viewUpdateFlag=-1,n._projectionUpdateFlag=-1,n._toBeDisposed=new Array(256),n._activeRequests=new Array,n._pendingData=new Array,n._isDisposed=!1,n.dispatchAllSubMeshesOfActiveMeshes=!1,n._activeMeshes=new nr(256),n._processedMaterials=new nr(256),n._renderTargets=new sr(256),n._materialsRenderTargets=new sr(256),n._activeParticleSystems=new nr(256),n._activeSkeletons=new sr(32),n._softwareSkinnedMeshes=new sr(32),n._activeAnimatables=new Array,n._transformMatrix=nt.Zero(),n.requireLightSorting=!1,n._components=[],n._serializableComponents=[],n._transientComponents=[],n._beforeCameraUpdateStage=Ir.Create(),n._beforeClearStage=Ir.Create(),n._beforeRenderTargetClearStage=Ir.Create(),n._gatherRenderTargetsStage=Ir.Create(),n._gatherActiveCameraRenderTargetsStage=Ir.Create(),n._isReadyForMeshStage=Ir.Create(),n._beforeEvaluateActiveMeshStage=Ir.Create(),n._evaluateSubMeshStage=Ir.Create(),n._preActiveMeshStage=Ir.Create(),n._cameraDrawRenderTargetStage=Ir.Create(),n._beforeCameraDrawStage=Ir.Create(),n._beforeRenderTargetDrawStage=Ir.Create(),n._beforeRenderingGroupDrawStage=Ir.Create(),n._beforeRenderingMeshStage=Ir.Create(),n._afterRenderingMeshStage=Ir.Create(),n._afterRenderingGroupDrawStage=Ir.Create(),n._afterCameraDrawStage=Ir.Create(),n._afterRenderTargetDrawStage=Ir.Create(),n._afterRenderStage=Ir.Create(),n._pointerMoveStage=Ir.Create(),n._pointerDownStage=Ir.Create(),n._pointerUpStage=Ir.Create(),n._geometriesByUniqueId=null,n._defaultMeshCandidates={data:[],length:0},n._defaultSubMeshCandidates={data:[],length:0},n._preventFreeActiveMeshesAndRenderingGroups=!1,n._activeMeshesFrozen=!1,n._activeMeshesFrozenButKeepClipping=!1,n._skipEvaluateActiveMeshesCompletely=!1,n._allowPostProcessClearColor=!0,n.getDeterministicFrameTime=function(){return n._engine.getTimeStep()},n._blockMaterialDirtyMechanism=!1,n._perfCollector=null,n.onComputePressureChanged=new _;var s=h({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},i);return n._engine=r||I.LastCreatedEngine,s.virtual?n._engine._virtualScenes.push(n):(I._LastCreatedScene=n,n._engine.scenes.push(n)),n._uid=null,n._renderingManager=new Pr(n),xr&&(n.postProcessManager=new xr(n)),g()&&n.attachControl(),n._createUbo(),dr&&(n._imageProcessingConfiguration=new dr),n.setDefaultCandidateProviders(),s.useGeometryUniqueIdsMap&&(n._geometriesByUniqueId={}),n.useMaterialMeshMap=s.useMaterialMeshMap,n.useClonedMeshMap=s.useClonedMeshMap,i&&i.virtual||n._engine.onNewSceneAddedObservable.notifyObservers(n),Yr.IsAvailable&&(n._computePressureObserver=new Yr((function(e){n.onComputePressureChanged.notifyObservers(e)}),{cpuUtilizationThresholds:[.25,.5,.75,.9],cpuSpeedThresholds:[.5]}),n._computePressureObserver.observe()),n}return u(t,e),t.DefaultMaterialFactory=function(e){throw A("StandardMaterial")},t.CollisionCoordinatorFactory=function(){throw A("DefaultCollisionCoordinator")},Object.defineProperty(t.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(e){this._environmentTexture!==e&&(this._environmentTexture=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(e){this._forceWireframe!==e&&(this._forceWireframe=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(e){this._skipFrustumClipping!==e&&(this._skipFrustumClipping=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(e){this._forcePointsCloud!==e&&(this._forcePointsCloud=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeRender",{set:function(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),e&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterRender",{set:function(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),e&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(e))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"beforeCameraRender",{set:function(e){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"afterCameraRender",{set:function(e){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DragMovementThreshold",{get:function(){return Hr.DragMovementThreshold},set:function(e){Hr.DragMovementThreshold=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"LongPressDelay",{get:function(){return Hr.LongPressDelay},set:function(e){Hr.LongPressDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"DoubleClickDelay",{get:function(){return Hr.DoubleClickDelay},set:function(e){Hr.DoubleClickDelay=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ExclusiveDoubleClickMode",{get:function(){return Hr.ExclusiveDoubleClickMode},set:function(e){Hr.ExclusiveDoubleClickMode=e},enumerable:!1,configurable:!0}),t.prototype.bindEyePosition=function(e,t,r){var i;void 0===t&&(t="vEyePosition"),void 0===r&&(r=!1);var n=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:null!==(i=this.activeCamera.globalPosition)&&void 0!==i?i:this.activeCamera.devicePosition,s=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return ot.Vector4[0].set(n.x,n.y,n.z,s?-1:1),e&&(r?e.setFloat3(t,ot.Vector4[0].x,ot.Vector4[0].y,ot.Vector4[0].z):e.setVector4(t,ot.Vector4[0])),ot.Vector4[0]},t.prototype.finalizeSceneUbo=function(){var e=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return e.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),e.update(),e},Object.defineProperty(t.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(e){this._useRightHandedSystem!==e&&(this._useRightHandedSystem=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),t.prototype.setStepId=function(e){this._currentStepId=e},t.prototype.getStepId=function(){return this._currentStepId},t.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(t.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(e){this._fogEnabled!==e&&(this._fogEnabled=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fogMode",{get:function(){return this._fogMode},set:function(e){this._fogMode!==e&&(this._fogMode=e,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"prePass",{get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(e){this._shadowsEnabled!==e&&(this._shadowsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(e){this._lightsEnabled!==e&&(this._lightsEnabled=e,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(e){e!==this._activeCamera&&(this._activeCamera=e,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=t.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(e){this._defaultMaterial=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(e){this._texturesEnabled!==e&&(this._texturesEnabled=e,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(e){this._skeletonsEnabled!==e&&(this._skeletonsEnabled=e,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=t.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),t.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var e=0,t=this._transientComponents;e<t.length;e++){t[e].register()}this._transientComponents=[]}},t.prototype._addComponent=function(e){this._components.push(e),this._transientComponents.push(e);var t=e;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)},t.prototype._getComponent=function(e){for(var t=0,r=this._components;t<r.length;t++){var i=r[t];if(i.name===e)return i}return null},t.prototype.getClassName=function(){return"Scene"},t.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},t.prototype._getDefaultSubMeshCandidates=function(e){return this._defaultSubMeshCandidates.data=e.subMeshes,this._defaultSubMeshCandidates.length=e.subMeshes.length,this._defaultSubMeshCandidates},t.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(t.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(e){this._inputManager.pointerX=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(e){this._inputManager.pointerY=e},enumerable:!1,configurable:!0}),t.prototype.getCachedMaterial=function(){return this._cachedMaterial},t.prototype.getCachedEffect=function(){return this._cachedEffect},t.prototype.getCachedVisibility=function(){return this._cachedVisibility},t.prototype.isCachedMaterialInvalid=function(e,t,r){return void 0===r&&(r=1),this._cachedEffect!==t||this._cachedMaterial!==e||this._cachedVisibility!==r},t.prototype.getEngine=function(){return this._engine},t.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(t.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),t.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(t.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),t.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(t.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),t.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(t.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),t.prototype.getActiveMeshes=function(){return this._activeMeshes},t.prototype.getAnimationRatio=function(){return void 0!==this._animationRatio?this._animationRatio:1},t.prototype.getRenderId=function(){return this._renderId},t.prototype.getFrameId=function(){return this._frameId},t.prototype.incrementRenderId=function(){this._renderId++},t.prototype._createUbo=function(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())},t.prototype.simulatePointerMove=function(e,t){return this._inputManager.simulatePointerMove(e,t),this},t.prototype.simulatePointerDown=function(e,t){return this._inputManager.simulatePointerDown(e,t),this},t.prototype.simulatePointerUp=function(e,t,r){return this._inputManager.simulatePointerUp(e,t,r),this},t.prototype.isPointerCaptured=function(e){return void 0===e&&(e=0),this._inputManager.isPointerCaptured(e)},t.prototype.attachControl=function(e,t,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=!0),this._inputManager.attachControl(e,t,r)},t.prototype.detachControl=function(){this._inputManager.detachControl()},t.prototype.isReady=function(e){if(void 0===e&&(e=!0),this._isDisposed)return!1;var t,r=this.getEngine(),i=!0;for(this._pendingData.length>0&&(i=!1),e&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),t=0;t<this.meshes.length;t++){var n=this.meshes[t];if(n.subMeshes&&0!==n.subMeshes.length)if(n.isReady(!0)){for(var s=n.hasThinInstances||"InstancedMesh"===n.getClassName()||"InstancedLinesMesh"===n.getClassName()||r.getCaps().instancedArrays&&n.instances.length>0,o=0,a=this._isReadyForMeshStage;o<a.length;o++){a[o].action(n,s)||(i=!1)}if(e){var u=n.material||this.defaultMaterial;if(u)if(u._storeEffectOnSubMeshes)for(var h=0,c=n.subMeshes;h<c.length;h++){var l=c[h].getMaterial();l&&l.hasRenderTargetTextures&&null!=l.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(l)&&(this._processedMaterials.push(l),this._materialsRenderTargets.concatWithNoDuplicate(l.getRenderTargetTextures()))}else u.hasRenderTargetTextures&&null!=u.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(u)&&(this._processedMaterials.push(u),this._materialsRenderTargets.concatWithNoDuplicate(u.getRenderTargetTextures()))}}else i=!1}if(!i)return!1;if(!r.areAllEffectsReady())return!1;if(e)for(t=0;t<this._materialsRenderTargets.length;++t){if(!this._materialsRenderTargets.data[t].isReadyForRendering())return!1}for(t=0;t<this.geometries.length;t++){if(2===this.geometries[t].delayLoadState)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var f=0,d=this.activeCameras;f<d.length;f++){if(!d[f].isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var p=0,_=this.particleSystems;p<_.length;p++){if(!_[p].isReady())return!1}return!0},t.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},t.prototype.registerBeforeRender=function(e){this.onBeforeRenderObservable.add(e)},t.prototype.unregisterBeforeRender=function(e){this.onBeforeRenderObservable.removeCallback(e)},t.prototype.registerAfterRender=function(e){this.onAfterRenderObservable.add(e)},t.prototype.unregisterAfterRender=function(e){this.onAfterRenderObservable.removeCallback(e)},t.prototype._executeOnceBeforeRender=function(e){var t=this;this.registerBeforeRender((function r(){e(),setTimeout((function(){t.unregisterBeforeRender(r)}))}))},t.prototype.executeOnceBeforeRender=function(e,t){var r=this;void 0!==t?setTimeout((function(){r._executeOnceBeforeRender(e)}),t):this._executeOnceBeforeRender(e)},t.prototype._addPendingData=function(e){this._pendingData.push(e)},t.prototype._removePendingData=function(e){var t=this.isLoading,r=this._pendingData.indexOf(e);-1!==r&&this._pendingData.splice(r,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},t.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),t.prototype.executeWhenReady=function(e,t){void 0===t&&(t=!1),this.onReadyObservable.add(e),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)},t.prototype.whenReadyAsync=function(e){var t=this;return void 0===e&&(e=!1),new Promise((function(r){t.executeWhenReady((function(){r()}),e)}))},t.prototype._checkIsReady=function(e){var t=this;return void 0===e&&(e=!1),this._registerTransientComponents(),this.isReady(e)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((function(){t._checkIsReady(e)}),100))},Object.defineProperty(t.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),t.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=E.Now},t.prototype.getViewMatrix=function(){return this._viewMatrix},t.prototype.getProjectionMatrix=function(){return this._projectionMatrix},t.prototype.getTransformMatrix=function(){return this._transformMatrix},t.prototype.setTransformMatrix=function(e,t,r,i){r||i||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===e.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=e.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=e,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?ar.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=ar.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(r,i):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))},t.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},t.prototype.createSceneUniformBuffer=function(e){var t=new Jt(this._engine,void 0,!1,null!==e&&void 0!==e?e:"scene");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t},t.prototype.setSceneUniformBuffer=function(e){this._sceneUbo=e,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1},t.prototype.getUniqueId=function(){return Xr.UniqueId},t.prototype.addMesh=function(e,t){var r=this;void 0===t&&(t=!1),this._blockEntityCollection||(this.meshes.push(e),e._resyncLightSources(),e.parent||e._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((function(e){r.addMesh(e)})))},t.prototype.removeMesh=function(e,t){var r=this;void 0===t&&(t=!1);var i=this.meshes.indexOf(e);return-1!==i&&(this.meshes[i]=this.meshes[this.meshes.length-1],this.meshes.pop(),e.parent||e._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(e),this.onMeshRemovedObservable.notifyObservers(e),t&&e.getChildMeshes().forEach((function(e){r.removeMesh(e)})),i},t.prototype.addTransformNode=function(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneTransformNodesArray||(e._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(e),e.parent||e._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(e))},t.prototype.removeTransformNode=function(e){var t=e._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){var r=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=r,r._indexInSceneTransformNodesArray=t}e._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),e.parent||e._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(e),t},t.prototype.removeSkeleton=function(e){var t=this.skeletons.indexOf(e);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(e),this._executeActiveContainerCleanup(this._activeSkeletons)),t},t.prototype.removeMorphTargetManager=function(e){var t=this.morphTargetManagers.indexOf(e);return-1!==t&&this.morphTargetManagers.splice(t,1),t},t.prototype.removeLight=function(e){var t=this.lights.indexOf(e);if(-1!==t){for(var r=0,i=this.meshes;r<i.length;r++){i[r]._removeLightSource(e,!1)}this.lights.splice(t,1),this.sortLightsByPriority(),e.parent||e._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(e),t},t.prototype.removeCamera=function(e){var t=this.cameras.indexOf(e);if(-1!==t&&(this.cameras.splice(t,1),e.parent||e._removeFromSceneRootNodes()),this.activeCameras){var r=this.activeCameras.indexOf(e);-1!==r&&this.activeCameras.splice(r,1)}return this.activeCamera===e&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(e),t},t.prototype.removeParticleSystem=function(e){var t=this.particleSystems.indexOf(e);return-1!==t&&(this.particleSystems.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t},t.prototype.removeAnimation=function(e){var t=this.animations.indexOf(e);return-1!==t&&this.animations.splice(t,1),t},t.prototype.stopAnimation=function(e,t,r){},t.prototype.removeAnimationGroup=function(e){var t=this.animationGroups.indexOf(e);return-1!==t&&this.animationGroups.splice(t,1),t},t.prototype.removeMultiMaterial=function(e){var t=this.multiMaterials.indexOf(e);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(e),t},t.prototype.removeMaterial=function(e){var t=e._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){var r=this.materials[this.materials.length-1];this.materials[t]=r,r._indexInSceneMaterialArray=t}e._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(e),t},t.prototype.removeActionManager=function(e){var t=this.actionManagers.indexOf(e);return-1!==t&&this.actionManagers.splice(t,1),t},t.prototype.removeTexture=function(e){var t=this.textures.indexOf(e);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(e),t},t.prototype.addLight=function(e){if(!this._blockEntityCollection){this.lights.push(e),this.sortLightsByPriority(),e.parent||e._addToSceneRootNodes();for(var t=0,r=this.meshes;t<r.length;t++){var i=r[t];-1===i.lightSources.indexOf(e)&&(i.lightSources.push(e),i._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(e)}},t.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(qr.CompareLightsPriority)},t.prototype.addCamera=function(e){this._blockEntityCollection||(this.cameras.push(e),this.onNewCameraAddedObservable.notifyObservers(e),e.parent||e._addToSceneRootNodes())},t.prototype.addSkeleton=function(e){this._blockEntityCollection||(this.skeletons.push(e),this.onNewSkeletonAddedObservable.notifyObservers(e))},t.prototype.addParticleSystem=function(e){this._blockEntityCollection||this.particleSystems.push(e)},t.prototype.addAnimation=function(e){this._blockEntityCollection||this.animations.push(e)},t.prototype.addAnimationGroup=function(e){this._blockEntityCollection||this.animationGroups.push(e)},t.prototype.addMultiMaterial=function(e){this._blockEntityCollection||(this.multiMaterials.push(e),this.onNewMultiMaterialAddedObservable.notifyObservers(e))},t.prototype.addMaterial=function(e){this._blockEntityCollection||e.getScene()===this&&-1!==e._indexInSceneMaterialArray||(e._indexInSceneMaterialArray=this.materials.length,this.materials.push(e),this.onNewMaterialAddedObservable.notifyObservers(e))},t.prototype.addMorphTargetManager=function(e){this._blockEntityCollection||this.morphTargetManagers.push(e)},t.prototype.addGeometry=function(e){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[e.uniqueId]=this.geometries.length),this.geometries.push(e))},t.prototype.addActionManager=function(e){this.actionManagers.push(e)},t.prototype.addTexture=function(e){this._blockEntityCollection||(this.textures.push(e),this.onNewTextureAddedObservable.notifyObservers(e))},t.prototype.switchActiveCamera=function(e,t){void 0===t&&(t=!0),this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=e,t&&e.attachControl())},t.prototype.setActiveCameraById=function(e){var t=this.getCameraById(e);return t?(this.activeCamera=t,t):null},t.prototype.setActiveCameraByName=function(e){var t=this.getCameraByName(e);return t?(this.activeCamera=t,t):null},t.prototype.getAnimationGroupByName=function(e){for(var t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===e)return this.animationGroups[t];return null},t.prototype.getMaterialByUniqueID=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].uniqueId===e)return this.materials[t];return null},t.prototype.getMaterialById=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].id===e)return this.materials[t];return null},t.prototype.getLastMaterialById=function(e,t){void 0===t&&(t=!1);for(var r=this.materials.length-1;r>=0;r--)if(this.materials[r].id===e)return this.materials[r];if(t)for(r=this.multiMaterials.length-1;r>=0;r--)if(this.multiMaterials[r].id===e)return this.multiMaterials[r];return null},t.prototype.getMaterialByName=function(e){for(var t=0;t<this.materials.length;t++)if(this.materials[t].name===e)return this.materials[t];return null},t.prototype.getTextureByUniqueId=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===e)return this.textures[t];return null},t.prototype.getTextureByName=function(e){for(var t=0;t<this.textures.length;t++)if(this.textures[t].name===e)return this.textures[t];return null},t.prototype.getCameraById=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].id===e)return this.cameras[t];return null},t.prototype.getCameraByUniqueId=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===e)return this.cameras[t];return null},t.prototype.getCameraByName=function(e){for(var t=0;t<this.cameras.length;t++)if(this.cameras[t].name===e)return this.cameras[t];return null},t.prototype.getBoneById=function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],i=0;i<r.bones.length;i++)if(r.bones[i].id===e)return r.bones[i];return null},t.prototype.getBoneByName=function(e){for(var t=0;t<this.skeletons.length;t++)for(var r=this.skeletons[t],i=0;i<r.bones.length;i++)if(r.bones[i].name===e)return r.bones[i];return null},t.prototype.getLightByName=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].name===e)return this.lights[t];return null},t.prototype.getLightById=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getLightByUniqueId=function(e){for(var t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===e)return this.lights[t];return null},t.prototype.getParticleSystemById=function(e){for(var t=0;t<this.particleSystems.length;t++)if(this.particleSystems[t].id===e)return this.particleSystems[t];return null},t.prototype.getGeometryById=function(e){for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].id===e)return this.geometries[t];return null},t.prototype._getGeometryByUniqueId=function(e){if(this._geometriesByUniqueId){if(void 0!==(t=this._geometriesByUniqueId[e]))return this.geometries[t]}else for(var t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===e)return this.geometries[t];return null},t.prototype.pushGeometry=function(e,t){return!(!t&&this._getGeometryByUniqueId(e.uniqueId))&&(this.addGeometry(e),this.onNewGeometryAddedObservable.notifyObservers(e),!0)},t.prototype.removeGeometry=function(e){var t;if(this._geometriesByUniqueId){if(void 0===(t=this._geometriesByUniqueId[e.uniqueId]))return!1}else if((t=this.geometries.indexOf(e))<0)return!1;if(t!==this.geometries.length-1){var r=this.geometries[this.geometries.length-1];r&&(this.geometries[t]=r,this._geometriesByUniqueId&&(this._geometriesByUniqueId[r.uniqueId]=t,this._geometriesByUniqueId[e.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(e),!0},t.prototype.getGeometries=function(){return this.geometries},t.prototype.getMeshById=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getMeshesById=function(e){return this.meshes.filter((function(t){return t.id===e}))},t.prototype.getTransformNodeById=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===e)return this.transformNodes[t];return null},t.prototype.getTransformNodeByUniqueId=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===e)return this.transformNodes[t];return null},t.prototype.getTransformNodesById=function(e){return this.transformNodes.filter((function(t){return t.id===e}))},t.prototype.getMeshByUniqueId=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===e)return this.meshes[t];return null},t.prototype.getLastMeshById=function(e){for(var t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];return null},t.prototype.getLastEntryById=function(e){var t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===e)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===e)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===e)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===e)return this.lights[t];return null},t.prototype.getNodeById=function(e){var t=this.getMeshById(e);if(t)return t;var r=this.getTransformNodeById(e);if(r)return r;var i=this.getLightById(e);if(i)return i;var n=this.getCameraById(e);if(n)return n;var s=this.getBoneById(e);return s||null},t.prototype.getNodeByName=function(e){var t=this.getMeshByName(e);if(t)return t;var r=this.getTransformNodeByName(e);if(r)return r;var i=this.getLightByName(e);if(i)return i;var n=this.getCameraByName(e);if(n)return n;var s=this.getBoneByName(e);return s||null},t.prototype.getMeshByName=function(e){for(var t=0;t<this.meshes.length;t++)if(this.meshes[t].name===e)return this.meshes[t];return null},t.prototype.getTransformNodeByName=function(e){for(var t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===e)return this.transformNodes[t];return null},t.prototype.getLastSkeletonById=function(e){for(var t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByUniqueId=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===e)return this.skeletons[t];return null},t.prototype.getSkeletonById=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===e)return this.skeletons[t];return null},t.prototype.getSkeletonByName=function(e){for(var t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===e)return this.skeletons[t];return null},t.prototype.getMorphTargetManagerById=function(e){for(var t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===e)return this.morphTargetManagers[t];return null},t.prototype.getMorphTargetById=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var r=this.morphTargetManagers[t],i=0;i<r.numTargets;++i){var n=r.getTarget(i);if(n.id===e)return n}return null},t.prototype.getMorphTargetByName=function(e){for(var t=0;t<this.morphTargetManagers.length;++t)for(var r=this.morphTargetManagers[t],i=0;i<r.numTargets;++i){var n=r.getTarget(i);if(n.name===e)return n}return null},t.prototype.getPostProcessByName=function(e){for(var t=0;t<this.postProcesses.length;++t){var r=this.postProcesses[t];if(r.name===e)return r}return null},t.prototype.isActiveMesh=function(e){return-1!==this._activeMeshes.indexOf(e)},Object.defineProperty(t.prototype,"uid",{get:function(){return this._uid||(this._uid=Ve.RandomId()),this._uid},enumerable:!1,configurable:!0}),t.prototype.addExternalData=function(e,t){return this._externalData||(this._externalData=new hr),this._externalData.add(e,t)},t.prototype.getExternalData=function(e){return this._externalData?this._externalData.get(e):null},t.prototype.getOrAddExternalDataWithFactory=function(e,t){return this._externalData||(this._externalData=new hr),this._externalData.getOrAddWithFactory(e,t)},t.prototype.removeExternalData=function(e){return this._externalData.remove(e)},t.prototype._evaluateSubMesh=function(e,t,r){if(r.hasInstances||r.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.alwaysSelectAsActiveMesh||1===t.subMeshes.length||e.isInFrustum(this._frustumPlanes)){for(var i=0,n=this._evaluateSubMeshStage;i<n.length;i++){n[i].action(t,e)}var s=e.getMaterial();null!==s&&void 0!==s&&(s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures())),this._renderingManager.dispatch(e,t,s))}},t.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(t.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(e){this._preventFreeActiveMeshesAndRenderingGroups!==e&&(e&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=e)},enumerable:!1,configurable:!0}),t.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var e=0;e<this.activeCameras.length;e++){var t=this.activeCameras[e];t&&t._activeMeshes&&t._activeMeshes.dispose()}},t.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var e=0;e<this.textures.length;e++){var t=this.textures[e];t&&t.renderList&&t.freeRenderingGroups()}},t.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},t.prototype.freezeActiveMeshes=function(e,t,r,i,n){var s=this;return void 0===e&&(e=!1),void 0===i&&(i=!0),void 0===n&&(n=!1),this.executeWhenReady((function(){if(s.activeCamera){if(s._frustumPlanes||s.updateTransformMatrix(),s._evaluateActiveMeshes(),s._activeMeshesFrozen=!0,s._activeMeshesFrozenButKeepClipping=n,s._skipEvaluateActiveMeshesCompletely=e,i)for(var o=0;o<s._activeMeshes.length;o++)s._activeMeshes.data[o]._freeze();t&&t()}else r&&r("No active camera found")})),this},t.prototype.unfreezeActiveMeshes=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(e=0;e<this._activeMeshes.length;e++)this._activeMeshes.data[e]._unFreeze();return this._activeMeshesFrozen=!1,this},t.prototype._executeActiveContainerCleanup=function(e){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((function(){return e.dispose()}))},t.prototype._evaluateActiveMeshes=function(){var e;if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode)this._activeMeshes.length>0&&(null===(e=this.activeCamera)||void 0===e||e._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset());else if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var t=this._activeMeshes.length,r=0;r<t;r++){(u=this._activeMeshes.data[r]).computeWorldMatrix()}if(this._activeParticleSystems){var i=this._activeParticleSystems.length;for(r=0;r<i;r++)this._activeParticleSystems.data[r].animate()}}else if(this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(var n=0,s=this._beforeEvaluateActiveMeshStage;n<s.length;n++){s[n].action()}var o=this.getActiveMeshCandidates(),a=o.length;for(r=0;r<a;r++){var u;if((u=o.data[r])._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!u.isBlocked&&(this._totalVertices.addCount(u.getTotalVertices(),!1),u.isReady()&&u.isEnabled()&&!u.scaling.hasAZeroComponent)){u.computeWorldMatrix(),u.actionManager&&u.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(u);var h=this.customLODSelector?this.customLODSelector(u,this.activeCamera):u.getLOD(this.activeCamera);if(u._internalAbstractMeshDataInfo._currentLOD=h,u._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==h&&null!==h&&(h!==u&&0!==h.billboardMode&&h.computeWorldMatrix(),u._preActivate(),u.isVisible&&u.visibility>0&&0!==(u.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||u.alwaysSelectAsActiveMesh||u.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(u),this.activeCamera._activeMeshes.push(u),h!==u&&h._activate(this._renderId,!1);for(var c=0,l=this._preActiveMeshStage;c<l.length;c++){l[c].action(u)}u._activate(this._renderId,!1)&&(u.isAnInstance?u._internalAbstractMeshDataInfo._actAsRegularMesh&&(h=u):h._internalAbstractMeshDataInfo._onlyForInstances=!1,h._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(u,h)),u._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var f=0;f<this.particleSystems.length;f++){var d=this.particleSystems[f];if(d.isStarted()&&d.emitter){var p=d.emitter;p.position&&!p.isEnabled()||(this._activeParticleSystems.push(d),d.animate(),this._renderingManager.dispatchParticles(d))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},t.prototype._activeMesh=function(e,t){if(this._skeletonsEnabled&&null!==t.skeleton&&void 0!==t.skeleton&&(this._activeSkeletons.pushNoDuplicate(t.skeleton)&&(t.skeleton.prepare(),this._activeBones.addCount(t.skeleton.bones.length,!1)),t.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(t)),t&&t.subMeshes&&t.subMeshes.length>0)for(var r=this.getActiveSubMeshCandidates(t),i=r.length,n=0;n<i;n++){var s=r.data[n];this._evaluateSubMesh(s,t,e)}},t.prototype.updateTransformMatrix=function(e){if(this.activeCamera)if(this.activeCamera._renderingMultiview){var t=this.activeCamera._rigCameras[0],r=this.activeCamera._rigCameras[1];this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(e),r.getViewMatrix(),r.getProjectionMatrix(e))}else this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(e))},t.prototype._bindFrameBuffer=function(e,t){void 0===t&&(t=!0),e&&e._multiviewTexture?e._multiviewTexture._bindFrameBuffer():e&&e.outputRenderTarget?e.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(e)},t.prototype._clearFrameBuffer=function(e){if(e&&e._multiviewTexture);else if(e&&e.outputRenderTarget){var t=e.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||(this._engine.clear(t.clearColor||this.clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())},t.prototype._renderForCamera=function(e,t,r){var i,n,s;if(void 0===r&&(r=!0),!e||!e._skipRendering){var o=this._engine;if(this._activeCamera=e,!this.activeCamera)throw new Error("Active camera not set");if(o.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&r){var a=!0;e._renderingMultiview&&e.outputRenderTarget&&(a=e.outputRenderTarget.skipInitialClear,this.autoClear&&(e.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),e._renderingMultiview&&e.outputRenderTarget&&(e.outputRenderTarget.skipInitialClear=a)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var u=0;u<this._softwareSkinnedMeshes.length;u++){var h=this._softwareSkinnedMeshes.data[u];h.applySkeleton(h.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),e.customRenderTargets&&e.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(e.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(var c=0,l=this._gatherActiveCameraRenderTargetsStage;c<l.length;c++){l[c].action(this._renderTargets)}var f=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){Ve.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var d=0;d<this._renderTargets.length;d++){var p=this._renderTargets.data[d];if(p._shouldRender()){this._renderId++;var _=p.activeCamera&&p.activeCamera!==this.activeCamera;p.render(_,this.dumpNextRenderTargets),f=!0}}Ve.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var g=0,m=this._cameraDrawRenderTargetStage;g<m.length;g++){f=m[g].action(this.activeCamera)||f}this._intermediateRendering=!1}this._engine.currentRenderPassId=null!==(s=null!==(n=null===(i=e.outputRenderTarget)||void 0===i?void 0:i.renderPassId)&&void 0!==n?n:e.renderPassId)&&void 0!==s?s:0,f&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||e._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(var y=0,v=this._beforeCameraDrawStage;y<v.length;y++){v[y].action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),o.snapshotRendering&&1===o.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var b=0,T=this._afterCameraDrawStage;b<T.length;b++){T[b].action(this.activeCamera)}if(this.postProcessManager&&!e._multiviewTexture){var M=e.outputRenderTarget?e.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(e.isIntermediate,M)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},t.prototype._processSubCameras=function(e,t){if(void 0===t&&(t=!0),0===e.cameraRigMode||e._renderingMultiview)return e._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(e,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(e);if(e._useMultiviewToSingleView)this._renderMultiviewToSingleView(e);else{this.onBeforeCameraRenderObservable.notifyObservers(e);for(var r=0;r<e._rigCameras.length;r++)this._renderForCamera(e._rigCameras[r],e)}this._activeCamera=e,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(e)},t.prototype._checkIntersections=function(){for(var e=0;e<this._meshesForIntersections.length;e++){var t=this._meshesForIntersections.data[e];if(t.actionManager)for(var r=function(e){var r=t.actionManager.actions[e];if(12===r.trigger||13===r.trigger){var i=r.getTriggerParameter(),n=i.mesh?i.mesh:i,s=n.intersectsMesh(t,i.usePreciseIntersection),o=t._intersectionsInProgress.indexOf(n);s&&-1===o?12===r.trigger?(r._executeCurrent(Mr.CreateNew(t,void 0,n)),t._intersectionsInProgress.push(n)):13===r.trigger&&t._intersectionsInProgress.push(n):!s&&o>-1&&(13===r.trigger&&r._executeCurrent(Mr.CreateNew(t,void 0,n)),t.actionManager.hasSpecificTrigger(13,(function(e){var t=e.mesh?e.mesh:e;return n===t}))&&13!==r.trigger||t._intersectionsInProgress.splice(o,1))}},i=0;t.actionManager&&i<t.actionManager.actions.length;i++)r(i)}},t.prototype._advancePhysicsEngineStep=function(e){},t.prototype._animate=function(){},t.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var e=Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime))+this._timeAccumulator,r=this._engine.getTimeStep(),i=1e3/r/1e3,n=0,s=this._engine.getLockstepMaxSteps(),o=Math.floor(e/r);for(o=Math.min(o,s);e>0&&n<o;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=r*i,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(r),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,n++,e-=r;this._timeAccumulator=e<0?0:e}else{e=this.useConstantAnimationDeltaTime?16:Math.max(t.MinDeltaTime,Math.min(this._engine.getDeltaTime(),t.MaxDeltaTime));this._animationRatio=.06*e,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(e)}},t.prototype._clear=function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)},t.prototype._checkCameraRenderTarget=function(e){var t;if((null===e||void 0===e?void 0:e.outputRenderTarget)&&!(null===e||void 0===e?void 0:e.isRigCamera)&&(e.outputRenderTarget._cleared=!1),null===(t=null===e||void 0===e?void 0:e.rigCameras)||void 0===t?void 0:t.length)for(var r=0;r<e.rigCameras.length;++r){var i=e.rigCameras[r].outputRenderTarget;i&&(i._cleared=!1)}},t.prototype.resetDrawCache=function(e){if(this.meshes)for(var t=0,r=this.meshes;t<r.length;t++){r[t].resetDrawCache(e)}},t.prototype.render=function(e,t){var r,i,n;if(void 0===e&&(e=!0),void 0===t&&(t=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),(null===(r=this.activeCameras)||void 0===r?void 0:r.length)&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),t||this.animate();for(var s=0,o=this._beforeCameraUpdateStage;s<o.length;s++){o[s].action()}if(e)if(this.activeCameras&&this.activeCameras.length>0)for(var a=0;a<this.activeCameras.length;a++){var u=this.activeCameras[a];if(u.update(),0!==u.cameraRigMode)for(var h=0;h<u._rigCameras.length;h++)u._rigCameras[h].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(h=0;h<this.activeCamera._rigCameras.length;h++)this.activeCamera._rigCameras[h].update();this.onBeforeRenderObservable.notifyObservers(this);var c=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var l=(null===(i=this.activeCameras)||void 0===i?void 0:i.length)?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){Ve.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var f=0;f<this.customRenderTargets.length;f++){var d=this.customRenderTargets[f];if(d._shouldRender()){if(this._renderId++,this.activeCamera=d.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");c.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),d.render(l!==this.activeCamera,this.dumpNextRenderTargets)}}Ve.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=null!==(n=null===l||void 0===l?void 0:l.renderPassId)&&void 0!==n?n:0,this.activeCamera=l,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var p=0,_=this._beforeClearStage;p<_.length;p++){_[p].action()}this._clearFrameBuffer(this.activeCamera);for(var g=0,m=this._gatherRenderTargetsStage;g<m.length;g++){m[g].action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(a=0;a<this.activeCameras.length;a++)this._processSubCameras(this.activeCameras[a],a>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}this._checkIntersections();for(var y=0,v=this._afterRenderStage;y<v.length;y++){v[y].action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(h=0;h<this._toBeDisposed.length;h++){var b=this._toBeDisposed[h];b&&b.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}},t.prototype.freezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].freeze()},t.prototype.unfreezeMaterials=function(){for(var e=0;e<this.materials.length;e++)this.materials[e].unfreeze()},t.prototype.dispose=function(){var e;if(!this.isDisposed){this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var t=0,r=this._activeRequests.slice();t<r.length;t++){r[t].abort()}if(this._activeRequests=[],this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onComputePressureChanged.clear(),null===(e=this._computePressureObserver)||void 0===e||e.unobserve(),this._computePressureObserver=void 0,this.detachControl(),this._engine.getInputElement())for(var i=0;i<this.cameras.length;i++)this.cameras[i].detachControl();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(function(e){return e.dispose(!0)})),this._disposeList(this.transformNodes,(function(e){return e.dispose(!0)})),this._disposeList(this.cameras),this._defaultMaterial&&this._defaultMaterial.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.particleSystems),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);var n=this._engine.scenes.indexOf(this);n>-1&&this._engine.scenes.splice(n,1),I._LastCreatedScene===this&&(this._engine.scenes.length>0?I._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:I._LastCreatedScene=null),(n=this._engine._virtualScenes.indexOf(this))>-1&&this._engine._virtualScenes.splice(n,1),this._engine.wipeCaches(!0),this._isDisposed=!0}},t.prototype._disposeList=function(e,t){t=null!==t&&void 0!==t?t:function(e){return e.dispose()};for(var r=0,i=e.slice(0);r<i.length;r++){t(i[r])}e.length=0},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),t.prototype.clearCachedVertexData=function(){for(var e=0;e<this.meshes.length;e++){var t=this.meshes[e].geometry;t&&t.clearCachedData()}},t.prototype.cleanCachedTextureBuffer=function(){for(var e=0,t=this.textures;e<t.length;e++){var r=t[e];r._buffer&&(r._buffer=null)}},t.prototype.getWorldExtends=function(e){var t=new tt(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=new tt(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return e=e||function(){return!0},this.meshes.filter(e).forEach((function(e){if(e.computeWorldMatrix(!0),e.subMeshes&&0!==e.subMeshes.length&&!e.infiniteDistance){var i=e.getBoundingInfo(),n=i.boundingBox.minimumWorld,s=i.boundingBox.maximumWorld;tt.CheckExtends(n,t,r),tt.CheckExtends(s,t,r)}})),{min:t,max:r}},t.prototype.createPickingRay=function(e,t,r,i,n){throw void 0===n&&(n=!1),A("Ray")},t.prototype.createPickingRayToRef=function(e,t,r,i,n,s,o){throw void 0===s&&(s=!1),void 0===o&&(o=!1),A("Ray")},t.prototype.createPickingRayInCameraSpace=function(e,t,r){throw A("Ray")},t.prototype.createPickingRayInCameraSpaceToRef=function(e,t,r,i){throw A("Ray")},t.prototype.pick=function(e,t,r,i,n,s){var o=new Qt;return o._pickingUnavailable=!0,o},t.prototype.pickWithBoundingInfo=function(e,t,r,i,n){var s=new Qt;return s._pickingUnavailable=!0,s},t.prototype.pickWithRay=function(e,t,r,i){throw A("Ray")},t.prototype.multiPick=function(e,t,r,i,n){throw A("Ray")},t.prototype.multiPickWithRay=function(e,t,r){throw A("Ray")},t.prototype.setPointerOverMesh=function(e,t,r){this._inputManager.setPointerOverMesh(e,t,r)},t.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},t.prototype._rebuildGeometries=function(){for(var e=0,t=this.geometries;e<t.length;e++){t[e]._rebuild()}for(var r=0,i=this.meshes;r<i.length;r++){i[r]._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var n=0,s=this._components;n<s.length;n++){s[n].rebuild()}for(var o=0,a=this.particleSystems;o<a.length;o++){a[o].rebuild()}if(this.spriteManagers)for(var u=0,h=this.spriteManagers;u<h.length;u++){h[u].rebuild()}},t.prototype._rebuildTextures=function(){for(var e=0,t=this.textures;e<t.length;e++){t[e]._rebuild()}this.markAllMaterialsAsDirty(1)},t.prototype._getByTags=function(e,t,r){if(void 0===t)return e;var i=[];for(var n in r=r||function(e){},e){var s=e[n];ze&&ze.MatchesQuery(s,t)&&(i.push(s),r(s))}return i},t.prototype.getMeshesByTags=function(e,t){return this._getByTags(this.meshes,e,t)},t.prototype.getCamerasByTags=function(e,t){return this._getByTags(this.cameras,e,t)},t.prototype.getLightsByTags=function(e,t){return this._getByTags(this.lights,e,t)},t.prototype.getMaterialByTags=function(e,t){return this._getByTags(this.materials,e,t).concat(this._getByTags(this.multiMaterials,e,t))},t.prototype.getTransformNodesByTags=function(e,t){return this._getByTags(this.transformNodes,e,t)},t.prototype.setRenderingOrder=function(e,t,r,i){void 0===t&&(t=null),void 0===r&&(r=null),void 0===i&&(i=null),this._renderingManager.setRenderingOrder(e,t,r,i)},t.prototype.setRenderingAutoClearDepthStencil=function(e,t,r,i){void 0===r&&(r=!0),void 0===i&&(i=!0),this._renderingManager.setRenderingAutoClearDepthStencil(e,t,r,i)},t.prototype.getAutoClearDepthStencilSetup=function(e){return this._renderingManager.getAutoClearDepthStencilSetup(e)},Object.defineProperty(t.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(e){this._blockMaterialDirtyMechanism!==e&&(this._blockMaterialDirtyMechanism=e,e||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),t.prototype.markAllMaterialsAsDirty=function(e,t){if(!this._blockMaterialDirtyMechanism)for(var r=0,i=this.materials;r<i.length;r++){var n=i[r];t&&!t(n)||n.markAsDirty(e)}},t.prototype._loadFile=function(e,t,r,i,n,s,o){var a=this,u=Ie(e,t,r,i?this.offlineProvider:void 0,n,s,o);return this._activeRequests.push(u),u.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),u},t.prototype._loadFileAsync=function(e,t,r,i,n){var s=this;return new Promise((function(o,a){s._loadFile(e,(function(e){o(e)}),t,r,i,(function(e,t){a(t)}),n)}))},t.prototype._requestFile=function(e,t,r,i,n,s,o){var a=this,u=Se(e,t,r,i?this.offlineProvider:void 0,n,s,o);return this._activeRequests.push(u),u.onCompleteObservable.add((function(e){a._activeRequests.splice(a._activeRequests.indexOf(e),1)})),u},t.prototype._requestFileAsync=function(e,t,r,i,n){var s=this;return new Promise((function(o,a){s._requestFile(e,(function(e){o(e)}),t,r,i,(function(e){a(e)}),n)}))},t.prototype._readFile=function(e,t,r,i,n){var s=this,o=Re(e,t,r,i,n);return this._activeRequests.push(o),o.onCompleteObservable.add((function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)})),o},t.prototype._readFileAsync=function(e,t,r){var i=this;return new Promise((function(n,s){i._readFile(e,(function(e){n(e)}),t,r,(function(e){s(e)}))}))},t.prototype.getPerfCollector=function(){throw A("performanceViewerSceneExtension")},t.FOGMODE_NONE=0,t.FOGMODE_EXP=1,t.FOGMODE_EXP2=2,t.FOGMODE_LINEAR=3,t.MinDeltaTime=1,t.MaxDeltaTime=1e3,t}(cr);Zr.prototype.setActiveCameraByID=function(e){return this.setActiveCameraById(e)},Zr.prototype.getLastMaterialByID=function(e){return this.getLastMaterialById(e)},Zr.prototype.getMaterialByID=function(e){return this.getMaterialById(e)},Zr.prototype.getTextureByUniqueID=function(e){return this.getTextureByUniqueId(e)},Zr.prototype.getCameraByID=function(e){return this.getCameraById(e)},Zr.prototype.getCameraByUniqueID=function(e){return this.getCameraByUniqueId(e)},Zr.prototype.getBoneByID=function(e){return this.getBoneById(e)},Zr.prototype.getLightByID=function(e){return this.getLightById(e)},Zr.prototype.getLightByUniqueID=function(e){return this.getLightByUniqueId(e)},Zr.prototype.getParticleSystemByID=function(e){return this.getParticleSystemById(e)},Zr.prototype.getGeometryByID=function(e){return this.getGeometryById(e)},Zr.prototype.getMeshByID=function(e){return this.getMeshById(e)},Zr.prototype.getMeshesByID=function(e){return this.getMeshesById(e)},Zr.prototype.getTransformNodeByID=function(e){return this.getTransformNodeById(e)},Zr.prototype.getTransformNodeByUniqueID=function(e){return this.getTransformNodeByUniqueId(e)},Zr.prototype.getTransformNodesByID=function(e){return this.getTransformNodesById(e)},Zr.prototype.getMeshByUniqueID=function(e){return this.getMeshByUniqueId(e)},Zr.prototype.getLastMeshByID=function(e){return this.getLastMeshById(e)},Zr.prototype.getLastEntryByID=function(e){return this.getLastEntryById(e)},Zr.prototype.getNodeByID=function(e){return this.getNodeById(e)},Zr.prototype.getLastSkeletonByID=function(e){return this.getLastSkeletonById(e)};var Qr,Jr=function(e){function t(r,i){var n=e.call(this,r,i)||this;return n.diffuse=new ut(1,1,1),n.specular=new ut(1,1,1),n.falloffType=t.FALLOFF_DEFAULT,n.intensity=1,n._range=Number.MAX_VALUE,n._inverseSquaredRange=0,n._photometricScale=1,n._intensityMode=t.INTENSITYMODE_AUTOMATIC,n._radius=1e-5,n.renderPriority=0,n._shadowEnabled=!0,n._excludeWithLayerMask=0,n._includeOnlyWithLayerMask=0,n._lightmapMode=0,n._excludedMeshesIds=new Array,n._includedOnlyMeshesIds=new Array,n._isLight=!0,n.getScene().addLight(n),n._uniformBuffer=new Jt(n.getScene().getEngine(),void 0,void 0,r),n._buildUniformLayout(),n.includedOnlyMeshes=new Array,n.excludedMeshes=new Array,n._resyncMeshes(),n}return u(t,e),Object.defineProperty(t.prototype,"range",{get:function(){return this._range},set:function(e){this._range=e,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(e){this._intensityMode=e,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"radius",{get:function(){return this._radius},set:function(e){this._radius=e,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(e){this._shadowEnabled!==e&&(this._shadowEnabled=e,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(e){this._includedOnlyMeshes=e,this._hookArrayForIncludedOnly(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(e){this._excludedMeshes=e,this._hookArrayForExcluded(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(e){this._excludeWithLayerMask=e,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(e){this._includeOnlyWithLayerMask=e,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(e){this._lightmapMode!==e&&(this._lightmapMode=e,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),t.prototype.transferTexturesToEffect=function(e,t){return this},t.prototype._bindLight=function(e,t,r,i,n){void 0===n&&(n=!0);var s=e.toString(),o=!1;if(this._uniformBuffer.bindToEffect(r,"Light"+s),this._renderId!==t.getRenderId()||this._lastUseSpecular!==i||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=i;var a=this.getScaledIntensity();this.transferToEffect(r,s),this.diffuse.scaleToRef(a,ct.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",ct.Color3[0],this.range,s),i&&(this.specular.scaleToRef(a,ct.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",ct.Color3[1],this.radius,s)),o=!0}if(this.transferTexturesToEffect(r,s),t.shadowsEnabled&&this.shadowEnabled&&n){var u=this.getShadowGenerator();u&&(u.bindShadowLight(s,r),o=!0)}o?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()},t.prototype.getClassName=function(){return"Light"},t.prototype.toString=function(e){var t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var r=0;r<this.animations.length;r++)t+=", animation[0]: "+this.animations[r].toString(e);return t},t.prototype._syncParentEnabledState=function(){e.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},t.prototype.setEnabled=function(t){e.prototype.setEnabled.call(this,t),this._resyncMeshes()},t.prototype.getShadowGenerator=function(){return this._shadowGenerator},t.prototype.getAbsolutePosition=function(){return tt.Zero()},t.prototype.canAffectMesh=function(e){return!e||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(e))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(e))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&e.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&e.layerMask)))},t.prototype.dispose=function(t,r){if(void 0===r&&(r=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this),this._parentContainer){var i=this._parentContainer.lights.indexOf(this);i>-1&&this._parentContainer.lights.splice(i,1),this._parentContainer=null}for(var n=0,s=this.getScene().meshes;n<s.length;n++){s[n]._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),e.prototype.dispose.call(this,t,r)},t.prototype.getTypeID=function(){return 0},t.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},t.prototype.clone=function(e,r){void 0===r&&(r=null);var i=t.GetConstructorFromName(this.getTypeID(),e,this.getScene());if(!i)return null;var n=Mt.Clone(i,this);return e&&(n.name=e),r&&(n.parent=r),n.setEnabled(this.isEnabled()),this.onClonedObservable.notifyObservers(n),n},t.prototype.serialize=function(){var e=Mt.Serialize(this);return e.uniqueId=this.uniqueId,e.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(e),this.excludedMeshes.length>0&&(e.excludedMeshesIds=[],this.excludedMeshes.forEach((function(t){e.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(e.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((function(t){e.includedOnlyMeshesIds.push(t.id)}))),Mt.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.isEnabled=this.isEnabled(),e},t.GetConstructorFromName=function(e,t,r){var i=At.Construct("Light_Type_"+e,t,r);return i||null},t.Parse=function(e,r){var i=t.GetConstructorFromName(e.type,e.name,r);if(!i)return null;var n=Mt.Parse(i,e,r);if(e.excludedMeshesIds&&(n._excludedMeshesIds=e.excludedMeshesIds),e.includedOnlyMeshesIds&&(n._includedOnlyMeshesIds=e.includedOnlyMeshesIds),void 0!==e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(n._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.falloffType&&(n.falloffType=e.falloffType),void 0!==e.lightmapMode&&(n.lightmapMode=e.lightmapMode),e.animations){for(var s=0;s<e.animations.length;s++){var o=e.animations[s],a=Ne("BABYLON.Animation");a&&n.animations.push(a.Parse(o))}At.ParseAnimationRanges(n,e,r)}return e.autoAnimate&&r.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),void 0!==e.isEnabled&&n.setEnabled(e.isEnabled),n},t.prototype._hookArrayForExcluded=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];for(var s=r.apply(e,i),o=0,a=i;o<a.length;o++){var u=a[o];u._resyncLightSource(t)}return s};var i=e.splice;e.splice=function(r,n){for(var s=i.apply(e,[r,n]),o=0,a=s;o<a.length;o++){a[o]._resyncLightSource(t)}return s};for(var n=0,s=e;n<s.length;n++){s[n]._resyncLightSource(this)}},t.prototype._hookArrayForIncludedOnly=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var s=r.apply(e,i);return t._resyncMeshes(),s};var i=e.splice;e.splice=function(r,n){var s=i.apply(e,[r,n]);return t._resyncMeshes(),s},this._resyncMeshes()},t.prototype._resyncMeshes=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){t[e]._resyncLightSource(this)}},t.prototype._markMeshesAsLightDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var r=t[e];-1!==r.lightSources.indexOf(this)&&r._markSubMeshesAsLightDirty()}},t.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},t.prototype._getPhotometricScale=function(){var e=0,r=this.getTypeID(),i=this.intensityMode;switch(i===t.INTENSITYMODE_AUTOMATIC&&(i=r===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),r){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(i){case t.INTENSITYMODE_LUMINOUSPOWER:e=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:e=1;break;case t.INTENSITYMODE_LUMINANCE:e=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(i){case t.INTENSITYMODE_ILLUMINANCE:e=1;break;case t.INTENSITYMODE_LUMINANCE:var n=this.radius;n=Math.max(n,.001),e=2*Math.PI*(1-Math.cos(n))}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:e=1}return e},t.prototype._reorderLightsInScene=function(){var e=this.getScene();0!=this._renderPriority&&(e.requireLightSorting=!0),this.getScene().sortLightsByPriority()},t.FALLOFF_DEFAULT=qr.FALLOFF_DEFAULT,t.FALLOFF_PHYSICAL=qr.FALLOFF_PHYSICAL,t.FALLOFF_GLTF=qr.FALLOFF_GLTF,t.FALLOFF_STANDARD=qr.FALLOFF_STANDARD,t.LIGHTMAP_DEFAULT=qr.LIGHTMAP_DEFAULT,t.LIGHTMAP_SPECULAR=qr.LIGHTMAP_SPECULAR,t.LIGHTMAP_SHADOWSONLY=qr.LIGHTMAP_SHADOWSONLY,t.INTENSITYMODE_AUTOMATIC=qr.INTENSITYMODE_AUTOMATIC,t.INTENSITYMODE_LUMINOUSPOWER=qr.INTENSITYMODE_LUMINOUSPOWER,t.INTENSITYMODE_LUMINOUSINTENSITY=qr.INTENSITYMODE_LUMINOUSINTENSITY,t.INTENSITYMODE_ILLUMINANCE=qr.INTENSITYMODE_ILLUMINANCE,t.INTENSITYMODE_LUMINANCE=qr.INTENSITYMODE_LUMINANCE,t.LIGHTTYPEID_POINTLIGHT=qr.LIGHTTYPEID_POINTLIGHT,t.LIGHTTYPEID_DIRECTIONALLIGHT=qr.LIGHTTYPEID_DIRECTIONALLIGHT,t.LIGHTTYPEID_SPOTLIGHT=qr.LIGHTTYPEID_SPOTLIGHT,t.LIGHTTYPEID_HEMISPHERICLIGHT=qr.LIGHTTYPEID_HEMISPHERICLIGHT,c([vt()],t.prototype,"diffuse",void 0),c([vt()],t.prototype,"specular",void 0),c([mt()],t.prototype,"falloffType",void 0),c([mt()],t.prototype,"intensity",void 0),c([mt()],t.prototype,"range",null),c([mt()],t.prototype,"intensityMode",null),c([mt()],t.prototype,"radius",null),c([mt()],t.prototype,"_renderPriority",void 0),c([gt("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),c([mt("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),c([mt("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),c([mt("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),c([mt("lightmapMode")],t.prototype,"_lightmapMode",void 0),t}(At),$r=function(){function e(){}return e.BindClipPlane=function(e,t){if(t.clipPlane){var r=t.clipPlane;e.setFloat4("vClipPlane",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane2){r=t.clipPlane2;e.setFloat4("vClipPlane2",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane3){r=t.clipPlane3;e.setFloat4("vClipPlane3",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane4){r=t.clipPlane4;e.setFloat4("vClipPlane4",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane5){r=t.clipPlane5;e.setFloat4("vClipPlane5",r.normal.x,r.normal.y,r.normal.z,r.d)}if(t.clipPlane6){r=t.clipPlane6;e.setFloat4("vClipPlane6",r.normal.x,r.normal.y,r.normal.z,r.d)}},e}(),ei=function(){function e(){}return e.BindSceneUniformBuffer=function(e,t){t.bindToEffect(e,"Scene")},e.PrepareDefinesForMergedUV=function(e,t,r){t._needUVs=!0,t[r]=!0,e.getTextureMatrix().isIdentityAs3x2()?(t[r+"DIRECTUV"]=e.coordinatesIndex+1,t["MAINUV"+(e.coordinatesIndex+1)]=!0):t[r+"DIRECTUV"]=0},e.BindTextureMatrix=function(e,t,r){var i=e.getTextureMatrix();t.updateMatrix(r+"Matrix",i)},e.GetFogState=function(e,t){return t.fogEnabled&&e.applyFog&&t.fogMode!==Zr.FOGMODE_NONE},e.PrepareDefinesForMisc=function(e,t,r,i,n,s,o){o._areMiscDirty&&(o.LOGARITHMICDEPTH=r,o.POINTSIZE=i,o.FOG=n&&this.GetFogState(e,t),o.NONUNIFORMSCALING=e.nonUniformScaling,o.ALPHATEST=s)},e.PrepareDefinesForFrameBoundValues=function(e,t,r,i,n,s){void 0===n&&(n=null),void 0===s&&(s=!1);var o,a,u,h,c,l,f=!1;o=null==n?void 0!==e.clipPlane&&null!==e.clipPlane:n,a=null==n?void 0!==e.clipPlane2&&null!==e.clipPlane2:n,u=null==n?void 0!==e.clipPlane3&&null!==e.clipPlane3:n,h=null==n?void 0!==e.clipPlane4&&null!==e.clipPlane4:n,c=null==n?void 0!==e.clipPlane5&&null!==e.clipPlane5:n,l=null==n?void 0!==e.clipPlane6&&null!==e.clipPlane6:n,r.CLIPPLANE!==o&&(r.CLIPPLANE=o,f=!0),r.CLIPPLANE2!==a&&(r.CLIPPLANE2=a,f=!0),r.CLIPPLANE3!==u&&(r.CLIPPLANE3=u,f=!0),r.CLIPPLANE4!==h&&(r.CLIPPLANE4=h,f=!0),r.CLIPPLANE5!==c&&(r.CLIPPLANE5=c,f=!0),r.CLIPPLANE6!==l&&(r.CLIPPLANE6=l,f=!0),r.DEPTHPREPASS!==!t.getColorWrite()&&(r.DEPTHPREPASS=!r.DEPTHPREPASS,f=!0),r.INSTANCES!==i&&(r.INSTANCES=i,f=!0),r.INSTANCESCOLOR&&!r.INSTANCES&&(r.INSTANCESCOLOR=!1,f=!0),r.THIN_INSTANCES!==s&&(r.THIN_INSTANCES=s,f=!0),f&&r.markAsUnprocessed()},e.PrepareDefinesForBones=function(e,t){if(e.useBones&&e.computeBonesUsingShaders&&e.skeleton){t.NUM_BONE_INFLUENCERS=e.numBoneInfluencers;var r=void 0!==t.BONETEXTURE;if(e.skeleton.isUsingTextureForMatrices&&r)t.BONETEXTURE=!0;else{t.BonesPerMesh=e.skeleton.bones.length+1,t.BONETEXTURE=!r&&void 0;var i=e.getScene().prePassRenderer;if(i&&i.enabled){var n=-1===i.excludedSkinnedMesh.indexOf(e);t.BONES_VELOCITY_ENABLED=n}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0},e.PrepareDefinesForMorphTargets=function(e,t){var r=e.morphTargetManager;r?(t.MORPHTARGETS_UV=r.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=r.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=r.supportsNormals&&t.NORMAL,t.MORPHTARGETS=r.numInfluencers>0,t.NUM_MORPH_INFLUENCERS=r.numInfluencers,t.MORPHTARGETS_TEXTURE=r.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)},e.PrepareDefinesForBakedVertexAnimation=function(e,t){var r=e.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!r||!r.isEnabled)},e.PrepareDefinesForAttributes=function(e,t,r,i,n,s,o){if(void 0===n&&(n=!1),void 0===s&&(s=!0),void 0===o&&(o=!0),!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&e.isVerticesDataPresent(Rt.NormalKind),t._needNormals&&e.isVerticesDataPresent(Rt.TangentKind)&&(t.TANGENT=!0);for(var a=1;a<=6;++a)t["UV"+a]=!!t._needUVs&&e.isVerticesDataPresent("uv".concat(1===a?"":a));if(r){var u=e.useVertexColors&&e.isVerticesDataPresent(Rt.ColorKind);t.VERTEXCOLOR=u,t.VERTEXALPHA=e.hasVertexAlpha&&u&&s}return e.isVerticesDataPresent(Rt.ColorInstanceKind)&&(e.hasInstances||e.hasThinInstances)&&(t.INSTANCESCOLOR=!0),i&&this.PrepareDefinesForBones(e,t),n&&this.PrepareDefinesForMorphTargets(e,t),o&&this.PrepareDefinesForBakedVertexAnimation(e,t),!0},e.PrepareDefinesForMultiview=function(e,t){if(e.activeCamera){var r=t.MULTIVIEW;t.MULTIVIEW=null!==e.activeCamera.outputRenderTarget&&e.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=r&&t.markAsUnprocessed()}},e.PrepareDefinesForOIT=function(e,t,r){var i=t.ORDER_INDEPENDENT_TRANSPARENCY,n=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=e.useOrderIndependentTransparency&&r,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!e.getEngine().getCaps().textureFloatLinearFiltering,i===t.ORDER_INDEPENDENT_TRANSPARENCY&&n===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()},e.PrepareDefinesForPrePass=function(e,t,r){var i=t.PREPASS;if(t._arePrePassDirty){var n=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(e.prePassRenderer&&e.prePassRenderer.enabled&&r){t.PREPASS=!0,t.SCENE_MRT_COUNT=e.prePassRenderer.mrtCount;for(var s=0;s<n.length;s++){var o=e.prePassRenderer.getIndex(n[s].type);-1!==o?(t[n[s].define]=!0,t[n[s].index]=o):t[n[s].define]=!1}}else{t.PREPASS=!1;for(s=0;s<n.length;s++)t[n[s].define]=!1}t.PREPASS!=i&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}},e.PrepareDefinesForLight=function(e,t,r,i,n,s,o){switch(o.needNormals=!0,void 0===n["LIGHT"+i]&&(o.needRebuild=!0),n["LIGHT"+i]=!0,n["SPOTLIGHT"+i]=!1,n["HEMILIGHT"+i]=!1,n["POINTLIGHT"+i]=!1,n["DIRLIGHT"+i]=!1,r.prepareLightSpecificDefines(n,i),n["LIGHT_FALLOFF_PHYSICAL"+i]=!1,n["LIGHT_FALLOFF_GLTF"+i]=!1,n["LIGHT_FALLOFF_STANDARD"+i]=!1,r.falloffType){case Jr.FALLOFF_GLTF:n["LIGHT_FALLOFF_GLTF"+i]=!0;break;case Jr.FALLOFF_PHYSICAL:n["LIGHT_FALLOFF_PHYSICAL"+i]=!0;break;case Jr.FALLOFF_STANDARD:n["LIGHT_FALLOFF_STANDARD"+i]=!0}if(s&&!r.specular.equalsFloats(0,0,0)&&(o.specularEnabled=!0),n["SHADOW"+i]=!1,n["SHADOWCSM"+i]=!1,n["SHADOWCSMDEBUG"+i]=!1,n["SHADOWCSMNUM_CASCADES"+i]=!1,n["SHADOWCSMUSESHADOWMAXZ"+i]=!1,n["SHADOWCSMNOBLEND"+i]=!1,n["SHADOWCSM_RIGHTHANDED"+i]=!1,n["SHADOWPCF"+i]=!1,n["SHADOWPCSS"+i]=!1,n["SHADOWPOISSON"+i]=!1,n["SHADOWESM"+i]=!1,n["SHADOWCLOSEESM"+i]=!1,n["SHADOWCUBE"+i]=!1,n["SHADOWLOWQUALITY"+i]=!1,n["SHADOWMEDIUMQUALITY"+i]=!1,t&&t.receiveShadows&&e.shadowsEnabled&&r.shadowEnabled){var a=r.getShadowGenerator();if(a){var u=a.getShadowMap();u&&u.renderList&&u.renderList.length>0&&(o.shadowEnabled=!0,a.prepareDefines(n,i))}}r.lightmapMode!=Jr.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,n["LIGHTMAPEXCLUDED"+i]=!0,n["LIGHTMAPNOSPECULAR"+i]=r.lightmapMode==Jr.LIGHTMAP_SHADOWSONLY):(n["LIGHTMAPEXCLUDED"+i]=!1,n["LIGHTMAPNOSPECULAR"+i]=!1)},e.PrepareDefinesForLights=function(e,t,r,i,n,s){if(void 0===n&&(n=4),void 0===s&&(s=!1),!r._areLightsDirty)return r._needNormals;var o=0,a={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(e.lightsEnabled&&!s)for(var u=0,h=t.lightSources;u<h.length;u++){var c=h[u];if(this.PrepareDefinesForLight(e,t,c,o,r,i,a),++o===n)break}r.SPECULARTERM=a.specularEnabled,r.SHADOWS=a.shadowEnabled;for(var l=o;l<n;l++)void 0!==r["LIGHT"+l]&&(r["LIGHT"+l]=!1,r["HEMILIGHT"+l]=!1,r["POINTLIGHT"+l]=!1,r["DIRLIGHT"+l]=!1,r["SPOTLIGHT"+l]=!1,r["SHADOW"+l]=!1,r["SHADOWCSM"+l]=!1,r["SHADOWCSMDEBUG"+l]=!1,r["SHADOWCSMNUM_CASCADES"+l]=!1,r["SHADOWCSMUSESHADOWMAXZ"+l]=!1,r["SHADOWCSMNOBLEND"+l]=!1,r["SHADOWCSM_RIGHTHANDED"+l]=!1,r["SHADOWPCF"+l]=!1,r["SHADOWPCSS"+l]=!1,r["SHADOWPOISSON"+l]=!1,r["SHADOWESM"+l]=!1,r["SHADOWCLOSEESM"+l]=!1,r["SHADOWCUBE"+l]=!1,r["SHADOWLOWQUALITY"+l]=!1,r["SHADOWMEDIUMQUALITY"+l]=!1);var f=e.getEngine().getCaps();return void 0===r.SHADOWFLOAT&&(a.needRebuild=!0),r.SHADOWFLOAT=a.shadowEnabled&&(f.textureFloatRender&&f.textureFloatLinearFiltering||f.textureHalfFloatRender&&f.textureHalfFloatLinearFiltering),r.LIGHTMAPEXCLUDED=a.lightmapMode,a.needRebuild&&r.rebuild(),a.needNormals},e.PrepareUniformsAndSamplersForLight=function(e,t,r,i,n,s){void 0===n&&(n=null),void 0===s&&(s=!1),n&&n.push("Light"+e),s||(t.push("vLightData"+e,"vLightDiffuse"+e,"vLightSpecular"+e,"vLightDirection"+e,"vLightFalloff"+e,"vLightGround"+e,"lightMatrix"+e,"shadowsInfo"+e,"depthValues"+e),r.push("shadowSampler"+e),r.push("depthSampler"+e),t.push("viewFrustumZ"+e,"cascadeBlendFactor"+e,"lightSizeUVCorrection"+e,"depthCorrection"+e,"penumbraDarkness"+e,"frustumLengths"+e),i&&(r.push("projectionLightSampler"+e),t.push("textureProjectionMatrix"+e)))},e.PrepareUniformsAndSamplersList=function(e,t,r,i){var n;void 0===i&&(i=4);var s=null;if(e.uniformsNames){var o=e;n=o.uniformsNames,s=o.uniformBuffersNames,t=o.samplers,r=o.defines,i=o.maxSimultaneousLights||0}else n=e,t||(t=[]);for(var a=0;a<i&&r["LIGHT"+a];a++)this.PrepareUniformsAndSamplersForLight(a,n,t,r["PROJECTEDLIGHTTEXTURE"+a],s);r.NUM_MORPH_INFLUENCERS&&n.push("morphTargetInfluences"),r.BAKED_VERTEX_ANIMATION_TEXTURE&&(n.push("bakedVertexAnimationSettings"),n.push("bakedVertexAnimationTextureSizeInverted"),n.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))},e.HandleFallbacksForShadows=function(e,t,r,i){void 0===r&&(r=4),void 0===i&&(i=0);for(var n=0,s=0;s<r&&e["LIGHT"+s];s++)s>0&&(n=i+s,t.addFallback(n,"LIGHT"+s)),e.SHADOWS||(e["SHADOW"+s]&&t.addFallback(i,"SHADOW"+s),e["SHADOWPCF"+s]&&t.addFallback(i,"SHADOWPCF"+s),e["SHADOWPCSS"+s]&&t.addFallback(i,"SHADOWPCSS"+s),e["SHADOWPOISSON"+s]&&t.addFallback(i,"SHADOWPOISSON"+s),e["SHADOWESM"+s]&&t.addFallback(i,"SHADOWESM"+s),e["SHADOWCLOSEESM"+s]&&t.addFallback(i,"SHADOWCLOSEESM"+s));return n++},e.PrepareAttributesForMorphTargetsInfluencers=function(e,t,r){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=r,this.PrepareAttributesForMorphTargets(e,t,this._TmpMorphInfluencers)},e.PrepareAttributesForMorphTargets=function(e,t,r){var i=r.NUM_MORPH_INFLUENCERS;if(i>0&&I.LastCreatedEngine){var n=I.LastCreatedEngine.getCaps().maxVertexAttribs,s=t.morphTargetManager;if(null===s||void 0===s?void 0:s.isUsingTextureForTargets)return;for(var o=s&&s.supportsNormals&&r.NORMAL,a=s&&s.supportsTangents&&r.TANGENT,u=s&&s.supportsUVs&&r.UV1,h=0;h<i;h++)e.push(Rt.PositionKind+h),o&&e.push(Rt.NormalKind+h),a&&e.push(Rt.TangentKind+h),u&&e.push(Rt.UVKind+"_"+h),e.length>n&&T.Error("Cannot add more vertex attributes for mesh "+t.name)}},e.PrepareAttributesForBakedVertexAnimation=function(e,t,r){r.BAKED_VERTEX_ANIMATION_TEXTURE&&r.INSTANCES&&e.push("bakedVertexAnimationSettingsInstanced")},e.PrepareAttributesForBones=function(e,t,r,i){r.NUM_BONE_INFLUENCERS>0&&(i.addCPUSkinningFallback(0,t),e.push(Rt.MatricesIndicesKind),e.push(Rt.MatricesWeightsKind),r.NUM_BONE_INFLUENCERS>4&&(e.push(Rt.MatricesIndicesExtraKind),e.push(Rt.MatricesWeightsExtraKind)))},e.PrepareAttributesForInstances=function(e,t){(t.INSTANCES||t.THIN_INSTANCES)&&this.PushAttributesForInstances(e,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&e.push(Rt.ColorInstanceKind)},e.PushAttributesForInstances=function(e,t){void 0===t&&(t=!1),e.push("world0"),e.push("world1"),e.push("world2"),e.push("world3"),t&&(e.push("previousWorld0"),e.push("previousWorld1"),e.push("previousWorld2"),e.push("previousWorld3"))},e.BindLightProperties=function(e,t,r){e.transferToEffect(t,r+"")},e.BindLight=function(e,t,r,i,n,s){void 0===s&&(s=!0),e._bindLight(t,r,i,n,s)},e.BindLights=function(e,t,r,i,n){void 0===n&&(n=4);for(var s=Math.min(t.lightSources.length,n),o=0;o<s;o++){var a=t.lightSources[o];this.BindLight(a,o,e,r,"boolean"===typeof i?i:i.SPECULARTERM,t.receiveShadows)}},e.BindFogParameters=function(e,t,r,i){void 0===i&&(i=!1),e.fogEnabled&&t.applyFog&&e.fogMode!==Zr.FOGMODE_NONE&&(r.setFloat4("vFogInfos",e.fogMode,e.fogStart,e.fogEnd,e.fogDensity),i?(e.fogColor.toLinearSpaceToRef(this._TempFogColor),r.setColor3("vFogColor",this._TempFogColor)):r.setColor3("vFogColor",e.fogColor))},e.BindBonesParameters=function(t,r,i){if(r&&t&&(t.computeBonesUsingShaders&&r._bonesComputationForcedToCPU&&(t.computeBonesUsingShaders=!1),t.useBones&&t.computeBonesUsingShaders&&t.skeleton)){var n=t.skeleton;if(n.isUsingTextureForMatrices&&r.getUniformIndex("boneTextureWidth")>-1){var s=n.getTransformMatrixTexture(t);r.setTexture("boneSampler",s),r.setFloat("boneTextureWidth",4*(n.bones.length+1))}else{var o=n.getTransformMatrices(t);o&&(r.setMatrices("mBones",o),i&&t.getScene().prePassRenderer&&t.getScene().prePassRenderer.getIndex(2)&&(i.previousBones[t.uniqueId]||(i.previousBones[t.uniqueId]=o.slice()),r.setMatrices("mPreviousBones",i.previousBones[t.uniqueId]),e._CopyBonesTransformationMatrices(o,i.previousBones[t.uniqueId])))}}},e._CopyBonesTransformationMatrices=function(e,t){return t.set(e),t},e.BindMorphTargetParameters=function(e,t){var r=e.morphTargetManager;e&&r&&t.setFloatArray("morphTargetInfluences",r.influences)},e.BindLogDepth=function(e,t,r){if(!e||e.LOGARITHMICDEPTH){var i=r.activeCamera;i.mode===ur.ORTHOGRAPHIC_CAMERA&&T.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(i.maxZ+1)/Math.LN2))}},e.BindClipPlane=function(e,t){$r.BindClipPlane(e,t)},e._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},e._TempFogColor=ut.Black(),e}(),ti=function(){function e(){this.reset()}return e.prototype.reset=function(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681},Object.defineProperty(e.prototype,"func",{get:function(){return this._func},set:function(e){this._func=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcRef",{get:function(){return this._funcRef},set:function(e){this._funcRef=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"funcMask",{get:function(){return this._funcMask},set:function(e){this._funcMask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilFail",{get:function(){return this._opStencilFail},set:function(e){this._opStencilFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opDepthFail",{get:function(){return this._opDepthFail},set:function(e){this._opDepthFail=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"opStencilDepthPass",{get:function(){return this._opStencilDepthPass},set:function(e){this._opStencilDepthPass=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(e){this._mask=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e},enumerable:!1,configurable:!0}),e.prototype.getClassName=function(){return"MaterialStencilState"},e.prototype.copyTo=function(e){Mt.Clone((function(){return e}),this)},e.prototype.serialize=function(){return Mt.Serialize(this)},e.prototype.parse=function(e,t,r){var i=this;Mt.Parse((function(){return i}),e,t,r)},c([mt()],e.prototype,"func",null),c([mt()],e.prototype,"funcRef",null),c([mt()],e.prototype,"funcMask",null),c([mt()],e.prototype,"opStencilFail",null),c([mt()],e.prototype,"opDepthFail",null),c([mt()],e.prototype,"opStencilDepthPass",null),c([mt()],e.prototype,"mask",null),c([mt()],e.prototype,"enabled",null),e}();!function(e){e[e.Created=1]="Created",e[e.Disposed=2]="Disposed",e[e.GetDefineNames=4]="GetDefineNames",e[e.PrepareUniformBuffer=8]="PrepareUniformBuffer",e[e.IsReadyForSubMesh=16]="IsReadyForSubMesh",e[e.PrepareDefines=32]="PrepareDefines",e[e.BindForSubMesh=64]="BindForSubMesh",e[e.PrepareEffect=128]="PrepareEffect",e[e.GetAnimatables=256]="GetAnimatables",e[e.GetActiveTextures=512]="GetActiveTextures",e[e.HasTexture=1024]="HasTexture",e[e.FillRenderTargetTextures=2048]="FillRenderTargetTextures",e[e.HasRenderTargetTextures=4096]="HasRenderTargetTextures",e[e.HardBindForSubMesh=8192]="HardBindForSubMesh"}(Qr||(Qr={}));var ri=function(){function e(t,r,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new _,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new ti,this._useUBO=!1,this._fillMode=e.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=function(){},this._callbackPluginEventIsReadyForSubMesh=function(){},this._callbackPluginEventPrepareDefines=function(){},this._callbackPluginEventPrepareDefinesBeforeAttributes=function(){},this._callbackPluginEventHardBindForSubMesh=function(){},this._callbackPluginEventBindForSubMesh=function(){},this._callbackPluginEventHasRenderTargetTextures=function(){},this._callbackPluginEventFillRenderTargetTextures=function(){},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t;var n=r||I.LastCreatedScene;n&&(this._scene=n,this._dirtyCallbacks={},this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=t||Ve.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new pe(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._scene.useRightHandedSystem?this.sideOrientation=e.ClockWiseSideOrientation:this.sideOrientation=e.CounterClockWiseSideOrientation,this._uniformBuffer=new Jt(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),e.OnEventObservable.notifyObservers(this,Qr.Created))}return Object.defineProperty(e.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){if(this._alpha!==t){var r=this._alpha;this._alpha=t,1!==r&&1!==t||this.markAsDirty(e.MiscDirtyFlag)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cullBackFaces",{get:function(){return this._cullBackFaces},set:function(t){this._cullBackFaces!==t&&(this._cullBackFaces=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRenderTargetTextures",{get:function(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new _),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBind",{set:function(e){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new _),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new _),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(e.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(e){this._needDepthPrePass!==e&&(this._needDepthPrePass=e,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isPrePassCapable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wireframe",{get:function(){switch(this._fillMode){case e.WireFrameFillMode:case e.LineListDrawMode:case e.LineLoopDrawMode:case e.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?e.WireFrameFillMode:e.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case e.PointFillMode:case e.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?e.PointFillMode:e.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(e.MiscDirtyFlag))},enumerable:!1,configurable:!0}),e.prototype._getDrawWrapper=function(){return this._drawWrapper},e.prototype._setDrawWrapper=function(e){this._drawWrapper=e},e.prototype.toString=function(e){return"Name: "+this.name},e.prototype.getClassName=function(){return"Material"},Object.defineProperty(e.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),e.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},e.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},e.prototype.isReady=function(e,t){return!0},e.prototype.isReadyForSubMesh=function(e,t,r){var i=t.materialDefines;return!!i&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=i,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)},e.prototype.getEffect=function(){return this._drawWrapper.effect},e.prototype.getScene=function(){return this._scene},Object.defineProperty(e.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===e.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===e.MATERIAL_OPAQUE||this._transparencyMode===e.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),e.prototype.needAlphaBlending=function(){return!this._disableAlphaBlending&&this.alpha<1},e.prototype.needAlphaBlendingForMesh=function(e){return!(this._disableAlphaBlending&&e.visibility>=1)&&(this.needAlphaBlending()||e.visibility<1||e.hasVertexAlpha)},e.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},e.prototype._shouldTurnAlphaTestOn=function(e){return!this.needAlphaBlendingForMesh(e)&&this.needAlphaTesting()},e.prototype.getAlphaTestTexture=function(){return null},e.prototype.markDirty=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var r=t[e];if(r.subMeshes)for(var i=0,n=r.subMeshes;i<n.length;i++){var s=n[i];s.getMaterial()===this&&(s.effect&&(s.effect._wasPreviouslyReady=!1,s.effect._wasPreviouslyUsingInstances=null))}}},e.prototype._preBind=function(t,r){void 0===r&&(r=null);var i=this._scene.getEngine(),n=(null==r?this.sideOrientation:r)===e.ClockWiseSideOrientation;return i.enableEffect(t||this._getDrawWrapper()),i.setState(this.backFaceCulling,this.zOffset,!1,n,this.cullBackFaces,this.stencil,this.zOffsetUnits),n},e.prototype.bind=function(e,t){},e.prototype.buildUniformLayout=function(){var e=this._uniformBuffer;this._eventInfo.ubo=e,this._callbackPluginEventGeneric(Qr.PrepareUniformBuffer,this._eventInfo),e.create(),this._uniformBufferLayoutBuilt=!0},e.prototype.bindForSubMesh=function(e,t,r){r.effect&&(this._eventInfo.subMesh=r,this._callbackPluginEventBindForSubMesh(this._eventInfo))},e.prototype.bindOnlyWorldMatrix=function(e){},e.prototype.bindView=function(e){this._useUBO?this._needToBindSceneUbo=!0:e.setMatrix("view",this.getScene().getViewMatrix())},e.prototype.bindViewProjection=function(e){this._useUBO?this._needToBindSceneUbo=!0:(e.setMatrix("viewProjection",this.getScene().getTransformMatrix()),e.setMatrix("projection",this.getScene().getProjectionMatrix()))},e.prototype.bindEyePosition=function(e,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(e,t)},e.prototype._afterBind=function(e,t){if(void 0===t&&(t=null),this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,ei.BindSceneUniformBuffer(t,this.getScene().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=e?e.visibility:1,this._onBindObservable&&e&&this._onBindObservable.notifyObservers(e),this.disableDepthWrite){var r=this._scene.getEngine();this._cachedDepthWriteState=r.getDepthWrite(),r.setDepthWrite(!1)}if(this.disableColorWrite){r=this._scene.getEngine();this._cachedColorWriteState=r.getColorWrite(),r.setColorWrite(!1)}if(0!==this.depthFunction){r=this._scene.getEngine();this._cachedDepthFunctionState=r.getDepthFunction()||0,r.setDepthFunction(this.depthFunction)}},e.prototype.unbind=function(){(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction)&&this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState);this.disableDepthWrite&&this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState);this.disableColorWrite&&this._scene.getEngine().setColorWrite(this._cachedColorWriteState)},e.prototype.getAnimatables=function(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(Qr.GetAnimatables,this._eventInfo),this._eventInfo.animatables},e.prototype.getActiveTextures=function(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(Qr.GetActiveTextures,this._eventInfo),this._eventInfo.activeTextures},e.prototype.hasTexture=function(e){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=e,this._callbackPluginEventGeneric(Qr.HasTexture,this._eventInfo),this._eventInfo.hasTexture},e.prototype.clone=function(e){return null},e.prototype.getBindedMeshes=function(){var e=this;if(this.meshMap){var t=new Array;for(var r in this.meshMap){var i=this.meshMap[r];i&&t.push(i)}return t}return this._scene.meshes.filter((function(t){return t.material===e}))},e.prototype.forceCompilation=function(e,t,r,i){var n=this,s=h({clipPlane:!1,useInstances:!1},r),o=this.getScene(),a=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;!function r(){if(n._scene&&n._scene.getEngine()){var u=o.clipPlane;if(s.clipPlane&&(o.clipPlane=new ir(0,0,0,1)),n._storeEffectOnSubMeshes){var h=!0,c=null;if(e.subMeshes){var l=new kt(0,0,0,0,0,e,void 0,!1,!1);l.materialDefines&&(l.materialDefines._renderId=-1),n.isReadyForSubMesh(e,l,s.useInstances)||(l.effect&&l.effect.getCompilationError()&&l.effect.allFallbacksProcessed()?c=l.effect.getCompilationError():(h=!1,setTimeout(r,16)))}h&&(n.allowShaderHotSwapping=a,c&&i&&i(c),t&&t(n))}else n.isReady()?(n.allowShaderHotSwapping=a,t&&t(n)):setTimeout(r,16);s.clipPlane&&(o.clipPlane=u)}}()},e.prototype.forceCompilationAsync=function(e,t){var r=this;return new Promise((function(i,n){r.forceCompilation(e,(function(){i()}),t,(function(e){n(e)}))}))},e.prototype.markAsDirty=function(t){this.getScene().blockMaterialDirtyMechanism||(e._DirtyCallbackArray.length=0,t&e.TextureDirtyFlag&&e._DirtyCallbackArray.push(e._TextureDirtyCallBack),t&e.LightDirtyFlag&&e._DirtyCallbackArray.push(e._LightsDirtyCallBack),t&e.FresnelDirtyFlag&&e._DirtyCallbackArray.push(e._FresnelDirtyCallBack),t&e.AttributesDirtyFlag&&e._DirtyCallbackArray.push(e._AttributeDirtyCallBack),t&e.MiscDirtyFlag&&e._DirtyCallbackArray.push(e._MiscDirtyCallBack),t&e.PrePassDirtyFlag&&e._DirtyCallbackArray.push(e._PrePassDirtyCallBack),e._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(e._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},e.prototype.resetDrawCache=function(){for(var e=0,t=this.getScene().meshes;e<t.length;e++){var r=t[e];if(r.subMeshes)for(var i=0,n=r.subMeshes;i<n.length;i++){var s=n[i];s.getMaterial()===this&&s.resetDrawCache()}}},e.prototype._markAllSubMeshesAsDirty=function(e){if(!this.getScene().blockMaterialDirtyMechanism)for(var t=0,r=this.getScene().meshes;t<r.length;t++){var i=r[t];if(i.subMeshes)for(var n=0,s=i.subMeshes;n<s.length;n++){var o=s[n];if(o.getMaterial(!1)===this)for(var a=0,u=o._drawWrappers;a<u.length;a++){var h=u[a];h&&h.defines&&h.defines.markAllAsDirty&&(this._materialContext===h.materialContext&&e(h.defines))}}}},e.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var e=this.getScene().enablePrePassRenderer();e&&e.markAsDirty()}},e.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(e._AllDirtyCallBack)},e.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(e._ImageProcessingDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(e._TextureDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelDirtyCallBack)},e.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._FresnelAndMiscDirtyCallBack)},e.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(e._LightsDirtyCallBack)},e.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(e._AttributeDirtyCallBack)},e.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(e._MiscDirtyCallBack)},e.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(e._TextureAndMiscDirtyCallBack)},e.prototype.setPrePassRenderer=function(e){return!1},e.prototype.dispose=function(e,t,r){var i=this.getScene();if(i.stopAnimation(this),i.freeProcessedMaterials(),i.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(Qr.Disposed,this._eventInfo),this._parentContainer){var n=this._parentContainer.materials.indexOf(this);n>-1&&this._parentContainer.materials.splice(n,1),this._parentContainer=null}if(!0!==r)if(this.meshMap)for(var s in this.meshMap){(u=this.meshMap[s])&&(u.material=null,this.releaseVertexArrayObject(u,e))}else for(var o=0,a=i.meshes;o<a.length;o++){var u;(u=a[o]).material!==this||u.sourceMesh||(u.material=null,this.releaseVertexArrayObject(u,e))}this._uniformBuffer.dispose(),e&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},e.prototype.releaseVertexArrayObject=function(e,t){if(e.geometry){var r=e.geometry;if(this._storeEffectOnSubMeshes)for(var i=0,n=e.subMeshes;i<n.length;i++){var s=n[i];r._releaseVertexArrayObject(s.effect),t&&s.effect&&s.effect.dispose()}else r._releaseVertexArrayObject(this._drawWrapper.effect)}},e.prototype.serialize=function(){var e=Mt.Serialize(this);return e.stencil=this.stencil.serialize(),e.uniqueId=this.uniqueId,e},e.Parse=function(e,t,r){if(e.customType){if("BABYLON.PBRMaterial"===e.customType&&e.overloadedAlbedo&&(e.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return T.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else e.customType="BABYLON.StandardMaterial";var i=Ve.Instantiate(e.customType).Parse(e,t,r);return i._loadedUniqueId=e.uniqueId,i},e.TriangleFillMode=0,e.WireFrameFillMode=1,e.PointFillMode=2,e.PointListDrawMode=3,e.LineListDrawMode=4,e.LineLoopDrawMode=5,e.LineStripDrawMode=6,e.TriangleStripDrawMode=7,e.TriangleFanDrawMode=8,e.ClockWiseSideOrientation=0,e.CounterClockWiseSideOrientation=1,e.TextureDirtyFlag=1,e.LightDirtyFlag=2,e.FresnelDirtyFlag=4,e.AttributesDirtyFlag=8,e.MiscDirtyFlag=16,e.PrePassDirtyFlag=32,e.AllDirtyFlag=63,e.MATERIAL_OPAQUE=0,e.MATERIAL_ALPHATEST=1,e.MATERIAL_ALPHABLEND=2,e.MATERIAL_ALPHATESTANDBLEND=3,e.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,e.MATERIAL_NORMALBLENDMETHOD_RNM=1,e.OnEventObservable=new _,e._AllDirtyCallBack=function(e){return e.markAllAsDirty()},e._ImageProcessingDirtyCallBack=function(e){return e.markAsImageProcessingDirty()},e._TextureDirtyCallBack=function(e){return e.markAsTexturesDirty()},e._FresnelDirtyCallBack=function(e){return e.markAsFresnelDirty()},e._MiscDirtyCallBack=function(e){return e.markAsMiscDirty()},e._PrePassDirtyCallBack=function(e){return e.markAsPrePassDirty()},e._LightsDirtyCallBack=function(e){return e.markAsLightDirty()},e._AttributeDirtyCallBack=function(e){return e.markAsAttributesDirty()},e._FresnelAndMiscDirtyCallBack=function(t){e._FresnelDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._TextureAndMiscDirtyCallBack=function(t){e._TextureDirtyCallBack(t),e._MiscDirtyCallBack(t)},e._DirtyCallbackArray=[],e._RunDirtyCallBacks=function(t){for(var r=0,i=e._DirtyCallbackArray;r<i.length;r++){(0,i[r])(t)}},c([mt()],e.prototype,"id",void 0),c([mt()],e.prototype,"uniqueId",void 0),c([mt()],e.prototype,"name",void 0),c([mt()],e.prototype,"metadata",void 0),c([mt()],e.prototype,"checkReadyOnEveryCall",void 0),c([mt()],e.prototype,"checkReadyOnlyOnce",void 0),c([mt()],e.prototype,"state",void 0),c([mt("alpha")],e.prototype,"_alpha",void 0),c([mt("backFaceCulling")],e.prototype,"_backFaceCulling",void 0),c([mt("cullBackFaces")],e.prototype,"_cullBackFaces",void 0),c([mt()],e.prototype,"sideOrientation",void 0),c([mt("alphaMode")],e.prototype,"_alphaMode",void 0),c([mt()],e.prototype,"_needDepthPrePass",void 0),c([mt()],e.prototype,"disableDepthWrite",void 0),c([mt()],e.prototype,"disableColorWrite",void 0),c([mt()],e.prototype,"forceDepthWrite",void 0),c([mt()],e.prototype,"depthFunction",void 0),c([mt()],e.prototype,"separateCullingPass",void 0),c([mt("fogEnabled")],e.prototype,"_fogEnabled",void 0),c([mt()],e.prototype,"pointSize",void 0),c([mt()],e.prototype,"zOffset",void 0),c([mt()],e.prototype,"zOffsetUnits",void 0),c([mt()],e.prototype,"pointsCloud",null),c([mt()],e.prototype,"fillMode",null),c([mt()],e.prototype,"transparencyMode",null),e}(),ii=function(e){function t(t,r){var i=e.call(this,t,r,!0)||this;return i._waitingSubMaterialsUniqueIds=[],i.getScene().multiMaterials.push(i),i.subMaterials=new Array,i._storeEffectOnSubMeshes=!0,i}return u(t,e),Object.defineProperty(t.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(e){this._subMaterials=e,this._hookArray(e)},enumerable:!1,configurable:!0}),t.prototype.getChildren=function(){return this.subMaterials},t.prototype._hookArray=function(e){var t=this,r=e.push;e.push=function(){for(var i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var s=r.apply(e,i);return t._markAllSubMeshesAsTexturesDirty(),s};var i=e.splice;e.splice=function(r,n){var s=i.apply(e,[r,n]);return t._markAllSubMeshesAsTexturesDirty(),s}},t.prototype.getSubMaterial=function(e){return e<0||e>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[e]},t.prototype.getActiveTextures=function(){var t;return(t=e.prototype.getActiveTextures.call(this)).concat.apply(t,this.subMaterials.map((function(e){return e?e.getActiveTextures():[]})))},t.prototype.hasTexture=function(t){var r;if(e.prototype.hasTexture.call(this,t))return!0;for(var i=0;i<this.subMaterials.length;i++)if(null===(r=this.subMaterials[i])||void 0===r?void 0:r.hasTexture(t))return!0;return!1},t.prototype.getClassName=function(){return"MultiMaterial"},t.prototype.isReadyForSubMesh=function(e,t,r){for(var i=0;i<this.subMaterials.length;i++){var n=this.subMaterials[i];if(n){if(n._storeEffectOnSubMeshes){if(!n.isReadyForSubMesh(e,t,r))return!1;continue}if(!n.isReady(e))return!1}}return!0},t.prototype.clone=function(e,r){for(var i=new t(e,this.getScene()),n=0;n<this.subMaterials.length;n++){var s=null,o=this.subMaterials[n];s=r&&o?o.clone(e+"-"+o.name):this.subMaterials[n],i.subMaterials.push(s)}return i},t.prototype.serialize=function(){var e={};e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,ze&&(e.tags=ze.GetTags(this)),e.materialsUniqueIds=[],e.materials=[];for(var t=0;t<this.subMaterials.length;t++){var r=this.subMaterials[t];r?(e.materialsUniqueIds.push(r.uniqueId),e.materials.push(r.id)):(e.materialsUniqueIds.push(null),e.materials.push(null))}return e},t.prototype.dispose=function(t,r,i){var n=this.getScene();if(n){if(i)for(var s=0;s<this.subMaterials.length;s++){var o=this.subMaterials[s];o&&o.dispose(t,r)}var a=n.multiMaterials.indexOf(this);a>=0&&n.multiMaterials.splice(a,1),e.prototype.dispose.call(this,t,r)}},t.ParseMultiMaterial=function(e,r){var i=new t(e.name,r);return i.id=e.id,i._loadedUniqueId=e.uniqueId,ze&&ze.AddTagsTo(i,e.tags),e.materialsUniqueIds?i._waitingSubMaterialsUniqueIds=e.materialsUniqueIds:e.materials.forEach((function(e){return i.subMaterials.push(r.getLastMaterialById(e))})),i},t}(ri);Le("BABYLON.MultiMaterial",ii);var ni=function(e,t){this.distanceOrScreenCoverage=e,this.mesh=t},si=function(){this.visibleInstances={},this.batchCache=new oi,this.batchCacheReplacementModeInFrozenMode=new oi,this.instancesBufferSize=2048},oi=function(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array},ai=function(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null},ui=function(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0},hi=function(e){function t(r,i,n,s,o,a){void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=null),void 0===a&&(a=!0);var u=e.call(this,r,i)||this;if(u._internalMeshDataInfo=new ui,u.delayLoadState=0,u.instances=new Array,u._creationDataStorage=null,u._geometry=null,u._instanceDataStorage=new si,u._thinInstanceDataStorage=new ai,u._shouldGenerateFlatShading=!1,u._originalBuilderSideOrientation=t.DEFAULTSIDE,u.overrideMaterialSideOrientation=null,u.ignoreCameraMaxZ=!1,i=u.getScene(),u._onBeforeDraw=function(e,t,r){e&&r&&(u._uniformBuffer?u.transferToEffect(t):r.bindOnlyWorldMatrix(t))},s){if(s._geometry&&s._geometry.applyToMesh(u),x.DeepCopy(s,u,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo"],["_poseMatrix"]),u._internalMeshDataInfo._source=s,i.useClonedMeshMap&&(s._internalMeshDataInfo.meshMap||(s._internalMeshDataInfo.meshMap={}),s._internalMeshDataInfo.meshMap[u.uniqueId]=u),u._originalBuilderSideOrientation=s._originalBuilderSideOrientation,u._creationDataStorage=s._creationDataStorage,s._ranges){var h=s._ranges;for(var c in h)Object.prototype.hasOwnProperty.call(h,c)&&h[c]&&u.createAnimationRange(c,h[c].from,h[c].to)}if(s.metadata&&s.metadata.clone?u.metadata=s.metadata.clone():u.metadata=s.metadata,ze&&ze.HasTags(s)&&ze.AddTagsTo(u,ze.GetTags(s,!0)),u.setEnabled(s.isEnabled()),u.parent=s.parent,u.setPivotMatrix(s.getPivotMatrix()),u.id=r+"."+s.id,u.material=s.material,!o)for(var l=s.getDescendants(!0),f=0;f<l.length;f++){var d=l[f];d.clone&&d.clone(r+"."+d.name,u)}if(s.morphTargetManager&&(u.morphTargetManager=s.morphTargetManager),i.getPhysicsEngine){var p=i.getPhysicsEngine();if(a&&p){var g=p.getImpostorForPhysicsObject(s);g&&(u.physicsImpostor=g.clone(u))}}for(f=0;f<i.particleSystems.length;f++){var m=i.particleSystems[f];m.emitter===s&&m.clone(m.name,u)}u.skeleton=s.skeleton,u.refreshBoundingInfo(!0,!0),u.computeWorldMatrix(!0)}return null!==n&&(u.parent=n),u._instanceDataStorage.hardwareInstancedRendering=u.getEngine().getCaps().instancedArrays,u._internalMeshDataInfo._onMeshReadyObserverAdded=function(e){e.unregisterOnNextCall=!0,u.isReady(!0)?u.onMeshReadyObservable.notifyObservers(u):u._internalMeshDataInfo._checkReadinessObserver||(u._internalMeshDataInfo._checkReadinessObserver=u._scene.onBeforeRenderObservable.add((function(){u.isReady(!0)&&(u._scene.onBeforeRenderObservable.remove(u._internalMeshDataInfo._checkReadinessObserver),u._internalMeshDataInfo._checkReadinessObserver=null,u.onMeshReadyObservable.notifyObservers(u))})))},u.onMeshReadyObservable=new _(u._internalMeshDataInfo._onMeshReadyObserverAdded),s&&s.onClonedObservable.notifyObservers(u),u}return u(t,e),t._GetDefaultSideOrientation=function(e){return e||t.FRONTSIDE},Object.defineProperty(t.prototype,"useLODScreenCoverage",{get:function(){return this._internalMeshDataInfo._useLODScreenCoverage},set:function(e){this._internalMeshDataInfo._useLODScreenCoverage=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(e){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==e&&(e&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(Rt.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(Rt.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new _),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new _),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new _),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBetweenPassObservable",{get:function(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new _),this._internalMeshDataInfo._onBetweenPassObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new _),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"onBeforeDraw",{set:function(e){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasThinInstances",{get:function(){var e;return(null!==(e=this._thinInstanceDataStorage.instancesCount)&&void 0!==e?e:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"forcedInstanceCount",{get:function(){return this._internalMeshDataInfo._forcedInstanceCount},set:function(e){this._internalMeshDataInfo._forcedInstanceCount=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(e){this._unIndexed!==e&&(this._unIndexed=e,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"previousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesPreviousData},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(e){this._instanceDataStorage.manualUpdate=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manualUpdateOfPreviousWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.previousManualUpdate},set:function(e){this._instanceDataStorage.previousManualUpdate=e},enumerable:!1,configurable:!0}),t.prototype.instantiateHierarchy=function(e,t,r){void 0===e&&(e=null);var i=!(this.getTotalVertices()>0)||t&&t.doNotInstantiate?this.clone("Clone of "+(this.name||this.id),e||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));i.parent=e||this.parent,i.position=this.position.clone(),i.scaling=this.scaling.clone(),this.rotationQuaternion?i.rotationQuaternion=this.rotationQuaternion.clone():i.rotation=this.rotation.clone(),r&&r(this,i);for(var n=0,s=this.getChildTransformNodes(!0);n<s.length;n++){s[n].instantiateHierarchy(i,t,r)}return i},t.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(t.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),t.prototype.toString=function(t){var r=e.prototype.toString.call(this,t);if(r+=", n vertices: "+this.getTotalVertices(),r+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var i=0;i<this.animations.length;i++)r+=", animation[0]: "+this.animations[i].toString(t);if(t)if(this._geometry){var n=this.getIndices(),s=this.getVerticesData(Rt.PositionKind);s&&n&&(r+=", flat shading: "+(s.length/3===n.length?"YES":"NO"))}else r+=", flat shading: UNKNOWN";return r},t.prototype._unBindEffect=function(){e.prototype._unBindEffect.call(this);for(var t=0,r=this.instances;t<r.length;t++){r[t]._unBindEffect()}},Object.defineProperty(t.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),t.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},t.prototype._sortLODLevels=function(){var e=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort((function(t,r){return t.distanceOrScreenCoverage<r.distanceOrScreenCoverage?e:t.distanceOrScreenCoverage>r.distanceOrScreenCoverage?-e:0}))},t.prototype.addLODLevel=function(e,t){if(t&&t._masterMesh)return T.Warn("You cannot use a mesh as LOD level twice"),this;var r=new ni(e,t);return this._internalMeshDataInfo._LODLevels.push(r),t&&(t._masterMesh=this),this._sortLODLevels(),this},t.prototype.getLODLevelAtDistance=function(e){for(var t=this._internalMeshDataInfo,r=0;r<t._LODLevels.length;r++){var i=t._LODLevels[r];if(i.distanceOrScreenCoverage===e)return i.mesh}return null},t.prototype.removeLODLevel=function(e){for(var t=this._internalMeshDataInfo,r=0;r<t._LODLevels.length;r++)t._LODLevels[r].mesh===e&&(t._LODLevels.splice(r,1),e&&(e._masterMesh=null));return this._sortLODLevels(),this},t.prototype.getLOD=function(e,t){var r,i=this._internalMeshDataInfo;if(!i._LODLevels||0===i._LODLevels.length)return this;t?r=t:r=this.getBoundingInfo().boundingSphere;var n=r.centerWorld.subtract(e.globalPosition).length(),s=n,o=1;if(i._useLODScreenCoverage){var a=e.screenArea,u=r.radiusWorld*e.minZ/n;s=(u=u*u*Math.PI)/a,o=-1}if(o*i._LODLevels[i._LODLevels.length-1].distanceOrScreenCoverage>o*s)return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this;for(var h=0;h<i._LODLevels.length;h++){var c=i._LODLevels[h];if(o*c.distanceOrScreenCoverage<o*s){if(c.mesh){if(4===c.mesh.delayLoadState)return c.mesh._checkDelayState(),this;if(2===c.mesh.delayLoadState)return this;c.mesh._preActivate(),c.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,c.mesh),c.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this},Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),t.prototype.getTotalVertices=function(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()},t.prototype.getVerticesData=function(e,t,r){var i,n;if(!this._geometry)return null;var s=null===(n=null===(i=this._userInstancedBuffersStorage)||void 0===i?void 0:i.vertexBuffers[e])||void 0===n?void 0:n.getFloatData(this._geometry.getTotalVertices(),r||t&&1!==this._geometry.meshes.length);return s||(s=this._geometry.getVerticesData(e,t,r)),s},t.prototype.getVertexBuffer=function(e){var t,r;return this._geometry?null!==(r=null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])&&void 0!==r?r:this._geometry.getVertexBuffer(e):null},t.prototype.isVerticesDataPresent=function(e){var t;return this._geometry?void 0!==(null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])||this._geometry.isVerticesDataPresent(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.isVertexBufferUpdatable=function(e){var t,r;return this._geometry?(null===(r=null===(t=this._userInstancedBuffersStorage)||void 0===t?void 0:t.vertexBuffers[e])||void 0===r?void 0:r.isUpdatable())||this._geometry.isVertexBufferUpdatable(e):!!this._delayInfo&&-1!==this._delayInfo.indexOf(e)},t.prototype.getVerticesDataKinds=function(){if(!this._geometry){var e=new Array;return this._delayInfo&&this._delayInfo.forEach((function(t){e.push(t)})),e}var t=this._geometry.getVerticesDataKinds();if(this._userInstancedBuffersStorage)for(var r in this._userInstancedBuffersStorage.vertexBuffers)t.push(r);return t},t.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},t.prototype.getIndices=function(e,t){return this._geometry?this._geometry.getIndices(e,t):[]},Object.defineProperty(t.prototype,"isBlocked",{get:function(){return null!==this._masterMesh&&void 0!==this._masterMesh},enumerable:!1,configurable:!0}),t.prototype.isReady=function(t,r){var i,n,s,o,a,u;if(void 0===t&&(t=!1),void 0===r&&(r=!1),2===this.delayLoadState)return!1;if(!e.prototype.isReady.call(this,t))return!1;if(!this.subMeshes||0===this.subMeshes.length)return!0;if(!t)return!0;var h=this.getEngine(),c=this.getScene(),l=r||h.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var f=this.material||c.defaultMaterial;if(f)if(f._storeEffectOnSubMeshes)for(var d=0,p=this.subMeshes;d<p.length;d++){var _=(M=p[d]).getMaterial();if(_)if(_._storeEffectOnSubMeshes){if(!_.isReadyForSubMesh(this,M,l))return!1}else if(!_.isReady(this,l))return!1}else if(!f.isReady(this,l))return!1;for(var g=h.currentRenderPassId,m=0,y=this.lightSources;m<y.length;m++){var v=y[m].getShadowGenerator();if(v&&(!(null===(i=v.getShadowMap())||void 0===i?void 0:i.renderList)||(null===(n=v.getShadowMap())||void 0===n?void 0:n.renderList)&&-1!==(null===(o=null===(s=v.getShadowMap())||void 0===s?void 0:s.renderList)||void 0===o?void 0:o.indexOf(this)))){v.getShadowMap()&&(h.currentRenderPassId=v.getShadowMap().renderPassId);for(var b=0,T=this.subMeshes;b<T.length;b++){var M=T[b];if(!v.isReady(M,l,null!==(u=null===(a=M.getMaterial())||void 0===a?void 0:a.needAlphaBlendingForMesh(this))&&void 0!==u&&u))return h.currentRenderPassId=g,!1}h.currentRenderPassId=g}}for(var x=0,E=this._internalMeshDataInfo._LODLevels;x<E.length;x++){var A=E[x];if(A.mesh&&!A.mesh.isReady(l))return!1}return!0},Object.defineProperty(t.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),t.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},t.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(t.prototype,"overridenInstanceCount",{set:function(e){this._instanceDataStorage.overridenInstanceCount=e},enumerable:!1,configurable:!0}),t.prototype._preActivate=function(){var e=this._internalMeshDataInfo,t=this.getScene().getRenderId();return e._preActivateId===t||(e._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this},t.prototype._preActivateForIntermediateRendering=function(e){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=e),this},t.prototype._registerInstanceForRenderId=function(e,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(e),this},t.prototype._afterComputeWorldMatrix=function(){e.prototype._afterComputeWorldMatrix.call(this),this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},t.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},t.prototype.refreshBoundingInfo=function(e,t){if(void 0===e&&(e=!1),void 0===t&&(t=!1),this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;var r=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(e,t),r),this},t.prototype._createGlobalSubMesh=function(e){var t=this.getTotalVertices();if(!t||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var r=this.getIndices();if(!r)return null;var i=r.length,n=!1;if(e)n=!0;else for(var s=0,o=this.subMeshes;s<o.length;s++){var a=o[s];if(a.indexStart+a.indexCount>i){n=!0;break}if(a.verticesStart+a.verticesCount>t){n=!0;break}}if(!n)return this.subMeshes[0]}return this.releaseSubMeshes(),new kt(0,0,t,0,this.getTotalIndices(),this)},t.prototype.subdivide=function(e){if(!(e<1)){for(var t=this.getTotalIndices(),r=t/e|0,i=0;r%3!==0;)r++;this.releaseSubMeshes();for(var n=0;n<e&&!(i>=t);n++)kt.CreateFromIndices(0,i,n===e-1?t-i:r,this),i+=r;this.synchronizeInstances()}},t.prototype.setVerticesData=function(e,t,r,i){if(void 0===r&&(r=!1),this._geometry)this._geometry.setVerticesData(e,t,r,i);else{var n=new It;n.set(t,e);var s=this.getScene();new Wt(Wt.RandomId(),s,n,r,this)}return this},t.prototype.removeVerticesData=function(e){this._geometry&&this._geometry.removeVerticesData(e)},t.prototype.markVerticesDataAsUpdatable=function(e,t){void 0===t&&(t=!0);var r=this.getVertexBuffer(e);r&&r.isUpdatable()!==t&&this.setVerticesData(e,this.getVerticesData(e),t)},t.prototype.setVerticesBuffer=function(e,t){return void 0===t&&(t=!0),this._geometry||(this._geometry=Wt.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(e,null,t),this},t.prototype.updateVerticesData=function(e,t,r,i){return this._geometry?(i?(this.makeGeometryUnique(),this.updateVerticesData(e,t,r,!1)):this._geometry.updateVerticesData(e,t,r),this):this},t.prototype.updateMeshPositions=function(e,t){void 0===t&&(t=!0);var r=this.getVerticesData(Rt.PositionKind);if(!r)return this;if(e(r),this.updateVerticesData(Rt.PositionKind,r,!1,!1),t){var i=this.getIndices(),n=this.getVerticesData(Rt.NormalKind);if(!n)return this;It.ComputeNormals(r,i,n),this.updateVerticesData(Rt.NormalKind,n,!1,!1)}return this},t.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;var e=this._geometry,t=this._geometry.copy(Wt.RandomId());return e.releaseForMesh(this,!0),t.applyToMesh(this),this},t.prototype.setIndices=function(e,t,r){if(void 0===t&&(t=null),void 0===r&&(r=!1),this._geometry)this._geometry.setIndices(e,t,r);else{var i=new It;i.indices=e;var n=this.getScene();new Wt(Wt.RandomId(),n,i,r,this)}return this},t.prototype.updateIndices=function(e,t,r){return void 0===r&&(r=!1),this._geometry?(this._geometry.updateIndices(e,t,r),this):this},t.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},t.prototype._bind=function(e,t,r){if(!this._geometry)return this;var i,n=this.getScene().getEngine();if(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(t),this._unIndexed)i=null;else switch(r){case ri.PointFillMode:i=null;break;case ri.WireFrameFillMode:i=e._getLinesIndexBuffer(this.getIndices(),n);break;default:case ri.TriangleFillMode:i=this._geometry.getIndexBuffer()}return!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,i):this._geometry._bind(t,i,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),this},t.prototype._draw=function(e,t,r){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var i=this.getScene().getEngine();return this._unIndexed||t==ri.PointFillMode?i.drawArraysType(t,e.verticesStart,e.verticesCount,this.forcedInstanceCount||r):t==ri.WireFrameFillMode?i.drawElementsType(t,0,e._linesIndexCount,this.forcedInstanceCount||r):i.drawElementsType(t,e.indexStart,e.indexCount,this.forcedInstanceCount||r),this},t.prototype.registerBeforeRender=function(e){return this.onBeforeRenderObservable.add(e),this},t.prototype.unregisterBeforeRender=function(e){return this.onBeforeRenderObservable.removeCallback(e),this},t.prototype.registerAfterRender=function(e){return this.onAfterRenderObservable.add(e),this},t.prototype.unregisterAfterRender=function(e){return this.onAfterRenderObservable.removeCallback(e),this},t.prototype._getInstancesRenderList=function(e,t){if(void 0===t&&(t=!1),this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[e]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[e]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}var r=this.getScene(),i=r._isInIntermediateRendering(),n=i?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,s=this._instanceDataStorage.batchCache;if(s.mustReturn=!1,s.renderSelf[e]=t||!n&&this.isEnabled()&&this.isVisible,s.visibleInstances[e]=null,this._instanceDataStorage.visibleInstances&&!t){var o=this._instanceDataStorage.visibleInstances,a=r.getRenderId(),u=i?o.intermediateDefaultRenderId:o.defaultRenderId;s.visibleInstances[e]=o[a],!s.visibleInstances[e]&&u&&(s.visibleInstances[e]=o[u])}return s.hardwareInstancedRendering[e]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==s.visibleInstances[e]&&void 0!==s.visibleInstances[e],this._instanceDataStorage.previousBatch=s,s},t.prototype._renderWithInstances=function(e,r,i,n,s){var o,a=i.visibleInstances[e._id];if(!a)return this;for(var u=this._instanceDataStorage,h=u.instancesBufferSize,c=u.instancesBuffer,l=u.instancesPreviousBuffer,f=16*(a.length+1)*4;u.instancesBufferSize<f;)u.instancesBufferSize*=2;u.instancesData&&h==u.instancesBufferSize||(u.instancesData=new Float32Array(u.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!u.instancesPreviousData||h!=u.instancesBufferSize)&&(u.instancesPreviousData=new Float32Array(u.instancesBufferSize/4));var d=0,p=0,_=i.renderSelf[e._id],g=!c||h!==u.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!u.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||u.isFrozen&&!g)p=(_?1:0)+a.length;else{var m=this.getWorldMatrix();if(_&&(this._scene.needsPreviousWorldMatrices&&(u.masterMeshPreviousWorldMatrix?(u.masterMeshPreviousWorldMatrix.copyToArray(u.instancesPreviousData,d),u.masterMeshPreviousWorldMatrix.copyFrom(m)):(u.masterMeshPreviousWorldMatrix=m.clone(),u.masterMeshPreviousWorldMatrix.copyToArray(u.instancesPreviousData,d))),m.copyToArray(u.instancesData,d),d+=16,p++),a){if(t.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&(null===(o=e.getMaterial())||void 0===o?void 0:o.needAlphaBlendingForMesh(e.getRenderingMesh()))){for(var y=this._scene.activeCamera.globalPosition,v=0;v<a.length;v++){var b=a[v];b._distanceToCamera=tt.Distance(b.getBoundingInfo().boundingSphere.centerWorld,y)}a.sort((function(e,t){return e._distanceToCamera>t._distanceToCamera?-1:e._distanceToCamera<t._distanceToCamera?1:0}))}for(v=0;v<a.length;v++){var T=a[v],M=T.getWorldMatrix();M.copyToArray(u.instancesData,d),this._scene.needsPreviousWorldMatrices&&(T._previousWorldMatrix?(T._previousWorldMatrix.copyToArray(u.instancesPreviousData,d),T._previousWorldMatrix.copyFrom(M)):(T._previousWorldMatrix=M.clone(),T._previousWorldMatrix.copyToArray(u.instancesPreviousData,d))),d+=16,p++}}}return g?(c&&c.dispose(),l&&l.dispose(),c=new Pt(s,u.instancesData,!0,16,!1,!0),u.instancesBuffer=c,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=c.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=c.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=c.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=c.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(l=new Pt(s,u.instancesPreviousData,!0,16,!1,!0),u.instancesPreviousBuffer=l,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=l.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=l.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=l.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=l.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen||(c.updateDirectly(u.instancesData,0,p),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||l.updateDirectly(u.instancesPreviousData,0,p)),this._processInstancedBuffers(a,_),this.getScene()._activeIndices.addCount(e.indexCount*p,!1),s._currentDrawContext&&(s._currentDrawContext.useInstancing=!0),this._bind(e,n,r),this._draw(e,r,p),!this._scene.needsPreviousWorldMatrices||g||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen||this._instanceDataStorage.previousManualUpdate||l.updateDirectly(u.instancesData,0,p),s.unbindInstanceAttributes(),this},t.prototype._renderWithThinInstances=function(e,t,r,i){var n,s,o=null!==(s=null===(n=this._thinInstanceDataStorage)||void 0===n?void 0:n.instancesCount)&&void 0!==s?s:0;this.getScene()._activeIndices.addCount(e.indexCount*o,!1),i._currentDrawContext&&(i._currentDrawContext.useInstancing=!0),this._bind(e,r,t),this._draw(e,t,o),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,o):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),i.unbindInstanceAttributes()},t.prototype._processInstancedBuffers=function(e,t){},t.prototype._processRendering=function(e,t,r,i,n,s,o,a){var u=this.getScene(),h=u.getEngine();if(s&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,i,r,h),this;if(s)this._renderWithInstances(t,i,n,r,h);else{h._currentDrawContext&&(h._currentDrawContext.useInstancing=!1);var c=0;n.renderSelf[t._id]&&(o&&o(!1,e.getWorldMatrix(),a),c++,this._draw(t,i,this._instanceDataStorage.overridenInstanceCount));var l=n.visibleInstances[t._id];if(l){var f=l.length;c+=f;for(var d=0;d<f;d++){var p=l[d].getWorldMatrix();o&&o(!0,p,a),this._draw(t,i)}}u._activeIndices.addCount(t.indexCount*c,!1)}return this},t.prototype._rebuild=function(t){if(void 0===t&&(t=!1),this._instanceDataStorage.instancesBuffer&&(t&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(var r in this._userInstancedBuffersStorage.vertexBuffers){var i=this._userInstancedBuffersStorage.vertexBuffers[r];i&&(t&&i.dispose(),this._userInstancedBuffersStorage.vertexBuffers[r]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,e.prototype._rebuild.call(this,t)},t.prototype._freeze=function(){if(this.subMeshes){for(var e=0;e<this.subMeshes.length;e++)this._getInstancesRenderList(e);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},t.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},t.prototype.render=function(e,t,r){var i,n,s,o=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;var a=this._getInstancesRenderList(e._id,!!r);if(a.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var u=o.getEngine(),h=0,c=null;this.ignoreCameraMaxZ&&o.activeCamera&&!o._isInIntermediateRendering()&&(h=o.activeCamera.maxZ,c=o.activeCamera,o.activeCamera.maxZ=0,o.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var l,f=a.hardwareInstancedRendering[e._id]||e.getRenderingMesh().hasThinInstances,d=this._instanceDataStorage,p=e.getMaterial();if(!p)return c&&(c.maxZ=h,o.updateTransformMatrix(!0)),this;if(d.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===p){if(p._storeEffectOnSubMeshes&&!(null===(i=e.effect)||void 0===i?void 0:i._wasPreviouslyReady)||!p._storeEffectOnSubMeshes&&!(null===(n=p.getEffect())||void 0===n?void 0:n._wasPreviouslyReady))return c&&(c.maxZ=h,o.updateTransformMatrix(!0)),this}else{if(p._storeEffectOnSubMeshes){if(!p.isReadyForSubMesh(this,e,f))return c&&(c.maxZ=h,o.updateTransformMatrix(!0)),this}else if(!p.isReady(this,f))return c&&(c.maxZ=h,o.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=p}t&&u.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode);for(var _=null!==(s=null===(l=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?e._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper())||void 0===l?void 0:l.effect)&&void 0!==s?s:null,g=0,m=o._beforeRenderingMeshStage;g<m.length;g++){m[g].action(this,e,a,_)}if(!l||!_)return c&&(c.maxZ=h,o.updateTransformMatrix(!0)),this;var y,v=r||this;if(d.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.backFaceCulling&&null===this.overrideMaterialSideOrientation)y=d.sideOrientation;else{var b=v._getWorldMatrixDeterminant();null==(y=this.overrideMaterialSideOrientation)&&(y=this._internalMeshDataInfo._effectiveMaterial.sideOrientation),b<0&&(y=y===ri.ClockWiseSideOrientation?ri.CounterClockWiseSideOrientation:ri.ClockWiseSideOrientation),d.sideOrientation=y}var T=this._internalMeshDataInfo._effectiveMaterial._preBind(l,y);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&u.setDepthWrite(!0);var M=o.forcePointsCloud?ri.PointFillMode:o.forceWireframe?ri.WireFrameFillMode:this._internalMeshDataInfo._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),f||this._bind(e,_,M);var x=this._internalMeshDataInfo._effectiveMaterial,E=v.getWorldMatrix();x._storeEffectOnSubMeshes?x.bindForSubMesh(E,this,e):x.bind(E,this),!x.backFaceCulling&&x.separateCullingPass&&(u.setState(!0,x.zOffset,!1,!T,x.cullBackFaces,x.stencil,x.zOffsetUnits),this._processRendering(this,e,_,M,a,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),u.setState(!0,x.zOffset,!1,T,x.cullBackFaces,x.stencil,x.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(e)),this._processRendering(this,e,_,M,a,f,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(var A=0,P=o._afterRenderingMeshStage;A<P.length;A++){P[A].action(this,e,a,_)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),c&&(c.maxZ=h,o.updateTransformMatrix(!0)),this},t.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(Rt.MatricesWeightsKind)&&(this.isVerticesDataPresent(Rt.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())},t.prototype._normalizeSkinFourWeights=function(){for(var e=this.getVerticesData(Rt.MatricesWeightsKind),t=e.length,r=0;r<t;r+=4){var i=e[r]+e[r+1]+e[r+2]+e[r+3];if(0===i)e[r]=1;else{var n=1/i;e[r]*=n,e[r+1]*=n,e[r+2]*=n,e[r+3]*=n}}this.setVerticesData(Rt.MatricesWeightsKind,e)},t.prototype._normalizeSkinWeightsAndExtra=function(){for(var e=this.getVerticesData(Rt.MatricesWeightsExtraKind),t=this.getVerticesData(Rt.MatricesWeightsKind),r=t.length,i=0;i<r;i+=4){var n=t[i]+t[i+1]+t[i+2]+t[i+3];if(0===(n+=e[i]+e[i+1]+e[i+2]+e[i+3]))t[i]=1;else{var s=1/n;t[i]*=s,t[i+1]*=s,t[i+2]*=s,t[i+3]*=s,e[i]*=s,e[i+1]*=s,e[i+2]*=s,e[i+3]*=s}}this.setVerticesData(Rt.MatricesWeightsKind,t),this.setVerticesData(Rt.MatricesWeightsKind,e)},t.prototype.validateSkinning=function(){var e=this.getVerticesData(Rt.MatricesWeightsExtraKind),t=this.getVerticesData(Rt.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,report:"not skinned"};for(var r=t.length,i=0,n=0,s=0,o=0,a=null===e?4:8,u=new Array,h=0;h<=a;h++)u[h]=0;for(h=0;h<r;h+=4){for(var c=t[h],l=c,f=0===l?0:1,d=1;d<a;d++){var p=d<4?t[h+d]:e[h+d-4];p>c&&i++,0!==p&&f++,l+=p,c=p}if(u[f]++,f>s&&(s=f),0===l)n++;else{var _=1/l,g=0;for(d=0;d<a;d++)g+=d<4?Math.abs(t[h+d]-t[h+d]*_):Math.abs(e[h+d-4]-e[h+d-4]*_);g>.001&&o++}}var m=this.skeleton.bones.length,y=this.getVerticesData(Rt.MatricesIndicesKind),v=this.getVerticesData(Rt.MatricesIndicesExtraKind),b=0;for(h=0;h<r;h+=4)for(d=0;d<a;d++){var T=d<4?y[h+d]:v[h+d-4];(T>=m||T<0)&&b++}return{skinned:!0,valid:0===n&&0===o&&0===b,report:"Number of Weights = "+r/4+"\\nMaximum influences = "+s+"\\nMissing Weights = "+n+"\\nNot Sorted = "+i+"\\nNot Normalized = "+o+"\\nWeightCounts = ["+u+"]\\nNumber of bones = "+m+"\\nBad Bone Indices = "+b}},t.prototype._checkDelayState=function(){var e=this.getScene();return this._geometry?this._geometry.load(e):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(e)),this},t.prototype._queueLoad=function(e){var t=this;e._addPendingData(this);var r=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return Ve.LoadFile(this.delayLoadingFile,(function(r){r instanceof ArrayBuffer?t._delayLoadingFunction(r,t):t._delayLoadingFunction(JSON.parse(r),t),t.instances.forEach((function(e){e.refreshBoundingInfo(),e._syncSubMeshes()})),t.delayLoadState=1,e._removePendingData(t)}),(function(){}),e.offlineProvider,r),this},t.prototype.isInFrustum=function(t){return 2!==this.delayLoadState&&(!!e.prototype.isInFrustum.call(this,t)&&(this._checkDelayState(),!0))},t.prototype.setMaterialById=function(e){var t,r=this.getScene().materials;for(t=r.length-1;t>-1;t--)if(r[t].id===e)return this.material=r[t],this;var i=this.getScene().multiMaterials;for(t=i.length-1;t>-1;t--)if(i[t].id===e)return this.material=i[t],this;return this},t.prototype.getAnimatables=function(){var e=new Array;return this.material&&e.push(this.material),this.skeleton&&e.push(this.skeleton),e},t.prototype.bakeTransformIntoVertices=function(e){if(!this.isVerticesDataPresent(Rt.PositionKind))return this;var t=this.subMeshes.splice(0);this._resetPointsArrayCache();var r,i=this.getVerticesData(Rt.PositionKind),n=new Array;for(r=0;r<i.length;r+=3)tt.TransformCoordinates(tt.FromArray(i,r),e).toArray(n,r);if(this.setVerticesData(Rt.PositionKind,n,this.getVertexBuffer(Rt.PositionKind).isUpdatable()),this.isVerticesDataPresent(Rt.NormalKind)){for(i=this.getVerticesData(Rt.NormalKind),n=[],r=0;r<i.length;r+=3)tt.TransformNormal(tt.FromArray(i,r),e).normalize().toArray(n,r);this.setVerticesData(Rt.NormalKind,n,this.getVertexBuffer(Rt.NormalKind).isUpdatable())}return e.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=t,this},t.prototype.bakeCurrentTransformIntoVertices=function(e){return void 0===e&&(e=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(e),this},Object.defineProperty(t.prototype,"_positions",{get:function(){return this._internalAbstractMeshDataInfo._positions?this._internalAbstractMeshDataInfo._positions:this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),t.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},t.prototype._generatePointsArray=function(){return!!this._geometry&&this._geometry._generatePointsArray()},t.prototype.clone=function(e,r,i,n){return void 0===e&&(e=""),void 0===r&&(r=null),void 0===n&&(n=!0),new t(e,this.getScene(),r,this,i,n)},t.prototype.dispose=function(t,r){void 0===r&&(r=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var i=this._internalMeshDataInfo;if(i._onBeforeDrawObservable&&i._onBeforeDrawObservable.clear(),i._onBeforeBindObservable&&i._onBeforeBindObservable.clear(),i._onBeforeRenderObservable&&i._onBeforeRenderObservable.clear(),i._onAfterRenderObservable&&i._onAfterRenderObservable.clear(),i._onBetweenPassObservable&&i._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(i.meshMap)for(var n in i.meshMap){(a=i.meshMap[n])&&(a._internalMeshDataInfo._source=null,i.meshMap[n]=void 0)}i._source&&i._source._internalMeshDataInfo.meshMap&&(i._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var s=0,o=this.getScene().meshes;s<o.length;s++){var a;(a=o[s])._internalMeshDataInfo&&a._internalMeshDataInfo._source&&a._internalMeshDataInfo._source===this&&(a._internalMeshDataInfo._source=null)}i._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),e.prototype.dispose.call(this,t,r)},t.prototype._disposeInstanceSpecificData=function(){},t.prototype._disposeThinInstanceSpecificData=function(){},t.prototype._invalidateInstanceVertexArrayObject=function(){},t.prototype.applyDisplacementMap=function(e,t,r,i,n,s,o){var a=this;void 0===o&&(o=!1);var u=this.getScene();return Ve.LoadImage(e,(function(e){var u=e.width,h=e.height,c=a.getEngine().createCanvas(u,h).getContext("2d");c.drawImage(e,0,0);var l=c.getImageData(0,0,u,h).data;a.applyDisplacementMapFromBuffer(l,u,h,t,r,n,s,o),i&&i(a)}),(function(){}),u.offlineProvider),this},t.prototype.applyDisplacementMapFromBuffer=function(e,t,r,i,n,s,o,a){if(void 0===a&&(a=!1),!this.isVerticesDataPresent(Rt.PositionKind)||!this.isVerticesDataPresent(Rt.NormalKind)||!this.isVerticesDataPresent(Rt.UVKind))return T.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var u=this.getVerticesData(Rt.PositionKind,!0,!0),h=this.getVerticesData(Rt.NormalKind),c=this.getVerticesData(Rt.UVKind),l=tt.Zero(),f=tt.Zero(),d=et.Zero();s=s||et.Zero(),o=o||new et(1,1);for(var p=0;p<u.length;p+=3){tt.FromArrayToRef(u,p,l),tt.FromArrayToRef(h,p,f),et.FromArrayToRef(c,p/3*2,d);var _=4*((Math.abs(d.x*o.x+s.x%1)*(t-1)%t|0)+(Math.abs(d.y*o.y+s.y%1)*(r-1)%r|0)*t),g=.3*(e[_]/255)+.59*(e[_+1]/255)+.11*(e[_+2]/255);f.normalize(),f.scaleInPlace(i+(n-i)*g),(l=l.add(f)).toArray(u,p)}return It.ComputeNormals(u,this.getIndices(),h),a?(this.setVerticesData(Rt.PositionKind,u),this.setVerticesData(Rt.NormalKind,h),this.setVerticesData(Rt.UVKind,c)):(this.updateVerticesData(Rt.PositionKind,u),this.updateVerticesData(Rt.NormalKind,h)),this},t.prototype.convertToFlatShadedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},n={},s={},o=!1;for(e=0;e<r.length;e++){t=r[e];var a=this.getVertexBuffer(t),u=a.getData();(u instanceof Array||u instanceof Float32Array)&&0===u.length||(t!==Rt.NormalKind?(i[t]=a,n[t]=this.getVerticesData(t),s[t]=[]):(o=a.isUpdatable(),r.splice(e,1),e--))}var h,c=this.subMeshes.slice(0),l=this.getIndices(),f=this.getTotalIndices();for(h=0;h<f;h++){var d=l[h];for(e=0;e<r.length;e++)if(i[t=r[e]])for(var p=i[t].getStrideSize(),_=0;_<p;_++)s[t].push(n[t][d*p+_])}var g,m=[],y=s[Rt.PositionKind];for(g=this.getScene().useRightHandedSystem?1===this.overrideMaterialSideOrientation:0===this.overrideMaterialSideOrientation,h=0;h<f;h+=3){l[h]=h,l[h+1]=h+1,l[h+2]=h+2;var v=tt.FromArray(y,3*h),b=tt.FromArray(y,3*(h+1)),T=tt.FromArray(y,3*(h+2)),M=v.subtract(b),x=T.subtract(b),E=tt.Normalize(tt.Cross(M,x));g&&E.scaleInPlace(-1);for(var A=0;A<3;A++)m.push(E.x),m.push(E.y),m.push(E.z)}for(this.setIndices(l),this.setVerticesData(Rt.NormalKind,m,o),e=0;e<r.length;e++)s[t=r[e]]&&this.setVerticesData(t,s[t],i[t].isUpdatable());this.releaseSubMeshes();for(var P=0;P<c.length;P++){var R=c[P];kt.AddToMesh(R.materialIndex,R.indexStart,R.indexCount,R.indexStart,R.indexCount,this)}return this.synchronizeInstances(),this},t.prototype.convertToUnIndexedMesh=function(){var e,t,r=this.getVerticesDataKinds(),i={},n={},s={};for(e=0;e<r.length;e++){t=r[e];var o=this.getVertexBuffer(t);i[t]=o,n[t]=i[t].getData(),s[t]=[]}var a,u=this.subMeshes.slice(0),h=this.getIndices(),c=this.getTotalIndices();for(a=0;a<c;a++){var l=h[a];for(e=0;e<r.length;e++)for(var f=i[t=r[e]].getStrideSize(),d=0;d<f;d++)s[t].push(n[t][l*f+d])}for(a=0;a<c;a+=3)h[a]=a,h[a+1]=a+1,h[a+2]=a+2;for(this.setIndices(h),e=0;e<r.length;e++)t=r[e],this.setVerticesData(t,s[t],i[t].isUpdatable(),i[t].getStrideSize());this.releaseSubMeshes();for(var p=0;p<u.length;p++){var _=u[p];kt.AddToMesh(_.materialIndex,_.indexStart,_.indexCount,_.indexStart,_.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},t.prototype.flipFaces=function(e){void 0===e&&(e=!1);var t,r=It.ExtractFromMesh(this);if(e&&this.isVerticesDataPresent(Rt.NormalKind)&&r.normals)for(t=0;t<r.normals.length;t++)r.normals[t]*=-1;if(r.indices){var i=void 0;for(t=0;t<r.indices.length;t+=3)i=r.indices[t+1],r.indices[t+1]=r.indices[t+2],r.indices[t+2]=i}return r.applyToMesh(this,this.isVertexBufferUpdatable(Rt.PositionKind)),this},t.prototype.increaseVertices=function(e){void 0===e&&(e=1);var t=It.ExtractFromMesh(this),r=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,i=t.positions&&!Array.isArray(t.positions)&&Array.from?Array.from(t.positions):t.positions,n=t.uvs&&!Array.isArray(t.uvs)&&Array.from?Array.from(t.uvs):t.uvs,s=t.normals&&!Array.isArray(t.normals)&&Array.from?Array.from(t.normals):t.normals;if(r&&i){t.indices=r,t.positions=i,n&&(t.uvs=n),s&&(t.normals=s);for(var o=e+1,a=new Array,u=0;u<o+1;u++)a[u]=new Array;var h=void 0,c=void 0,l=new tt(0,0,0),f=new tt(0,0,0),d=new et(0,0),p=new Array,_=new Array,g=new Array,m=void 0,y=i.length,v=void 0;n&&(v=n.length);var b=void 0;s&&(b=s.length);for(u=0;u<r.length;u+=3){_[0]=r[u],_[1]=r[u+1],_[2]=r[u+2];for(var M=0;M<3;M++)if(h=_[M],c=_[(M+1)%3],void 0===g[h]&&void 0===g[c]?(g[h]=new Array,g[c]=new Array):(void 0===g[h]&&(g[h]=new Array),void 0===g[c]&&(g[c]=new Array)),void 0===g[h][c]&&void 0===g[c][h]){g[h][c]=[],l.x=(i[3*c]-i[3*h])/o,l.y=(i[3*c+1]-i[3*h+1])/o,l.z=(i[3*c+2]-i[3*h+2])/o,s&&(f.x=(s[3*c]-s[3*h])/o,f.y=(s[3*c+1]-s[3*h+1])/o,f.z=(s[3*c+2]-s[3*h+2])/o),n&&(d.x=(n[2*c]-n[2*h])/o,d.y=(n[2*c+1]-n[2*h+1])/o),g[h][c].push(h);for(var x=1;x<o;x++)g[h][c].push(i.length/3),i[y++]=i[3*h]+x*l.x,i[y++]=i[3*h+1]+x*l.y,i[y++]=i[3*h+2]+x*l.z,s&&(s[b++]=s[3*h]+x*f.x,s[b++]=s[3*h+1]+x*f.y,s[b++]=s[3*h+2]+x*f.z),n&&(n[v++]=n[2*h]+x*d.x,n[v++]=n[2*h+1]+x*d.y);g[h][c].push(c),g[c][h]=new Array,m=g[h][c].length;for(var E=0;E<m;E++)g[c][h][E]=g[h][c][m-1-E]}a[0][0]=r[u],a[1][0]=g[r[u]][r[u+1]][1],a[1][1]=g[r[u]][r[u+2]][1];for(x=2;x<o;x++){a[x][0]=g[r[u]][r[u+1]][x],a[x][x]=g[r[u]][r[u+2]][x],l.x=(i[3*a[x][x]]-i[3*a[x][0]])/x,l.y=(i[3*a[x][x]+1]-i[3*a[x][0]+1])/x,l.z=(i[3*a[x][x]+2]-i[3*a[x][0]+2])/x,s&&(f.x=(s[3*a[x][x]]-s[3*a[x][0]])/x,f.y=(s[3*a[x][x]+1]-s[3*a[x][0]+1])/x,f.z=(s[3*a[x][x]+2]-s[3*a[x][0]+2])/x),n&&(d.x=(n[2*a[x][x]]-n[2*a[x][0]])/x,d.y=(n[2*a[x][x]+1]-n[2*a[x][0]+1])/x);for(M=1;M<x;M++)a[x][M]=i.length/3,i[y++]=i[3*a[x][0]]+M*l.x,i[y++]=i[3*a[x][0]+1]+M*l.y,i[y++]=i[3*a[x][0]+2]+M*l.z,s&&(s[b++]=s[3*a[x][0]]+M*f.x,s[b++]=s[3*a[x][0]+1]+M*f.y,s[b++]=s[3*a[x][0]+2]+M*f.z),n&&(n[v++]=n[2*a[x][0]]+M*d.x,n[v++]=n[2*a[x][0]+1]+M*d.y)}a[o]=g[r[u+1]][r[u+2]],p.push(a[0][0],a[1][0],a[1][1]);for(x=1;x<o;x++){M=void 0;for(M=0;M<x;M++)p.push(a[x][M],a[x+1][M],a[x+1][M+1]),p.push(a[x][M],a[x+1][M+1],a[x][M+1]);p.push(a[x][M],a[x+1][M],a[x+1][M+1])}}t.indices=p,t.applyToMesh(this,this.isVertexBufferUpdatable(Rt.PositionKind))}else T.Warn("Couldn\'t increase number of vertices : VertexData must contain at least indices and positions")},t.prototype.forceSharedVertices=function(){var e=It.ExtractFromMesh(this),t=e.uvs,r=e.indices,i=e.positions,n=e.colors;if(void 0===r||void 0===i||null===r||null===i)T.Warn("VertexData contains empty entries");else{for(var s=new Array,o=new Array,a=new Array,u=new Array,h=new Array,c=0,l={},f=void 0,d=void 0,p=0;p<r.length;p+=3){d=[r[p],r[p+1],r[p+2]],h=new Array;for(var _=0;_<3;_++){h[_]="";for(var g=0;g<3;g++)Math.abs(i[3*d[_]+g])<1e-8&&(i[3*d[_]+g]=0),h[_]+=i[3*d[_]+g]+"|"}if(h[0]!=h[1]&&h[0]!=h[2]&&h[1]!=h[2])for(_=0;_<3;_++){if(void 0===(f=l[h[_]])){l[h[_]]=c,f=c++;for(g=0;g<3;g++)s.push(i[3*d[_]+g]);if(null!==n&&void 0!==n)for(g=0;g<4;g++)u.push(n[4*d[_]+g]);if(null!==t&&void 0!==t)for(g=0;g<2;g++)a.push(t[2*d[_]+g])}o.push(f)}}var m=new Array;It.ComputeNormals(s,o,m),e.positions=s,e.indices=o,e.normals=m,null!==t&&void 0!==t&&(e.uvs=a),null!==n&&void 0!==n&&(e.colors=u),e.applyToMesh(this,this.isVertexBufferUpdatable(Rt.PositionKind))}},t._instancedMeshFactory=function(e,t){throw A("InstancedMesh")},t._PhysicsImpostorParser=function(e,t,r){throw A("PhysicsImpostor")},t.prototype.createInstance=function(e){return t._instancedMeshFactory(e,this)},t.prototype.synchronizeInstances=function(){for(var e=0;e<this.instances.length;e++){this.instances[e]._syncSubMeshes()}return this},t.prototype.optimizeIndices=function(e){var t=this,r=this.getIndices(),i=this.getVerticesData(Rt.PositionKind);if(!i||!r)return this;for(var n=new Array,s=0;s<i.length;s+=3)n.push(tt.FromArray(i,s));var o=new Array;return Ge.SyncAsyncForLoop(n.length,40,(function(e){for(var t=n.length-1-e,r=n[t],i=0;i<t;++i){var s=n[i];if(r.equals(s)){o[t]=i;break}}}),(function(){for(var i=0;i<r.length;++i)r[i]=o[r[i]]||r[i];var n=t.subMeshes.slice(0);t.setIndices(r),t.subMeshes=n,e&&e(t)})),this},t.prototype.serialize=function(e){e.name=this.name,e.id=this.id,e.uniqueId=this.uniqueId,e.type=this.getClassName(),ze&&ze.HasTags(this)&&(e.tags=ze.GetTags(this)),e.position=this.position.asArray(),this.rotationQuaternion?e.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(e.rotation=this.rotation.asArray()),e.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?e.pivotMatrix=this.getPivotMatrix().asArray():e.localMatrix=this.getPivotMatrix().asArray(),e.isEnabled=this.isEnabled(!1),e.isVisible=this.isVisible,e.infiniteDistance=this.infiniteDistance,e.pickable=this.isPickable,e.receiveShadows=this.receiveShadows,e.billboardMode=this.billboardMode,e.visibility=this.visibility,e.checkCollisions=this.checkCollisions,e.isBlocker=this.isBlocker,e.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&this.parent._serializeAsParent(e),e.isUnIndexed=this.isUnIndexed;var t=this._geometry;if(t&&this.subMeshes){e.geometryUniqueId=t.uniqueId,e.geometryId=t.id,e.subMeshes=[];for(var r=0;r<this.subMeshes.length;r++){var i=this.subMeshes[r];e.subMeshes.push({materialIndex:i.materialIndex,verticesStart:i.verticesStart,verticesCount:i.verticesCount,indexStart:i.indexStart,indexCount:i.indexCount})}}(this.material?this.material.doNotSerialize||(e.materialUniqueId=this.material.uniqueId,e.materialId=this.material.id):(this.material=null,e.materialUniqueId=this._scene.defaultMaterial.uniqueId,e.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(e.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(e.skeletonId=this.skeleton.id,e.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(Rr.NAME_PHYSICSENGINE))&&((o=this.getPhysicsImpostor())&&(e.physicsMass=o.getParam("mass"),e.physicsFriction=o.getParam("friction"),e.physicsRestitution=o.getParam("mass"),e.physicsImpostor=o.type));this.metadata&&(e.metadata=this.metadata),e.instances=[];for(var n=0;n<this.instances.length;n++){var s=this.instances[n];if(!s.doNotSerialize){var o,a={name:s.name,id:s.id,isEnabled:s.isEnabled(!1),isVisible:s.isVisible,isPickable:s.isPickable,checkCollisions:s.checkCollisions,position:s.position.asArray(),scaling:s.scaling.asArray()};if(s.parent&&s.parent._serializeAsParent(a),s.rotationQuaternion?a.rotationQuaternion=s.rotationQuaternion.asArray():s.rotation&&(a.rotation=s.rotation.asArray()),this.getScene()._getComponent(Rr.NAME_PHYSICSENGINE))(o=s.getPhysicsImpostor())&&(a.physicsMass=o.getParam("mass"),a.physicsFriction=o.getParam("friction"),a.physicsRestitution=o.getParam("mass"),a.physicsImpostor=o.type);s.metadata&&(a.metadata=s.metadata),e.instances.push(a),Mt.AppendSerializedAnimations(s,a),a.ranges=s.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(e.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){var u={data:{},sizes:{},strides:{}};for(var h in this._userThinInstanceBuffersStorage.data)u.data[h]=Array.from(this._userThinInstanceBuffersStorage.data[h]),u.sizes[h]=this._userThinInstanceBuffersStorage.sizes[h],u.strides[h]=this._userThinInstanceBuffersStorage.strides[h];e.thinInstances.userThinInstance=u}Mt.AppendSerializedAnimations(this,e),e.ranges=this.serializeAnimationRanges(),e.layerMask=this.layerMask,e.alphaIndex=this.alphaIndex,e.hasVertexAlpha=this.hasVertexAlpha,e.overlayAlpha=this.overlayAlpha,e.overlayColor=this.overlayColor.asArray(),e.renderOverlay=this.renderOverlay,e.applyFog=this.applyFog,this.actionManager&&(e.actions=this.actionManager.serialize(this.name))},t.prototype._syncGeometryWithMorphTargetManager=function(){if(this.geometry){this._markSubMeshesAsAttributesDirty();var e=this._internalAbstractMeshDataInfo._morphTargetManager;if(e&&e.vertexCount){if(e.vertexCount!==this.getTotalVertices())return T.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(e.isUsingTextureForTargets)return;for(var t=0;t<e.numInfluencers;t++){var r=e.getActiveTarget(t),i=r.getPositions();if(!i)return void T.Error("Invalid morph target. Target must have positions.");this.geometry.setVerticesData(Rt.PositionKind+t,i,!1,3);var n=r.getNormals();n&&this.geometry.setVerticesData(Rt.NormalKind+t,n,!1,3);var s=r.getTangents();s&&this.geometry.setVerticesData(Rt.TangentKind+t,s,!1,3);var o=r.getUVs();o&&this.geometry.setVerticesData(Rt.UVKind+"_"+t,o,!1,2)}}else for(t=0;this.geometry.isVerticesDataPresent(Rt.PositionKind+t);)this.geometry.removeVerticesData(Rt.PositionKind+t),this.geometry.isVerticesDataPresent(Rt.NormalKind+t)&&this.geometry.removeVerticesData(Rt.NormalKind+t),this.geometry.isVerticesDataPresent(Rt.TangentKind+t)&&this.geometry.removeVerticesData(Rt.TangentKind+t),this.geometry.isVerticesDataPresent(Rt.UVKind+t)&&this.geometry.removeVerticesData(Rt.UVKind+"_"+t),t++}},t.Parse=function(e,r,i){var n;if((n=e.type&&"LinesMesh"===e.type?t._LinesMeshParser(e,r):e.type&&"GroundMesh"===e.type?t._GroundMeshParser(e,r):e.type&&"GoldbergMesh"===e.type?t._GoldbergMeshParser(e,r):new t(e.name,r)).id=e.id,ze&&ze.AddTagsTo(n,e.tags),n.position=tt.FromArray(e.position),void 0!==e.metadata&&(n.metadata=e.metadata),e.rotationQuaternion?n.rotationQuaternion=it.FromArray(e.rotationQuaternion):e.rotation&&(n.rotation=tt.FromArray(e.rotation)),n.scaling=tt.FromArray(e.scaling),e.localMatrix?n.setPreTransformMatrix(nt.FromArray(e.localMatrix)):e.pivotMatrix&&n.setPivotMatrix(nt.FromArray(e.pivotMatrix)),n.setEnabled(e.isEnabled),n.isVisible=e.isVisible,n.infiniteDistance=e.infiniteDistance,n.showBoundingBox=e.showBoundingBox,n.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox,void 0!==e.applyFog&&(n.applyFog=e.applyFog),void 0!==e.pickable&&(n.isPickable=e.pickable),void 0!==e.alphaIndex&&(n.alphaIndex=e.alphaIndex),n.receiveShadows=e.receiveShadows,n.billboardMode=e.billboardMode,void 0!==e.visibility&&(n.visibility=e.visibility),n.checkCollisions=e.checkCollisions,n.overrideMaterialSideOrientation=e.overrideMaterialSideOrientation,void 0!==e.isBlocker&&(n.isBlocker=e.isBlocker),n._shouldGenerateFlatShading=e.useFlatShading,e.freezeWorldMatrix&&(n._waitingData.freezeWorldMatrix=e.freezeWorldMatrix),void 0!==e.parentId&&(n._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(n._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.actions&&(n._waitingData.actions=e.actions),void 0!==e.overlayAlpha&&(n.overlayAlpha=e.overlayAlpha),void 0!==e.overlayColor&&(n.overlayColor=ut.FromArray(e.overlayColor)),void 0!==e.renderOverlay&&(n.renderOverlay=e.renderOverlay),n.isUnIndexed=!!e.isUnIndexed,n.hasVertexAlpha=e.hasVertexAlpha,e.delayLoadingFile?(n.delayLoadState=4,n.delayLoadingFile=i+e.delayLoadingFile,n.buildBoundingInfo(tt.FromArray(e.boundingBoxMinimum),tt.FromArray(e.boundingBoxMaximum)),e._binaryInfo&&(n._binaryInfo=e._binaryInfo),n._delayInfo=[],e.hasUVs&&n._delayInfo.push(Rt.UVKind),e.hasUVs2&&n._delayInfo.push(Rt.UV2Kind),e.hasUVs3&&n._delayInfo.push(Rt.UV3Kind),e.hasUVs4&&n._delayInfo.push(Rt.UV4Kind),e.hasUVs5&&n._delayInfo.push(Rt.UV5Kind),e.hasUVs6&&n._delayInfo.push(Rt.UV6Kind),e.hasColors&&n._delayInfo.push(Rt.ColorKind),e.hasMatricesIndices&&n._delayInfo.push(Rt.MatricesIndicesKind),e.hasMatricesWeights&&n._delayInfo.push(Rt.MatricesWeightsKind),n._delayLoadingFunction=Wt._ImportGeometry,Vt.ForceFullSceneLoadingForIncremental&&n._checkDelayState()):Wt._ImportGeometry(e,n),e.materialUniqueId?n._waitingMaterialId=e.materialUniqueId:e.materialId&&(n._waitingMaterialId=e.materialId),e.morphTargetManagerId>-1&&(n.morphTargetManager=r.getMorphTargetManagerById(e.morphTargetManagerId)),void 0!==e.skeletonId&&null!==e.skeletonId&&(n.skeleton=r.getLastSkeletonById(e.skeletonId),e.numBoneInfluencers&&(n.numBoneInfluencers=e.numBoneInfluencers)),e.animations){for(var s=0;s<e.animations.length;s++){var o=e.animations[s];(c=Ne("BABYLON.Animation"))&&n.animations.push(c.Parse(o))}At.ParseAnimationRanges(n,e,r)}if(e.autoAnimate&&r.beginAnimation(n,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1),e.layerMask&&!isNaN(e.layerMask)?n.layerMask=Math.abs(parseInt(e.layerMask)):n.layerMask=268435455,e.physicsImpostor&&t._PhysicsImpostorParser(r,n,e),e.lodMeshIds&&(n._waitingData.lods={ids:e.lodMeshIds,distances:e.lodDistances?e.lodDistances:null,coverages:e.lodCoverages?e.lodCoverages:null}),e.instances)for(var a=0;a<e.instances.length;a++){var u=e.instances[a],h=n.createInstance(u.name);if(u.id&&(h.id=u.id),ze&&(u.tags?ze.AddTagsTo(h,u.tags):ze.AddTagsTo(h,e.tags)),h.position=tt.FromArray(u.position),void 0!==u.metadata&&(h.metadata=u.metadata),void 0!==u.parentId&&(h._waitingParentId=u.parentId),void 0!==u.parentInstanceIndex&&(h._waitingParentInstanceIndex=u.parentInstanceIndex),void 0!==u.isEnabled&&null!==u.isEnabled&&h.setEnabled(u.isEnabled),void 0!==u.isVisible&&null!==u.isVisible&&(h.isVisible=u.isVisible),void 0!==u.isPickable&&null!==u.isPickable&&(h.isPickable=u.isPickable),u.rotationQuaternion?h.rotationQuaternion=it.FromArray(u.rotationQuaternion):u.rotation&&(h.rotation=tt.FromArray(u.rotation)),h.scaling=tt.FromArray(u.scaling),void 0!=u.checkCollisions&&null!=u.checkCollisions&&(h.checkCollisions=u.checkCollisions),void 0!=u.pickable&&null!=u.pickable&&(h.isPickable=u.pickable),void 0!=u.showBoundingBox&&null!=u.showBoundingBox&&(h.showBoundingBox=u.showBoundingBox),void 0!=u.showSubMeshesBoundingBox&&null!=u.showSubMeshesBoundingBox&&(h.showSubMeshesBoundingBox=u.showSubMeshesBoundingBox),void 0!=u.alphaIndex&&null!=u.showSubMeshesBoundingBox&&(h.alphaIndex=u.alphaIndex),u.physicsImpostor&&t._PhysicsImpostorParser(r,h,u),u.animations){for(s=0;s<u.animations.length;s++){var c;o=u.animations[s];(c=Ne("BABYLON.Animation"))&&h.animations.push(c.Parse(o))}At.ParseAnimationRanges(h,u,r),u.autoAnimate&&r.beginAnimation(h,u.autoAnimateFrom,u.autoAnimateTo,u.autoAnimateLoop,u.autoAnimateSpeed||1)}}if(e.thinInstances){var l=e.thinInstances;if(n.thinInstanceEnablePicking=!!l.enablePicking,l.matrixData?(n.thinInstanceSetBuffer("matrix",new Float32Array(l.matrixData),16,!1),n._thinInstanceDataStorage.matrixBufferSize=l.matrixBufferSize,n._thinInstanceDataStorage.instancesCount=l.instancesCount):n._thinInstanceDataStorage.matrixBufferSize=l.matrixBufferSize,e.thinInstances.userThinInstance){var f=e.thinInstances.userThinInstance;for(var d in f.data)n.thinInstanceSetBuffer(d,new Float32Array(f.data[d]),f.strides[d],!1),n._userThinInstanceBuffersStorage.sizes[d]=f.sizes[d]}}return n},t.prototype.setPositionsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourcePositions){var t=this.getVerticesData(Rt.PositionKind);if(!t)return e._sourcePositions;e._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(Rt.PositionKind)||this.setVerticesData(Rt.PositionKind,t,!0)}return e._sourcePositions},t.prototype.setNormalsForCPUSkinning=function(){var e=this._internalMeshDataInfo;if(!e._sourceNormals){var t=this.getVerticesData(Rt.NormalKind);if(!t)return e._sourceNormals;e._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(Rt.NormalKind)||this.setVerticesData(Rt.NormalKind,t,!0)}return e._sourceNormals},t.prototype.applySkeleton=function(e){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(Rt.PositionKind))return this;if(!this.isVerticesDataPresent(Rt.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(Rt.MatricesWeightsKind))return this;var t=this.isVerticesDataPresent(Rt.NormalKind),r=this._internalMeshDataInfo;if(!r._sourcePositions){var i=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=i}t&&!r._sourceNormals&&this.setNormalsForCPUSkinning();var n=this.getVerticesData(Rt.PositionKind);if(!n)return this;n instanceof Float32Array||(n=new Float32Array(n));var s=this.getVerticesData(Rt.NormalKind);if(t){if(!s)return this;s instanceof Float32Array||(s=new Float32Array(s))}var o=this.getVerticesData(Rt.MatricesIndicesKind),a=this.getVerticesData(Rt.MatricesWeightsKind);if(!a||!o)return this;for(var u,h=this.numBoneInfluencers>4,c=h?this.getVerticesData(Rt.MatricesIndicesExtraKind):null,l=h?this.getVerticesData(Rt.MatricesWeightsExtraKind):null,f=e.getTransformMatrices(this),d=tt.Zero(),p=new nt,_=new nt,g=0,m=0;m<n.length;m+=3,g+=4){var y=void 0;for(u=0;u<4;u++)(y=a[g+u])>0&&(nt.FromFloat32ArrayToRefScaled(f,Math.floor(16*o[g+u]),y,_),p.addToSelf(_));if(h)for(u=0;u<4;u++)(y=l[g+u])>0&&(nt.FromFloat32ArrayToRefScaled(f,Math.floor(16*c[g+u]),y,_),p.addToSelf(_));tt.TransformCoordinatesFromFloatsToRef(r._sourcePositions[m],r._sourcePositions[m+1],r._sourcePositions[m+2],p,d),d.toArray(n,m),t&&(tt.TransformNormalFromFloatsToRef(r._sourceNormals[m],r._sourceNormals[m+1],r._sourceNormals[m+2],p,d),d.toArray(s,m)),p.reset()}return this.updateVerticesData(Rt.PositionKind,n),t&&this.updateVerticesData(Rt.NormalKind,s),this},t.MinMax=function(e){var t=null,r=null;return e.forEach((function(e){var i=e.getBoundingInfo().boundingBox;t&&r?(t.minimizeInPlace(i.minimumWorld),r.maximizeInPlace(i.maximumWorld)):(t=i.minimumWorld,r=i.maximumWorld)})),t&&r?{min:t,max:r}:{min:tt.Zero(),max:tt.Zero()}},t.Center=function(e){var r=e instanceof Array?t.MinMax(e):e;return tt.Center(r.min,r.max)},t.MergeMeshes=function(e,r,i,n,s,o){return void 0===r&&(r=!0),He(t._MergeMeshesCoroutine(e,r,i,n,s,o,!1))},t.MergeMeshesAsync=function(e,r,i,n,s,o){return void 0===r&&(r=!0),Xe(t._MergeMeshesCoroutine(e,r,i,n,s,o,!0),function(e){var t;return void 0===e&&(e=25),function(r,i,n){var s=performance.now();void 0===t||s-t>e?(t=s,setTimeout((function(){Ke(r,i,n)}),0)):Ke(r,i,n)}}())},t._MergeMeshesCoroutine=function(e,r,i,n,s,o,a){var u,h,c,l,d,p,_,g,m,y,v,b,M,x,E,A,P,R,I,S,C,D,O,F,w,B;return void 0===r&&(r=!0),f(this,(function(f){switch(f.label){case 0:if(0===(e=e.filter(Boolean)).length)return[2,null];if(!i)for(h=0,u=0;u<e.length;u++)if((h+=e[u].getTotalVertices())>=65536)return T.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),[2,null];for(o&&(s=!1),c=new Array,l=new Array,d=new Array,p=e[0].overrideMaterialSideOrientation,u=0;u<e.length;u++){if((_=e[u]).isAnInstance)return T.Warn("Cannot merge instance meshes."),[2,null];if(p!==_.overrideMaterialSideOrientation)return T.Warn("Cannot merge meshes with different overrideMaterialSideOrientation values."),[2,null];if(s&&d.push(_.getTotalIndices()),o)if(_.material)if((g=_.material)instanceof ii){for(m=0;m<g.subMaterials.length;m++)c.indexOf(g.subMaterials[m])<0&&c.push(g.subMaterials[m]);for(B=0;B<_.subMeshes.length;B++)l.push(c.indexOf(g.subMaterials[_.subMeshes[B].materialIndex])),d.push(_.subMeshes[B].indexCount)}else for(c.indexOf(g)<0&&c.push(g),B=0;B<_.subMeshes.length;B++)l.push(c.indexOf(g)),d.push(_.subMeshes[B].indexCount);else for(B=0;B<_.subMeshes.length;B++)l.push(0),d.push(_.subMeshes[B].indexCount)}return y=e[0],v=function(e){var t=e.computeWorldMatrix(!0);return[It.ExtractFromMesh(e,!1,!1),t]},b=v(y),M=b[0],x=b[1],a?[4]:[3,2];case 1:f.sent(),f.label=2;case 2:E=new Array(e.length-1),A=1,f.label=3;case 3:return A<e.length?(E[A-1]=v(e[A]),a?[4]:[3,5]):[3,6];case 4:f.sent(),f.label=5;case 5:return A++,[3,3];case 6:P=M._mergeCoroutine(x,E,i,a,!r),R=P.next(),f.label=7;case 7:return R.done?[3,10]:a?[4]:[3,9];case 8:f.sent(),f.label=9;case 9:return R=P.next(),[3,7];case 10:I=R.value,n||(n=new t(y.name+"_merged",y.getScene())),S=I._applyToCoroutine(n,void 0,a),C=S.next(),f.label=11;case 11:return C.done?[3,14]:a?[4]:[3,13];case 12:f.sent(),f.label=13;case 13:return C=S.next(),[3,11];case 14:if(n.checkCollisions=y.checkCollisions,n.overrideMaterialSideOrientation=y.overrideMaterialSideOrientation,r)for(u=0;u<e.length;u++)e[u].dispose();if(s||o){for(n.releaseSubMeshes(),u=0,D=0;u<d.length;)kt.CreateFromIndices(0,D,d[u],n,void 0,!1),D+=d[u],u++;for(O=0,F=n.subMeshes;O<F.length;O++)F[O].refreshBoundingInfo();n.computeWorldMatrix(!0)}if(o){for((w=new ii(y.name+"_merged",y.getScene())).subMaterials=c,B=0;B<n.subMeshes.length;B++)n.subMeshes[B].materialIndex=l[B];n.material=w}else n.material=y.material;return[2,n]}}))},t.prototype.addInstance=function(e){e._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(e)},t.prototype.removeInstance=function(e){var t=e._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){var r=this.instances[this.instances.length-1];this.instances[t]=r,r._indexInSourceMeshInstanceArray=t}e._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},t.prototype._shouldConvertRHS=function(){return this.overrideMaterialSideOrientation===ri.CounterClockWiseSideOrientation},t.FRONTSIDE=It.FRONTSIDE,t.BACKSIDE=It.BACKSIDE,t.DOUBLESIDE=It.DOUBLESIDE,t.DEFAULTSIDE=It.DEFAULTSIDE,t.NO_CAP=0,t.CAP_START=1,t.CAP_END=2,t.CAP_ALL=3,t.NO_FLIP=0,t.FLIP_TILE=1,t.ROTATE_TILE=2,t.FLIP_ROW=3,t.ROTATE_ROW=4,t.FLIP_N_ROTATE_TILE=5,t.FLIP_N_ROTATE_ROW=6,t.CENTER=0,t.LEFT=1,t.RIGHT=2,t.TOP=3,t.BOTTOM=4,t.INSTANCEDMESH_SORT_TRANSPARENT=!1,t._GroundMeshParser=function(e,t){throw A("GroundMesh")},t._GoldbergMeshParser=function(e,t){throw A("GoldbergMesh")},t._LinesMeshParser=function(e,t){throw A("LinesMesh")},t}(rr);function ci(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Le("BABYLON.Mesh",hi),hi.prototype.setMaterialByID=function(e){return this.setMaterialById(e)},hi.CreateDisc=hi.CreateDisc||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateBox=hi.CreateBox||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateSphere=hi.CreateSphere||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateCylinder=hi.CreateCylinder||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateTorusKnot=hi.CreateTorusKnot||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateTorus=hi.CreateTorus||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreatePlane=hi.CreatePlane||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateGround=hi.CreateGround||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateTiledGround=hi.CreateTiledGround||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateGroundFromHeightMap=hi.CreateGroundFromHeightMap||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateTube=hi.CreateTube||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreatePolyhedron=hi.CreatePolyhedron||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateIcoSphere=hi.CreateIcoSphere||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateDecal=hi.CreateDecal||function(){throw new Error("Import MeshBuilder to populate this function")},hi.CreateCapsule=hi.CreateCapsule||function(){throw new Error("Import MeshBuilder to populate this function")},hi.ExtendToGoldberg=hi.ExtendToGoldberg||function(){throw new Error("Import MeshBuilder to populate this function")};function li(e,t,r){return 1023&e|(1023&t)<<10|(1023&r)<<20}var fi=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.arr=[],this.hash={}}var t,r,i;return t=e,r=[{key:"forEach",value:function(e,t){this.arr.forEach(e,t)}},{key:"includes",value:function(e,t,r){var i=li(e,t,r);return!!this.hash[i]}},{key:"add",value:function(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=li(e,t,r);this.hash[n]||(i?this.arr.unshift([e,t,r,n]):this.arr.push([e,t,r,n]),this.hash[n]=!0)}},{key:"removeByIndex",value:function(e){var t=this.arr[e];delete this.hash[t[3]],this.arr.splice(e,1)}},{key:"remove",value:function(e,t,r){var i=li(e,t,r);if(this.hash[i]){delete this.hash[i];for(var n=0;n<this.arr.length;n++)if(i===this.arr[n][3])return void this.arr.splice(n,1);throw"internal bug with location queue - hash value overlapped"}}},{key:"count",value:function(){return this.arr.length}},{key:"isEmpty",value:function(){return 0===this.arr.length}},{key:"empty",value:function(){this.arr=[],this.hash={}}},{key:"pop",value:function(){var e=this.arr.pop();return delete this.hash[e[3]],e}},{key:"copyFrom",value:function(e){for(var t in this.arr=e.arr.slice(),this.hash={},e.hash)this.hash[t]=!0}},{key:"sortByDistance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.arr.length,n=r&&i>1e3;if(n){var s=this.arr.slice(0,100).concat(this.arr.slice(i-100));di(s,e,t);for(var o=0;o<100;o++)this.arr[o]=s[o],this.arr[i-o-1]=s[200-o-1]}else di(this.arr,e,t)}}],r&&ci(t.prototype,r),i&&ci(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}();function di(e,t,r){var n,s={},o=i(e);try{for(o.s();!(n=o.n()).done;){var a=n.value;s[a[3]]=t(a[0],a[1],a[2])}}catch(u){o.e(u)}finally{o.f()}r?e.sort((function(e,t){return s[e[3]]-s[t[3]]})):e.sort((function(e,t){return s[t[3]]-s[e[3]]})),s=null}function pi(e,t,r,i,n,s,a,u){var h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;this.noa=e,this.isDisposed=!1,this.requestID=t,this.voxels=a,this.userData=u,this.i=r,this.j=i,this.k=n,this.size=s,this.x=r*s,this.y=i*s,this.z=n*s,this.pos=[this.x,this.y,this.z],this._terrainDirty=!1,this._objectsDirty=!1,this._terrainMeshes=[],e._terrainMesher.initChunk(this),e._objectMesher.initChunk(this),this._isFull=!1,this._isEmpty=!1,this._wholeLayerVoxel=Array(s).fill(-1),h>=0&&(this.voxels.data.fill(h,0,this.voxels.size),this._wholeLayerVoxel.fill(h));var c=Array.from(Array(27),(function(){return null}));this._neighbors=o()(c,[3,3,3]).lo(1,1,1),this._neighbors.set(0,0,0,this),this._neighborCount=0,this._timesMeshed=0,this._blockHandlerLocs=new fi,gi(this)}function _i(e,t,r,i,n,s){var o=t[r];o&&o(e.x+i,e.y+n,e.z+s)}function gi(e){for(var t=e.voxels,r=t.data,i=t.shape[0],n=e.noa.registry._opacityLookup,s=e.noa.registry._blockHandlerLookup,o=e.noa.registry._objectLookup,a=e.noa.registry._blockIsPlainLookup,u=e.noa._objectMesher,h=!0,c=!0,l=0;l<i;++l){var f=e._wholeLayerVoxel[l];if(f>=0&&!u[f]&&!s[f])n[f]||(h=!1),0!==f&&(c=!1);else{for(var d=t.get(0,l,0),p=0;p<i;++p)for(var _=t.index(p,l,0),g=0;g<i;++g,++_){var m=r[_];if(d>=0&&m!==d&&(d=-1),0!==m)if(a[m])c=!1;else{h=h&&n[m],c=!1,o[m]&&(u.setObjectBlock(e,m,p,l,g),e._objectsDirty=!0);var y=s[m];y&&(e._blockHandlerLocs.add(p,l,g),_i(e,y,"onLoad",p,l,g))}else h=!1}d>=0&&(e._wholeLayerVoxel[l]=d)}}e._isFull=h,e._isEmpty=c,e._terrainDirty=!e._isEmpty}function mi(e,t){var r=e.voxels,i=e.noa.registry._blockHandlerLookup;e._blockHandlerLocs.arr.forEach((function(s){var o=n(s,3),a=o[0],u=o[1],h=o[2],c=r.get(a,u,h);_i(e,i[c],t,a,u,h)}))}pi.prototype._updateVoxelArray=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;mi(this,"onUnload"),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels=e,this._terrainDirty=!1,this._objectsDirty=!1,this._blockHandlerLocs.empty(),this.noa._objectMesher.initChunk(this),this.noa._terrainMesher.initChunk(this),t>=0?this._wholeLayerVoxel.fill(t):this._wholeLayerVoxel.fill(-1),gi(this)},pi.prototype.get=function(e,t,r){return this.voxels.get(e,t,r)},pi.prototype.getSolidityAt=function(e,t,r){return this.noa.registry._solidityLookup[this.voxels.get(e,t,r)]},pi.prototype.set=function(e,t,r,i){var n=this.voxels.get(e,t,r);if(i!==n){this.voxels.set(e,t,r,i);var s=this.noa.registry._solidityLookup,o=this.noa.registry._objectLookup,a=this.noa.registry._opacityLookup,u=this.noa.registry._blockHandlerLookup;a[i]||(this._isFull=!1),0!==i&&(this._isEmpty=!1),this._wholeLayerVoxel[t]!==i&&(this._wholeLayerVoxel[t]=-1);var h=u[n],c=u[i];h&&_i(this,h,"onUnset",e,t,r),c?(_i(this,c,"onSet",e,t,r),this._blockHandlerLocs.add(e,t,r)):this._blockHandlerLocs.remove(e,t,r);var l=this.noa._objectMesher,f=o[n],d=o[i];f&&l.setObjectBlock(this,0,e,t,r),d&&l.setObjectBlock(this,i,e,t,r);var p=s[n]!==s[i],_=a[n]!==a[i],g=!f&&0!==n,m=!d&&0!==i;if((f||d)&&(this._objectsDirty=!0),(p||_||g||m)&&(this._terrainDirty=!0),(this._terrainDirty||this._objectsDirty)&&this.noa.world._queueChunkForRemesh(this),p||_||g||m)for(var y=this.size-1,v=0===t?-1:0,b=0===r?-1:0,T=e===y?1:0,M=t===y?1:0,x=r===y?1:0,E=0===e?-1:0;E<=T;E++)for(var A=v;A<=M;A++)for(var P=b;P<=x;P++)if(0!==(E|A|P)){var R=this._neighbors.get(E,A,P);R&&(R._terrainDirty=!0,this.noa.world._queueChunkForRemesh(R))}}},pi.prototype.updateMeshes=function(){this._terrainDirty&&(this.noa._terrainMesher.meshChunk(this),this._timesMeshed++,this._terrainDirty=!1),this._objectsDirty&&(this.noa._objectMesher.buildObjectMeshes(),this._objectsDirty=!1)},pi.prototype.dispose=function(){mi(this,"onUnload"),this._blockHandlerLocs.empty(),this.noa._objectMesher.disposeChunk(this),this.noa._terrainMesher.disposeChunk(this),this.voxels.data=null,this.voxels=null,this._neighbors.data=null,this._neighbors=null,this.isDisposed=!0};function yi(){this.terrainID=0,this.numFaces=0,this.matIDs=[],this.dirs=[],this.is=[],this.js=[],this.ks=[],this.wids=[],this.hts=[],this.packedAO=[]}function vi(e,t,r,n,s,a,u){var h=new Int16Array(16),c=new Int16Array(16),l=function(e,t){return s[6*e+t]},f=function(e){return a[e]},d=f,p=u-1,_=[1,1,1,1,1,-1,1,-1,1,-1,1,1,-1,-1,1,-1,1,-1,1,-1,-1,-1,-1,-1],g=[0,0,0,0,0,p,0,p,0,p,0,0,p,p,0,p,0,p,0,p,p,p,p,p],m=[0,1,1,0,1,-1,1,1,0,-1,1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,-1,1,0,-1,-1,1,-1,0,-1,-1,0],y=[0,0,0,1,0,0,0,0,p,1,0,p,0,0,0,0,0,1,p,0,0,p,0,1,0,0,0,0,1,0,p,0,0,p,1,0,0,0,p,0,1,p,p,0,p,p,1,p,0,p,0,1,p,0,0,p,p,1,p,p,0,p,0,0,p,1,p,p,0,p,p,1],v=[0,0,1,0,0,-1,0,1,0,0,-1,0,1,0,0,-1,0,0],b=[0,0,0,1,0,0,0,0,p,1,0,p,0,0,0,1,0,0,0,p,0,1,p,0,0,0,0,0,1,0,p,0,0,p,1,0],T=[0,0,0,0,1,0,0,0,p,0,1,p,0,0,0,0,0,1,0,p,0,0,p,1,0,0,0,0,0,1,p,0,0,p,0,1],M=[];function x(e,t){if(E=e.get(0,0,0),A=e,P.length!==t+1){P=[],R=[],I=[];for(var r=-1;r<t+1;r++){var i=r<0?0:r<t?1:2;P[r]=0|[-1,0,1][i],R[r]=0|[t-1,r,0][i],I[r]=0|[0,r,t-1][i]}}}this.copyNeighborChunksForMesh=function(e){for(var t=Mi.get(),r=e.size,n=0;n<_.length;n+=3){var s=_[n],o=_[n+1],a=_[n+2],u=e._neighbors.get(s,o,a);if(u){var h=bi.get();t.set(s,o,a,h);var c=Ti.get(h),l=g[n],f=g[n+1],d=g[n+2];c.set(l,f,d,u.voxels.get(l,f,d)),Ti.release(c)}}for(var p=0;p<m.length;p+=3){var x=m[p],E=m[p+1],A=m[p+2],P=e._neighbors.get(x,E,A);if(P){var R=bi.get();t.set(x,E,A,R);for(var I=Ti.get(R),S=y[2*p],C=y[2*p+1],D=y[2*p+2],O=y[2*p+3],F=y[2*p+4],w=y[2*p+5],B=I.index(S,C,D),L=I.index(O,F,w)-B,N=0,U=B;N<r;N++,U+=L)R[U]=P.voxels.data[U];Ti.release(I)}}for(var k=0;k<v.length;k+=3){var V=v[k],G=v[k+1],W=v[k+2],z=e._neighbors.get(V,G,W);if(z){var K=bi.get();t.set(V,G,W,K);for(var j=Ti.get(K),H=b[2*k],X=b[2*k+1],q=b[2*k+2],Y=b[2*k+3],Z=b[2*k+4],Q=b[2*k+5],J=T[2*k],$=T[2*k+1],ee=T[2*k+2],te=T[2*k+3],re=T[2*k+4],ie=T[2*k+5],ne=j.index(H,X,q),se=j.index(Y,Z,Q)-ne,oe=j.index(J,$,ee),ae=j.index(te,re,ie)-oe,ue=0,he=ne;ue<r;ue++,he+=se)for(var ce=0,le=he;ce<r;ce++,le+=ae)K[le]=z.voxels.data[le];Ti.release(j)}}var fe=bi.get();t.set(0,0,0,fe);for(var de=0;de<e.voxels.data.length;de++)fe[de]=e.voxels.data[de];var pe,_e=0,ge=i(t.data);try{for(ge.s();!(pe=ge.n()).done;){var me=pe.value;me&&(M[_e++]=me.buffer)}}catch(ye){ge.e(ye)}finally{ge.f()}return M.length=_e,Mi.release(t),{copiedNeighbors:t,transferableBuffers:M}},this.mesh=function(e){var t=e.size;d=f;var r=e._isEmpty||e._isFull,i={};xi.reset();for(var n=0;n<3;++n){var s=2===n?0:2,a=1===n?0:1,u=e._neighbors.data.map((function(e){return e&&e.voxels?e.voxels.transpose(n,s,a):null})),l=o()(u,[3,3,3]).lo(1,1,1).transpose(n,s,a);h.length<t*t&&(h=new Int16Array(t*t),c=new Int16Array(t*t)),x(l,t);var p=l.get(-1,0,0),_=l.get(0,0,0);if(p){var g=p.lo(t,0,0),m=C(n,g,-1,_,0);m>0&&D(0,n,s,a,t,t,m,i)}if(!r)for(var y=0;y<t-1;y++){if(1===n){var v=e._wholeLayerVoxel[y];if(v>=0&&v===e._wholeLayerVoxel[y+1])continue}var b=1===n?null:e._wholeLayerVoxel,T=C(n,_,y,_,y+1,b);T>0&&D(y+1,n,s,a,t,t,T,i)}}return i};var E,A,P=[],R=[],I=[];function S(t,r,i){var n=0|P[t],s=0|P[r],o=0|P[i];if(0===(n|s|o))return e[E.get(t,r,i)];var a=A.get(n,s,o);if(a){var u=0|R[t],h=0|R[r],c=0|R[i];return e[a.get(u,h,c)]}var l=0|I[t],f=0|I[r],d=0|I[i];return e[E.get(l,f,d)]}function C(e,i,s,o,a){for(var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,f=i.shape[1],d=h,p=c,_=2*e,g=0,m=i.index(s,0,0),y=i.stride[1],v=i.stride[2],b=o.index(a,0,0),T=o.stride[1],M=o.stride[2],x=0,E=0;E<f;++E){var A=m,P=b;if(m+=v,b+=M,u&&u[E]>=0)g+=f;else for(var R=0;R<f;R++,g++,A+=y,P+=T){var I=i.data[A],C=o.data[P];if(I!==C){var D=n[I],O=n[C];if(!D||!O){var F=l(I,_),w=l(C,_+1);F!==w&&(D||0===w?(d[g]=F,t&&(p[g]=Ai(S,a,s,R,E,r)),x++):(O||0===F)&&(d[g]=-w,t&&(p[g]=Ai(S,s,a,R,E,r)),x++))}}}}return x}function D(e,r,i,n,s,o,a,u){var l=h,f=c,p=0,_=2*r,g=[0,0,0];g[r]=e;for(var m=t?O:F,y=0;y<o;++y)for(var v=1,b=1,T=0;T<s;T+=v,p+=v){var M=0|l[p];if(M){var x=0|f[p];for(v=1;v<s-T&&m(p+v,l,M,f,x);++v);e:for(b=1;b<o-y;++b)for(var E=0;E<v;++E){if(!m(p+E+b*s,l,M,f,x))break e}var A=Math.abs(M),P=d(A);if(!(P in u)){var R=xi.get();R.numFaces=0,R.terrainID=P,u[P]=R}var I=u[P],S=I.numFaces;I.numFaces++,I.matIDs[S]=A,g[i]=T,g[n]=y,I.is[S]=g[0],I.js[S]=g[1],I.ks[S]=g[2],I.wids[S]=v,I.hts[S]=b,I.packedAO[S]=x,I.dirs[S]=M>0?_:_+1;for(var C=0;C<b;++C)for(var D=0;D<v;++D)l[p+D+C*s]=0;if(0===(a-=v*b))return}else v=1}}function O(e,t,r,i,n){return r===t[e]&&n===i[e]}function F(e,t,r,i,n){return r===t[e]}}var bi,Ti,Mi,xi=function(){var e=[],t=0;return{get:function(){return t>=e.length&&e.push(new yi),t++,e[t-1]},reset:function(){t=0}}}();function Ei(e,t,r,s,o,a,u){function h(e,t,r,i,n,s,o,a){var u=12*t,h=[r,i,n],c=[0,0,0],l=[0,0,0];c[2===s?0:2]=o,l[1===s?0:1]=a;for(var f=0;f<3;f++)e[u+f]=h[f],e[u+3+f]=h[f]+c[f],e[u+6+f]=h[f]+c[f]+l[f],e[u+9+f]=h[f]+l[f]}function c(e,t,r,i,n,s){for(var o=8*t,a=.0015,u=0;u<8;u++)e[o+u]=a;0===r?(e[o+1]=e[o+3]=n-a,e[o+2]=e[o+4]=s*(i-a),e[o+0]=e[o+6]=s*a):1===r?(e[o+1]=e[o+7]=i-a,e[o+4]=e[o+6]=s*(n-a),e[o+0]=e[o+2]=s*a):(e[o+1]=e[o+3]=n-a,e[o+2]=e[o+4]=-s*(i-a),e[o+0]=e[o+6]=-s*a)}function l(e,t,r){for(var i=12*t,n=0;n<12;n++)e[i+n]=r[n%3]}function f(e,t,r,i,n){var s=6*t,o=4*t;0===r&&(i=-i);var a=i<0?0:1;n||(a+=2);for(var u=d[a],h=0;h<6;h++)e[s+h]=o+u[h]}this.buildMesh=function(r){var n,s=e.rendering.getScene(),o=[],a=i(r);try{for(a.s();!(n=a.n()).done;){var u=n.value,h=u.positions,c=u.indices,l=u.normals,f=u.colors,d=u.uvs,p=u.atlasIndexes,_=u.requestID,g=u.terrainID,m="chunk_".concat(_,"_").concat(g),y=new hi(m,s),v=new It;v.positions=h,v.indices=c,v.normals=l,v.colors=f,v.uvs=d,v.applyToMesh(y),y.doNotSyncBoundingInfo=!0,y._updateBoundingInfo=function(){return y},y._refreshBoundingInfo=function(){return y},p&&y.setVerticesData("texAtlasIndices",p,!1,1),y.material=t.getMaterial(g),o.push(y)}}catch(b){a.e(b)}finally{a.f()}return o},this.createMeshData=function(e,t){var i=[1,1,1],d=[];for(var y in e){var v=e[y],b=v.terrainID,T=!1;T=a[v.matIDs[0]]>=0;var M,x=v.numFaces,E=new Uint16Array(6*x),A=new Float32Array(12*x),P=new Float32Array(12*x),R=new Float32Array(16*x),I=new Float32Array(8*x);T&&(M=new Float32Array(4*x));for(var S=0;S<v.numFaces;S++){var C=v.matIDs[S],D=v.dirs[S],O=v.is[S],F=v.js[S],w=v.ks[S],B=v.wids[S],L=v.hts[S],N=D/2|0,U=D%2?-1:1;h(A,S,O,F,w,N,B,L),c(I,S,N,B,L,U);var k=[0,0,0];k[N]=U,l(P,S,k);var V=n(Pi(v.packedAO[S]),4),G=V[0],W=V[1],z=V[2],K=V[3];if(f(E,S,N,U,_(G,W,z,K)),T)p(M,S,a[C]);var j=u[C]||i;r?m(R,S,j,s,o,G,W,z,K):g(R,S,j)}d.push({positions:A,indices:E,normals:P,colors:R,uvs:I,atlasIndexes:T?M:null,requestID:t.requestID,terrainID:b})}return d};var d=[[0,1,2,0,2,3],[0,2,1,0,3,2],[1,2,3,1,3,0],[1,3,2,1,0,3]];function p(e,t,r){for(var i=4*t,n=0;n<4;n++)e[i+n]=r}function _(e,t,r,i){return e===r?i!==t||2===i:i!==t&&e+r>i+t}function g(e,t,r){for(var i=16*t,n=0;n<16;n+=4)e[i+n]=r[0],e[i+n+1]=r[1],e[i+n+2]=r[2],e[i+n+3]=1}function m(e,t,r,i,n,s,o,a,u){var h=16*t;y(e,h,r,s,i,n),y(e,h+4,r,u,i,n),y(e,h+8,r,a,i,n),y(e,h+12,r,o,i,n)}function y(e,t,r,i,n,s){var o=0===i?s:n[i-1];e[t]=r[0]*o,e[t+1]=r[1]*o,e[t+2]=r[2]*o,e[t+3]=1}}function Ai(e,t,r,i,n){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=1,a=1,u=1,h=1;e(t,i+1,n)&&(++u,++h),e(t,i-1,n)&&(++o,++a),e(t,i,n+1)&&(++a,++h),e(t,i,n-1)&&(++o,++u);var c=e(t,i,n);return c?(h=3===h||e(t,i+1,n+1)?3:2,a=3===a||e(t,i-1,n+1)?3:2,h<<6|(u=3===u||e(t,i+1,n-1)?3:2)<<4|a<<2|(o=3===o||e(t,i-1,n-1)?3:2)):s?(1===h&&e(t,i+1,n+1)&&(h=2),1===a&&e(t,i-1,n+1)&&(a=2),1===u&&e(t,i+1,n-1)&&(u=2),1===o&&e(t,i-1,n-1)&&(o=2),h<<6|u<<4|a<<2|o):(1===h&&(e(t,i+1,n+1)?h=2:e(r,i,n+1)&&e(r,i+1,n)&&e(r,i+1,n+1)||(h=0)),1===u&&(e(t,i+1,n-1)?u=2:e(r,i,n-1)&&e(r,i+1,n)&&e(r,i+1,n-1)||(u=0)),1===a&&(e(t,i-1,n+1)?a=2:e(r,i,n+1)&&e(r,i-1,n)&&e(r,i-1,n+1)||(a=0)),1===o&&(e(t,i-1,n-1)?o=2:e(r,i,n-1)&&e(r,i-1,n)&&e(r,i-1,n-1)||(o=0)),h<<6|u<<4|a<<2|o)}function Pi(e){return[3&e,e>>2&3,e>>6&3,e>>4&3]}var Ri,Ii,Si=r(786);self.onmessage=function(e){var t=e.data,r=t.type,n=t.data;switch(r){case"meshingInit":var s=n.chunkSize,o=n.solidLookupArr,a=n.doAO,u=n.skipRevAo,h=n.opacityLookup,c=n.blockFaceToMatId,l=n.matIdToTerrainId,f=n.aoVals,d=n.revAoVal,p=n.atlasIndexLookup,_=n.matColorLookup;Ri=new vi(o,a,u,h,c,l,s),Ii=new Ei(null,null,a,f,d,p,_);break;case"meshChunk":for(var g=n.chunk,m=g.size,y=0;y<g._neighborsData.length;y++){g._neighborsData[y]&&(g._neighborsData[y]={voxels:Si(g._neighborsData[y],[m,m,m])})}g._neighbors=Si(g._neighborsData,[3,3,3]).lo(1,1,1);var v=Ri.mesh(g),b=Ii.createMeshData(v,g),T=[];for(var M in b){var x=b[M];for(var E in x){var A;null!==(A=x[E])&&void 0!==A&&A.buffer&&T.push(x[E].buffer)}}var P,R=[],I=i(g._neighborsData);try{for(I.s();!(P=I.n()).done;){var S=P.value;if(S){var C=S.voxels.data;R.push(C),T.push(C.buffer)}}}catch(D){I.e(D)}finally{I.f()}self.postMessage({chunkI:g.chunkI,chunkJ:g.chunkJ,chunkK:g.chunkK,vertexDataInfo:b,reusableChunkArrs:R},T);break;default:console.error("Unrecognised data.type")}}}()}();',"Worker",void 0,r.p+"meshing.worker.js")}var Mn,Tn,Pn=_().GameAnalytics,In=_(),kn=r(52126).ZP,En=function(){};function Rn(e){l.EU.noa&&console.log("client csv detection");try{var t;if(null!==(t=(0,a.K7)())&&void 0!==t&&t.GAConfig){var r=(0,a.K7)().GAConfig;l.EU.GameAnalytics=Pn,l.EU.gaENums=In,["development","test"].includes("production")&&kn.logGameAnalyticsDebug?Pn.setEnabledInfoLog(!0):Pn.setEnabledInfoLog(!1),Pn.configureAvailableResourceCurrencies(r.AvailableCurrencies),Pn.configureAvailableResourceItemTypes(r.AvailableItemCategories),Pn.initialize(r.GAGameKey,r.GASecretKey);var n=u.parse(document.location.search);Pn.addDesignEvent("portal:".concat(n.portal||"root"),234);var i={hey:{category:"hi",subCategory:"noway",value:2}},o=l.f$.subscribe("leaveValues",(function(e){var t=e.leaveEventType,r=e.category,n=e.subCategory,o=e.value;console.log(t,r,n,o),i[t]={category:r,subCategory:n,value:o}}));En=function(){for(var e in i){var t=i[e],r=t.category,n=t.subCategory,o=t.value,s=e;r&&(s+=":"+r),n&&(s+=":"+n),Pn.addDesignEvent(s,o||0)}},e.GA=l.EU.GameAnalytics,e.gaENums=l.EU.gaENums,e.logErrorMessage=(0,l.fj)(e.GA,e.gaENums),console.log("Defined noa.logErrorMessage");var s=function(t){var r=t.message,n=t.filename,i=t.lineno,o=t.colno,s=t.error;e.logErrorMessage("Uncaught error in window event listener ".concat(r,", ").concat(n,", ").concat(i,", ").concat(o,", ").concat(s),s)};window.addEventListener("error",s),(0,l.Xr)((function(){En(),Pn.endSession(),l.f$.unsubscribe(o),En=function(){},e.GA=void 0,e.gaENums=void 0,e.logErrorMessage=function(e,t){var r=new Date;console.error("".concat(r.getUTCHours(),":").concat(r.getUTCMinutes(),":").concat(r.getUTCSeconds()),e,t,null===t||void 0===t?void 0:t.stack)},window.removeEventListener("error",s)}))}}catch(c){console.error("ERROR initialising gameanalytics")}}function wn(e,t){return Bn.apply(this,arguments)}function Bn(){return Bn=(0,n.Z)(o().mark((function e(t,r){var i,s,a,c,f,p,m,g,y;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Play attempted."),i=t,s=r,console.log("Awaiting for all libs needed for gameplay to be loaded."),console.log("Libs needed for gameplay loaded."),!(a=u.parse(document.location.search).forcedIp)||kn.testLocalMatchmaking){e.next=13;break}c=a||kn.localGameserverUrl,console.log("Colyseus connecting to ".concat(c)),Tn=new v.KU(c),l.EU.connectedWebsocketUrl=c,e.next=25;break;case 13:return e.next=15,h()((0,n.Z)(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Dn(t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),{onFailedAttempt:function(e){console.log("Attempt ".concat(e.attemptNumber," to get game server IP failed."))},retries:3});case 15:if(f=e.sent,p=f.succeeded,m=f.failReason,g=f.lobbyName,y=f.playingMode,p){e.next=23;break}return console.log("Join room did not succeed, reason:",m),e.abrupt("return",{succeeded:!1,failReason:m,playingMode:null,lobby:null});case 23:i=g,s=y;case 25:return console.log("Playing",s),l.EU.connectedPlayingMode=s,l.f$.publish("enterLoadingScreen"),l.f$.publish("loadingScreenState","Loading Game"),(0,d.Uz)(),Mn?Nn(Mn,i,s):Ln(i,s),e.abrupt("return",{succeeded:!0,failReason:null,playingMode:s,lobby:i});case 32:case"end":return e.stop()}}),e)}))),Bn.apply(this,arguments)}function Dn(e,t){return On.apply(this,arguments)}function On(){return On=(0,n.Z)(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.ni)("".concat(kn.matchmakingUrl,"/play"),{requestedLobbyName:null!==t&&void 0!==t?t:null,languages:(0,l.HZ)(),game:r,dbId:l.EU.id}).then((function(e){var t=e.ip,r=e.lobbyName,n=e.game,i=e.succeeded,o=e.failReason;if(!i)return{succeeded:!1,failReason:o,lobbyName:null,playingMode:null};var s="wss://";console.log("Connecting to ".concat(s).concat(t));var a="".concat(s).concat(t);return Tn=new v.KU(a),l.EU.connectedWebsocketUrl=a,{succeeded:!0,failReason:null,lobbyName:r,playingMode:n}})));case 1:case"end":return e.stop()}}),e)}))),On.apply(this,arguments)}function Ln(e,t){je(Mn=new s.D({tickRate:kn.clientTicksPerSecond,debug:!1,showFPS:!1,inverseY:!1,inverseX:!1,chunkSize:kn.chunkSize,blockTestDistance:kn.blockTestDistance,playerStart:[0,5,0],playerHeight:kn.playerHeight,playerWidth:kn.playerWidth,playerAutoStep:kn.playerAutoStep,useAO:!0,AOmultipliers:[.92,.8,.5],reverseAOmultiplier:1,chunkAddDistance:[kn.chunkHorizAddDistance,kn.chunkVertAddDistance],chunkRemoveDistance:[kn.chunkHorizAddDistance+1,kn.chunkVertAddDistance+1],preventDefaults:!1,fluidDrag:1,fluidDensity:3,isBodyInsideUnloadedBlock:function(e){var t=l.EU.bloxd;if(e===Mn.ents.getPhysicsBody(Mn.playerEntity))return(0,yt.IE)(t,e);var r=[Math.floor((e.aabb.base[0]+e.aabb.max[0])/2),Math.floor(e.aabb.base[1]),Math.floor((e.aabb.base[2]+e.aabb.max[2])/2)];return t.localToGlobal(r,r),!t.hasChunkWithBlockCoordinates(r[0],r[1],r[2])},getMeshingWorker:function(){return new Cn}})),l.EU.BloxdClientRenderingClass=xn,l.EU.bloxd=new Ct(Mn),Mn.bloxd=l.EU.bloxd;l.EU.bloxd,l.EU.noa=Mn,l.f$.publish("noaDefined"),console.log("noaDefined"),l.EU.pointerLockWrapper=new g(Mn),(0,l.ZC)((function(){l.EU.pointerLockWrapper.reset()}));var r=function(e){return z.apply(this,arguments)}(Mn),n=(0,We.fs)(Mn),i=Promise.all([r,n]);Mn.colyClient=Tn,(0,Ge.rI)(Mn,e,t,i),Ue(Mn),i.then((function(){(0,ze.ix)(Mn)})),(0,yn.vh)(Mn),l.Cc.setItem("numTimesPlayed",l.Cc.getItem("numTimesPlayed")+1),Rn(Mn),console.log("Running with webgl version",Mn.rendering._engine.webGLVersion)}function Fn(){var e,t,r,n;console.log("Leaving game"),l.f$.publish("leaveGame"),null===(e=Mn.colyRoom)||void 0===e||null===(t=e.removeAllListeners)||void 0===t||t.call(e),null===(r=Mn.colyRoom)||void 0===r||null===(n=r.leave)||void 0===n||n.call(r),delete Mn.colyRoom,delete Mn.serverPlayerEntity,(0,l.eM)(Mn),function(e){Le=!1,ke=!1,Fe.destroySeed(Ee),Ee=null,e.world.markAllChunksForRemoval(),De={},Ne={}}(Mn),l.EU.connectedWebsocketUrl=null}function Nn(e,t,r){(0,l.eM)(e),e.colyClient=Tn,(0,Ge.rI)(e,t,r),Rn(e)}window.addEventListener("beforeunload",(function(){En()})),r.e(622).then(r.t.bind(r,67882,23)).then((function(e){e.polyfill()})),window.leaveGame=function(){Fn()}},66293:function(e,t,r){"use strict";r.d(t,{X:function(){return u},b:function(){return d}});var n=r(29439),i=r(85774),o=r(34703),s=r(47313),a=r(44695),l=r(46417),u=s.memo((function(){var e,t,r=(0,i.Zx)(),u=(0,o.$i)("canChange");(0,o.I4)("cameraZoomSet",null),(0,o.I4)("newLocalPlayerHeldItem",null);var c=(0,s.useState)(!1),h=(0,n.Z)(c,2),d=h[0],f=h[1];(0,o.lF)("mouseState",(function(e){var t=e.isDown;f(t)}));var m=null===(e=(0,i.Zx)().ents.getHeldItemState((0,i.Zx)().playerEntity))||void 0===e?void 0:e.heldItem,g=r.camera.zoomDistance<=1||u||null!==r.entities.getHeldItemState(r.playerEntity).heldItemName,v=(null===m||void 0===m?void 0:m.gunTypeObj)||(null===m||void 0===m||null===(t=m.typeObj)||void 0===t?void 0:t.holdAsAiming);return"touchOnly"===a.vO&&!v||!g?null:"Gun"===r.entities.getHeldItemState(r.playerEntity).heldType?(0,l.jsx)(p,{}):(0,l.jsx)("div",{className:"CrossHair",style:{transform:"scale(".concat(d?1.4:1,")")},children:"+"})})),c=[{current:null},{current:null},{current:null},{current:null}],h=0;function d(e){c[0].current?f(e):h=e}function f(e){var t="".concat(.1*e,"vh");c[0].current.style.transform="translateX(calc(0px - ".concat(t,"))"),c[1].current.style.transform="translateX(calc(0px + ".concat(t,"))"),c[2].current.style.transform="translateY(calc(0px - ".concat(t,"))"),c[3].current.style.transform="translateY(calc(0px + ".concat(t,"))")}function p(){var e=.6,t=.15,r="".concat(1.2,"vh"),n="".concat(.3,"vh");return(0,s.useEffect)((function(){h&&f(h)}),[]),(0,l.jsxs)("div",{className:"GunCrosshairWrapper",children:[(0,l.jsx)("div",{className:"GunCrosshair",style:{width:r,height:n,top:"".concat(49.85,"vh"),left:"calc(50vw - ".concat(e,"vh)")},ref:c[0]}),(0,l.jsx)("div",{className:"GunCrosshair",style:{width:r,height:n,top:"".concat(49.85,"vh"),left:"calc(50vw - ".concat(e,"vh)")},ref:c[1]}),(0,l.jsx)("div",{className:"GunCrosshair",style:{width:n,height:r,top:"".concat(49.4,"vh"),left:"calc(50vw - ".concat(t,"vh)")},ref:c[2]}),(0,l.jsx)("div",{className:"GunCrosshair",style:{width:n,height:r,top:"".concat(49.4,"vh"),left:"calc(50vw - ".concat(t,"vh)")},ref:c[3]})]})}},3170:function(e,t,r){"use strict";r.d(t,{t:function(){return l},$:function(){return u}});var n=r(34703),i=r(85774),o=r(47313),s=r(46417),a={},l=o.memo((function(){var e=(0,n.GG)();return(0,n.lF)("damagedByOtherPlayer",(function(t){var r=t.whoShotEId,n=t.direction;if(a[r]){var i=a[r];clearTimeout(i.timeout),i.direction=n,i.timeout=setTimeout((function(){delete a[r],e()}),800)}else a[r]={direction:n,domElement:null,timeout:setTimeout((function(){delete a[r],e()}),800)};e()})),(0,n.lF)("playerKilled",(function(t){var r=t.deadEId;t.killerEId===(0,i.Zx)().serverPlayerEntity&&r in a&&(clearTimeout(a[r].timeout),delete a[r],e())})),(0,o.useEffect)((function(){return function(){for(var e in a)clearTimeout(a[e].timeout),delete a[e]}}),[]),(0,s.jsx)("div",{className:"DirectionalDamage",children:Object.keys(a).map((function(e){return(0,s.jsx)("div",{className:"DamageIndicator",ref:function(t){a[e]&&(a[e].domElement=t)},style:{width:c,height:c}},e)}))})}));function u(e){for(var t=0,r=Object.values(a);t<r.length;t++){var n=r[t];h(e,n.domElement,n.direction)}}var c="".concat(3.5,"vw");function h(e,t,r){var n=r-e.camera.heading,i=13*Math.sin(n),o=13*Math.cos(n);t.style.transform="translate(calc(".concat(i,"vw - 50%), calc(0px - ").concat(o,"vw - 50%)) rotate(").concat(n,"rad)")}},96724:function(e,t,r){"use strict";r.d(t,{a:function(){return y},v6:function(){return T}});var n=r(29439),i=r(47313),o=r(85774),s=r(13529),a=r.n(s),l=r(44695),u=r(47077),c=r.n(u),h=r(52126),d=r(34703),f=r(46123),p=r.n(f),m=r(85008),g=r(80427),v=r(46417),y=i.memo((function(e){var t=e.escMenuOptions;return(0,i.useEffect)((function(){var e=(0,o.Zx)().camera;e.sensitivityX=t.touchscreenSensitivity,e.sensitivityY=t.touchscreenSensitivity;var r=(0,o.Zx)().ents;return r.getState((0,o.Zx)().playerEntity,r.names.receivesInputs).isTouchscreen=!0,console.log(l.vO),"touchOnly"!==l.vO&&o.f$.publish("showError",{error:"Touch detected, setting controls to touch. Mouse and keyboard control will be disabled. Change control type by visiting the options in the top right",timeoutLength:15e3}),function(){r.getState((0,o.Zx)().playerEntity,r.names.receivesInputs).isTouchscreen=!1,e.sensitivityX=t.mouseSensitivity,e.sensitivityY=t.mouseSensitivity}}),[t.mouseSensitivity,t.touchscreenSensitivity]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(A,{}),(0,v.jsx)(S,{}),(0,v.jsx)(P,{}),(0,v.jsx)(b,{}),(0,v.jsx)(_,{})]})}));function _(){var e=(0,o.Zx)();return(0,i.useEffect)((function(){var t=function(t,r){var n=e.rendering.getScene().createPickingRay(t,r),i=n.origin,s=n.direction;e.actionOrigin=[i.x,i.y,i.z],e.actionDirection=[s.x,s.y,s.z],i=[i.x,i.y,i.z],s=[s.x,s.y,s.z],(0,o.rL)().localToGlobal(i,i);var a=e.pickBlock(i,s,e.camera.zoomDistance+h.ZP.blockTestDistance,(function(e){return 0!==e}));if(a&&(a.blockID&&c().dist(a.position,(0,o.rL)().getPlayerEyePos(e.playerEntity))<=h.ZP.blockTestDistance))return e.blockTestDistance=e.camera.zoomDistance+h.ZP.blockTestDistance,void e.updateBlockTargets();e.blockTestDistance=0},r=document.getElementById("noa-container"),n=null,i=null,s=!1,a=function(r){if(i=Date.now(),s=function(e,t){for(var r in I)if(I[r](e,t))return!0;return!1}(r.targetTouches[0].clientX,r.targetTouches[0].clientY))return e.actionOrigin=null,void(e.actionDirection=null);if(t(r.targetTouches[0].clientX,r.targetTouches[0].clientY),e.targetedBlock){var a=e.targetedBlock.position.join("|");n=setTimeout((function(){if(e.targetedBlock){var t=e.targetedBlock.position.join("|");a===t&&((0,o.Xi)(g.Vz.ingameClick,{wasAltClick:!1,doubleClick:(0,o.QY)()},!0),e.ents.getHeldItem(e.playerEntity).touchDownLong()),n=null}}),300)}},l=function(e){s||t(e.targetTouches[0].clientX,e.targetTouches[0].clientY)},u=function(r){s?s=!1:(t(r.changedTouches[0].clientX,r.changedTouches[0].clientY),Date.now()-i<200&&((0,o.Xi)(g.Vz.ingameClick,{wasAltClick:!1,doubleClick:(0,o.QY)()},!0),e.ents.getHeldItem(e.playerEntity).touchShort()),e.ents.getHeldItem(e.playerEntity).upFirePrimary(),e.actionOrigin=null,e.actionDirection=null,clearTimeout(n))};return r.addEventListener("touchstart",a,{passive:!0}),r.addEventListener("touchmove",l,{passive:!0}),r.addEventListener("touchend",u,{passive:!0}),function(){r.removeEventListener("touchstart",a),r.removeEventListener("touchmove",l),r.removeEventListener("touchend",u),clearTimeout(n)}}),[e]),null}function b(){var e=(0,i.useRef)(!1),t=(0,i.useRef)(!1),r=(0,i.useRef)(0),n=(0,d.GG)(),s=function(){var r=(0,o.Zx)();r.entities.getMoveState(r.playerEntity).crouching=e.current||t.current,M(),n()},a=e.current||t.current;return(0,v.jsx)("div",{className:"TouchCrouchBackground",children:(0,v.jsx)("div",{className:p()("TouchCrouch",{TouchCrouchDown:a}),children:(0,v.jsx)("i",{className:"fas fa-angle-down",onPointerDown:function(){e.current=!0,t.current?t.current=!1:Date.now()-r.current<400&&(t.current=!0),r.current=Date.now(),s()},onPointerUp:function(){e.current=!1,s()}})})})}function S(){return(0,v.jsx)("div",{className:"JumpCircle TouchButton",onTouchStart:function(){(0,o.Zx)().ents.getMoveState((0,o.Zx)().playerEntity).jumping=!0},onTouchEnd:function(){(0,o.Zx)().ents.getMoveState((0,o.Zx)().playerEntity).jumping=!1},children:(0,v.jsx)("i",{className:"fas fa-arrow-up JumpIcon"})})}function A(){var e=(0,o.Zx)(),t=(0,i.useRef)(null),r=(0,i.useState)(!1),s=(0,n.Z)(r,2),l=s[0],u=s[1];return(0,i.useEffect)((function(){var r=a().create({zone:t.current,mode:l?"dynamic":"static",color:"white",dynamicPage:!0,fadeTime:1,multitouch:!0,maxNumberOfNipples:1,restOpacity:1,position:{bottom:"50vh",left:"20vw"}});return r.on("move",(function(t,r){var n=e.ents;n.getState(e.playerEntity,n.names.receivesInputs).joystickHeading=r.angle.radian,C=r.distance/50,M()})),r.on("end",(function(e,t){C=0,M(),u(!0)})),function(){r.destroy()}}),[l]),(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{id:"NippleZone",className:"NippleZone",ref:t})})}var x,C=0;function M(){var e=(0,o.Zx)(),t=e.ents.getMoveState(e.playerEntity),r=e.serverSettings.runningSpeed,n=e.ents.getMovement(e.playerEntity);(t.crouching&&!n.shouldIgnoreCrouchingSpeedReduction()||!e.ents.getState(e.playerEntity,"receivesInputs").canRunCombinator.getTotalBooleanVal())&&(r=e.serverSettings.crouchingSpeed),t.speed=C*r,t.speedMultiplier.setMultiplierType("serverSettingsSpeedMultiplier",e.serverSettings.speedMultiplier)}function T(){var e;null===(e=x)||void 0===e||e()}function P(){var e,t,r,s=null===(e=(0,o.Zx)().ents.getHeldItemState((0,o.Zx)().playerEntity))||void 0===e?void 0:e.heldItem,a=(0,d.$i)("touchscreenActionButton"),l=null!==s&&void 0!==s&&s.gunTypeObj?[{icon:"arrows-rotate"}]:a,u=null;null!==s&&void 0!==s&&s.gunTypeObj||null!==s&&void 0!==s&&null!==(t=s.typeObj)&&void 0!==t&&t.holdAsAiming?u=[{icon:"Arrow"}]:"Chargeable"===(null===s||void 0===s||null===(r=s.typeObj)||void 0===r?void 0:r.type)&&(u=[{icon:s.typeObj.name}]);var c=null!==s&&void 0!==s&&s.gunTypeObj?[{icon:"crosshairs"}]:null,h=(0,i.useReducer)((function(e){return e+1}),0),f=(0,n.Z)(h,2),p=(f[0],f[1]);x=p;var m=[{bottom:6,right:15,size:5},{bottom:12,right:11,size:8},{bottom:15,right:5,size:5}],y=[{onPointerDown:function(){(0,o.Xi)(g.Vz.touchscreenActionButtonPress,!0),null!==s&&void 0!==s&&s.gunTypeObj&&s.reload()},onPointerUp:function(){(0,o.Xi)(g.Vz.touchscreenActionButtonPress,!1)}},{onPointerDown:function(){null===s||void 0===s||s.touchDownSecondary()},onPointerUp:function(){null===s||void 0===s||s.touchUpSecondary()}},{onPointerDown:function(){null===s||void 0===s||s.touchDownTertiary()},onPointerUp:function(){null===s||void 0===s||s.touchUpTertiary()}}];return(0,v.jsx)(v.Fragment,{children:[l,u,c].map((function(e,t){if(!e)return null;var r=m[t];return(0,v.jsx)(k,{icon:e,bottom:r.bottom,right:r.right,size:r.size,pointerDown:y[t].onPointerDown,pointerUp:y[t].onPointerUp},JSON.stringify(e))}))})}var I={};function k(e){var t=e.icon,r=e.bottom,o=e.right,s=e.size,a=e.pointerDown,l=e.pointerUp,u=JSON.stringify(t),c=(0,i.useRef)(!1),h=(0,i.useRef)({centreX:0,centreY:0,radius:0}),f=(0,m.iP)(),p=(0,n.Z)(f,2),g=p[0],y=p[1];(0,i.useEffect)((function(){var e=document.getElementById(u).getBoundingClientRect(),t=e.left+e.width/2,r=e.top+e.height/2,n=e.width/2;h.current={centreX:t,centreY:r,radius:n}}),[g,y]);var _=function(e){S(e.changedTouches[0].clientX,e.changedTouches[0].clientY)&&(c.current=!0,a())},b=function(){c.current&&(c.current=!1,l())},S=function(e,t){return Math.hypot(e-h.current.centreX,t-h.current.centreY)<h.current.radius};return(0,i.useEffect)((function(){return I[u]=S,function(){delete I[u]}}),[u]),(0,i.useEffect)((function(){var e=document.getElementById("noa-container");return e.addEventListener("touchstart",_,{passive:!0}),e.addEventListener("touchend",b,{passive:!0}),function(){e.removeEventListener("touchstart",_),e.removeEventListener("touchend",b)}})),(0,v.jsx)("div",{className:"TouchArbitraryActionButton TouchButton",id:u,style:{bottom:"".concat(r,"rem"),right:"".concat(o,"rem"),width:"".concat(s,"rem"),height:"".concat(s,"rem"),fontSize:"".concat(2*s/5,"rem")},children:(0,v.jsx)(d.fD,{text:t})})}},14848:function(e,t,r){"use strict";r.d(t,{Al:function(){return o},Ng:function(){return s},zz:function(){return i}});var n=r(85774),i={Wood:0,Iron:1,Gold:2,Diamond:3},o=(0,n.hu)(2*Object.keys(i).length*64)/64,s=r(74304)},43971:function(e,t,r){"use strict";r.d(t,{$:function(){return c},_h:function(){return u},uH:function(){return i}});var n=r(85774),i={head:{Bob:{texture:"bob_head",previewTex:h("bob_head_preview"),skinColour:[220,157,118]},Emma:{texture:"emma_head",previewTex:h("emma_head_preview"),skinColour:[239,216,177]},Leo:{texture:"leo_head",previewTex:h("leo_head_preview"),skinColour:[255,224,177]},Isabel:{texture:"isabel_head",previewTex:h("isabel_head_preview"),skinColour:[220,157,118]},Sanjay:{texture:"sanjay_head",previewTex:h("sanjay_head_preview"),skinColour:[181,135,72]},Sara:{texture:"sara_head",previewTex:h("sara_head_preview"),skinColour:[140,112,91]}},body:{Bob:{texture:"bob_body",previewTex:h("bob_body_preview")},Emma:{texture:"emma_body",previewTex:h("emma_body_preview")},"Light Blue Polo":{texture:"light_blue_polo",previewTex:h("light_blue_polo_preview")},"Green Top With Rolled Up Sleeves":{texture:"green_top_with_rolled_up_sleeves",previewTex:h("green_top_with_rolled_up_sleeves_preview")},Khakis:{texture:"khakis_body",previewTex:h("khakis_body_preview")},"Light Blue Crop Top":{texture:"light_blue_crop_top",previewTex:h("light_blue_crop_top_preview")}},legs:{Bob:{texture:"bob_legs",previewTex:h("bob_legs_preview")},Emma:{texture:"emma_legs",previewTex:h("emma_legs_preview")},"Navy Blue Jeans":{texture:"navy_blue_jeans",previewTex:h("navy_blue_jeans_preview")},"Tan Shorts":{texture:"tan_shorts",previewTex:h("tan_shorts_preview")},Khakis:{texture:"khakis_legs",previewTex:h("khakis_legs_preview")},"Navy Blue Denim Shorts":{texture:"navy_blue_denim_shorts",previewTex:h("navy_blue_denim_shorts_preview")}}},o=0;for(var s in i){var a=i[s];for(var l in a)a[l].atlasIdx=o++}var u=(0,n.hu)(64*o)/64,c=h("componentAtlas");function h(e){return r(86940)("./".concat(e,".png"))}},37928:function(e,t,r){"use strict";r.d(t,{Fu:function(){return v},J5:function(){return y},XT:function(){return m},cd:function(){return g}});var n=r(60136),i=r(43668),o=r(93433),s=r(37762),a=r(15671),l=r(43144),u=r(96558),c=r(80105),h=r(43971),d=r(9488),f=r(14848),p=r(23886),m={"LegLeft|Armour":1,"LegRight|Armour":1,"LowerBody|Armour":1,"GauntletLeft|Armour":0,"GauntletRight|Armour":0,"Body|Armour":0,"Helmet|Armour":0,"BootsLeft|Armour":0,"BootsRight|Armour":0},g=function(){function e(t,r){(0,a.Z)(this,e),this.bloxd=void 0,this.playerCharMeshNames=[],this.bloxd=t;var n,i=r.meshes.slice(1),o=(0,s.Z)(i);try{for(o.s();!(n=o.n()).done;){var l=n.value;void 0===m[l.name]&&this.playerCharMeshNames.push(l.name)}}catch(v){o.e(v)}finally{o.f()}var u,f=(0,s.Z)(i);try{for(f.s();!(u=f.n()).done;){var p=u.value;if(void 0!==m[p.name])p.registerInstancedBuffer("aAtlasIdx1",1),p.registerInstancedBuffer("aHueColour",4),p.instancedBuffers.aAtlasIdx1=0,p.instancedBuffers.aHueColour=new d.HE(0,0,0,0);else{p.registerInstancedBuffer("aAtlasIdx1",1),p.registerInstancedBuffer("aAtlasIdx2",1),p.registerInstancedBuffer("aAtlasIdx3",1),p.registerInstancedBuffer("aSkinColour",3),p.registerInstancedBuffer("aOverlayColour",4),p.instancedBuffers.aAtlasIdx1=h.uH.head.Bob.atlasIdx,p.instancedBuffers.aAtlasIdx2=h.uH.body.Bob.atlasIdx,p.instancedBuffers.aAtlasIdx3=h.uH.legs.Bob.atlasIdx;var g=h.uH.head.Bob.skinColour;p.instancedBuffers.aSkinColour=new c.P(g[0]/255,g[1]/255,g[2]/255),p.instancedBuffers.aOverlayColour=new d.HE(0,0,0,0)}}}catch(v){f.e(v)}finally{f.f()}}return(0,l.Z)(e,[{key:"updateInstanceCustomisation",value:function(e,t,r){var n,i=this.getPlayerInstanceChildren(e),o=(0,s.Z)(i);try{for(o.s();!(n=o.n()).done;){var a=n.value;if("head"===t){a.instancedBuffers.aAtlasIdx1=h.uH.head[r].atlasIdx;var l=h.uH.head[r].skinColour;a.instancedBuffers.aSkinColour=new c.P(l[0]/255,l[1]/255,l[2]/255)}else"body"===t?a.instancedBuffers.aAtlasIdx2=h.uH.body[r].atlasIdx:"legs"===t&&(a.instancedBuffers.aAtlasIdx3=h.uH.legs[r].atlasIdx)}}catch(u){o.e(u)}finally{o.f()}}},{key:"updateInstanceOverlayColour",value:function(e,t){var r,n=this.getPlayerInstanceChildren(e),i=(0,s.Z)(n);try{for(i.s();!(r=i.n()).done;){r.value.instancedBuffers.aOverlayColour=t}}catch(o){i.e(o)}finally{i.f()}}},{key:"updateInstanceArmour",value:function(e,t,r,n){var i=[];"Helmet"===t?i.push("Helmet|Armour"):"Chestplate"===t?i.push("Body|Armour"):"Gauntlets"===t?(i.push("GauntletLeft|Armour"),i.push("GauntletRight|Armour")):"Leggings"===t?(i.push("LegLeft|Armour"),i.push("LegRight|Armour"),i.push("LowerBody|Armour")):"Boots"===t&&(i.push("BootsLeft|Armour"),i.push("BootsRight|Armour"));for(var s=this.bloxd.noa.ents.getPlayerMeshState(e).namedNodes,a=0,l=i;a<l.length;a++){var u=l[a],h=s[u];null===r?h.setEnabled(!1):(h.instancedBuffers.aAtlasIdx1=2*f.zz[r]+m[u],h.instancedBuffers.aHueColour=n?p.Vt.apply(void 0,(0,o.Z)(n).concat([1])):new c.Lt(0,0,0,0),h.setEnabled(!0))}}},{key:"getPlayerInstanceChildren",value:function(e){var t=this,r=e.getChildMeshes(!1).filter((function(e){return t.playerCharMeshNames.includes(e.name)}));return 6!==r.length&&(console.error("getPlayerInstanceChildren num instance descendance failed."),console.log("root instance that failed:",e)),r}}]),e}(),v=function(e){(0,n.Z)(r,e);var t=(0,i.Z)(r);function r(e){var n;(0,a.Z)(this,r);var i={ATLAS_TEX_NUM:"".concat(h._h.toString(),".0")};return e.customShaderNameResolve=function(e,t,r,i,o,s){return s&&n.getAttributes(s),e},(n=t.call(this,e,"Player",200,i))._enable(!0),n}return(0,l.Z)(r,[{key:"getClassName",value:function(){return"PlayerMaterialPlugin"}},{key:"getAttributes",value:function(e){e.includes("aAtlasIdx1")||(e.push("aAtlasIdx1"),e.push("aAtlasIdx2"),e.push("aAtlasIdx3"),e.push("aSkinColour"),e.push("aOverlayColour"))}},{key:"getCustomCode",value:function(e){return"vertex"===e?{CUSTOM_VERTEX_DEFINITIONS:"\n                attribute highp float aAtlasIdx1;\n                attribute highp float aAtlasIdx2;\n                attribute highp float aAtlasIdx3;\n                attribute lowp vec3 aSkinColour;\n                \n                attribute lowp vec4 aOverlayColour;\n                                \n                // vMainUV1 is inbuilt into the babylon shader\n                varying highp vec2 vMainUV2;\n                varying highp vec2 vMainUV3;\n                varying lowp vec3 vSkinColour;\n                \n                varying lowp vec4 vOverlayColour;\n            ",CUSTOM_VERTEX_MAIN_END:"\n\t\t\t\tvMainUV2 = vec2((vMainUV1.x+aAtlasIdx2)/ATLAS_TEX_NUM, vMainUV1.y);\n\t\t\t\tvMainUV3 = vec2((vMainUV1.x+aAtlasIdx3)/ATLAS_TEX_NUM, vMainUV1.y);\n\t\t\t\t\n\t\t\t\tvMainUV1 = vec2((vMainUV1.x+aAtlasIdx1)/ATLAS_TEX_NUM, vMainUV1.y);\n\t\t\t\t\n\t\t\t\tvSkinColour = aSkinColour;\n\t\t\t\tvOverlayColour = aOverlayColour;\n\t\t\t"}:"fragment"===e?{CUSTOM_FRAGMENT_DEFINITIONS:"\n                varying highp vec2 vMainUV2;\n                varying highp vec2 vMainUV3;\n                varying lowp vec3 vSkinColour;\n                \n                varying lowp vec4 vOverlayColour;\n            ","!baseColor\\=texture2D\\(diffuseSampler,vDiffuseUV\\+uvOffset\\);":"\n\t\t\t\t// Apply selected skins\n\t\t\t\tvec4 col1 = texture2D(diffuseSampler, vMainUV1);\n\t\t\t\tvec4 col2 = texture2D(diffuseSampler, vMainUV2);\n\t\t\t\tvec4 col3 = texture2D(diffuseSampler, vMainUV3);\n\t\t\t\tbaseColor = col1+col2*(1.0-col1.a)+col3*(max(1.0-col1.a-col2.a, 0.0))+vec4(vSkinColour, 1)*(max(1.0-col1.a-col2.a-col3.a, 0.0));\n\t\t\t\t\n\t\t\t\t// Apply overlay\n\t\t\t\tbaseColor = baseColor*(1.0-vOverlayColour.a) + vOverlayColour*vOverlayColour.a;\n\t\t\t"}:null}}]),r}(u.n),y=function(e){(0,n.Z)(r,e);var t=(0,i.Z)(r);function r(e,n){var i;(0,a.Z)(this,r);var o={ATLAS_TEX_NUM:n};return e.customShaderNameResolve=function(e,t,r,n,o,s){return s&&i.getAttributes(s),e},(i=t.call(this,e,"Armour",200,o))._enable(!0),i}return(0,l.Z)(r,[{key:"getClassName",value:function(){return"ArmourMaterialPlugin"}},{key:"getAttributes",value:function(e){e.includes("aAtlasIdx1")||(e.push("aAtlasIdx1"),e.push("aHueColour"))}},{key:"getCustomCode",value:function(e){return"vertex"===e?{CUSTOM_VERTEX_DEFINITIONS:"\n                attribute highp float aAtlasIdx1;\n                attribute lowp vec4 aHueColour;\n                \n                varying lowp vec4 vHueColour;\n            ",CUSTOM_VERTEX_MAIN_END:"\n                // vMainUV1 is inbuilt into the babylon shader\n\t\t\t\tvMainUV1 = vec2((vMainUV1.x+aAtlasIdx1)/ATLAS_TEX_NUM, vMainUV1.y);\n\t\t\t\tvHueColour = aHueColour;\n\t\t\t"}:"fragment"===e?{CUSTOM_FRAGMENT_DEFINITIONS:"\n                varying lowp vec4 vHueColour;\n            ","!baseColor\\=texture2D\\(diffuseSampler,vDiffuseUV\\+uvOffset\\);":"\n\t\t\t\tvec4 col1 = texture2D(diffuseSampler, vMainUV1);\n\t\t\t\tbaseColor = col1;\n\t\t\t\t\n\t\t\t\tbaseColor = baseColor*(1.0-vHueColour.a) + vec4(baseColor.rgb*vHueColour.rgb, baseColor.a)*vHueColour.a;\n\t\t\t"}:null}}]),r}(u.n)},34177:function(e,t,r){"use strict";r.d(t,{O:function(){return o},T:function(){return n}});var n=["Dirt","Grass Block","Sand","Red Sand","Clay","Snow","Ice","Maple Log","Maple Wood Planks","Stone","Messy Stone","Smooth Stone","Diorite","Smooth Diorite","Andesite","Smooth Andesite","Granite","Smooth Granite","Sandstone","Red Sandstone","Coal Ore","Iron Ore","Gold Ore","Diamond Ore","Moonstone Ore","Block of Coal","Block of Iron","Block of Gold","Block of Diamond","Block of Moonstone","Workbench","Artisan Bench","Furnace","Chest","Moonstone Chest","Maple Door","Maple Trapdoor","Ladder","Iron Ladder","Vines","Baked Clay","Maple Leaves","Tilled Soil","Rocky Dirt","Messy Dirt","Bread Block","Apple Block","Plum Block","Coconut Block","Pear Block","Melon","Watermelon","Pumpkin","Carved Pumpkin","Jack o'Lantern","Glass","Bricks","Stone Bricks","Engraved Stone","Mossy Stone Bricks","Cracked Stone Bricks","Mossy Messy Stone","Compressed Messy Stone","Extra Compressed Messy Stone","Super Compressed Messy Stone","Hyper Compressed Messy Stone","Ultra Compressed Messy Stone","Mega Compressed Messy Stone","Smooth Sandstone","Engraved Sandstone","Marked Sandstone","Sandstone Bricks","Smooth Red Sandstone","Engraved Red Sandstone","Marked Red Sandstone","Red Sandstone Bricks","Engraved Diorite","Diorite Bricks","Engraved Andesite","Andesite Bricks","Engraved Granite","Granite Bricks","Ice Bricks","Magma","Moonstone Explosive","Fireball","Iceball","Bedrock","Pine Log","Plum Log","Cedar Log","Aspen Log","Elm Log","Palm Log","Pear Log","Pine Wood Planks","Plum Wood Planks","Cedar Wood Planks","Aspen Wood Planks","Elm Wood Planks","Palm Wood Planks","Pear Wood Planks","Pine Leaves","Plum Leaves","Cedar Leaves","Aspen Leaves","Elm Leaves","Palm Leaves","Pear Leaves","Autumn Maple Leaves","Fallen Maple Leaves","Board","Pine Door","Plum Door","Cedar Door","Aspen Door","Elm Door","Palm Door","Pear Door","Pine Trapdoor","Plum Trapdoor","Cedar Trapdoor","Aspen Trapdoor","Elm Trapdoor","Palm Trapdoor","Pear Trapdoor","Fat Cactus","Dry Fat Cactus","Cactus","Tall Grass","Wheat Seeds","Melon Seeds","Watermelon Seeds","Pumpkin Seeds","Wheat","Dandelion","Poppy","Red Tulip","Pink Tulip","White Tulip","Orange Tulip","Daisy","Bluebell","Forget-me-not","Allium","Maple Sapling","Pine Sapling","Plum Sapling","Cedar Sapling","Aspen Sapling","Elm Sapling","Palm Sapling","Pear Sapling","White Planks","Orange Planks","Magenta Planks","Light Blue Planks","Yellow Planks","Lime Planks","Pink Planks","Gray Planks","Light Gray Planks","Cyan Planks","Purple Planks","Blue Planks","Brown Planks","Green Planks","Red Planks","Black Planks","White Bed","Orange Bed","Magenta Bed","Light Blue Bed","Yellow Bed","Lime Bed","Pink Bed","Gray Bed","Light Gray Bed","Cyan Bed","Purple Bed","Blue Bed","Brown Bed","Green Bed","Red Bed","Black Bed","Green Wool","White Wool","Light Gray Wool","Gray Wool","Black Wool","Brown Wool","Red Wool","Orange Wool","Yellow Wool","Lime Wool","Cyan Wool","Light Blue Wool","Blue Wool","Purple Wool","Magenta Wool","Pink Wool","White Concrete","Orange Concrete","Magenta Concrete","Light Blue Concrete","Yellow Concrete","Lime Concrete","Pink Concrete","Gray Concrete","Light Gray Concrete","Cyan Concrete","Purple Concrete","Blue Concrete","Brown Concrete","Green Concrete","Red Concrete","Black Concrete","White Baked Clay","Orange Baked Clay","Magenta Baked Clay","Light Blue Baked Clay","Yellow Baked Clay","Lime Baked Clay","Pink Baked Clay","Gray Baked Clay","Light Gray Baked Clay","Cyan Baked Clay","Purple Baked Clay","Blue Baked Clay","Brown Baked Clay","Green Baked Clay","Red Baked Clay","Black Baked Clay","White Ceramic","Orange Ceramic","Magenta Ceramic","Light Blue Ceramic","Yellow Ceramic","Lime Ceramic","Pink Ceramic","Gray Ceramic","Light Gray Ceramic","Purple Ceramic","Blue Ceramic","Brown Ceramic","Green Ceramic","Red Ceramic","Black Ceramic","Maple Slab","Pine Slab","Plum Slab","Cedar Slab","Aspen Slab","Elm Slab","Palm Slab","Pear Slab","Dirt Slab","Grass Slab","Messy Stone Slab","Stone Slab","Smooth Stone Slab","Engraved Stone Slab","Stone Bricks Slab","Mossy Stone Slab","Mossy Stone Bricks Slab","Andesite Slab","Smooth Andesite Slab","Engraved Andesite Slab","Andesite Bricks Slab","Diorite Slab","Smooth Diorite Slab","Engraved Diorite Slab","Diorite Bricks Slab","Granite Slab","Smooth Granite Slab","Engraved Granite Slab","Granite Bricks Slab","Sandstone Slab","Smooth Sandstone Slab","Engraved Sandstone Slab","Marked Sandstone Slab","Sandstone Bricks Slab","Red Sandstone Slab","Smooth Red Sandstone Slab","Engraved Red Sandstone Slab","Marked Red Sandstone Slab","Red Sandstone Bricks Slab","Bricks Slab","Ice Bricks Slab","Shears","Stick","Net","Cobweb","Coal","Iron Bar","Gold Bar","Diamond","Moonstone","Bucket","Water Bucket","Bread","Apple","Plum","Pear","Melon Slice","Watermelon Slice","Gold Melon Slice","Gold Watermelon Slice","Pumpkin Pie","Snowball","Pebble","Reinforced Pebble","Ball","Reinforced Ball","Moonstone Orb","Cracked Coconut","Coconut","Wood Pickaxe","Stone Pickaxe","Iron Pickaxe","Gold Pickaxe","Diamond Pickaxe","Moonstone Pickaxe","Wood Axe","Stone Axe","Iron Axe","Gold Axe","Diamond Axe","Wood Spade","Stone Spade","Iron Spade","Gold Spade","Diamond Spade","Wood Sword","Stone Sword","Iron Sword","Gold Sword","Diamond Sword","Wood Hoe","Stone Hoe","Iron Hoe","Gold Hoe","Diamond Hoe","Wood Bow","Stone Bow","Iron Bow","Gold Bow","Diamond Bow","Wood Crossbow","Stone Crossbow","Iron Crossbow","Gold Crossbow","Diamond Crossbow","Arrow","Wood Helmet","Iron Helmet","Gold Helmet","Diamond Helmet","Wood Chestplate","Iron Chestplate","Gold Chestplate","Diamond Chestplate","Wood Leggings","Iron Leggings","Gold Leggings","Diamond Leggings","Wood Boots","Iron Boots","Gold Boots","Diamond Boots","Wood Gauntlets","Iron Gauntlets","Gold Gauntlets","Diamond Gauntlets","White Wood Helmet","White Wood Chestplate","White Wood Leggings","White Wood Boots","White Wood Gauntlets","Orange Wood Helmet","Orange Wood Chestplate","Orange Wood Leggings","Orange Wood Boots","Orange Wood Gauntlets","Magenta Wood Helmet","Magenta Wood Chestplate","Magenta Wood Leggings","Magenta Wood Boots","Magenta Wood Gauntlets","Light Blue Wood Helmet","Light Blue Wood Chestplate","Light Blue Wood Leggings","Light Blue Wood Boots","Light Blue Wood Gauntlets","Yellow Wood Helmet","Yellow Wood Chestplate","Yellow Wood Leggings","Yellow Wood Boots","Yellow Wood Gauntlets","Lime Wood Helmet","Lime Wood Chestplate","Lime Wood Leggings","Lime Wood Boots","Lime Wood Gauntlets","Pink Wood Helmet","Pink Wood Chestplate","Pink Wood Leggings","Pink Wood Boots","Pink Wood Gauntlets","Gray Wood Helmet","Gray Wood Chestplate","Gray Wood Leggings","Gray Wood Boots","Gray Wood Gauntlets","Light Gray Wood Helmet","Light Gray Wood Chestplate","Light Gray Wood Leggings","Light Gray Wood Boots","Light Gray Wood Gauntlets","Cyan Wood Helmet","Cyan Wood Chestplate","Cyan Wood Leggings","Cyan Wood Boots","Cyan Wood Gauntlets","Purple Wood Helmet","Purple Wood Chestplate","Purple Wood Leggings","Purple Wood Boots","Purple Wood Gauntlets","Blue Wood Helmet","Blue Wood Chestplate","Blue Wood Leggings","Blue Wood Boots","Blue Wood Gauntlets","Brown Wood Helmet","Brown Wood Chestplate","Brown Wood Leggings","Brown Wood Boots","Brown Wood Gauntlets","Green Wood Helmet","Green Wood Chestplate","Green Wood Leggings","Green Wood Boots","Green Wood Gauntlets","Red Wood Helmet","Red Wood Chestplate","Red Wood Leggings","Red Wood Boots","Red Wood Gauntlets","Black Wood Helmet","Black Wood Chestplate","Black Wood Leggings","Black Wood Boots","Black Wood Gauntlets","Protector"],i={Workbench:{altName:"Crafting Table"},"Gray Planks":{altName:"Grey Planks"},"Light Gray Planks":{altName:"Light Grey Planks"},"Light Gray Wool":{altName:"Light Grey Wool"},"Gray Wool":{altName:"Grey Wool"},"Gray Baked Clay":{altName:"Grey Baked Clay"},"Light Gray Baked Clay":{altName:"Light Grey Baked Clay"},"Gray Ceramic":{altName:"Grey Ceramic"},"Light Gray Ceramic":{altName:"Light Grey Ceramic"},"White Bed":{showOnlyInSearch:!0},"Orange Bed":{showOnlyInSearch:!0},"Magenta Bed":{showOnlyInSearch:!0},"Light Blue Bed":{showOnlyInSearch:!0},"Yellow Bed":{showOnlyInSearch:!0},"Pink Bed":{showOnlyInSearch:!0},"Gray Bed":{showOnlyInSearch:!0,altName:"Grey Bed"},"Light Gray Bed":{showOnlyInSearch:!0,altName:"Light Grey Bed"},"Cyan Bed":{showOnlyInSearch:!0},"Purple Bed":{showOnlyInSearch:!0},"Blue Bed":{showOnlyInSearch:!0},"Brown Bed":{showOnlyInSearch:!0},"Green Bed":{showOnlyInSearch:!0},"Red Bed":{showOnlyInSearch:!0},"Black Bed":{showOnlyInSearch:!0},"White Wood Helmet":{showOnlyInSearch:!0},"White Wood Chestplate":{showOnlyInSearch:!0},"White Wood Leggings":{showOnlyInSearch:!0},"White Wood Boots":{showOnlyInSearch:!0},"White Wood Gauntlets":{showOnlyInSearch:!0},"Orange Wood Helmet":{showOnlyInSearch:!0},"Orange Wood Chestplate":{showOnlyInSearch:!0},"Orange Wood Leggings":{showOnlyInSearch:!0},"Orange Wood Boots":{showOnlyInSearch:!0},"Orange Wood Gauntlets":{showOnlyInSearch:!0},"Magenta Wood Helmet":{showOnlyInSearch:!0},"Magenta Wood Chestplate":{showOnlyInSearch:!0},"Magenta Wood Leggings":{showOnlyInSearch:!0},"Magenta Wood Boots":{showOnlyInSearch:!0},"Magenta Wood Gauntlets":{showOnlyInSearch:!0},"Light Blue Wood Helmet":{showOnlyInSearch:!0},"Light Blue Wood Chestplate":{showOnlyInSearch:!0},"Light Blue Wood Leggings":{showOnlyInSearch:!0},"Light Blue Wood Boots":{showOnlyInSearch:!0},"Light Blue Wood Gauntlets":{showOnlyInSearch:!0},"Yellow Wood Helmet":{showOnlyInSearch:!0},"Yellow Wood Chestplate":{showOnlyInSearch:!0},"Yellow Wood Leggings":{showOnlyInSearch:!0},"Yellow Wood Boots":{showOnlyInSearch:!0},"Yellow Wood Gauntlets":{showOnlyInSearch:!0},"Lime Wood Helmet":{showOnlyInSearch:!0},"Lime Wood Chestplate":{showOnlyInSearch:!0},"Lime Wood Leggings":{showOnlyInSearch:!0},"Lime Wood Boots":{showOnlyInSearch:!0},"Lime Wood Gauntlets":{showOnlyInSearch:!0},"Pink Wood Helmet":{showOnlyInSearch:!0},"Pink Wood Chestplate":{showOnlyInSearch:!0},"Pink Wood Leggings":{showOnlyInSearch:!0},"Pink Wood Boots":{showOnlyInSearch:!0},"Pink Wood Gauntlets":{showOnlyInSearch:!0},"Gray Wood Helmet":{showOnlyInSearch:!0,altName:"Grey Wood Helmet"},"Gray Wood Chestplate":{showOnlyInSearch:!0,altName:"Grey Wood Chestplate"},"Gray Wood Leggings":{showOnlyInSearch:!0,altName:"Grey Wood Leggings"},"Gray Wood Boots":{showOnlyInSearch:!0,altName:"Grey Wood Boots"},"Gray Wood Gauntlets":{showOnlyInSearch:!0,altName:"Grey Wood Gauntlets"},"Light Gray Wood Helmet":{showOnlyInSearch:!0,altName:"Light Grey Wood Helmet"},"Light Gray Wood Chestplate":{showOnlyInSearch:!0,altName:"Light Grey Wood Chestplate"},"Light Gray Wood Leggings":{showOnlyInSearch:!0,altName:"Light Grey Wood Leggings"},"Light Gray Wood Boots":{showOnlyInSearch:!0,altName:"Light Grey Wood Boots"},"Light Gray Wood Gauntlets":{showOnlyInSearch:!0,altName:"Light Grey Wood Gauntlets"},"Cyan Wood Helmet":{showOnlyInSearch:!0},"Cyan Wood Chestplate":{showOnlyInSearch:!0},"Cyan Wood Leggings":{showOnlyInSearch:!0},"Cyan Wood Boots":{showOnlyInSearch:!0},"Cyan Wood Gauntlets":{showOnlyInSearch:!0},"Purple Wood Helmet":{showOnlyInSearch:!0},"Purple Wood Chestplate":{showOnlyInSearch:!0},"Purple Wood Leggings":{showOnlyInSearch:!0},"Purple Wood Boots":{showOnlyInSearch:!0},"Purple Wood Gauntlets":{showOnlyInSearch:!0},"Blue Wood Helmet":{showOnlyInSearch:!0},"Blue Wood Chestplate":{showOnlyInSearch:!0},"Blue Wood Leggings":{showOnlyInSearch:!0},"Blue Wood Boots":{showOnlyInSearch:!0},"Blue Wood Gauntlets":{showOnlyInSearch:!0},"Brown Wood Helmet":{showOnlyInSearch:!0},"Brown Wood Chestplate":{showOnlyInSearch:!0},"Brown Wood Leggings":{showOnlyInSearch:!0},"Brown Wood Boots":{showOnlyInSearch:!0},"Brown Wood Gauntlets":{showOnlyInSearch:!0},"Green Wood Helmet":{showOnlyInSearch:!0},"Green Wood Chestplate":{showOnlyInSearch:!0},"Green Wood Leggings":{showOnlyInSearch:!0},"Green Wood Boots":{showOnlyInSearch:!0},"Green Wood Gauntlets":{showOnlyInSearch:!0},"Red Wood Helmet":{showOnlyInSearch:!0},"Red Wood Chestplate":{showOnlyInSearch:!0},"Red Wood Leggings":{showOnlyInSearch:!0},"Red Wood Boots":{showOnlyInSearch:!0},"Red Wood Gauntlets":{showOnlyInSearch:!0},"Black Wood Helmet":{showOnlyInSearch:!0},"Black Wood Chestplate":{showOnlyInSearch:!0},"Black Wood Leggings":{showOnlyInSearch:!0},"Black Wood Boots":{showOnlyInSearch:!0},"Black Wood Gauntlets":{showOnlyInSearch:!0}};function o(e){var t=e.toLowerCase();if(""===t)return new Array(n.length).fill(0).map((function(e,t){return t})).filter((function(e){return!function(e){var t,r;return null!==(t=null===(r=i[e])||void 0===r?void 0:r.showOnlyInSearch)&&void 0!==t&&t}(n[e])}));for(var r=[],o=0;o<n.length;o++){n[o].toLowerCase().includes(t.toLowerCase())&&r.push(o)}for(var s in r.sort((function(e,r){var i=n[e].toLowerCase(),o=n[r].toLowerCase();return i.indexOf(t)-o.indexOf(t)})),i){var a;if((null!==(a=i[s].altName)&&void 0!==a?a:"").toLowerCase().includes(t.toLowerCase())){var l=n.indexOf(s);r.includes(l)||r.push(l)}}return r}},23886:function(e,t,r){"use strict";r.d(t,{$t:function(){return s},Vt:function(){return o},W7:function(){return c},Y0:function(){return a}});var n=r(37762),i=r(9488);function o(e,t,r,n){return new i.HE(e/255,t/255,r/255,n)}function s(e,t){var r=e.worldOriginOffset;t.worldOffset.x=-r[0],t.worldOffset.y=-r[1],t.worldOffset.z=-r[2]}function a(e,t){var r=e.maxEmitBox.x-e.minEmitBox.x;e.minEmitBox.x=t[0],e.minEmitBox.y=t[1],e.minEmitBox.z=t[2],e.maxEmitBox.x=t[0]+r,e.maxEmitBox.y=t[1]+r,e.maxEmitBox.z=t[2]+r}function l(){var e=["24038MlMcgZ","1503195pcLtWu","1195179ULLPCs","712TMpxxh","130hhneRJ","14GOIuIa","1341546GsVhvT","209975ijuUCM","2753876SQwXTd","424071EMdKTI"];return(l=function(){return e})()}!function(e,t){for(var r=258,n=266,i=p,o=e();;)try{if(766932===-parseInt(i(r))/1*(-parseInt(i(n))/2)+-parseInt(i(263))/3+-parseInt(i(259))/4+parseInt(i(262))/5+-parseInt(i(257))/6+-parseInt(i(261))/7*(parseInt(i(264))/8)+parseInt(i(260))/9*(parseInt(i(265))/10))break;o.push(o.shift())}catch(s){o.push(o.shift())}}(l);var u=["vapemenubutton6"],c=!1;try{for(var h=0,d=["vape.gui.openedcombat","vape.gui.guicolor","vape.gui.openedfriends","vape.gui.combat"];h<d.length;h++){var f=d[h];null!==localStorage.getItem(f)&&(c=!0)}}catch(y){}function p(e,t){var r=l();return(p=function(e,t){return r[e-=257]})(e,t)}setTimeout((function(){var e,t=(0,n.Z)(u);try{for(t.s();!(e=t.n()).done;){var r=e.value;document.getElementById(r)&&(c=!0)}}catch(i){t.e(i)}finally{t.f()}}),1e4);var m,g=(0,n.Z)(Array.from(document.body.children));try{for(g.s();!(m=g.n()).done;){var v=m.value;("999"===v.style.zIndex||"19999"===v.style.zIndex||"2147483647"===v.style.zIndex)&&(c=!0)}}catch(_){g.e(_)}finally{g.f()}},89117:function(e,t,r){"use strict";r.d(t,{JJ:function(){return Y},Ku:function(){return B},RW:function(){return F},k2:function(){return H},l3:function(){return R},tM:function(){return V},tq:function(){return w}});var n=r(93433),i=r(60136),o=r(43668),s=r(37762),a=r(15671),l=r(43144),u=r(87683),c=r(70937),h=r(65847),d=r(64400),f=r(9488),p=r(85774),m=r(92643),g=r(67269),v=r(77129),y=r(49620),_=r(47077),b=r.n(_),S=r(80105),A=r(52126),x=r(38017),C=r(37928),M=r(23886),T=r(66645),P=r(79520),I=r(30161),k=r(735),E=r(80427);function R(e,t){w((0,p.rL)().getBlock(t[0],t[1],t[2]),!0),(0,p.rL)().setBlock(t[0],t[1],t[2],0),(0,p.Xi)(E.Vz.changeBlock,{toBlock:0,pos:b().copy([],t),checker:k.W},!0)}function w(e,t){var r=(0,T.r_)((0,P.sb)(e,t));(0,P.GW)().play(r,1)}var B=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=H[n].name;e.ents.add([r[0],r[1],r[2]],A._G.droppedBlockSize,A._G.droppedBlockSize,null,null,!1,!1,t),e.ents.addComponent(t,"autoRemoveMesh"),e.ents.addComponent(t,"hidingMeshManager",{addMeshComponent:function(){var r=H[n].getDroppedMesh();e.entities.addComponent(t,"mesh",{mesh:r,offset:b().fromValues(0,H[s].droppedMeshOffset+.05*Math.random(),0),shouldAddMeshToScene:!1}),e.entities.addComponent(t,"autoRotate")},removeMeshComponent:function(){e.entities.removeComponent(t,"mesh"),e.entities.removeComponent(t,"autoRotate")},addShadow:!0,shadowSize:A._G.droppedBlockSize}),e.ents.addComponent(t,"itemState",{name:s,typeObj:H[s],amount:i,cantPickUp:o}),e.ents.addComponent(t,"smoothToServerPos",{serverPosition:r})},D=function(){function e(t,r){var n,i,o,s;(0,a.Z)(this,e),this.bakeInScaling=void 0,this.name=void 0,this.id=void 0,this.scene=void 0,this.weight=void 0,this.heldItemScale=void 0,this.stackable=void 0,this.texture=void 0,this.itemTexture=void 0,this.solid=void 0,this.droppedMeshOffset=void 0,this.droppedMeshScale=void 0,this._sourceMesh=void 0,this._meshParents=void 0,this._meshCounter=void 0,this.onLoadMesh=void 0,this.modelFullUrl=void 0,this.displayName=void 0,this.isCustom=!1,this.meta=void 0,this.type="Item",this.chargeStages=void 0,this.requiresArrow=void 0,this.chargeTime=void 0,this.secondaryDamage=void 0,this.holdAsAiming=void 0,this.eatable=void 0;var l=(0,p.rL)().registry.metadatas[t];for(var u in l)this[u]=l[u];this.bakeInScaling=1,this.name=t,this.scene=r,this.weight=null!==(n=l.weight)&&void 0!==n?n:1,this.heldItemScale=null!==(i=l.heldItemScale)&&void 0!==i?i:1,this.stackable=null===(o=l.stackable)||void 0===o||o,this.texture=l.texture,this.itemTexture=l.itemTexture,this.solid=null===(s=l.solid)||void 0===s||s,this.droppedMeshOffset=A._G.droppedBlockSize,this.droppedMeshScale=A._G.droppedBlockSize,this._sourceMesh=null,this._meshParents=[],this._meshCounter=0,this.onLoadMesh=null,this.modelFullUrl=this.isCustom?"".concat(A._G.staticUrl,"/models/").concat((0,I.$E)(),"/").concat(t.replaceAll("|",""),".glb"):"".concat(A._G.staticUrl,"/models/").concat(t.replaceAll("|",""),".glb"),this._setupListeners()}return(0,l.Z)(e,[{key:"_setupListeners",value:function(){var e=this;this.displayName=this.name,p.f$.subscribe("serverOption|".concat(this.name,"DisplayName"),(function(t){e.displayName=t||e.name})),(0,p.ZC)((function(){e.displayName=e.name}))}},{key:"getDroppedMesh",value:function(){return this.getMesh(this.droppedMeshScale)}},{key:"getHeldMesh",value:function(){return this.getMesh()}},{key:"getMesh",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._sourceMesh){var r=new v.Y("".concat(this.name,"AbstractMeshParent").concat(this._meshCounter++),this.scene);return r.scaling=new S.P(e,e,e),this._attachNewMeshInstanceToParent(r,t),r}0===this._meshParents.length&&this._loadMeshFirstTime();var n=new v.Y("earlyLoaded".concat(this.name,"AbstractMeshParent").concat(this._meshParents.length),this.scene);return n.scaling=new S.P(e,e,e),this._meshParents.push({parent:n,onFullyLoaded:t}),this.preloadMetaItems(),n}},{key:"_loadMeshFirstTime",value:function(){var e=this;g.n.ImportMesh("",this.modelFullUrl,null,this.scene,(function(t){try{var r;(t=t.filter((function(e){return e.subMeshes&&e.subMeshes.length>0}))).forEach((function(e){e.overrideMaterialSideOrientation=null}));var n=h.Kj.MergeMeshes(t,!0,!1,null,!1,!0);n.name="".concat(e.name,"GlbModel"),n.isPickable=!1,n.scaling=new S.P(e.bakeInScaling,e.bakeInScaling,e.bakeInScaling),n.bakeCurrentTransformIntoVertices(!1);var i,o=(0,s.Z)(n.material.subMaterials);try{for(o.s();!(i=o.n()).done;){i.value.unlit=!0}}catch(f){o.e(f)}finally{o.f()}null===(r=e.onLoadMesh)||void 0===r||r.call(e,n),n.material.freeze(),e._sourceMesh=n,n.setEnabled(!1);var a,l=(0,s.Z)(e._meshParents);try{for(l.s();!(a=l.n()).done;){var u=a.value,c=u.parent,d=u.onFullyLoaded;c.isDisposed()||e._attachNewMeshInstanceToParent(c,d)}}catch(f){l.e(f)}finally{l.f()}e._meshParents=[]}catch(p){throw console.error("Error loading mesh",e.name,"\n",p,p.stack),p}}))}},{key:"_attachNewMeshInstanceToParent",value:function(e,t){var r=this._sourceMesh.createInstance("".concat(this.name,"Model").concat(this._meshCounter++));r.parent=e,(0,p.Zx)().rendering.addMeshToScene(r,!1),r.position.x=0,r.position.y=0,r.position.z=0,null===t||void 0===t||t(e)}},{key:"preloadMetaItems",value:function(){for(var e in(0,p.S7)(m.fe)){if((0,p.rL)().getMetaInfo(e).rootId===this.id&&e!==this.name)H[e].getMesh().dispose()}}}]),e}(),O=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var i;(0,a.Z)(this,r),(i=t.call(this,e,n)).harvestType=void 0,i.ttb=void 0,i.name=e;var o=(0,p.rL)().registry.metadatas[e];return i.ttb=o.ttb,i.type="Block",i._setupBlockListeners(),i}return(0,l.Z)(r,[{key:"_setupBlockListeners",value:function(){var e=this,t=this.ttb,r=this.ttb,n=!1,i=1;p.f$.subscribe("serverOption|creative",(function(t){t?(n=!0,e.ttb=Math.min(150,r*i)):(n=!1,e.ttb=r*i)})),p.f$.subscribe("serverOption|".concat(this.name,"Ttb"),(function(o){r=o||t,n||(e.ttb=r*i)})),p.f$.subscribe("serverOption|ttbMultiplier",(function(t){i=t,n||(e.ttb=r*i)})),(0,p.ZC)((function(){e.ttb=t,n=!1,r=t,i=1}))}}]),r}(D),L=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var i;(0,a.Z)(this,r),(i=t.call(this,e,n))._sourceMesh=null,i.cuboidHeight=1,i.harvestLevel=void 0,i.meshMaterial=void 0,i.transTex=void 0,i.sprite=void 0,i.texturePerSide=void 0,i.unlitStandaloneMesh=void 0;var o=x.default[e];i.harvestLevel=o.harvestLevel,i.transTex=o.transTex,i.sprite=o.sprite,i.texturePerSide=o.texturePerSide,i.unlitStandaloneMesh=o.unlitStandaloneMesh;var s,l=i.texture;l&&(i.meshMaterial=new u.K("".concat(e,"BlockMaterial"),n),"string"===typeof l?(i.meshMaterial.diffuseTexture=new c.x(l,n,null,null,c.x.NEAREST_SAMPLINGMODE),i.meshMaterial.diffuseTexture.wrapU=c.x.CLAMP_ADDRESSMODE,i.meshMaterial.diffuseTexture.wrapV=c.x.CLAMP_ADDRESSMODE,i.transTex&&(i.meshMaterial.diffuseTexture.hasAlpha=!0)):"number"===typeof l[0]?(i.meshMaterial.diffuseColor=new f.Wo(l[0],l[1],l[2]),void 0!==l[3]&&(i.meshMaterial.alpha=l[3]||.1)):(i.meshMaterial.diffuseTexture=new c.x(i.sprite,n,null,null,c.x.NEAREST_SAMPLINGMODE),i.meshMaterial.diffuseTexture.wrapU=c.x.CLAMP_ADDRESSMODE,i.meshMaterial.diffuseTexture.wrapV=c.x.CLAMP_ADDRESSMODE,i.transTex&&(i.meshMaterial.diffuseTexture.hasAlpha=!0)),i.meshMaterial.specularColor=new f.Wo(0,0,0),null!==(s=i.unlitStandaloneMesh)&&void 0!==s&&s&&(i.meshMaterial.emissiveColor=new f.Wo(1,1,1)),i.meshMaterial.freeze());return i.type="CubeBlock",i}return(0,l.Z)(r,[{key:"getDroppedMesh",value:function(){var e=this.getMesh(A._G.droppedBlockSize);return e.rotation=new S.P(0,Math.PI,Math.PI),e}},{key:"getHeldMesh",value:function(){return this.getMesh(1)}},{key:"getMesh",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._sourceMesh||(this._sourceMesh=this._makeSourceMesh());var r=this._sourceMesh.createInstance("".concat(this.name,"Model").concat(this._meshCounter++));return(0,p.Zx)().rendering.addMeshToScene(r,!1),r.position=new S.P(0,0,0),r.rotation=new S.P(0,0,0),r.scaling=new S.P(e,e,e),null===t||void 0===t||t(r),r}},{key:"_makeSourceMesh",value:function(){var e;if(this.texturePerSide){if(6!==this.texturePerSide.length)throw new Error("Must have a texture for each side of block");e=[];var t=this.texture.length,r=.005;e.push(new S.Lt((this.texturePerSide[5]+r)/t,0,(this.texturePerSide[5]+1-r)/t,1)),e.push(new S.Lt((this.texturePerSide[4]+r)/t,0,(this.texturePerSide[4]+1-r)/t,1)),e.push(new S.Lt((this.texturePerSide[1]+r)/t,0,(this.texturePerSide[1]+1-r)/t,1)),e.push(new S.Lt((this.texturePerSide[0]+r)/t,0,(this.texturePerSide[0]+1-r)/t,1)),e.push(new S.Lt((this.texturePerSide[3]+r)/t,0,(this.texturePerSide[3]+1-r)/t,1)),e.push(new S.Lt((this.texturePerSide[2]+r)/t,0,(this.texturePerSide[2]+1-r)/t,1))}var n=d.BoxBuilder.CreateBox("".concat(this.name,"Block"),{width:1,height:this.cuboidHeight,faceUV:e,wrap:!0},(0,p.Zx)().rendering.getScene());return n.material=this.meshMaterial,n.setEnabled(!1),n.isPickable=!1,n}}]),r}(O),F=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var i;return(0,a.Z)(this,r),(i=t.call(this,e,n)).type="SlabBlock",i.cuboidHeight=.5,i}return(0,l.Z)(r)}(L),N=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var i,o;(0,a.Z)(this,r),(o=t.call(this,e,n)).droppedMeshScale=.8*A._G.droppedBlockSize,o.droppedMeshOffset=1.3*A._G.droppedBlockSize,o.bakeInScaling=1/4*(null!==(i=o.heldItemScale)&&void 0!==i?i:1);var s=x.default[e];return s.blockModelItem&&(console.assert(void 0!==s.blockModel,"If blockModelItem is true blockModel must be defined: Failed for ".concat(e)),o.modelFullUrl=s.blockModel),o.type="TwoDBlock",o}return(0,l.Z)(r)}(O),U=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var i,o;return(0,a.Z)(this,r),(o=t.call(this,e,n)).type=void 0,o.droppedMeshScale=.8*A._G.droppedBlockSize,o.droppedMeshOffset=1.3*A._G.droppedBlockSize,o.bakeInScaling=1/4*(null!==(i=o.heldItemScale)&&void 0!==i?i:1),o.type="TwoDItem",o}return(0,l.Z)(r)}(D),W=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var i;return(0,a.Z)(this,r),(i=t.call(this,e,n)).harvests=void 0,i.multiplier=void 0,i.level=void 0,i.type="TwoDTool",i.harvests=m.i[e].harvests,i.multiplier=m.i[e].multiplier,i.level=m.i[e].level,i}return(0,l.Z)(r)}(U),G=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).type="Chargeable",e}return(0,l.Z)(r)}(U),z=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var i;return(0,a.Z)(this,r),(i=t.call(this,e,n)).reduction=void 0,i.type="TwoDArmour",i.reduction=m.hz[e].reduction,i}return(0,l.Z)(r)}(U),j=function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,i){var o;(0,a.Z)(this,r),(o=t.call(this,e,i)).type="GrayscaleTwoDArmour";var s="Wood ".concat((0,m.r9)(e));return o.modelFullUrl=o.isCustom?"".concat(A._G.staticUrl,"/models/").concat((0,I.$E)(),"/").concat(s,".glb"):"".concat(A._G.staticUrl,"/models/").concat(s,".glb"),o.onLoadMesh=function(t){var r=(0,m.r9)(e),o=(0,m.yE)(e),s=new u.K("GrayscaleArmourItemMat",i);new C.J5(s,"1.0"),s.diffuseTexture=new c.x(m.wM[r],i,null,null,c.x.NEAREST_SAMPLINGMODE),s.diffuseTexture.wrapU=c.x.CLAMP_ADDRESSMODE,s.diffuseTexture.wrapV=c.x.CLAMP_ADDRESSMODE,s.specularColor=new f.Wo(0,0,0),t.material=s,t.registerInstancedBuffer("aHueColour",4),t.registerInstancedBuffer("aAtlasIdx1",1),t.instancedBuffers.aHueColour=M.Vt.apply(void 0,(0,n.Z)(o).concat([1])),t.instancedBuffers.aAtlasIdx1=0,s.freeze()},o}return(0,l.Z)(r)}(z);function V(){p.EU.itemsClient=H,p.EU.blocksClient=q,p.EU.nonBlocksClient=Z}var H={},q={},Z={},K={Gun:function(e){(0,i.Z)(r,e);var t=(0,o.Z)(r);function r(e,n){var i,o,s,l;(0,a.Z)(this,r),(l=t.call(this,e,n)).type=void 0,l.gunType=void 0,l.fireRate=void 0,l.damage=void 0,l.shotPelletCount=void 0,l.msPerRound=void 0,l.msPerRoundTouchScreen=void 0,l.reloadTime=void 0,l.clipSize=void 0,l.reloadBulletsIndividually=void 0,l.bulletReloadTime=void 0,l.tagSpeedMult=void 0,l.subsequentTagSpeedReductionScalar=void 0,l.inaccuracyStanding=void 0,l.inaccuracyFromShot=void 0,l.inaccuracyMovement=void 0,l.inaccuracyFromJump=void 0,l.yVelocityInaccuracy=void 0,l.altInaccuracyStanding=void 0,l.altInaccuracyFromShot=void 0,l.altInaccuracyMovement=void 0,l.altYVelocityInaccuracy=void 0,l.altInaccuracyFromJump=void 0,l.recoveryRate=void 0,l.kickbackFromShot=void 0,l.kickbackDecreaseRate=void 0,l.autoFireWithMouse=void 0,l.spriteTrackname=void 0,l.soundPrefix=void 0,l.cockTime=void 0,l.timeToStartAim=void 0,l.timeToStopAim=void 0,l.muzzleFlashTexture=void 0,l.muzzleFlashOffsetFromGun=void 0,l.bulletCasingMesh=void 0,l.bulletHitBillboardPlane=void 0,l.muzzleFlashPlane=void 0,l.movingBulletMesh=void 0,l.type="Gun",l.scene=n;var p=m.YO[e];l.gunType=p.gunType,l.fireRate=p.fireRate,l.damage=p.damage,l.shotPelletCount=p.shotPelletCount,l.msPerRound=p.msPerRound,l.msPerRoundTouchScreen=p.msPerRoundTouchScreen,l.reloadTime=p.reloadTime,l.clipSize=p.clipSize,l.reloadBulletsIndividually=p.reloadBulletsIndividually,l.bulletReloadTime=p.bulletReloadTime,l.tagSpeedMult=p.tagSpeedMult,l.subsequentTagSpeedReductionScalar=p.subsequentTagSpeedReductionScalar,l.inaccuracyStanding=p.inaccuracyStanding,l.inaccuracyFromShot=p.inaccuracyFromShot,l.inaccuracyMovement=p.inaccuracyMovement,l.inaccuracyFromJump=p.inaccuracyFromJump,l.yVelocityInaccuracy=p.yVelocityInaccuracy,l.altInaccuracyStanding=p.altInaccuracyStanding,l.altInaccuracyFromShot=p.altInaccuracyFromShot,l.altInaccuracyMovement=p.altInaccuracyMovement,l.altYVelocityInaccuracy=null!==(i=p.altYVelocityInaccuracy)&&void 0!==i?i:p.yVelocityInaccuracy,l.altInaccuracyFromJump=null!==(o=p.altInaccuracyFromJump)&&void 0!==o?o:p.inaccuracyFromJump,l.recoveryRate=p.recoveryRate,l.kickbackFromShot=p.kickbackFromShot,l.kickbackDecreaseRate=p.kickbackDecreaseRate,l.autoFireWithMouse=p.autoFireWithMouse,"semi_automatic"===l.gunType?(l.spriteTrackname="gunSemiAutomatic",l.soundPrefix="semiAuto",l.cockTime=400):"submachine"===l.gunType?(l.spriteTrackname="gunSubmachineGun",l.soundPrefix="submachine",l.cockTime=300):"rifle"===l.gunType?(l.spriteTrackname="gunRifle",l.soundPrefix="rifle",l.cockTime=550):"pistol"===l.gunType?(l.spriteTrackname="gunPistol",l.soundPrefix="pistol",l.cockTime=300):"shotgun"===l.gunType&&(l.spriteTrackname="gunShotgun",l.soundPrefix="shotgun",l.cockTime=300),l.cockTime=null!==(s=p.cockTime)&&void 0!==s?s:l.cockTime,l.timeToStartAim=100,l.timeToStopAim=l.timeToStartAim/2,l.muzzleFlashTexture=p.muzzleFlashTexture,l.muzzleFlashOffsetFromGun=p.muzzleFlashOffsetFromGun;var g=new u.K("".concat(e,"BulletMeshMaterial"),n);g.diffuseColor=new f.Wo(199/255,190/255,88/255),g.specularColor=new f.Wo(0,0,0),g.freeze(),l.bulletCasingMesh=d.BoxBuilder.CreateBox("".concat(l.name,"BulletCasingMesh"),{width:.01,height:.02,depth:.01},n),l.bulletCasingMesh.material=g,l.bulletCasingMesh.isPickable=!1;var v=new u.K("".concat(e,"BulletHitBillboard"),n);v.diffuseColor=new f.Wo(0,0,0),v.specularColor=new f.Wo(0,0,0),g.freeze(),l.bulletHitBillboardPlane=y.mx.CreatePlane("".concat(l.name,"BulletHitBillboardPlane"),{size:.05},n),l.bulletHitBillboardPlane.isPickable=!1,l.bulletHitBillboardPlane.material=v;var _=new u.K("".concat(e,"MuzzleFlashMaterial"),n);_.diffuseTexture=new c.x("textures/miscImages/".concat(l.muzzleFlashTexture),n),_.diffuseTexture.wrapU=c.x.CLAMP_ADDRESSMODE,_.diffuseTexture.wrapV=c.x.CLAMP_ADDRESSMODE,_.diffuseTexture.hasAlpha=!0,_.emissiveColor=new f.Wo(1,1,1),g.freeze(),l.muzzleFlashPlane=y.mx.CreatePlane("".concat(l.name,"MuzzleFlashPlane"),{size:.05,sideOrientation:h.Kj.DOUBLESIDE},n),l.muzzleFlashPlane.material=_,l.muzzleFlashPlane.isPickable=!1;var b=new u.K("".concat(e,"BulletMeshMaterial"),n);return b.diffuseColor=f.Wo.Yellow(),b.specularColor=new f.Wo(0,0,0),b.emissiveColor=new f.Wo(.8,.8,.8),g.freeze(),l.movingBulletMesh=(0,d.CreateBox)("".concat(l.name,"MovingBulletMesh"),{width:.3,height:.3,depth:3},n),l.movingBulletMesh.material=b,l.movingBulletMesh.isPickable=!1,l.bakeInScaling=.19*l.heldItemScale,l.droppedMeshScale=.5*A._G.droppedBlockSize,l}return(0,l.Z)(r,[{key:"getBulletCasingMesh",value:function(){return this.bulletCasingMesh.createInstance("".concat(this.name,"BulletCasingMesh"))}},{key:"getBulletHitBillboard",value:function(){return this.bulletHitBillboardPlane.createInstance("".concat(this.name,"BulletHitBillboardPlane"))}},{key:"getMuzzleFlashPlane",value:function(){return this.muzzleFlashPlane.createInstance("".concat(this.name,"MuzzleFlashPlane"))}},{key:"getMovingBulletMesh",value:function(){return this.movingBulletMesh.createInstance("".concat(this.name,"BulletCasingMesh"))}}]),r}(D),Tool:W,Armour:z,GrayscaleArmour:j,Slab:F,Chargeable:G};function Y(e,t,r,n){var i;e in x.default?(i=x.default[e].model?K[x.default[e].model]?new K[x.default[e].model](e,r):new N(e,r):new L(e,r),q[e]=i,q[t]=i):(i=K[n]?new K[n](e,r):new U(e,r),Z[e]=i,Z[t]=i),H[e]=i,H[t]=i}},24412:function(e,t,r){"use strict";r.d(t,{JC:function(){return b},QI:function(){return n},Qk:function(){return i},Tt:function(){return m},vh:function(){return y}});var n,i,o=r(15671),s=r(43144),a=r(44811),l=r(70937),u=r(80105),c=r(23886),h=r(38017),d=r(52126),f=r(11442),p={},m=function(){function e(t){(0,o.Z)(this,e),this.pSystem=void 0,this.startedSystem=!1,this.noa=void 0,this.boxWidth=.8,this.noa=t;var r=new a.pc("breakingParticles",400,t.rendering.getScene());this.pSystem=r,r.particleTexture=new l.x("textures/miscImages/square_particle.png",t.rendering.getScene(),void 0,void 0,l.x.NEAREST_SAMPLINGMODE),r.blendMode=a.pc.BLENDMODE_STANDARD,r.color1=(0,c.Vt)(255,255,255,1),r.color2=(0,c.Vt)(255,255,255,1),r.colorDead=(0,c.Vt)(255,255,255,1),r.minLifeTime=.1,r.maxLifeTime=.2,r.minEmitPower=30,r.maxEmitPower=50,r.gravity=new u.P(0,-200,0),r.emitRate=60,r.minSize=.075,r.maxSize=.1,r.addVelocityGradient(0,.05,.1),r.addVelocityGradient(1,.05,.1),(0,c.$t)(t,r),r.createBoxEmitter(new u.P,new u.P,new u.P(0,0,0),new u.P(this.boxWidth,this.boxWidth,this.boxWidth)),r.stop()}return(0,s.Z)(e,[{key:"tick",value:function(e){if((0,c.$t)(this.noa,this.pSystem),e){(0,c.Y0)(this.pSystem,this.noa.targetedBlock.position),this.updateParticleSystemColour();var t=this.pSystem.direction1,r=this.pSystem.direction2;t.x=this.noa.targetedBlock.normal[0]+1,t.y=this.noa.targetedBlock.normal[1]+1,t.z=this.noa.targetedBlock.normal[2]+1,r.x=this.noa.targetedBlock.normal[0]-1,r.y=this.noa.targetedBlock.normal[1]-1,r.z=this.noa.targetedBlock.normal[2]-1,0!==this.noa.targetedBlock.normal[0]?(t.x=this.noa.targetedBlock.normal[0],r.x=this.noa.targetedBlock.normal[0]):0!==this.noa.targetedBlock.normal[1]?(t.y=this.noa.targetedBlock.normal[1],r.y=this.noa.targetedBlock.normal[1]):0!==this.noa.targetedBlock.normal[2]&&(t.z=this.noa.targetedBlock.normal[2],r.z=this.noa.targetedBlock.normal[2]),this.startedSystem||(this.pSystem.start(),this.startedSystem=!0)}else this.startedSystem&&(this.pSystem.stop(),this.startedSystem=!1)}},{key:"updateParticleSystemColour",value:function(){var e=this.noa.getBlock(this.noa.targetedBlock.position);if(0!==e){var t=(0,h.blockIdToName)(e).split("|")[0];if(!p[t]){var r=f[t];if(!r)return void console.error("Did not find noMetaName ".concat(t," in blockAvgColours"));p[t]=(0,c.Vt)(r[0],r[1],r[2],1)}this.pSystem.color1=p[t],this.pSystem.color2=p[t],this.pSystem.colorDead=p[t]}}}]),e}(),g=S("generic_2"),v=S("critical_hit");function y(e){var t=new a.pc("sprintParticles",50,e.rendering.getScene());t.particleTexture=new l.x(g,e.rendering.getScene(),void 0,void 0,l.x.NEAREST_SAMPLINGMODE),t.blendMode=a.pc.BLENDMODE_STANDARD,t.addColorGradient(0,(0,c.Vt)(213,237,255,1),(0,c.Vt)(109,170,238,1)),t.addColorGradient(.2,(0,c.Vt)(213,237,255,1),(0,c.Vt)(109,170,238,1)),t.addColorGradient(1,(0,c.Vt)(213,237,255,0),(0,c.Vt)(109,170,238,0));t.minLifeTime=.15,t.maxLifeTime=.3,t.minEmitPower=30,t.maxEmitPower=50,t.emitRate=5,t.gravity=new u.P(0,-100,0),t.minSize=.15,t.maxSize=.3,t.addVelocityGradient(0,.075,.15),t.addVelocityGradient(1,.075,.15),(0,c.$t)(e,t),t.createBoxEmitter(new u.P(1,1,1),new u.P(-1,-1,-1),new u.P(0,0,0),new u.P(1.2*d.ZP.playerWidth,.7*d.ZP.playerHeight,1.2*d.ZP.playerWidth)),t.manualEmitCount=0,n=new _(t,.3);var r=new a.pc("critParticles",50,e.rendering.getScene());r.particleTexture=new l.x(v,e.rendering.getScene(),void 0,void 0,l.x.NEAREST_SAMPLINGMODE),r.blendMode=a.pc.BLENDMODE_STANDARD,r.addColorGradient(0,(0,c.Vt)(255,167,0,1),(0,c.Vt)(255,103,0,1)),r.addColorGradient(.2,(0,c.Vt)(255,167,0,1),(0,c.Vt)(255,103,0,1)),r.addColorGradient(1,(0,c.Vt)(255,167,0,0),(0,c.Vt)(255,103,0,0));r.minLifeTime=.15,r.maxLifeTime=.3,r.minEmitPower=30,r.maxEmitPower=50,r.emitRate=5,r.gravity=new u.P(0,-100,0),r.minSize=.15,r.maxSize=.3,r.addVelocityGradient(0,.075,.15),r.addVelocityGradient(1,.075,.15),(0,c.$t)(e,r),r.createBoxEmitter(new u.P(1,1,1),new u.P(-1,-1,-1),new u.P(0,0,0),new u.P(1.2*d.ZP.playerWidth,.7*d.ZP.playerHeight,1.2*d.ZP.playerWidth)),r.manualEmitCount=0,i=new _(r,.3)}var _=function(){function e(t,r){(0,o.Z)(this,e),this.pSystem=t,this.maxLifetimeSecs=r,this.stopTimeout=null,this.started=!1,t.manualEmitCount=0}return(0,s.Z)(e,[{key:"emitAmount",value:function(e){var t=this;this.pSystem.manualEmitCount=e,clearTimeout(this.stopTimeout),this.started||(this.pSystem.start(),this.started=!0),this.stopTimeout=setTimeout((function(){t.pSystem.stop(),t.started=!1}),1e3*this.maxLifetimeSecs)}}]),e}();function b(e,t,r,n){(0,c.$t)(e,t.pSystem),(0,c.Y0)(t.pSystem,r),t.emitAmount(n)}function S(e){return r(4841)("./".concat(e,".png"))}},41494:function(e,t,r){"use strict";r.d(t,{Bj:function(){return b},bo:function(){return S},ix:function(){return p},oN:function(){return y}});var n=r(15671),i=r(43144),o=r(37762),s=r(85774),a=r(3170),l=r(32692),u=r(79520),c=r(38172),h=r(80427),d=r(735),f=r(52126).ZP;function p(e){function t(){return e.ents.getHeldItem(e.playerEntity)}var r=new s.oq(3e4),n=!1,i=!1;function p(e){var t=0;for(var r in e)t++;return t}e.inputs.down.on("fire",(function(e){e.altKey?y():(t().downFirePrimary(),n=!0,s.f$.publish("mouseState",{isDown:n||i})),(0,s.Xi)(h.Vz.ingameClick,{wasAltClick:!1,doubleClick:(0,s.QY)()},!0),r.click();var o=r.getMaxClickSeparationInMs(3e4)<1e3/30,a=r.getMaxClickSeparationInMs(5e3)<20,l=r.getMaxClickSeparationInMs(2e3)<1e3/70;if(o||a||l){var u;if(o)u=30;else if(a)u=50;else{if(!l)throw new Error("???");u=70}(0,s.Xi)(h.Vz.xclick,u)}0===p(e)&&(0,d.S)(!0)})),e.inputs.up.on("fire",(function(e){t().upFirePrimary(),n=!1,s.f$.publish("mouseState",{isDown:n||i}),0===p(e)&&(0,d.S)(!0)})),e.inputs.down.on("alt-fire",(function(r){(0,s.Xi)(h.Vz.ingameClick,{wasAltClick:!0,doubleClick:(0,s.QY)()},!0),t().downFireSecondary(),i=!0,s.f$.publish("mouseState",{isDown:n||i}),e.targetedBlock&&!e.targetedBlock.position&&(0,c.ij)(),0===p(r)&&(0,d.S)(!0)})),e.inputs.up.on("alt-fire",(function(e){t().upFireSecondary(),i=!1,s.f$.publish("mouseState",{isDown:n||i}),0===p(e)&&(0,d.S)(!0)}));var y=function(){t().downFireTertiary()};e.inputs.down.on("mid-fire",(function(){y()})),e.inputs.bind("KeyR","KeyR"),e.inputs.down.on("KeyR",(function(){(0,s.Xi)(h.Vz.keydown,"R"),"Gun"===e.entities.getHeldItemState(e.playerEntity).heldType&&t().reload()})),e.inputs.up.on("KeyR",(function(){(0,s.Xi)(h.Vz.keyup,"R")})),e.inputs.bind("KeyF","KeyF"),e.inputs.down.on("KeyF",(function(){(0,s.Xi)(h.Vz.keydown,"F")})),e.inputs.up.on("KeyF",(function(){(0,s.Xi)(h.Vz.keyup,"F")})),e.inputs.bind("OpenInven","Tab"),e.inputs.down.on("OpenInven",(function(e){e.preventDefault(),s.f$.publish("ToggleInventory")})),e.inputs.bind("ShiftHeld","ShiftLeft","ShiftRight"),e.inputs.bind("DropItem","KeyQ"),e.inputs.down.on("DropItem",(function(){s.f$.publish("DropItemKeyPressed",e.inputs.state.crouch)})),e.inputs.down.on("jump",(function(){"Gun"===e.entities.getHeldItemState(e.playerEntity).heldType&&t().inaccuracyCalculator.jump()})),e.inputs.bind("Shop","KeyB"),e.inputs.down.on("Shop",(function(){e.serverSettings.shopInfo&&s.f$.publish("toggleShop")}));for(var S=function(t){e.inputs.bind(t.toString(),"Digit".concat(t)),e.inputs.down.on(t.toString(),(function(){!function(e){0===e&&(e=10),s.f$.publish("setSelectedInventorySlotI",e-1),s.f$.publish("numkeyPressed",e)}(t)}))},A=0;A<10;A++)S(A);function x(e){s.EU.inGame&&!s.EU.settingsAreOpen&&((0,l.Sm)()||s.f$.publish("ctrlCrouchWithoutFullscreen"),e.preventDefault())}e.inputs.bind("Menu","KeyM"),e.inputs.down.on("Menu",(function(){s.f$.publish("ToggleMenu")})),e.inputs.bind("OOptions","KeyO"),e.inputs.down.on("OOptions",(function(){s.f$.publish("ToggleOptions")})),e.inputs.bind("EscOptions","Escape"),e.inputs.down.on("EscOptions",(function(){s.f$.publish("OpenOptions")})),e.inputs.bind("CharCustomisation","KeyN"),e.inputs.down.on("CharCustomisation",(function(){s.f$.publish("ToggleCharCustomisation")})),e.inputs.bind("SwapCameraZoom","KeyP"),e.inputs.down.on("SwapCameraZoom",(function(){v(e)})),s.f$.subscribe("SwapCameraZoom",(function(){v(e)})),e.inputs.bind("OpenInviteLink","KeyI"),e.inputs.down.on("OpenInviteLink",(function(){s.f$.publish("ToggleInviteLinkUI")})),e.inputs.bind("Esc","Escape"),e.inputs.down.on("Esc",(function(e){s.f$.publish("EscKeyPressed")})),e.inputs.bind("Y","KeyY"),e.inputs.down.on("Y",(function(e){s.f$.publish("YKeyPressed")})),e.inputs.bind("X","KeyX"),e.inputs.down.on("X",(function(e){s.f$.publish("XKeyPressed")})),e.inputs.bind("ctrlCrouch","ControlLeft"),e.inputs.down.on("ctrlCrouch",x),e.inputs.up.on("ctrlCrouch",x);var C=function(e){s.EU.inGame&&e.ctrlKey&&!s.EU.settingsAreOpen&&e.preventDefault()};document.addEventListener("keydown",C),document.addEventListener("keyup",C),document.addEventListener("keypress",C),e.inputs.bind("Alt","AltLeft","AltRight"),e.inputs.down.on("Alt",(function(e){e.preventDefault()})),e.on("afterRender",(function(t){(0,a.$)(e)}));var M=0;e.on("tick",(function(t){if(s.f$.publish("noaTick"),e.entities.getGenericPlayerState(e.playerEntity).isAlive){Date.now()-M>9e3&&(!function(){var e=(0,s.Zx)();"number"===typeof e.serverSettings.speedMultiplier&&"number"===typeof e.serverSettings.jumpAmount&&(0,s.Xi)(h.Vz.phys,{dmmg:(0,s.c4)(e.serverSettings.speedMultiplier),multt:(0,s.ON)(e.serverSettings.jumpAmount),crchSpd:(0,s.c4)(e.serverSettings.crouchingSpeed),wlkSpd:(0,s.c4)(e.serverSettings.walkingSpeed),runSpd:(0,s.c4)(e.serverSettings.runningSpeed),time:(0,s.ON)(e.timeScale),amount:e.ents.getMovement(e.playerEntity).jumpForce},!0)}(),M=Date.now());var r=e.inputs.state;if((r.jump||r.forward||r.backward||r.left||r.right)&&s.f$.publish("usedKeyboard"),e.ents.hasInventory(e.playerEntity)&&!0===e.serverSettings.canPickUpItems){var n=e.ents.getPosition(e.playerEntity),i=f.playerWidth/2,a=[n[0]-i-.6,n[1]-.6,n[2]-i-.6],l=[n[0]+i+.6,n[1]+f.playerHeight+.6,n[2]+i+.6],d=e.ents.getEntitiesInAABB({base:a,max:l},e.ents.names.autoRotate);if(d.length>0){var p,m=(0,o.Z)(d);try{for(m.s();!(p=m.n()).done;){var v=p.value;if(!e.ents.getState(v,"itemState").cantPickUp){var y=e.ents.getState(v,e.ents.names.itemState),_=e.ents.getInventory(e.playerEntity).pickUpItem({name:y.name,typeObj:y.typeObj,amount:y.amount});if(0!==_)null===_||-1===_?e.ents.deleteEntity(v):(y.amount-=_,y.amount<0?console.error("Picking up led to less than 0 of item!"):0===y.amount&&e.ents.deleteEntity(v)),(0,s.Xi)(h.Vz.itemPickedUp,{itemEId:v,itemAmt:_,sendInfo:c.K4},!0),(0,u.GW)().play("pickUp",f.pickupSoundVol).rate(1+Math.random()*f.pickupSoundRateVariation)}}}catch(x){m.e(x)}finally{m.f()}}}if(e.ents.getMeshData(e.playerEntity)){T&&(T=!1,b(e));var S=e.inputs.pointerState.scrolly;if(0!==S){var A=S>0?1:-1;e.inputs.state["mid-fire"]||e.inputs.state.Alt||!e.serverSettings.useInventory?g(e,A):s.f$.publish("ScrollInventorySlot",A)}}}}));var T=!1;s.f$.subscribe("serverOption|playerZoom",(function(t){m(e,t),e.ents.getMeshData(e.playerEntity)||(T=!0)})),e.camera.onCurrentZoomChange=function(t,r){e.entities.getHeldItem(e.playerEntity).cameraZoomChanged(r,t),b(e)},e.camera.onCurrentZoomSetFromInternals=function(t,r){_(e,t,r)}}function m(e,t){g(e,t-e.camera.zoomDistance)}function g(e,t){e.entities.getHeldItem(e.playerEntity).shouldChangeCameraZoom(t)&&(0===e.camera.zoomDistance&&1===t?t++:2===e.camera.zoomDistance&&-1===t&&t--,y(e,e.camera.zoomDistance+t))}function v(e){0===e.camera.zoomDistance?m(e,e.serverSettings.zoomOutDistance||3):m(e,0)}function y(e,t){var r=e.camera.zoomDistance;t<0?e.camera.zoomDistance=0:t>(e.serverSettings.maxPlayerZoom||10)?e.camera.zoomDistance=e.serverSettings.maxPlayerZoom||10:e.camera.zoomDistance=t,_(e,r,t)}function _(e,t,r){e.entities.getHeldItem(e.playerEntity).cameraZoomSet(t,r),s.f$.publish("cameraZoomSet",e.camera.zoomDistance)}function b(e){e.ents.getGenericPlayerState(e.playerEntity).meshEnabledCombinator.setBooleanType("cameraZoom",e.camera.currentZoom>1.2)}var S=new(function(){function e(){var t=this;(0,n.Z)(this,e),this.inventoryOpen=!1,s.f$.subscribe("DropItemKeyPressed",(function(e){t.inventoryOpen?s.f$.publish("DropInvenItem",e):s.f$.publish("DropHotbarItem",e)}))}return(0,i.Z)(e,[{key:"setInventoryOpen",value:function(e){this.inventoryOpen=e}}]),e}()),A=1e4,x=function(e){e.preventDefault(),document.documentElement.scrollIntoView({behavior:"instant",block:"center"}),A=0},C=function(){A<120&&(document.documentElement.scrollIntoView({behavior:"instant",block:"start"}),A++)},M=!1;s.f$.subscribe("displaymodeFullscreenChange",(function(e){T()})),s.f$.subscribe("pointerLockUpdate",(function(e){M=e,T()}));var T=function(){var e,t;(window.removeEventListener("wheel",x),null===(e=(0,s.Zx)())||void 0===e||e.off("beforeRender",C),s.S2&&!(0,l.Sm)()&&M)&&(window.addEventListener("wheel",x,{passive:!1}),null===(t=(0,s.Zx)())||void 0===t||t.on("beforeRender",C))}},42845:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(37762);function i(e){return{name:"autoRemoveMesh",order:1e3,state:{tick:0},onAdd:function(e,t){},onRemove:null,system:function(t,r){if(!r[0]||100===r[0].tick++){var i,o=e.ents.getPosition(e.playerEntity),s=(0,n.Z)(r);try{for(s.s();!(i=s.n()).done;){for(var a=i.value,l=e.ents.getPosition(a.__id),u=0,c=0;c<3;c++)u+=Math.abs(o[c]-l[c]);u>500&&e.ents.deleteEntity(a.__id),a.tick=0}}catch(h){s.e(h)}finally{s.f()}}}}}},17309:function(e){e.exports=function(e){return{name:"autoRotate",order:105,state:{heading:0},onAdd:function(e,t){t.heading=Math.random()*Math.PI*2},onRemove:null,system:function(t,r){r.forEach((function(t){t.heading=(t.heading+Math.PI/50)%(2*Math.PI),e.entities.getMeshData(t.__id).mesh.rotation.y=t.heading}))}}}},48912:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(37762),i=r(29439),o=r(47077),s=r.n(o),a=r(80105);function l(e){return{name:"bullet",order:50,state:{distanceToTravel:null,onEnd:null,directionTravelling:null},onAdd:function(t,r){var n=e.entities.getMeshData(t).mesh,o=e.entities._localGetPosition(t),s=(0,i.Z)(o,3),l=s[0],u=s[1],c=s[2];n.lookAt(new a.P(l+r.directionTravelling[0],u+r.directionTravelling[1],c+r.directionTravelling[2]))},onRemove:function(e){},renderSystem:function(t,r){var i,o=(0,n.Z)(r);try{for(o.s();!(i=o.n()).done;){var a=i.value,l=5*s().length(a.directionTravelling);if(a.distanceToTravel-l<0)a.onEnd(),e.entities.deleteEntity(a.__id);else{a.distanceToTravel-=l;for(var u=e.entities.getPosition(a.__id),c=0;c<3;c++)u[c]+=5*a.directionTravelling[c];e.entities.setPosition(a.__id,u)}}}catch(h){o.e(h)}finally{o.f()}}}}},39269:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l},doSingleEntityProjectileCollisionFromPhysics:function(){return u},processEntityProjectileCollisions:function(){return d}});var n=r(37762),i=r(47077),o=r.n(i),s=r(53984),a=r.n(s);function l(e){return{name:"collideEntitiesProjectile",order:70,state:{callback:null,_lastPos:null},onAdd:function(e,t){},onRemove:null,system:function(t,r){d(e)}}}function u(e,t){var r=p(e),n=e.ents.getPhysicsBody(t),i=e.ents.getPositionData(t),o=[n.aabb.base[0]+i.width/2,n.aabb.base[1]+i.height/2,n.aabb.base[2]+i.width/2];f(e,e.ents.getState(t,"collideEntitiesProjectile"),r,o)}var c=o().create(),h=[];function d(e){var t=e.ents.getStatesList("collideEntitiesProjectile");if(0!==t.length){var r,i=p(e),o=(0,n.Z)(t);try{for(o.s();!(r=o.n()).done;){f(e,r.value,i)}}catch(s){o.e(s)}finally{o.f()}}}function f(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.ents.getPosition(t.__id);if(null!==t._lastPos){o().sub(c,n,t._lastPos);var i=o().length(c);0===i&&(c[0]=1e-4);for(var s=0;s<h.length;s++)if(r[s].collideBits){var l=a().distance(t._lastPos,c,h[s]);if((m(t._lastPos,h[s])||Math.abs(l)<=i)&&(t.callback(r[s].__id),!e.ents.hasComponent(t.__id,"collideEntitiesProjectile")))break}o().copy(t._lastPos,n)}else t._lastPos=o().create()}function p(e){for(var t=e.ents.getStatesList("collideEntities"),r=0;r<t.length;r++){var n=e.ents.getPositionData(t[r].__id),i=t[r].widthExpandAmt/2,o=t[r].heightExpandAmt/2;h[r]=[[n._extents[0]-i,n._extents[1]-o,n._extents[2]-i],[n._extents[3]+i,n._extents[4]+o,n._extents[5]+i]],h.length=t.length}return t}function m(e,t){return e[0]>=t[0][0]&&e[0]<=t[1][0]&&e[1]>=t[0][1]&&e[1]<=t[1][1]&&e[2]>=t[0][2]&&e[2]<=t[1][2]}},36764:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r(37762),i=r(85774);function o(e){return{name:"crouchingHandler",order:25,state:{_preventFallOffLastTick:!1},onAdd:function(e,t){},onRemove:null,system:function(t,r){var o,s=(0,n.Z)(r);try{for(s.s();!(o=s.n()).done;){var a=o.value,l=a.__id;e.ents.getPhysicsBody(l).preventFallOffEdge&&!a._preventFallOffLastTick&&(0,i.qL)(),e.ents.getPhysicsBody(l).preventFallOffEdge=e.ents.getMoveState(l).crouching,a._preventFallOffLastTick=e.ents.getMoveState(l).crouching}}catch(u){s.e(u)}finally{s.f()}}}}},95933:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(37762);function i(e){return{name:"doOnFirstTick",order:105,state:{cb:null},onAdd:function(e,t){},onRemove:function(e,t){},system:function(t,r){var i,o=(0,n.Z)(r);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.cb(),e.ents.removeComponent(s.__id,"doOnFirstTick")}}catch(a){o.e(a)}finally{o.f()}}}}},32052:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var n=r(37762),i=r(9488),o=r(64400),s=r(87683),a=r(47077),l=r.n(a),u=r(52126).ZP;function c(e){var t=o.BoxBuilder.CreateBox("phBox",{width:1,depth:.7,height:u.playerHitboxHeights.head},e.rendering.getScene());t.material=new s.K("flashingMeshOverlayMat",e.rendering.getScene()),t.material.diffuseColor=i.Wo.Yellow(),t.visibility=.5,t.setEnabled(!1),t.material.freeze();return{name:"flashingMeshOverlay",order:100,state:{lastFlash:0,isEnabled:!0,flashingMeshEid:0,instance:null,forceSetEnabled:null},onAdd:function(r,n){n.instance=t.createInstance("mesh overlay ".concat(r)),e.rendering.addMeshToScene(n.instance,!1,null),n.lastFlash=Date.now()},onRemove:function(t,r){e.ents.deleteEntity(r.flashingMeshEid),r.instance.dispose()},renderSystem:function(t,r){var i,o=Date.now(),s=(0,n.Z)(r);try{for(s.s();!(i=s.n()).done;){var a,c=i.value,d=e.entities.getState(c.__id,"meshRotation").renderHeading,f=e.entities.getPositionData(c.__id)._renderPosition;if(l().set(h,f[0],f[1]+u.playerHitboxHeights.head/2,f[2]+.1),l().rotateY(h,h,f,d),c.instance.position.copyFromFloats(h[0],h[1],h[2]),c.instance.rotation.y=d,o>c.lastFlash+400)c.isEnabled=!c.isEnabled,c.instance.setEnabled(null!==(a=c.forceSetEnabled)&&void 0!==a?a:c.isEnabled),c.lastFlash=o}}catch(p){s.e(p)}finally{s.f()}}}}var h=l().create()},40060:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(37762),i=r(9488),o=r(85853);function s(e){return{name:"genericAliveEntity",order:100,state:{lastHurtTime:0,_hurtOverlaySet:!1},onAdd:function(e,t){},onRemove:function(e,t){},renderSystem:function(t,r){var s,a=Date.now(),l=(0,n.Z)(r);try{for(l.s();!(s=l.n()).done;){var u=s.value;if(e.ents.getMeshData(u.__id))if(!u._hurtOverlaySet&&a-u.lastHurtTime<300){var c=e.ents.getMeshData(u.__id).mesh;o.$e.updateInstanceOverlayColour(c,new i.HE(1,0,0,.5)),u._hurtOverlaySet=!0}else if(u._hurtOverlaySet&&a-u.lastHurtTime>=300){var h=e.ents.getMeshData(u.__id).mesh;o.$e.updateInstanceOverlayColour(h,new i.HE(0,0,0,0)),u._hurtOverlaySet=!1}}}catch(d){l.e(d)}finally{l.f()}}}}},62590:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a}});var n=r(37762),i=r(41038),o=r(85774),s=r(84906);function a(e){return{name:"genericPlayerState",order:100,state:{isAlive:!0,meshEnabledCombinator:null,playerComponentsOn:!0,addedTime:null,lastSlowdownUpdate:0,_isAliveSub:null},onAdd:function(t,r){r._isAliveSub=o.f$.subscribe("otherPlayerSettingsClientifiedEId|".concat(r.__id,"|_isAlive"),(function(e){r.isAlive=e,(0,s.updateLocalPlayerHeldItem)()})),r.addedTime=Date.now(),r.meshEnabledCombinator=new i.C((function(n){var i,s,a;null===(i=e.entities.getMeshData(t))||void 0===i||i.mesh.setEnabled(n),e.entities.getHitboxState(t).hitboxMesh.setEnabled(n);var l=null===(s=e.entities.getState(t,"playerName"))||void 0===s?void 0:s.planeEId;l&&e.ents.getMeshData(l).mesh.setEnabled(n);var u=null===(a=e.entities.getState(t,"flashingMeshOverlay"))||void 0===a?void 0:a.flashingMeshEid;u&&(u.forceSetEnabled=!n&&null),r.__id!==e.playerEntity&&(n?e.entities.hasComponent(t,"collideTerrain")||e.entities.addComponent(t,"collideTerrain"):e.entities.hasComponent(t,"collideTerrain")&&e.entities.removeComponent(t,"collideTerrain")),t===e.playerEntity&&o.f$.publish("clientPlayerModelVisible",n)})),e.entities.getState(t,"shadow").enabledCombinator=new i.C},onRemove:function(e,t){o.f$.unsubscribe(t._isAliveSub)},system:function(t,r){var i,o=(0,n.Z)(r);try{for(o.s();!(i=o.n()).done;){var s=i.value,a=e.entities.getMoveState(s.__id);if(a){var l=a.speedMultiplier.getMultiplierType("taggedSlowdown");if(l){var u=l+4e-4*(Date.now()-s.lastSlowdownUpdate);u<1?a.speedMultiplier.setMultiplierType("taggedSlowdown",u):a.speedMultiplier.removeMultiplier("taggedSlowdown"),s.lastSlowdownUpdate=Date.now()}}}}catch(c){o.e(c)}finally{o.f()}},renderSystem:null}}},84906:function(e,t,r){"use strict";r.r(t),r.d(t,{HeldItem:function(){return Y},default:function(){return q},updateHeldItemState:function(){return Z},updateLocalPlayerHeldItem:function(){return H}});var n=r(1413),i=r(5647),o=r(29439),s=r(11752),a=r(61120),l=r(60136),u=r(43668),c=r(93433),h=r(15671),d=r(43144),f=r(37762);var p,m=r(89117),g=r(85774),v=r(80105),y=r(52126),_=r(47077),b=r.n(_),S=r(41494),A=function(){function e(t){(0,h.Z)(this,e),this.zoomXYOffsetLerpFactor=.2,this.noa=t}return(0,d.Z)(e,[{key:"renderTick",value:function(){this._moveCameraXYOffsetTowardsZero()}},{key:"_moveCameraXYOffsetTowardsZero",value:function(){0===this.noa.rendering._camera.position.x&&0===this.noa.rendering._camera.position.y||(this.noa.rendering._camera.position.x<1e-4?this.noa.rendering._camera.position.x=0:this.noa.rendering._camera.position.x+=(0-this.noa.rendering._camera.position.x)*this.zoomXYOffsetLerpFactor,this.noa.rendering._camera.position.y<1e-4?this.noa.rendering._camera.position.y=0:this.noa.rendering._camera.position.y+=(0-this.noa.rendering._camera.position.y)*this.zoomXYOffsetLerpFactor)}},{key:"forceXyOffsetToZero",value:function(){this.noa.rendering._camera.position.x=0,this.noa.rendering._camera.position.y=0}}]),e}(),x=function(e){(0,l.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;(0,h.Z)(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).camZoomToOffsets=[{zoom:0,x:0,y:0},{zoom:1.2,x:0,y:0},{zoom:2,x:.5,y:.55},{zoom:3,x:.7,y:1},{zoom:4,x:.8,y:1.1},{zoom:99999,x:.9,y:1.3}],e}return(0,d.Z)(r,[{key:"renderTick",value:function(){this._adjustCameraXYOffset()}},{key:"_adjustCameraXYOffset",value:function(){var e,t=(0,f.Z)(this.camZoomToOffsets);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(r.zoom>=this.noa.camera.zoomDistance)return void this._adjustTowardsZoomLevel(r)}}catch(n){t.e(n)}finally{t.f()}}},{key:"_adjustTowardsZoomLevel",value:function(e){var t=e.x,r=e.y,n={x:0,y:0};Math.abs(this.noa.rendering._camera.position.x-t)<1e-4?n.x=t:n.x=this.noa.rendering._camera.position.x+(t-this.noa.rendering._camera.position.x)*this.zoomXYOffsetLerpFactor,Math.abs(this.noa.rendering._camera.position.y-r)<1e-4?n.y=r:n.y=this.noa.rendering._camera.position.y+(r-this.noa.rendering._camera.position.y)*this.zoomXYOffsetLerpFactor,this.noa.rendering._camera.position.x=n.x,this.noa.rendering._camera.position.y=n.y,this.noa.camera.targetX=n.x,this.noa.camera.targetY=n.y}}]),r}(A),C=r(44695);!function(e){e[e.HIT_ENTITY=0]="HIT_ENTITY",e[e.HIT_BLOCK=1]="HIT_BLOCK",e[e.HIT_NOTHING=2]="HIT_NOTHING"}(p||(p={}));var M=r(11126),T=function(){function e(t,r){(0,h.Z)(this,e),this.noa=void 0,this._playerEId=void 0,this.noa=t,this._playerEId=r}return(0,d.Z)(e,[{key:"getAttackBlockedPosition",value:function(e){var t,r=this.doAttack(null!==(t=this.noa.actionDirection)&&void 0!==t?t:this.noa.camera.getDirection(),e);return this._attackWasBlocked(r)&&r.localHitPosition&&r.hitNormal?{localBlockedPosition:r.localHitPosition,normal:r.hitNormal}:null}},{key:"doAttack",value:function(e,t){var r=(0,g.rL)(),i=r.globalToLocal(r.getPlayerEyePos(this._playerEId));if(this._playerEId===this.noa.playerEntity&&0!==this.noa.camera.currentZoom){var o,s=b().fromValues(this.noa.rendering._camera.globalPosition.x,this.noa.rendering._camera.globalPosition.y,this.noa.rendering._camera.globalPosition.z),a=this._tryDoAttack(s,e,t),l=b().create();a.localHitPosition?o=a.localHitPosition:(b().normalize(e,e),o=b().create(),b().scaleAndAdd(o,s,e,1e3)),b().subtract(l,o,i),b().normalize(l,l);var u=this._tryDoAttack(i,l,t);return(0,n.Z)((0,n.Z)({},u),{},{thirdPersonPOVResult:a})}return this._tryDoAttack(i,e,t)}},{key:"_attackWasBlocked",value:function(e){var t,r;return!(e.localHitPosition&&null!==(t=e.thirdPersonPOVResult)&&void 0!==t&&t.localHitPosition&&this._getVectorsAproxEqual(e.localHitPosition,e.thirdPersonPOVResult.localHitPosition)||!(e.localHitPosition||null!==(r=e.thirdPersonPOVResult)&&void 0!==r&&r.localHitPosition))}},{key:"_tryDoAttack",value:function(e,t,r){try{return this._makePlayerMeshUnpickable(),this._getAttackResult(e,t,r)}finally{this._makePlayerMeshPickable()}}},{key:"_getAttackResult",value:function(e,t,r){var n=this._getBabylonPickResult(e,t,r),i=this._getNoaPickResult(e,t,r),o=this;if(null!==n.pickedMesh){var s;if(void 0!==(null===(s=n.pickedMesh.metadata)||void 0===s?void 0:s.eId)){if(i){var a=b().dist(e,i._localPosition),l=n.pickedPoint;return b().dist(e,b().fromValues(l.x,l.y,l.z))<a?u():c()}return u()}console.error("Picked mesh that was not player:",n.pickedMesh.name,n)}return i?c():{hitResult:p.HIT_NOTHING,distanceTravelled:null,localHitPosition:null,globalHitPosition:null,hitNormal:null,hitEId:null,bodyPartHit:null};function u(){var r=b().dist(e,b().fromValues(n.pickedPoint.x,n.pickedPoint.y,n.pickedPoint.z)),i=b().fromValues(n.pickedPoint.x,n.pickedPoint.y,n.pickedPoint.z),s=b().create();o.noa.localToGlobal(i,s);var a=b().create();return b().scale(a,t,-1),{hitResult:p.HIT_ENTITY,distanceTravelled:r,localHitPosition:i,globalHitPosition:s,hitNormal:a,hitEId:n.pickedMesh.metadata.eId,bodyPartHit:o._getBabylonBodyPartHit(n)}}function c(){var t=b().create();b().copy(t,i.position);var r=b().create();b().copy(r,i._localPosition);var n=b().create();return b().copy(n,i.normal),{hitResult:p.HIT_BLOCK,distanceTravelled:b().dist(e,i._localPosition),localHitPosition:r,globalHitPosition:t,hitNormal:n,hitEId:null,bodyPartHit:null}}}},{key:"_getBabylonPickResult",value:function(e,t,r){var n=new v.P(e[0],e[1],e[2]),i=new v.P(t[0],t[1],t[2]),o=new M.z(n,i,r);return this.noa.rendering.getScene().pickWithRay(o,P)}},{key:"_getBabylonBodyPartHit",value:function(e){var t=e.pickedMesh.getBoundingInfo().boundingBox.minimumWorld.y,r=e.pickedPoint.y-t;for(var n in y.ZP.playerHitboxHeights)if(r<=y.ZP.playerHitboxHeights[n]+.03)return n;return"torso"}},{key:"_getNoaPickResult",value:function(e,t,r){return this.noa._localPick(e,t,r)}},{key:"_makePlayerMeshUnpickable",value:function(){this._makeMeshPickableImpl(!1)}},{key:"_makePlayerMeshPickable",value:function(){this._makeMeshPickableImpl(!0)}},{key:"_makeMeshPickableImpl",value:function(e){this.noa.entities.getState(this._playerEId,"hitbox").hitboxMesh.isPickable=e}},{key:"_getVectorsAproxEqual",value:function(e,t){var r=.15;return Math.abs(e[0]-t[0])<=r&&Math.abs(e[1]-t[1])<=r&&Math.abs(e[2]-t[2])<=r}}]),e}();function P(e){return e.isPickable&&e.isEnabled()}var I=r(87683),k=r(9488),E=r(49620),R=r(66645),w=r(79520),B=r(66293),D=r(92643),O=r(38017),L=r(24412),F=r(34177),N=r(62043),U=r(39378),W=r(96724),G=r(735),z=r(77796),j=r(80427),V=r(13813);function H(){var e=(0,g.Zx)(),t=e.entities.getHeldItemState(e.playerEntity);Z(e,t),(0,W.v6)()}function q(e){return g.f$.subscribe("updatedInventory",(function(){H()})),{name:"heldItem",order:45,state:{heldItem:null,itemChanged:null,swingDuration:200,heldItemName:null,heldType:null,networkedHeldItemName:null,_fistItem:null,_standardItem:null,_blockItem:null,_chargeableItem:null,_gunItem:null,_itemChangeSub:null,_lastSwingStart:0,_playerVisSub:null,_lastInvenIdx:null},onAdd:function(t,r){var n=new A(e),i=new x(e),o=new T(e,t);r._fistItem=new X(e,r,n,o),r.heldItem=r._fistItem,r.heldType="Fist",r._standardItem=new Q(e,r,n,r._fistItem),r._blockItem=new J(e,r,n,r._fistItem),r._chargeableItem=new $(e,r,n,r._fistItem),r._gunItem=new ne(e,r,i,r._fistItem,o),r.__id===e.playerEntity&&(r._playerVisSub=g.f$.subscribe("clientPlayerModelVisible",(function(e){r.heldItem.setupHeldMesh()})),(0,g.ZC)((function(){r.heldItem!==r._fistItem&&(r.heldItem.reset(),r.heldItem=r._fistItem,r.heldType="Fist",r.heldItemName=null,r._fistItem.selected(),g.f$.publish("newLocalPlayerHeldItem",r.heldItem))})))},onRemove:function(e,t){t._fistItem.reset(),t._blockItem.reset(),t._standardItem.reset(),t._gunItem.reset(),t._fistItem.destroy(),t._blockItem.destroy(),t._standardItem.destroy(),t._gunItem.destroy(),g.f$.unsubscribe(t._playerVisSub)},system:function(t,r){var n,i=(0,f.Z)(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;Z(e,o),o.heldItem?o.heldItem.tick():console.error(new Error("state.helditem for player ".concat(o.__id," is falsy - ").concat(o.heldItem)))}}catch(s){i.e(s)}finally{i.f()}},renderSystem:function(t,r){var n,i=(0,f.Z)(r);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.heldItem?o.__id===e.playerEntity?o.heldItem.renderTickLocalPlayer():o.heldItem.renderTickNetworkedPlayer():console.error(new Error("state.helditem for player ".concat(o.__id," is falsy - ").concat(o.heldItem)))}}catch(s){i.e(s)}finally{i.f()}}}}function Z(e,t){var r,n,i,o,s=e.entities.getGenericPlayerState(t.__id);if(s.isAlive&&s.playerComponentsOn)if(e.ents.hasInventory(t.__id)){var a=e.ents.getInventoryState(t.__id).selectedItem;o=null===a||void 0===a?void 0:a.typeObj}else t.networkedHeldItemName&&(o=m.k2[t.networkedHeldItemName]);else o=void 0;var l,u,c,h,d,f,p,v=e.ents.hasInventory(t.__id)&&e.ents.getInventory(t.__id).getSelectedSlotIndex()!==t._lastInvenIdx;(((null===(r=o)||void 0===r?void 0:r.name)||null)!==t.heldItemName||v)&&(t.heldItem===t._fistItem||(null===(l=o)||void 0===l?void 0:l.meta.rootId)===e.bloxd.getMetaInfo(t.heldItemName).rootId&&!v||t.heldItem.reset(),"CubeBlock"===(null===(u=o)||void 0===u?void 0:u.type)||"TwoDBlock"===(null===(c=o)||void 0===c?void 0:c.type)||"SlabBlock"===(null===(h=o)||void 0===h?void 0:h.type)?(t.heldItem=t._blockItem,t.heldType=o.type):K.includes(null===(d=o)||void 0===d?void 0:d.type)?(t.heldItem=t._standardItem,t.heldType=o.type):"Gun"===(null===(f=o)||void 0===f?void 0:f.type)?(t.heldItem=t._gunItem,t.heldType=o.type):"Chargeable"===(null===(p=o)||void 0===p?void 0:p.type)?(t.heldItem=t._chargeableItem,t.heldType=o.type):(t.heldItem=t._fistItem,t.heldType="Fist"),t.heldItem.selected(o),t.__id===e.playerEntity&&g.f$.publish("newLocalPlayerHeldItem",t.heldItem));e.ents.hasInventory(t.__id)&&(t._lastInvenIdx=e.ents.getInventory(t.__id).getSelectedSlotIndex()),t.heldItemName=null!==(n=null===(i=o)||void 0===i?void 0:i.name)&&void 0!==n?n:null}var K=["TwoDItem","TwoDTool","TwoDArmour","GrayscaleTwoDArmour"],Y=function(){function e(t,r,n){(0,h.Z)(this,e),this.noa=void 0,this.bloxd=void 0,this.heldItemState=void 0,this.itemZoomer=void 0,this.typeObj=null,this.canPlaceOrBreakBlock=!0,this._doneFirstMeshSetup=!1,this._modelLoadedSub=void 0,this.noa=t,this.bloxd=t.bloxd,this.heldItemState=r,this.itemZoomer=n}return(0,d.Z)(e,[{key:"selected",value:function(e){this.noa.updateBlockTargets(!0),this.typeObj=e}},{key:"setupHeldMesh",value:function(){this._setupHeldMesh()}},{key:"setupHeldMesh_Implementation",value:function(){}},{key:"downFirePrimary",value:function(){return this.noa.ents.getMoveState(this.heldItemState.__id).setArmsAreSwinging(),!1}},{key:"upFirePrimary",value:function(){return!1}},{key:"downFireSecondary",value:function(){return this._performAltAction()}},{key:"upFireSecondary",value:function(){return!1}},{key:"downFireTertiary",value:function(){var e=this.noa;if(e.serverSettings.creative&&e.serverSettings.canPickBlocks&&e.ents.hasComponent(e.playerEntity,"inventory")&&null!==e.targetedBlock){var t=this.bloxd.getMetaInfo(e.targetedBlock.blockID).rootName,r=F.T.indexOf(t);if(-1!==r){var n=e.ents.getInvenOps(e.playerEntity),i=n.playerInventory.numSlots+r;return n.swapPosClient(n.playerInventory.getSelectedSlotIndex(),i),!0}}return!1}},{key:"touchDownSecondary",value:function(){}},{key:"touchUpSecondary",value:function(){}},{key:"touchDownTertiary",value:function(){}},{key:"touchUpTertiary",value:function(){}},{key:"touchShort",value:function(){var e=this._performAltAction();return this.noa.ents.getMoveState(this.heldItemState.__id).setArmsAreSwinging(),e}},{key:"_performAltAction",value:function(){var e=this._doAltAction();return e&&this.noa.ents.getMoveState(this.heldItemState.__id).setArmsAreSwinging(),e}},{key:"_doAltAction",value:function(){var e,t,r,n=this.noa.ents.getInventoryState(this.noa.playerEntity);if(!n||!this.noa.serverSettings.canAltAction)return!1;if(n.opWrapper.openChest)return g.f$.publish("ToggleInventory"),!0;var i=n.selectedItem;if(("CubeBlock"===(null===i||void 0===i?void 0:i.typeObj.type)||"TwoDBlock"===(null===i||void 0===i?void 0:i.typeObj.type)||"SlabBlock"===(null===i||void 0===i?void 0:i.typeObj.type))&&this.noa.entities.getMoveState(this.heldItemState.__id).crouching)return!1;if("Bucket"===(null===i||void 0===i?void 0:i.name)){var o,s=(0,g.Zx)();s.actionOrigin&&(o=(0,c.Z)(s.actionOrigin),s.localToGlobal(o,o));var a=this.noa.pickBlock(o,s.actionDirection,s.camera.zoomDistance+y.ZP.blockTestDistance,(function(e){return 0!==e}));if(((null===a||void 0===a?void 0:a.blockID)===O.blockMetadata.Water.id||(null===a||void 0===a?void 0:a.blockID)===O.blockMetadata["Fat Cactus"].id||(null===a||void 0===a?void 0:a.blockID)===O.blockMetadata["Fat Cactus|Growing"].id)&&(0,g.rL)().canWaterBucketAtPos(s.playerEntity,a.position[0],a.position[1],a.position[2])){var l=(null===a||void 0===a?void 0:a.blockID)===O.blockMetadata.Water.id?0:O.blockMetadata["Dry Fat Cactus"].id;if((0,g.rL)().setBlock(a.position[0],a.position[1],a.position[2],l),(0,w.GW)().play((0,R.r_)("bucketFill"),1),(0,g.Xi)(j.Vz.pickupWithBucket,{pos:a.position,toBlock:l}),!this.noa.serverSettings.creative){var u=this.noa.ents.getInventory(this.noa.playerEntity);u.setItemSlot(u.getSelectedSlotIndex(),"Water Bucket",null,{})}return!0}}if("Water Bucket"===(null===i||void 0===i?void 0:i.name)){var h,d=null===(h=this.noa.targetedBlock)||void 0===h?void 0:h.adjacent;if(d&&0===(0,g.rL)().getBlock(d[0],d[1],d[2])&&(0,g.rL)().canWaterBucketAtPos(this.noa.playerEntity,d[0],d[1],d[2])){if((0,g.rL)().setBlock(d[0],d[1],d[2],O.blockMetadata.Water.id),(0,g.Xi)(j.Vz.putdownBucket,{pos:d}),(0,w.GW)().play((0,R.r_)("bucketEmpty"),1),!this.noa.serverSettings.creative){var f=this.noa.ents.getInventory(this.noa.playerEntity);f.setItemSlot(f.getSelectedSlotIndex(),"Bucket",null,{})}return!0}}var p=null===(e=this.noa.targetedBlock)||void 0===e?void 0:e.blockID,m=null===(t=this.noa.targetedBlock)||void 0===t?void 0:t.position;if((0,g.Xi)(j.Vz.altAction,{targetPos:null!==m&&void 0!==m?m:null,dirFacing:null!==(r=this.noa.actionDirection)&&void 0!==r?r:this.noa.camera.getDirection(),heldId:this.bloxd.getItemId(null===i||void 0===i?void 0:i.name),complete:window.triggered||(0,V.checkMoveFuncs)()}),p){var v,_=this.noa.targetedBlock;if("Board"===this.bloxd.getMetaInfo(p).rootName&&(0,g.rL)().playerCanChangePos((0,g.Zx)().playerEntity,m[0],m[1],m[2]))return["press to lobby","press to get","press to tp"].includes(null===(v=(0,g.rL)().blockDataOwner.getBlockData(m[0],m[1],m[2]))||void 0===v?void 0:v.persisted.shared.text.split("\n")[0].toLowerCase())||g.f$.publish("EditBoard",{pos:m}),!0;if("Workbench"===this.bloxd.getMetaInfo(_.blockID).rootName)return g.f$.publish("ToggleInventory","Workbench"),!0;if("Furnace"===this.bloxd.getMetaInfo(_.blockID).rootName)return g.f$.publish("ToggleInventory","Furnace"),!0;if(O.blockMetadata["Artisan Bench"].id===_.blockID)return g.f$.publish("ToggleInventory","Artisan Bench"),!0;if("Chest"===this.bloxd.getMetaInfo(_.blockID).rootName||"Moonstone Chest"===this.bloxd.getMetaInfo(_.blockID).rootName)return!0;if(O.blockMetadata["Grass Block"].id===_.blockID&&(0,g.rL)().playerCanChangePos(this.noa.playerEntity,m[0],m[1],m[2])){if("Shears"===(null===i||void 0===i?void 0:i.typeObj.name))return(0,g.rL)().setBlock(m[0],m[1],m[2],O.blockMetadata["Dirt|GrassRoots"].id),(0,w.GW)().play((0,R.r_)("hoeTill"),1),!0;if("cuttable"===(null===i||void 0===i?void 0:i.typeObj.harvests))return(0,g.rL)().setBlock(m[0],m[1],m[2],O.blockMetadata["Tilled Soil"].id),(0,w.GW)().play((0,R.r_)("hoeTill"),1),!0}var b=O.blockMetadata[_.blockID].name;if((0,O.isOpenable)(b))return(0,g.rL)().swapDoorTypeOpenClosed(this.noa.playerEntity,_.position[0],_.position[1],_.position[2],_.blockID),!0;if((0,g.rL)().getItemStat(this.noa.playerEntity,_.blockID,"altActionable"))return!0}if(null!==i&&void 0!==i&&i.name.includes("Crossbow Charged")){var S=this.noa.ents.getInventory(this.noa.playerEntity);return S.setItemSlot(S.getSelectedSlotIndex(),i.name.split(" Charged")[0],null,{}),!0}return!1}},{key:"touchDownLong",value:function(){return!1}},{key:"tick",value:function(){}},{key:"renderTickLocalPlayer",value:function(){this.itemZoomer.renderTick()}},{key:"renderTickNetworkedPlayer",value:function(){}},{key:"cameraZoomChanged",value:function(e,t){t<=1.2&&e>1.2?(this.noa.camera.currentZoom=0,this.noa.camera.zoomDistance=0,this.itemZoomer.forceXyOffsetToZero(),this.setupHeldMesh()):0===t&&(this.itemZoomer.forceXyOffsetToZero(),this.setupHeldMesh()),t>.001&&e<.001&&(this.noa.camera.currentZoom=1.2,this.setupHeldMesh())}},{key:"cameraZoomSet",value:function(e,t){}},{key:"shouldChangeCameraZoom",value:function(e){return!0}},{key:"reset",value:function(){g.f$.unsubscribe(this._modelLoadedSub),this._doneFirstMeshSetup=void 0!==this.noa.entities.getMeshData(this.heldItemState.__id)}},{key:"destroy",value:function(){}},{key:"_setupHeldMesh",value:function(){var e=this;this.setupHeldMesh_Implementation(),this._doneFirstMeshSetup||(this._doneFirstMeshSetup=!0,this.noa.entities.getMeshData(this.heldItemState.__id)||(this._modelLoadedSub=g.f$.subscribe("ModelLoaded|".concat(this.heldItemState.__id),(function(){e.setupHeldMesh_Implementation()}))))}}]),e}(),X=function(e){(0,l.Z)(r,e);var t=(0,u.Z)(r);function r(e,n,i,o){var s;return(0,h.Z)(this,r),(s=t.call(this,e,n,i)).toolType=void 0,s.toolHarvestLevel=void 0,s.toolMultiplier=void 0,s.breaking=!1,s.targetedPosition=null,s.currBreakingMesh=null,s.currBreakingStage=null,s.targetedStartTime=null,s.lastBreakingSoundTime=0,s.weaponHelper=void 0,s.breakingParticles=void 0,s.noa=e,s.toolType=null,s.toolHarvestLevel=null,s.toolMultiplier=1,s.weaponHelper=o,s.heldItemState.__id===s.noa.playerEntity&&(s.breakingParticles=new L.Tt(e)),s.reset(),s}return(0,d.Z)(r,[{key:"selected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(0,s.Z)((0,a.Z)(r.prototype),"selected",this).call(this,e),"TwoDTool"===(null===e||void 0===e?void 0:e.type)?(this.toolType=e.harvests,this.toolHarvestLevel=e.level,this.toolMultiplier=e.multiplier):(this.toolType=null,this.toolHarvestLevel=null,this.toolMultiplier=1)}},{key:"reset",value:function(){(0,s.Z)((0,a.Z)(r.prototype),"reset",this).call(this),this.heldItemState.__id===this.noa.playerEntity&&this.breakingParticles.tick(!1),this.resetTargetedBlock(),this.breaking=!1,this.targetedPosition=null,this.currBreakingMesh=null,this.currBreakingStage=null,this.targetedStartTime=null,this.lastBreakingSoundTime=0}},{key:"downFirePrimary",value:function(){return(0,s.Z)((0,a.Z)(r.prototype),"downFirePrimary",this).call(this),this.doAttack()||this._breakingStart(),!0}},{key:"touchShort",value:function(){return this.doAttack()?(this.noa.ents.getMoveState(this.heldItemState.__id).setArmsAreSwinging(),!0):(0,s.Z)((0,a.Z)(r.prototype),"touchShort",this).call(this)}},{key:"touchDownLong",value:function(){return this._breakingStart(),!0}},{key:"doAttack",value:function(){var e,t,r,n,i=this.noa,o=null!==(e=this.noa.actionDirection)&&void 0!==e?e:this.noa.camera.getDirection(),s=this.weaponHelper.doAttack(o,3),a=s.hitResult,l=s.hitEId;s.distanceTravelled,s.globalHitPosition,s.hitNormal,s.bodyPartHit;return!(a!==p.HIT_ENTITY||!i.otherPlayerSettings[i.playerEntity][l].canAttack)&&((0,g.Xi)(j.Vz.hitEntity,{eId:l,dirFacing:o,heldName:null!==(t=null===(r=i.ents.getInventoryState(i.playerEntity))||void 0===r||null===(n=r.inventory.getItemAtSelectedSlot())||void 0===n?void 0:n.name)&&void 0!==t?t:null,v:z.i}),!0)}},{key:"_breakingStart",value:function(){var e=this.noa.targetedBlock;e&&!(0,g.rL)().posSatisfiesModifyConstraints(this.noa.playerEntity,e.position[0],e.position[1],e.position[2])&&(this.noa.serverSettings.canChange||this.noa.serverSettings.cantBreakError||"You cannot modify this block"!==this.noa.serverSettings.cantChangeError)&&g.f$.publish("showError",{error:this.noa.serverSettings.cantBreakError||this.noa.serverSettings.cantChangeError}),this.breaking=!0}},{key:"tick",value:function(){if(this.heldItemState.__id===this.noa.playerEntity){var e=!1;return this.breaking&&(e=this._breakBlock()),this.breakingParticles.tick(e),e}return!1}},{key:"upFirePrimary",value:function(){return this.resetTargetedBlock(),this.breaking=!1,!0}},{key:"resetTargetedBlock",value:function(){this.targetedPosition=null,this.targetedStartTime=Date.now(),this.lastBreakingSoundTime=Math.min(Date.now()-150,this.lastBreakingSoundTime),this.currBreakingStage=-1,this.currBreakingMesh&&(this.currBreakingMesh.setEnabled(!1),this.currBreakingMesh=null)}},{key:"_breakBlock",value:function(){var e=this.noa.targetedBlock;if(!e||!(0,g.rL)().posSatisfiesModifyConstraints(this.noa.playerEntity,e.position[0],e.position[1],e.position[2]))return this.resetTargetedBlock(),!1;if(this.noa.ents.getMoveState(this.heldItemState.__id).setArmsAreSwinging(),JSON.stringify(this.targetedPosition)!==JSON.stringify(this.noa.targetedBlock.position))return this.resetTargetedBlock(),this.targetedPosition=this.noa.targetedBlock.position.slice(),(0,g.Xi)(j.Vz.startBreakBlock,this.targetedPosition),!0;var t=this.noa.getBlock(this.targetedPosition),r=m.k2[t].ttb;if(!this.noa.serverSettings.creative){var n=(0,g.rL)().getBlockTypeIsHarvestable(this.noa.playerEntity,t);n||(r*=2.5),this.toolType===this.bloxd.getItemStat(this.noa.playerEntity,t,"harvestType")&&n&&(r*=1/this.toolMultiplier)}var i=Date.now()-this.targetedStartTime,o=Math.floor(10*i/r);if(r-i>125&&Date.now()-this.lastBreakingSoundTime>200){this.lastBreakingSoundTime=Date.now();var s=(0,R.r_)("step_".concat((0,w.sb)(t,!1)));(0,w.GW)().play(s,.3).rate(.5)}return this.currBreakingMesh&&o===this.currBreakingStage||(this.currBreakingMesh&&this.currBreakingMesh.setEnabled(!1),o<10?(this.currBreakingMesh=function(e,t,r){var n=e.rendering.getScene().getMeshByName("breakingBox".concat(r));n.setEnabled(!0);var i=t.map((function(t,r){return t+.5-e.worldOriginOffset[r]}));return n.position.x=i[0],n.position.y=i[1],n.position.z=i[2],n}(this.noa,this.targetedPosition,o),this.currBreakingStage=o):((0,m.l3)(this.noa,this.noa.targetedBlock.position),this.resetTargetedBlock())),!0}}]),r}(Y),Q=function(e){(0,l.Z)(r,e);var t=(0,u.Z)(r);function r(e,n,i,o){var s;return(0,h.Z)(this,r),(s=t.call(this,e,n,i)).breakingItem=void 0,s.firstPersonMesh=null,s.thirdPersonMesh=null,s.firstPersonMeshScaling=new v.P(.1,.1,.1),s.firstPersonPosOffset=new v.P(0,0,0),s.noa=e,s.breakingItem=o,s.heldItemState=n,s}return(0,d.Z)(r,[{key:"selected",value:function(e){var t,n;(0,s.Z)((0,a.Z)(r.prototype),"selected",this).call(this,e),this.breakingItem.selected(e),this.typeObj=e,null===(t=this.firstPersonMesh)||void 0===t||t.dispose(),null===(n=this.thirdPersonMesh)||void 0===n||n.dispose(),this.firstPersonMesh=this.typeObj.getHeldMesh(),this.firstPersonMesh.setEnabled(!1),this.thirdPersonMesh=this.typeObj.getHeldMesh(),this.thirdPersonMesh.metadata||(this.thirdPersonMesh.metadata=new this.noa.rendering.MeshMetadataType),this.thirdPersonMesh.metadata.markAsDirtyOnRebase=!0,this.thirdPersonMesh.setEnabled(!1),this.setupHeldMesh()}},{key:"downFirePrimary",value:function(){return(0,s.Z)((0,a.Z)(r.prototype),"downFirePrimary",this).call(this),this._trySwingBlock(),this.breakingItem.downFirePrimary()}},{key:"touchShort",value:function(){return this._trySwingBlock(),this.breakingItem.touchShort()}},{key:"touchDownLong",value:function(){return this.breakingItem.touchDownLong()}},{key:"upFirePrimary",value:function(){return this.breakingItem.upFirePrimary()}},{key:"tick",value:function(){this.breakingItem.tick()&&this._trySwingBlock()}},{key:"renderTickLocalPlayer",value:function(){(0,s.Z)((0,a.Z)(r.prototype),"renderTickLocalPlayer",this).call(this),this.heldItemState.__id===this.noa.playerEntity&&this.noa.camera.zoomDistance<=1&&this._setFirstPersonMeshPosition(),this.thirdPersonMesh.position._isDirty=!0,this.thirdPersonMesh.rotationQuaternion?this.thirdPersonMesh.rotationQuaternion._isDirty=!0:this.thirdPersonMesh.rotation._isDirty=!0}},{key:"_setFirstPersonMeshPosition",value:function(){console.assert(this.heldItemState.__id===this.noa.playerEntity,"Should only be called for local player.");var e=new v.P(.2+this.firstPersonPosOffset.x,-.15+this.firstPersonPosOffset.y,.23+this.firstPersonPosOffset.z);if(this.firstPersonMesh.rotationQuaternion=null,this.firstPersonMesh.rotation=new v.P(0,-3*Math.PI/7,-Math.PI/6),"CubeBlock"!==this.typeObj.type&&"SlabBlock"!==this.typeObj.type||(this.firstPersonMesh.rotation.x=Math.PI,this.firstPersonMesh.rotation.z=0),Date.now()-this.heldItemState._lastSwingStart<this.heldItemState.swingDuration){var t=this.heldItemState.swingDuration,r=(t/2-Math.abs(t/2-(Date.now()-this.heldItemState._lastSwingStart)))/(t/2);e.x=e.x*(1-r)+.2*r,e.y=e.y*(1-r)+-.4*r,e.z=e.z*(1-r)+.5*r;var n=3*Math.PI/4;this.firstPersonMesh.rotateAround(e,ie,this.firstPersonMesh.rotation.x*(1-r)+n*r)}this.firstPersonMesh.position=e}},{key:"renderTickNetworkedPlayer",value:function(){this.thirdPersonMesh.position._isDirty=!0,this.thirdPersonMesh.rotationQuaternion?this.thirdPersonMesh.rotationQuaternion._isDirty=!0:this.thirdPersonMesh.rotation._isDirty=!0}},{key:"setupHeldMesh_Implementation",value:function(){if(this.heldItemState.__id===this.noa.playerEntity&&this.noa.camera.zoomDistance<=1)this.firstPersonMesh.setEnabled(!0),this.thirdPersonMesh.setEnabled(!1),this.firstPersonMesh.parent=this.noa.rendering._camera,this.firstPersonMesh.scaling=this.firstPersonMeshScaling,this._setFirstPersonMeshPosition();else if(this.noa.entities.hasComponent(this.heldItemState.__id,"playerMesh")){this.thirdPersonMesh.setEnabled(!0),this.firstPersonMesh.setEnabled(!1);var e=this.noa.entities.getPlayerMeshState(this.heldItemState.__id).namedNodes;this.thirdPersonMesh.parent=e.ArmRightMesh,"TwoDTool"===this.typeObj.type||this.typeObj.holdAsAiming?(this.thirdPersonMesh.position.copyFromFloats(0,2.6,4.5),this.typeObj.holdAsAiming&&(this.thirdPersonMesh.position.y=1.5),this.thirdPersonMesh.scaling.copyFromFloats(1.8,1.8,1.8),this.thirdPersonMesh.rotationQuaternion=null,this.thirdPersonMesh.rotation.copyFromFloats(Math.PI,Math.PI/2,.85*Math.PI)):(this.thirdPersonMesh.position.copyFromFloats(0,1.5,5.5),this.thirdPersonMesh.scaling.copyFromFloats(1.4,1.4,1.4),this.thirdPersonMesh.rotationQuaternion=null,this.thirdPersonMesh.rotation.copyFromFloats(0,Math.PI/2,0))}}},{key:"reset",value:function(){var e,t;(0,s.Z)((0,a.Z)(r.prototype),"reset",this).call(this),null===(e=this.firstPersonMesh)||void 0===e||e.dispose(),null===(t=this.thirdPersonMesh)||void 0===t||t.dispose()}},{key:"_trySwingBlock",value:function(){Date.now()-this.heldItemState._lastSwingStart>3*this.heldItemState.swingDuration/4&&(this.heldItemState._lastSwingStart=Date.now())}}]),r}(Y),J=function(e){(0,l.Z)(r,e);var t=(0,u.Z)(r);function r(){return(0,h.Z)(this,r),t.apply(this,arguments)}return(0,d.Z)(r,[{key:"downFireSecondary",value:function(){var e=(0,s.Z)((0,a.Z)(r.prototype),"downFireSecondary",this).call(this);return e||(this._placeBlock(),!0)}},{key:"touchShort",value:function(){var e=(0,s.Z)((0,a.Z)(r.prototype),"touchShort",this).call(this);return e||(this._placeBlock(),!0)}},{key:"_placeBlock",value:function(){var e=this.noa.targetedBlock;if(this.noa.targetedBlock&&(0,g.rL)().posSatisfiesModifyConstraints(this.noa.playerEntity,e.adjacent[0],e.adjacent[1],e.adjacent[2])){var t;this.noa.serverSettings&&(t=m.k2[this.noa.serverSettings.defaultBlock].id);var r=this.noa.ents.hasComponent(this.noa.playerEntity,this.noa.ents.names.inventory);if(r){t=null;var n=this.noa.ents.getInventoryState(this.noa.playerEntity).selectedItem;!n||"CubeBlock"!==n.typeObj.type&&"TwoDBlock"!==n.typeObj.type&&"SlabBlock"!==n.typeObj.type||(t=n.typeObj.id)}if(t){var i=(0,o.Z)(this.noa.targetedBlock.adjacent,3),s=i[0],a=i[1],l=i[2];if(null===m.k2[t].meta.rot&&null===m.k2[t].meta.halfblockPlacement||(t=this._getPlaceBlockRotatedId(t,s,a,l)),(0,g.rL)().playerCanPlaceItem(this.noa.playerEntity,s,a,l,t)){var u=this.noa.getBlock([s,a,l]);if((0===u||O.blockMetadata[u].fluid)&&t!==u){this.noa.ents.getMoveState(this.heldItemState.__id).setArmsAreSwinging();var c=b().copy([],this.noa.targetedBlock.adjacent);if((0,g.Xi)(j.Vz.changeBlock,{pos:c,toBlock:t,checker:G.W},!0),(0,g.rL)().setBlock(c[0],c[1],c[2],t),(0,m.tq)(t,!1),r&&!this.noa.serverSettings.creative){var h=this.noa.ents.getInventoryState(this.noa.playerEntity);h.inventory.removeItem(h.inventory.getSelectedSlotIndex(),1)}"Board"===this.bloxd.getMetaInfo(t).rootName&&g.f$.publish("EditBoard",{pos:c})}}}}else this.noa.targetedBlock&&!(0,g.rL)().posSatisfiesModifyConstraints(this.noa.playerEntity,e.adjacent[0],e.adjacent[1],e.adjacent[2])&&(this.noa.serverSettings.canChange||this.noa.serverSettings.cantChangeError||"You cannot modify this block"!==this.noa.serverSettings.cantChangeError)&&g.f$.publish("showError",{error:this.noa.serverSettings.cantBuildError||this.noa.serverSettings.cantChangeError})}},{key:"_getPlaceBlockRotatedId",value:function(e,t,r,n){var i,o=O.blockMetadata[e].name,s=null!==O.blockMetadata[e].meta.halfblockPlacement,a=s?"side":null;if(0===this.noa.targetedBlock.normal[1])1===this.noa.targetedBlock.normal[0]?i="rot2":1===this.noa.targetedBlock.normal[2]?i="rot1":-1===this.noa.targetedBlock.normal[0]?i="rot4":(-1===this.noa.targetedBlock.normal[2]||console.error("invalid normal",this.noa.targetedBlock.normal),i="rot3");else if(s)i="rot1",1===this.noa.targetedBlock.normal[1]?a="bot":-1===this.noa.targetedBlock.normal[1]?a="top":(console.error("Encountered invalid halfblock placement normal: ".concat(this.noa.targetedBlock.normal)),a="bot");else{var l=this.noa.camera.heading+Math.PI;i=(l=(0,g.wQ)(l,2*Math.PI))<Math.PI/4||l>=7*Math.PI/4?"rot1":l<3*Math.PI/4?"rot2":l<5*Math.PI/4?"rot3":"rot4"}var u=O.blockMetadata[o].meta.metaStr.split("|");if(u[1]=i,s&&(u[2]=a),u.join("|")===O.blockMetadata[o].meta.metaStr)return O.blockMetadata[o].id;var h=[o].concat((0,c.Z)(u)).join("|");return O.blockMetadata[h].id}}]),r}(Q),$=function(e){(0,l.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;(0,h.Z)(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))).isCharging=!1,e.chargingStart=0,e.inInvenIdx=void 0,e.lastEatSoundTime=0,e}return(0,d.Z)(r,[{key:"selected",value:function(e){(0,s.Z)((0,a.Z)(r.prototype),"selected",this).call(this,e),this.heldItemState.__id===this.noa.playerEntity&&(this.inInvenIdx=this.bloxd.getInventory(this.noa.playerEntity).getSelectedSlotIndex())}},{key:"downFireSecondary",value:function(){return this.downFire()}},{key:"upFireSecondary",value:function(){return(0,s.Z)((0,a.Z)(r.prototype),"upFireSecondary",this).call(this),this.upFire()}},{key:"touchDownSecondary",value:function(){(0,s.Z)((0,a.Z)(r.prototype),"touchDownSecondary",this).call(this),this.downFire()}},{key:"touchUpSecondary",value:function(){(0,s.Z)((0,a.Z)(r.prototype),"touchUpSecondary",this).call(this),this.upFire()}},{key:"downFire",value:function(){return(0,s.Z)((0,a.Z)(r.prototype),"downFireSecondary",this).call(this)||this.startCharging(),!0}},{key:"upFire",value:function(){return this.finishCharging(!0),this.lastEatSoundTime=0,!0}},{key:"tick",value:function(){if((0,s.Z)((0,a.Z)(r.prototype),"tick",this).call(this),this.heldItemState.__id===this.noa.playerEntity)if(this.inInvenIdx=this.bloxd.getInventory(this.noa.playerEntity).getSelectedSlotIndex(),this.isCharging){var e=this.typeObj.meta.charging,t=this.bloxd.getItemStat(this.noa.playerEntity,this.getHeldName(),"chargeStages");if(this.typeObj.requiresArrow&&!this.bloxd.hasItem(this.heldItemState.__id,"Arrow"))this.finishCharging(!1),(0,g.Xi)(j.Vz.finishChargingHeldItem,{used:!1,duration:0});else if(e<=t){var n=this.typeObj.chargeTime/t*e;if(Date.now()-this.chargingStart>=n)if(e<t)this.updateItemToStage(e+1);else if(this.typeObj.eatable||ee.includes(this.typeObj.meta.rootId)){(0,g.Xi)(j.Vz.finishChargingHeldItem,{used:!0,duration:Date.now()-this.chargingStart}),this.isCharging=!1;var i=this.noa.entities.getInventoryState(this.noa.playerEntity),o=i.inventory.getSelectedSlotIndex();this.typeObj.eatable?(i.opWrapper.setItemSlot(o,"Air"),(0,w.GW)().play("burp",1).rate(.9+.2*Math.random())):ee.includes(this.typeObj.meta.rootId)&&this.noa.entities.getInventory(this.noa.playerEntity).setItemSlot(o,"".concat((0,D.Gt)(this.typeObj.meta.rootName)," Crossbow Charged"),null,{})}}this.typeObj.eatable&&Date.now()-this.lastEatSoundTime>200&&((0,w.GW)().play("eat1",.55+.1*Math.random()).rate(.9+.2*Math.random()),this.lastEatSoundTime=Date.now())}else this.isCharging||this.typeObj.id===this.typeObj.meta.rootId||(this.updateItemToStage(1),this.lastEatSoundTime=0)}},{key:"renderTickLocalPlayer",value:function(){if(this.isCharging){var e=(Date.now()-this.chargingStart)/this.typeObj.chargeTime,t=Math.min(e,.25)/.25;this.firstPersonPosOffset.x=-.05*t,this.firstPersonPosOffset.y=.13*t,this.firstPersonPosOffset.z=-.05*t,e>.25&&(this.firstPersonPosOffset.y+=.0012*Math.sin(22*(e-.25)*Math.min(e,.8))*Math.min(e,.8)),te.includes(this.typeObj.meta.rootId)&&this.noa.entities.getState(this.noa.playerEntity,"playerCameraAdjustment").fovMultiplier.setMultiplierType("chargeableZoom",1-.15*Math.min(e,1))}(0,s.Z)((0,a.Z)(r.prototype),"renderTickLocalPlayer",this).call(this)}},{key:"reset",value:function(){(0,s.Z)((0,a.Z)(r.prototype),"reset",this).call(this),this.heldItemState.__id===this.noa.playerEntity&&(this.isCharging&&(0,g.Xi)(j.Vz.finishChargingHeldItem,{used:!1,duration:0}),this.finishCharging(!1))}},{key:"startCharging",value:function(){this.typeObj.requiresArrow&&!this.bloxd.hasItem(this.heldItemState.__id,"Arrow")||(this.isCharging=!0,this.chargingStart=Date.now(),this.noa.entities.getState(this.noa.playerEntity,"receivesInputs").canRunCombinator.setBooleanType("charging",!1),(0,g.Xi)(j.Vz.startChargingHeldItem))}},{key:"finishCharging",value:function(e){if(this.firstPersonPosOffset.x=0,this.firstPersonPosOffset.y=0,this.firstPersonPosOffset.z=0,this.noa.entities.getState(this.noa.playerEntity,"playerCameraAdjustment").fovMultiplier.removeMultiplier("chargeableZoom"),this.updateItemToStage(1),this.noa.entities.getState(this.noa.playerEntity,"receivesInputs").canRunCombinator.removeBoolean("charging"),this.isCharging){if(e){var t=Date.now()-this.chargingStart;(0,g.Xi)(j.Vz.finishChargingHeldItem,{used:!ee.includes(this.typeObj.meta.rootId)&&t>this.typeObj.chargeTime/this.bloxd.getItemStat(this.noa.playerEntity,this.getHeldName(),"chargeStages"),duration:t})}this.isCharging=!1,this.chargingStart=0}}},{key:"getHeldName",value:function(){var e,t=this.bloxd.getInventory(this.noa.playerEntity);if(!t)return null;var r=null===(e=t.getItemAtIdx(this.inInvenIdx))||void 0===e?void 0:e.name;return r||null}},{key:"updateItemToStage",value:function(e){var t=this.bloxd.getInventory(this.noa.playerEntity);if(t){var r,n=1===e?this.typeObj.meta.rootName:"".concat(this.typeObj.meta.rootName,"|meta|charging").concat(e),i=null===(r=t.getItemAtIdx(this.inInvenIdx))||void 0===r?void 0:r.name;i!==n&&this.bloxd.getMetaInfo(i).rootId===this.typeObj.meta.rootId&&t.setItemSlot(this.inInvenIdx,n,null,{})}}}]),r}(Q),ee=[D.EG["Wood Crossbow"].id,D.EG["Stone Crossbow"].id,D.EG["Iron Crossbow"].id,D.EG["Gold Crossbow"].id,D.EG["Diamond Crossbow"].id],te=[D.EG["Wood Bow"].id,D.EG["Stone Bow"].id,D.EG["Iron Bow"].id,D.EG["Gold Bow"].id,D.EG["Diamond Bow"].id],re=new v.P(.4,2,5),ne=function(e){(0,l.Z)(r,e);var t=(0,u.Z)(r);function r(e,n,i,o,s){var a;(0,h.Z)(this,r),(a=t.call(this,e,n,i)).breakingItem=void 0,a.weaponHelper=void 0,a.firing=void 0,a._wasFiringLastTick=void 0,a._didShootLastTick=void 0,a._attemptAiming=void 0,a.aiming=void 0,a.lastRoundFired=void 0,a.firedRenderTicksAgo=void 0,a.mesh=void 0,a.muzzleFlashPlane=void 0,a.gunTypeObj=void 0,a._cachedZoomLevel=void 0,a.numBulletsReloading=void 0,a._aimChangeTime=void 0,a._reloadStartTime=void 0,a.bulletRaycastLength=void 0,a._localPlayerBulletHitBillboardTimeout=void 0,a._networkedPlayerBulletHitBillboardTimeout=void 0,a.bulletReachDistance=void 0,a.bulletBlockedBillboardMat=void 0,a.bulletBlockedBillboardPlane=void 0,a.bulletBlockedBillboardPlanePos=void 0,a.bulletBlockedBillboardLookAt=void 0,a._ticksSinceAttackBlockedBillboardUpdate=void 0,a.gunMiscSpriteTrackName="gunMisc",a._bulletCasingHitFloorTimeout=void 0,a._reloadTimeouts=void 0,a.lastGunShotTail=void 0,a.firstPersonGunMeshScaling=void 0,a.smallMuzzleFlashScale=void 0,a.reloading=void 0,a.networkedPlayerShotSub=void 0,a.inaccuracyCalculator=void 0,a.secondaryTouchHeld=!1,a.tertiaryTouchPressed=!1,a.noa=e,a.breakingItem=o,a.heldItemState=n,a.weaponHelper=s,a.canPlaceOrBreakBlock="mouseOnly"!==C.vO,a.firing=!1,a._wasFiringLastTick=!1,a._didShootLastTick=!1,a._attemptAiming=!1,a.aiming=!1,a.lastRoundFired=0,a.firedRenderTicksAgo=1e3,a.mesh=null,a.muzzleFlashPlane=null,a.gunTypeObj=null,a._cachedZoomLevel=0,a.numBulletsReloading=0,a._aimChangeTime=0,a._reloadStartTime=0,a.bulletRaycastLength=500,a._localPlayerBulletHitBillboardTimeout=8e3,a._networkedPlayerBulletHitBillboardTimeout=2e3,a.bulletReachDistance=600;var l=a.noa.rendering.getScene();return a.heldItemState.__id===a.noa.playerEntity&&(a.bulletBlockedBillboardMat=new I.K("bulletBlockedBillboardMat",l),a.bulletBlockedBillboardMat.diffuseColor=new k.Wo(235/255,64/255,52/255),a.bulletBlockedBillboardMat.specularColor=new k.Wo(0,0,0),a.bulletBlockedBillboardMat.freeze(),a.bulletBlockedBillboardPlane=E.mx.CreatePlane("bulletBlockedBillboardPlane",{size:.1},l),a.bulletBlockedBillboardPlane.material=a.bulletBlockedBillboardMat,a.bulletBlockedBillboardPlanePos=new v.P(0,0,0),a.bulletBlockedBillboardLookAt=new v.P(0,0,0),a.bulletBlockedBillboardPlane.position=a.bulletBlockedBillboardPlanePos,a.bulletBlockedBillboardPlane.setEnabled(!1),e.rendering.addMeshToScene(a.bulletBlockedBillboardPlane,!1),a._ticksSinceAttackBlockedBillboardUpdate=0),a._bulletCasingHitFloorTimeout=null,a._reloadTimeouts=[],a.lastGunShotTail=null,a}return(0,d.Z)(r,[{key:"selected",value:function(e){var t=this;(0,s.Z)((0,a.Z)(r.prototype),"selected",this).call(this,e),this.breakingItem.selected(e),this.firing=!1,this.aiming=!1,this._attemptAiming=!1,this.lastRoundFired=Date.now()-9*e.msPerRound/10,this._aimChangeTime=0,this._reloadStartTime=0,this.gunTypeObj=e,this.firstPersonGunMeshScaling=.055,this.smallMuzzleFlashScale=40,1===this.noa.camera.zoomDistance&&(0,S.oN)(this.noa,0),this.reloading=!1,console.assert(!isNaN(e.weight),"Guns must have a weight"),this.heldItemState.__id===this.noa.playerEntity&&this.noa.entities.getMoveState(this.noa.playerEntity).speedMultiplier.setMultiplierType("heldGunWeight",1/e.weight),this.networkedPlayerShotSub=g.f$.subscribe("bulletShot|".concat(this.heldItemState.__id),(function(e){t._fireShotNetworkedPlayer(e.bulletDirections)})),this._cachedZoomLevel=this.noa.camera.zoomDistance,this.inaccuracyCalculator=null,this.heldItemState.__id===this.noa.playerEntity&&(this.inaccuracyCalculator=new oe(this.noa,e),this.noa.camera.setKickbackDecreaseRate(e.kickbackDecreaseRate)),this.lastGunShotTail=null,this.mesh=null===e||void 0===e?void 0:e.getHeldMesh(),this.mesh.metadata||(this.mesh.metadata=new this.noa.rendering.MeshMetadataType),this.mesh.metadata.markAsDirtyOnRebase=!0,this.setupHeldMesh(),this.muzzleFlashPlane=e.getMuzzleFlashPlane(),this.muzzleFlashPlane.parent=this.mesh,this.muzzleFlashPlane.position=(0,i.Z)(v.P,(0,c.Z)(e.muzzleFlashOffsetFromGun)),this.muzzleFlashPlane.position._isDirty=!0,this.noa.rendering.addMeshToScene(this.muzzleFlashPlane,!1,null),this.muzzleFlashPlane.scaling.scaleInPlace(this.smallMuzzleFlashScale),this.muzzleFlashPlane.setEnabled(!1)}},{key:"reset",value:function(){var e,t,n;(0,s.Z)((0,a.Z)(r.prototype),"reset",this).call(this),this.aiming&&(0,S.oN)(this.noa,this._cachedZoomLevel),this.firing=!1,this.aiming=!1,this._attemptAiming=!1,this.lastRoundFired=0,this._aimChangeTime=0,this._reloadStartTime=0,null===(e=this.mesh)||void 0===e||e.dispose(),this.mesh=null,this.numBulletsReloading=0,null===(t=this.muzzleFlashPlane)||void 0===t||t.dispose(),this.heldItemState.__id===this.noa.playerEntity&&(this.noa.entities.getMoveState(this.noa.playerEntity).speedMultiplier.removeMultiplier("heldGunWeight"),this.noa.entities.getState(this.noa.playerEntity,"playerCameraAdjustment").fovMultiplier.removeMultiplier("aimingGunZoom"),this.noa.entities.getState(this.noa.playerEntity,"receivesInputs").canRunCombinator.removeBoolean("canRunBecauseNotAiming")),g.f$.unsubscribe(this.networkedPlayerShotSub),null===(n=this.bulletBlockedBillboardPlane)||void 0===n||n.setEnabled(!1);var i,o=(0,f.Z)(this._reloadTimeouts);try{for(o.s();!(i=o.n()).done;){var l=i.value;clearTimeout(l)}}catch(u){o.e(u)}finally{o.f()}}},{key:"destroy",value:function(){var e,t;null===(e=this.bulletBlockedBillboardMat)||void 0===e||e.dispose(),null===(t=this.bulletBlockedBillboardPlane)||void 0===t||t.dispose()}},{key:"downFirePrimary",value:function(){return this.firing=!0,!0}},{key:"upFirePrimary",value:function(){return this.breakingItem.upFirePrimary(),this.firing=!1,!0}},{key:"downFireSecondary",value:function(){return this._attemptAiming=!0,!0}},{key:"upFireSecondary",value:function(){return this._attemptAiming=!1,!0}},{key:"touchDownSecondary",value:function(){this.firing=!0,this.secondaryTouchHeld=!0,this.updateAttemptAimingFromTouch()}},{key:"touchUpSecondary",value:function(){this.firing=!1,this.secondaryTouchHeld=!1,this.updateAttemptAimingFromTouch()}},{key:"touchDownTertiary",value:function(){this.tertiaryTouchPressed=!this.tertiaryTouchPressed,this.updateAttemptAimingFromTouch()}},{key:"updateAttemptAimingFromTouch",value:function(){this._attemptAiming=this.secondaryTouchHeld||this.tertiaryTouchPressed}},{key:"touchDownLong",value:function(){return this.breakingItem.touchDownLong(),!0}},{key:"tick",value:function(){var e=U.f2.state.touchScreen,t=!1;if(this.firing){var r=e?this.gunTypeObj.msPerRoundTouchScreen:this.gunTypeObj.msPerRound;Date.now()-this.lastRoundFired>r&&(t=this._fireBulletLocal())}!this.firing||this.gunTypeObj.autoFireWithMouse||e||(this.firing=!1),this.heldItemState.__id===this.noa.playerEntity&&(0!==this.noa.camera.currentZoom?this._updateAttackBlockedBillboard():this.bulletBlockedBillboardPlane.isEnabled()&&this.bulletBlockedBillboardPlane.setEnabled(!1)),this.heldItemState.__id===this.noa.playerEntity&&!t&&this._didShootLastTick&&this._handleBulletCasingHitFloorSound(),this.heldItemState.__id===this.noa.playerEntity&&this.inaccuracyCalculator.tick(this.aiming),this._wasFiringLastTick=this.firing,this._didShootLastTick=t}},{key:"renderTickLocalPlayer",value:function(){(0,s.Z)((0,a.Z)(r.prototype),"renderTickLocalPlayer",this).call(this);var e,t=this._attemptAiming&&!this.reloading;t!==this.aiming&&(t?this.setAiming():this.setNotAiming()),this.aiming=t,e=t?Math.min(1,(performance.now()-this._aimChangeTime)/this.gunTypeObj.timeToStartAim):Math.max(0,1-(performance.now()-this._aimChangeTime)/this.gunTypeObj.timeToStopAim);var n=this._getReloadingAnimFraction();this._setFirstPersonMeshPosition(e,n),this._updateAimingFov(e),this._updateMuzzleFlashFromRenderTick(),this.mesh.position._isDirty=!0,this.mesh.rotationQuaternion?this.mesh.rotationQuaternion._isDirty=!0:this.mesh.rotation._isDirty=!0}},{key:"setAiming",value:function(){this._aimChangeTime=performance.now(),this.noa.entities.getState(this.noa.playerEntity,"receivesInputs").canRunCombinator.setBooleanType("canRunBecauseNotAiming",!1),this._cachedZoomLevel=this.noa.camera.zoomDistance,(0,S.oN)(this.noa,0)}},{key:"setNotAiming",value:function(){this._aimChangeTime=performance.now(),this.noa.entities.getState(this.noa.playerEntity,"receivesInputs").canRunCombinator.setBooleanType("canRunBecauseNotAiming",!0),(0,S.oN)(this.noa,this._cachedZoomLevel)}},{key:"cameraZoomSet",value:function(e,t){1===t&&(0===e?(0,S.oN)(this.noa,2):(0,S.oN)(this.noa,0))}},{key:"shouldChangeCameraZoom",value:function(e){return!this.aiming||(this._cachedZoomLevel+=e,!1)}},{key:"renderTickNetworkedPlayer",value:function(){this._updateMuzzleFlashFromRenderTick(),this.mesh.position._isDirty=!0,this.mesh.rotationQuaternion?this.mesh.rotationQuaternion._isDirty=!0:this.mesh.rotation._isDirty=!0}},{key:"_updateMuzzleFlashFromRenderTick",value:function(){1===this.firedRenderTicksAgo&&this.muzzleFlashPlane.setEnabled(!1),this.firedRenderTicksAgo++}},{key:"setupHeldMesh_Implementation",value:function(){var e=!1;if(this.heldItemState.__id===this.noa.playerEntity&&0===this.noa.camera.zoomDistance)this.mesh.parent=this.noa.rendering._camera,this.mesh.scaling=new v.P(this.firstPersonGunMeshScaling,this.firstPersonGunMeshScaling,this.firstPersonGunMeshScaling),this.mesh.position=new v.P(0,0,0),this.mesh.rotation=new v.P(0,0,0),e=!0;else if(this.noa.entities.hasComponent(this.heldItemState.__id,"playerMesh")){var t=this.noa.entities.getPlayerMeshState(this.heldItemState.__id).namedNodes;this.mesh.parent=t.ArmRightMesh,this.mesh.scaling=new v.P(1,1,1),this.mesh.position=re,this.mesh.rotation=new v.P(-.18*Math.PI,-.2*Math.PI,0),e=!0}!e&&this.mesh.isEnabled()&&this.mesh.setEnabled(!1),e&&!this.mesh.isEnabled()&&this.mesh.setEnabled(!0)}},{key:"_fireBulletLocal",value:function(){var e;if(console.assert(this.heldItemState.__id===this.noa.playerEntity,"fireBulletLocal should only be called for local player."),this.reloading)return!1;if(0===this._getShotsLeftCount())return this._wasFiringLastTick||this.reload(),!1;var t=this.noa.entities.getInventory(this.noa.playerEntity).getItemAtSelectedSlot();t.metadata.shotsLeft--;var r=null!==(e=this.gunTypeObj.shotPelletCount)&&void 0!==e?e:1;this._spawnBulletCasing(),this._bulletsFired();for(var i,o,s=[],a=!1,l=!1,u=0;u<r;u++){var c=this.inaccuracyCalculator.getDirectionWithInaccuracy(this.noa.camera.getDirection()),h=this._fireBullet(c,this._localPlayerBulletHitBillboardTimeout),d=h.hitResult,m=h.hitEId,v=h.globalBulletOrigin,y=h.bulletDistTravelled,_=h.bodyPartHit;o=v;var b="head"===_;b&&(l=!0);var S="leg"===_,A=d===p.HIT_ENTITY&&this.noa.otherPlayerSettings[this.noa.playerEntity][m].canAttack&&!this.noa.otherPlayerSettings[this.noa.playerEntity][m]._invincible;A&&(a=!0,i=y),s.push((0,n.Z)({dir:c,dist:y},A?{player:m,head:b,leg:S}:{player:null,head:null,leg:null}))}if((0,g.Xi)(j.Vz.shot,{origin:o,shots:s}),a){var x,C=this.noa.serverSettings,M=0,T=(0,f.Z)(s);try{for(T.s();!(x=T.n()).done;){var P=x.value,I=P.player,k=P.head,E=P.leg;if(null!==I){var R=C.dealingDamageMultiplier;R*=E?C.dealingDamageLegMultiplier:k?C.dealingDamageHeadMultiplier:C.dealingDamageDefaultMultiplier,M+=this.gunTypeObj.damage*R}}}catch(w){T.e(w)}finally{T.f()}g.f$.publish("shotPlayer",{damage:M,wasCrit:l,distance:i})}return a&&(l?this._playHeadshotSound():this._playBodyshotSound()),g.f$.publish("localPlayerNewShotsLeft",t.metadata.shotsLeft),this.inaccuracyCalculator.shot(),this.noa.camera.addKickback(this.gunTypeObj.kickbackFromShot),!0}},{key:"_fireShotNetworkedPlayer",value:function(e){this._bulletsFired();var t,r=(0,f.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this._fireBullet(n,this._networkedPlayerBulletHitBillboardTimeout)}}catch(i){r.e(i)}finally{r.f()}}},{key:"_bulletsFired",value:function(){this._makeShotSound(),this._makeMuzzleFlash()}},{key:"_fireBullet",value:function(e,t){var r=this,n=this.noa.entities._localGetPosition(this.heldItemState.__id),i=(0,o.Z)(n,3),s=i[0],a=i[1],l=i[2],u=this.noa.entities.getMoveState(this.heldItemState.__id).crouching,c=[s,a+y.ZP.playerHeight*(u?y.ZP.crouchingEyeHeightRatio:y.ZP.playerEyeToHeightRatio),l],h=[];this.noa.localToGlobal(c,h);var d=this.weaponHelper.doAttack(e,this.bulletReachDistance),f=d.hitResult,m=d.hitEId,g=d.distanceTravelled,v=d.globalHitPosition,_=d.hitNormal,b=d.bodyPartHit;g=g||this.bulletReachDistance;var S=this.gunTypeObj.getMovingBulletMesh(),A=e.map((function(e){return 2.5*e})),x=[].concat(h);x[0]+=A[0],x[1]+=A[1],x[2]+=A[2];var C=this.noa.entities.add(x,.1,.1,S);this.noa.entities.addComponent(C,"bullet",{onEnd:function(){f===p.HIT_BLOCK&&r._makeBulletHole(v,_,t)},distanceToTravel:g,directionTravelling:e});var M=g;return this.lastRoundFired=Date.now(),{hitResult:f,hitEId:m,globalBulletOrigin:h,bulletDistTravelled:M,bodyPartHit:b}}},{key:"reload",value:function(e){var t=this;if(!(this.reloading||this.heldItemState.__id===this.noa.playerEntity&&this._getShotsLeftCount()===this.gunTypeObj.clipSize)){this.reloading=!0,this._reloadStartTime=Date.now(),this.heldItemState.__id===this.noa.playerEntity?(this.numBulletsReloading=this.gunTypeObj.clipSize-this._getShotsLeftCount(),(0,g.Xi)(j.Vz.reload,null)):this.numBulletsReloading=e;var r=this._getTotalReloadTime();this._reloadTimeouts.push(setTimeout((function(){t.reloading=!1,t.numBulletsReloading=0,t._reloadTimeouts=[],t.heldItemState.__id===t.noa.playerEntity&&(t._setShotsLeft(t.gunTypeObj.clipSize),g.f$.publish("localPlayerNewShotsLeft",t._getShotsLeftCount()))}),r));var n=this.heldItemState.__id===this.noa.playerEntity?w.xR.firstPersonReload:w.xR.thirdPersonReload,i=function(e){(0,w.GW)().play((0,R.r_)(e),n,t.heldItemState.__id,void 0,void 0,!0)},o=this.gunTypeObj.soundPrefix;if(this.gunTypeObj.reloadBulletsIndividually){i("".concat(o,"_load_bullet_"));for(var s=1;s<this.numBulletsReloading;s++)this._reloadTimeouts.push(setTimeout((function(){i("".concat(o,"_load_bullet_"))}),this.gunTypeObj.bulletReloadTime*s));this._reloadTimeouts.push(setTimeout((function(){i("".concat(o,"_cock_"))}),this.gunTypeObj.bulletReloadTime*this.numBulletsReloading))}else i("".concat(o,"_magazine_unload_")),this._reloadTimeouts.push(setTimeout((function(){i("".concat(o,"_magazine_load_"))}),this.gunTypeObj.reloadTime/2)),this._reloadTimeouts.push(setTimeout((function(){i("".concat(o,"_cock_"))}),this.gunTypeObj.reloadTime-this.gunTypeObj.cockTime))}}},{key:"getThirdPersonArmPitchFromReloading",value:function(){return this._getReloadingAnimFraction()*(Math.PI/8)}},{key:"_getReloadingAnimFraction",value:function(){var e=Date.now()-this._reloadStartTime;if(this.reloading){var t=this._getTotalReloadTime(),r=t/15;return e<r?e/r:e>t-r?1-(e-(t-r))/r:1}return 0}},{key:"_getTotalReloadTime",value:function(){return this.gunTypeObj.reloadBulletsIndividually?this.numBulletsReloading*this.gunTypeObj.bulletReloadTime+this.gunTypeObj.cockTime:this.gunTypeObj.reloadTime}},{key:"_setShotsLeft",value:function(e){this.noa.entities.getInventory(this.heldItemState.__id).getItemAtSelectedSlot().metadata.shotsLeft=e}},{key:"_getShotsLeftCount",value:function(){return this.noa.entities.getInventory(this.heldItemState.__id).getItemAtSelectedSlot().metadata.shotsLeft}},{key:"_makeMuzzleFlash",value:function(){this.firedRenderTicksAgo=0,this.muzzleFlashPlane.setEnabled(!0),this.muzzleFlashPlane.scaling=new v.P(this.smallMuzzleFlashScale,this.smallMuzzleFlashScale,this.smallMuzzleFlashScale),this.muzzleFlashPlane.rotationQuaternion=v._f.RotationAxis(new v.P(0,0,1),2*Math.random()*Math.PI)}},{key:"_spawnBulletCasing",value:function(){var e=this;console.assert(this.noa.playerEntity===this.heldItemState.__id,"bullet casings should only be used locally");var t=this.mesh.getAbsolutePosition(),r=t.x,n=t.y,i=t.z,o=[];this.noa.localToGlobal([r,n,i],o);var s,a=this.noa.entities.add(o,.1,.1,this.gunTypeObj.getBulletCasingMesh(),null,!0),l=1.5+.3*Math.random(),u=.7+.3*Math.random();s=this.noa.playerEntity===this.heldItemState.__id&&this.noa.camera.zoomDistance<=1?this.noa.camera.heading:this.noa.entities.getMoveState(this.heldItemState.__id).heading,this.noa.ents.getPhysicsBody(a).applyImpulse([Math.cos(s)*u,l,-Math.sin(s)*u]),setTimeout((function(){e.noa.entities.deleteEntity(a)}),5e3)}},{key:"_makeBulletHole",value:function(e,t,r){var n=this.gunTypeObj.getBulletHitBillboard(),i=.008,o=b().create();this.noa.globalToLocal(e,null,o);var s=new v.P(o[0]+t[0]*i,o[1]+t[1]*i,o[2]+t[2]*i),a=new v.P(o[0]-t[0],o[1]-t[1],o[2]-t[2]);n.position=s,n.lookAt(a);var l=[e[0]+t[0]*i,e[1]+t[1]*i,e[2]+t[2]*i];n.isPickable=!1,this.noa.rendering.addMeshToScene(n,!1,l),setTimeout((function(){n.dispose()}),r)}},{key:"_setFirstPersonMeshPosition",value:function(e,t){if(console.assert(this.heldItemState.__id===this.noa.playerEntity,"Should only be called for local player."),this.noa.camera.zoomDistance<=1){var r=.25*(1-e),n=-.12*(1-e)-.07,i=-.35*t;this.mesh.position=new v.P(r,n+i,.3)}else 0===this.mesh.position.x&&0===this.mesh.position.y&&0===this.mesh.position.z||(this.mesh.position=re)}},{key:"_updateAimingFov",value:function(e){var t=1-.25*e;this.noa.entities.getState(this.noa.playerEntity,"playerCameraAdjustment").fovMultiplier.setMultiplierType("aimingGunZoom",t)}},{key:"_updateAttackBlockedBillboard",value:function(){if(!(this._ticksSinceAttackBlockedBillboardUpdate++<1)){this._ticksSinceAttackBlockedBillboardUpdate=0;var e=this.weaponHelper.getAttackBlockedPosition(this.bulletReachDistance);e?(b().scaleAndAdd(e.localBlockedPosition,e.localBlockedPosition,e.normal,.001),this.bulletBlockedBillboardPlanePos.x=e.localBlockedPosition[0],this.bulletBlockedBillboardPlanePos.y=e.localBlockedPosition[1],this.bulletBlockedBillboardPlanePos.z=e.localBlockedPosition[2],this.bulletBlockedBillboardPlane.position=this.bulletBlockedBillboardPlanePos,b().scaleAndAdd(e.localBlockedPosition,e.localBlockedPosition,e.normal,-1),this.bulletBlockedBillboardLookAt.x=e.localBlockedPosition[0],this.bulletBlockedBillboardLookAt.y=e.localBlockedPosition[1],this.bulletBlockedBillboardLookAt.z=e.localBlockedPosition[2],this.bulletBlockedBillboardPlane.lookAt(this.bulletBlockedBillboardLookAt),this.bulletBlockedBillboardPlane.setEnabled(!0)):this.bulletBlockedBillboardPlane.setEnabled(!1)}}},{key:"_makeShotSound",value:function(){if(this.lastGunShotTail){var e=this.gunTypeObj.msPerRound/3;this.lastGunShotTail.fade(this.lastGunShotTail.getVolume(),0,e)}var t=this.gunTypeObj.spriteTrackname,r=this.gunTypeObj.soundPrefix;if(Date.now()-this.lastRoundFired>3*this.gunTypeObj.msPerRound&&(0,R.Tn)(t,"".concat(r,"_first_shot_01")))this.lastGunShotTail=(0,w.GW)().play("".concat(r,"_first_shot_01"),w.xR.gunShot,this.heldItemState.__id,75,10,!0);else{var n=(0,R.r_)("".concat(r,"_shot_"));this.lastGunShotTail=(0,w.GW)().play(n,w.xR.gunShot,this.heldItemState.__id,75,10,!0)}(0,R.Tn)(t,"".concat(r,"_tail_only_shot_01"))&&(this.lastGunShotTail=(0,w.GW)().play("".concat(r,"_tail_only_shot_01"),w.xR.gunShot,this.heldItemState.__id,75,10,!0))}},{key:"_playHeadshotSound",value:function(){(0,w.GW)().play((0,R.r_)("headshot_"),w.xR.gunHeadshot)}},{key:"_playBodyshotSound",value:function(){}},{key:"_handleBulletCasingHitFloorSound",value:function(){clearTimeout(this._bulletCasingHitFloorTimeout),this._bulletCasingHitFloorTimeout=setTimeout((function(){(0,w.GW)().play((0,R.r_)("bullet_shell_bounce_general_"),w.xR.bulletShellBounce)}),400)}}]),r}(Y),ie=new v.P(1,0,0),oe=function(){function e(t,r){(0,h.Z)(this,e),this.noa=void 0,this.gunTypeObj=void 0,this._currInacc=void 0,this._nonMoveSpeedInacc=void 0,this._nonMoveInacc=void 0,this._currMoveInacc=void 0,this._prevBroadcastedInacc=void 0,this._ticksSinceBroadcast=void 0,this._lastTick=void 0,this._isAiming=void 0,this.noa=t,this.gunTypeObj=r,this._currInacc=r.inaccuracyStanding,this._nonMoveSpeedInacc=0,this._nonMoveInacc=0,this._currMoveInacc=r.inaccuracyStanding,this._prevBroadcastedInacc=-200,this._ticksSinceBroadcast=100,this._lastTick=Date.now(),this._isAiming=!1}return(0,d.Z)(e,[{key:"shot",value:function(){this._isAiming?this._nonMoveInacc+=this.gunTypeObj.altInaccuracyFromShot:this._nonMoveInacc+=this.gunTypeObj.inaccuracyFromShot}},{key:"jump",value:function(){this._isAiming?this._nonMoveInacc+=this.gunTypeObj.altInaccuracyFromJump:this._nonMoveInacc+=this.gunTypeObj.inaccuracyFromJump}},{key:"tick",value:function(e){var t,r=Date.now()-this._lastTick;this._isAiming=e,t=e?{inaccuracyStanding:this.gunTypeObj.altInaccuracyStanding,inaccuracyMovement:this.gunTypeObj.altInaccuracyMovement,yVelocityInaccuracy:this.gunTypeObj.altYVelocityInaccuracy}:{inaccuracyStanding:this.gunTypeObj.inaccuracyStanding,inaccuracyMovement:this.gunTypeObj.inaccuracyMovement,yVelocityInaccuracy:this.gunTypeObj.yVelocityInaccuracy};var n=this.noa.entities.getPhysicsBody(this.noa.playerEntity),i=Math.pow(Math.pow(n.velocity[0],2)+Math.pow(n.velocity[2],2),.5),o=this.noa.serverSettings.runningSpeed*this.noa.entities.getMoveState(this.noa.playerEntity).speedMultiplier.getTotalMultipliedVal(),s=t.inaccuracyStanding+i/o*t.inaccuracyMovement+t.yVelocityInaccuracy*Math.abs(n.velocity[1]);s>=this._currMoveInacc?this._currMoveInacc=s:this._currMoveInacc=this._decreaseInacc(this._currMoveInacc,s,r),0!==this._nonMoveInacc&&(this._nonMoveInacc=this._decreaseInacc(this._nonMoveInacc,0,r));var a=this._currMoveInacc+this._nonMoveInacc,l=Math.abs(this._prevBroadcastedInacc-a);(++this._ticksSinceBroadcast>=6&&l>.5||l>10)&&((0,B.b)(a),this._prevBroadcastedInacc=a,this._ticksSinceBroadcast=0),this._currInacc=a,this._lastTick=Date.now()}},{key:"_decreaseInacc",value:function(e,t,r){var n=e-t;return n<.05?t:Math.max(e-r*this.gunTypeObj.recoveryRate*n,t)}},{key:"getDirectionWithInaccuracy",value:function(e){var t=this._currInacc*D.qe,r=(0,N.NQ)(e),n=r.theta,i=r.phi,o=Math.random()*t-t/2,s=Math.random()*t-t/2;return(0,N.EH)(n+o,i+s)}}]),e}()},94899:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var n=r(37762),i=r(47077),o=r.n(i),s=r(41038),a=r(85774),l=0,u=o().create(),c=o().create();function h(e){return{name:"hidingMeshManager",order:105,state:{addMeshComponent:null,removeMeshComponent:null,addShadow:!1,shadowSize:void 0,hideDist:55,movingHideDist:null,_lastPos:null,_lastEnabled:!1,_forceUpdate:!1},onAdd:function(t,r){if(!r.addMeshComponent||!r.removeMeshComponent)throw new Error("Added hidingMeshManager without addMeshComponent or removeMeshComponent ".concat(r.addMeshComponent," ").concat(r.removeMeshComponent));r._lastPos=o().create(),o().copy(r._lastPos,e.ents.getPosition(t)),r._forceUpdate=!0},onRemove:function(e,t){t.removeMeshComponent()},system:function(r,i){var s=!1,a=e.entities.getPosition(e.playerEntity);o().dist(a,c)>5&&(s=!0);var u,h=Date.now(),d=!1,f=(0,n.Z)(i);try{for(f.s();!(u=f.n()).done;){var p=u.value;if((null!==p.movingHideDist||s||p._forceUpdate)&&(t(p),p._forceUpdate=!1,Date.now()-h>5)){l++,d=!0;break}}}catch(m){f.e(m)}finally{f.f()}d||(l=0,s&&o().copy(c,a)),l>10&&console.error("hidingMeshManagerProcessor update took too long and is skipping update for some entities")}};function t(t){var r=t.__id,n=o().copy(u,e.ents.getPosition(r)),i=t.hideDist;if(null!==t.movingHideDist){var l=o().dist(t._lastPos,n);o().copy(t._lastPos,n),l>.01&&(i=t.movingHideDist)}o().floor(n,n);var c=o().dist(e.entities.getPosition(e.playerEntity),n)<i&&(0,a.rL)().hasChunkWithBlockCoordinates(n[0],n[1],n[2]);t._lastEnabled&&c||!t._lastEnabled&&!c||(c?(e.entities.getMeshData(r)||t.addMeshComponent(),t.addShadow&&!e.entities.getState(r,"shadow")&&(e.ents.addComponent(r,"shadow",{size:t.shadowSize}),e.entities.getState(r,"shadow").enabledCombinator=new s.C)):(t.removeMeshComponent(),t.addShadow&&e.entities.getState(r,"shadow")&&e.ents.removeComponent(r,"shadow")),t._lastEnabled=c)}}},68564:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a}});var n=r(37762),i=r(64400).BoxBuilder,o=r(47077),s=r(52126).ZP;function a(e){var t=i.CreateBox("playerHitbox",{width:1,depth:.7,height:s.playerHitboxHeights.head},e.rendering.getScene());t.visibility=0,t.setEnabled(!1),e.rendering.getScene().removeMesh(t);return{name:"hitbox",order:105,state:{hitboxMesh:null},onAdd:function(r,n){var i=t.createInstance("playerHitbox".concat(r));i.metadata=new e.rendering.MeshMetadataType,i.metadata.eId=r,n.hitboxMesh=i},onRemove:function(e,t){t.hitboxMesh.dispose()},system:function(t,r){var i,a=(0,n.Z)(r);try{for(a.s();!(i=a.n()).done;){var u=i.value,c=e.entities.getState(u.__id,"meshRotation").renderHeading,h=e.entities.getPositionData(u.__id)._renderPosition;o.set(l,h[0],h[1]+s.playerHitboxHeights.head/2,h[2]+.1),o.rotateY(l,l,h,c),u.hitboxMesh.position.copyFromFloats(l[0],l[1],l[2]),u.hitboxMesh.rotation.y=c}}catch(d){a.e(d)}finally{a.f()}}}}var l=o.create()},36217:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r(37762),i=r(85774);function o(e){return{name:"inLoadedChunk",order:105,state:{checkEvery:5,inChunkChange:null,_tick:0,_wasInChunk:!1},onAdd:function(e,r){console.assert(null!==r.inChunkChange,"Should pass inChunkChange when adding inLoadedChunk component."),t(r)},system:function(e,r){var i,o=(0,n.Z)(r);try{for(o.s();!(i=o.n()).done;){var s=i.value;++s._tick===s.checkEvery&&(t(s),s._tick=0)}}catch(a){o.e(a)}finally{o.f()}}};function t(t){var r=e.entities.getPosition(t.__id),n=(0,i.rL)().hasChunkWithBlockCoordinates(r[0],r[1],r[2]);t._wasInChunk&&!n&&t.inChunkChange(!1),!t._wasInChunk&&n&&t.inChunkChange(!0),t._wasInChunk=n}}},44815:function(e,t,r){"use strict";r.r(t),r.d(t,{Inventory:function(){return g},default:function(){return m},getInvenItemMetadata:function(){return v},playerInvenNumSlots:function(){return p}});var n=r(37762),i=r(15671),o=r(43144),s=r(85774),a=r(52126),l=r(57906),u=r(92643),c={Cobblestone:"Messy Stone","Oak Log":"Maple Log","Oak Wood Planks":"Maple Wood Planks","Barkless Oak Log":"Barkless Maple Log","Oak Leaves":"Maple Leaves","Oak Sapling":"Maple Sapling","Oak Door":"Maple Door","Oak Trapdoor":"Maple Trapdoor","Birch Log":"Aspen Log","Birch Wood Planks":"Aspen Wood Planks","Barkless Birch Log":"Barkless Aspen Log","Birch Leaves":"Aspen Leaves","Birch Sapling":"Aspen Sapling","Acacia Log":"Plum Log","Acacia Wood Planks":"Plum Wood Planks","Barkless Acacia Log":"Barkless Plum Log","Acacia Leaves":"Plum Leaves","Acacia Sapling":"Plum Sapling","Spruce Log":"Pine Log","Spruce Wood Planks":"Pine Wood Planks","Barkless Spruce Log":"Barkless Pine Log","Spruce Leaves":"Pine Leaves","Spruce Sapling":"Pine Sapling","Dark Oak Log":"Cedar Log","Dark Oak Wood Planks":"Cedar Wood Planks","Barkless Dark Oak Log":"Barkless Cedar Log","Dark Oak Leaves":"Cedar Leaves","Dark Oak Sapling":"Cedar Sapling","Jungle Log":"Elm Log","Jungle Wood Planks":"Elm Wood Planks","Barkless Jungle Log":"Barkless Elm Log","Jungle Leaves":"Elm Leaves","Jungle Sapling":"Elm Sapling","White Oak Planks":"White Planks","Orange Oak Planks":"Orange Planks","Magenta Oak Planks":"Magenta Planks","Light Blue Oak Planks":"Light Blue Planks","Yellow Oak Planks":"Yellow Planks","Lime Oak Planks":"Lime Planks","Pink Oak Planks":"Pink Planks","Gray Oak Planks":"Gray Planks","Light Gray Oak Planks":"Light Gray Planks","Cyan Oak Planks":"Cyan Planks","Purple Oak Planks":"Purple Planks","Blue Oak Planks":"Blue Planks","Brown Oak Planks":"Brown Planks","Green Oak Planks":"Green Planks","Red Oak Planks":"Red Planks","Black Oak Planks":"Black Planks"},h={Board:!0};function d(e){return e in c?c[e]:e}var f=r(20306),p=51;function m(e){return{name:"inventory",order:150,state:{selectedItem:null,inventory:null,opWrapper:null,onInventoryUpdate:null,onChestUpdate:null},onAdd:function(t,r){r.inventory||(r.inventory=new g(e,r,p)),r.opWrapper||(r.opWrapper=new l.ay(e,r.inventory,r.onChestUpdate))},onRemove:null,system:null}}var g=function(){function e(t,r,n){(0,i.Z)(this,e),this.noa=void 0,this.state=void 0,this.numSlots=void 0,this.items=void 0,this._selectedSlotI=0,this.noa=t,this.state=r,this.numSlots=n,this.items=new Array(this.numSlots).fill(null)}return(0,o.Z)(e,[{key:"stringify",value:function(){for(var e=[],t=0;t<this.items.length;t++)if(this.items[t]){var r=this.items[t],n=r.name,i=r.amount,o=r.metadata;e.push({name:this.noa.bloxd.getMetaInfo(n).rootName,amount:i,metadata:o})}else e.push(this.items[t]);return JSON.stringify(e)}},{key:"loadFromString",value:function(e){for(var t,r=JSON.parse(e),n=0;n<Math.min(r.length,this.items.length);n++)if(r[n]&&(r[n].name=d(r[n].name)),(t=r[n])&&!0===h[t.name]&&null===t.amount&&(t.amount=1),r[n]&&this.checkItem(r[n])){var i=r[n],o=i.name,s=i.amount,a=i.metadata;this.items[n]={name:o,amount:s,metadata:a,typeObj:this.noa.bloxd.getItemTypeObj(o)}}else this.items[n]=null;this.update()}},{key:"pickUpItem",value:function(e){if(e.typeObj.stackable){if(e.typeObj.stackable&&(0===e.amount||null===e.amount))return console.error(new Error("Stackable object ".concat(e.name," is being picked up with amount ").concat(e.amount,". Nothing will be added to inventory.")).stack),0;if(e.amount<0)return console.error(new Error("Found item with amount less than 0 ".concat(e.name," ").concat(e.amount)).stack),0}else e.amount=null;var t=e.amount;if(null!==e.amount)for(var r=0;r<this.items.length;r++){var n=this.items[r];if((null===n||void 0===n?void 0:n.name)===e.name){if(n.amount<=0||null===n.amount)return console.error(new Error("Found item with different amount type to current item ".concat(e.name," ").concat(n.name," ").concat(e.amount," ").concat(n.amount)).stack),0;if(n.amount+t<=a.ZP.maxItemStackSize)return n.amount+=t,this.update(),e.amount;if(n.amount<a.ZP.maxItemStackSize){var i=a.ZP.maxItemStackSize-n.amount;t-=i,n.amount+=i}}}var o,s=this.getFreeInventoryPosition();return null!==s?(this.items[s]={name:e.name,amount:t,typeObj:e.typeObj,metadata:e.metadata},this.update(),null!==(o=e.amount)&&void 0!==o?o:1):t!==e.amount?e.amount-t:0}},{key:"removeItem",value:function(e,t){return null!==this.items[e]&&(null===this.items[e].amount?this.items[e]=null:(this.items[e].amount<=0&&console.error(new Error("Found item with amount less than or equal to zero ".concat(this.items[e].name," ").concat(this.items[e].amount))),this.items[e].amount-=t,this.items[e].amount<=0&&(this.items[e]=null)),this.update(),!0)}},{key:"removeItemName",value:function(e,t){for(var r=t,n=0;n<this.items.length;n++){var i=this.items[n];if((null===i||void 0===i?void 0:i.name)===e){if(null===i.amount){if(this.items[n]=null,--t>0)continue;return this.update(),r}if(i.amount<=0){console.error(new Error("Found item ".concat(i.name," with amount <= 0 ").concat(i.amount,". Clearing slot")).stack),this.items[n]=null;continue}if(i.amount-t>=0)return i.amount-=t,0===i.amount&&(this.items[n]=null),this.update(),r;t-=i.amount,this.items[n]=null}}return t>0&&console.error(new Error("Failed to remove ".concat(t," of ").concat(e)).stack),this.update(),r-t}},{key:"setItemSlot",value:function(e,t,r,n){var i=this.noa.bloxd.getItemTypeObj(t);if(this.items[e]=null,"Air"!==t){if(i.stackable||null===r||(console.error("Unstackable object ".concat(t," is being set with amount ").concat(r,". Amount will be set to null.")),r=null),i.stackable&&(r<=0||null===r))return console.error(new Error("Stackable object ".concat(t," is being set with amount ").concat(r,". Inventory slot will be set to air.")).stack),void this.update();this.items[e]={name:t,amount:r,typeObj:i,metadata:n}}this.update()}},{key:"getFreeInventoryPosition",value:function(){return this.getFreeSlotBoundIdxs(0)}},{key:"getNumFreeSlots",value:function(){for(var e=0,t=0;t<this.items.length-u.XL.length;t++)null===this.items[t]&&e++;return e}},{key:"getFreeSlotBoundIdxs",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.items.length-u.XL.length,r=e;r<Math.min(t,this.items.length-u.XL.length);r++)if(null===this.items[r])return r;return null}},{key:"clearInventory",value:function(){for(var e=0;e<this.items.length;e++)this.setItemSlot(e,"Air",null,null);this.update()}},{key:"setSelectedSlotIndex",value:function(e){this._selectedSlotI=e,this.update()}},{key:"getSelectedSlotIndex",value:function(){return this._selectedSlotI}},{key:"update",value:function(){var e,t;this.state.selectedItem=this.items[this._selectedSlotI],null===(e=(t=this.state).onInventoryUpdate)||void 0===e||e.call(t),s.f$.publish("updatedInventory",this.getItems())}},{key:"getItemAtSelectedSlot",value:function(){return this.items[this._selectedSlotI]}},{key:"getItemAtIdx",value:function(e){return this.items[e]}},{key:"getAmountOfItem",value:function(e){var t,r=0,i=(0,n.Z)(this.items);try{for(i.s();!(t=i.n()).done;){var o=t.value;if((null===o||void 0===o?void 0:o.name)===e){if(null===o.amount){r++;continue}if(o.amount<=0){console.error(new Error("Found item ".concat(o.name," with amount ").concat(o.amount)).stack);continue}r+=o.amount}}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"getHotBar",value:function(){return this.items.slice(0,10)}},{key:"getItems",value:function(){return this.items.slice(0,this.items.length)}},{key:"getFreeSlotCount",value:function(){for(var e=0,t=0;t<this.numSlots-u.XL.length;t++){null===this.items[t]&&e++}return e}},{key:"checkItem",value:function(e){return this.noa.bloxd.registry.metadatas[e.name]?this.noa.bloxd.getItemTypeObj(e.name).stackable&&null===e.amount?(console.error(new Error("Checked stackable item ".concat(e.name," with null amount")).stack),!1):this.noa.bloxd.getItemTypeObj(e.name).stackable||null===e.amount?this.noa.bloxd.getItemTypeObj(e.name).stackable&&e.amount<=0?(console.error(new Error("Checked stackable item ".concat(e.name," with amount <= 0 ").concat(e.amount)).stack),!1):this.noa.bloxd.getItemTypeObj(e.name).stackable&&e.amount>a.ZP.maxItemStackSize?(console.error(new Error("Checked stackable item ".concat(e.name," with amount > 999 ").concat(e.amount)).stack),!1):f.a[e.name]&&!f.E[e.name]?(console.error(new Error("Checked item: multiblock component ".concat(e.name," that is not a root multiblock")).stack),!1):"Unloaded"!==e.name||(console.error(new Error('Checked item "Unloaded"').stack),!1):(console.error(new Error("Checked non-stackable item ".concat(e.name," with numeric amount ").concat(e.amount)).stack),!1):(console.error(new Error("Checked item with unknown/outdated name ".concat(e.name)).stack),!1)}}]),e}();function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e in u.YO&&(t.shotsLeft=t.shotsLeft||u.YO[e].clipSize),t}},17870:function(e){e.exports=function(e){return{name:"itemState",order:105,state:{amount:1,name:null,typeObj:null,cantPickUp:!1},onAdd:null,onRemove:null,system:null}}},21262:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r(37762),i=r(85774);function o(e){return{name:"meshRotation",order:100,state:{renderHeading:0,serverSetHeading:0},onAdd:function(e,t){},onRemove:null,renderSystem:function(r,i){var o,s=(0,n.Z)(i);try{for(s.s();!(o=s.n()).done;){var a=o.value,l=e.ents.getMoveState(a.__id),u=void 0;u=a.__id===e.playerEntity?e.camera.heading:e.entities.getGenericPlayerState(a.__id)?l.heading:a.serverSetHeading,a.renderHeading=t(a.renderHeading,u);var c=e.entities.getMeshData(a.__id);c&&(c.mesh.rotation.y=a.renderHeading+Math.PI)}}catch(h){s.e(h)}finally{s.f()}}};function t(e,t){var r=(0,i.wQ)(t-e+Math.PI,2*Math.PI)-Math.PI,n=Math.max(Math.abs(r)/5,Math.min(Math.abs(r),.15));return r<0?(e-n)%(2*Math.PI):(e+n)%(2*Math.PI)}}},92199:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r(37762),i=r(41038);function o(e){return{name:"moveState",order:30,state:{heading:0,crouching:!1,speed:0,jumping:!1,cameraPitch:0,speedMultiplier:null,hitInPrevTick:!1,setArmsAreSwinging:null,armSwinging:!1,_renderTickSinceSwing:!1,_armSwungLastTick:!1,_tickSinceSwing:!1},onAdd:function(t,r){r.speedMultiplier=new i.N,r.setArmsAreSwinging=function(){t===e.playerEntity&&(r.armSwinging=!0,r._armSwungLastTick=!0,r._renderTickSinceSwing=!1,r._tickSinceSwing=!1)}},onRemove:null,system:function(t,r){var i,o=(0,n.Z)(r);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.__id===e.playerEntity&&(!s._armSwungLastTick&&s._tickSinceSwing&&s._renderTickSinceSwing&&(s.armSwinging=!1),s._tickSinceSwing=!0,s._armSwungLastTick=!1,s.hitInPrevTick=!1)}}catch(a){o.e(a)}finally{o.f()}},renderSystem:function(t,r){var i,o=(0,n.Z)(r);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.__id===e.playerEntity&&(s._renderTickSinceSwing=!0)}}catch(a){o.e(a)}finally{o.f()}}}}},13813:function(e,t,r){"use strict";r.r(t),r.d(t,{checkMoveFuncs:function(){return m},default:function(){return g},jumpOffLadderApplyForceOverTicks:function(){return f},tickMovementPrePhysics:function(){return v}});var n,i,o=r(15671),s=r(43144),a=r(47077),l=r.n(a),u=r(85774),c=r(90574),h=r(38017),d={Vines:{upForceScalar:1},Ladder:{upForceScalar:1},"Iron Ladder":{upForceScalar:1.4},"Maple Trapdoor":{upForceScalar:1},"Pine Trapdoor":{upForceScalar:1},"Plum Trapdoor":{upForceScalar:1},"Cedar Trapdoor":{upForceScalar:1},"Aspen Trapdoor":{upForceScalar:1},"Elm Trapdoor":{upForceScalar:1},"Palm Trapdoor":{upForceScalar:1},"Pear Trapdoor":{upForceScalar:1}},f=6,p=function(){function e(){(0,o.Z)(this,e),this.__id=void 0,this.maxSpeed=4,this.moveForce=80,this.responsiveness=20,this.movingFriction=0,this.standingFriction=5,this.airMoveMult=1,this.jumpForce=0,this.jumpTime=500,this._jumpCount=0,this._currjumptime=0,this._isJumping=!1,this._bhopCount=0,this._onGroundPrevTick=!0,this._hadJumpInputPrevTick=!1,this._hadCrouchInputPrevTick=!1,this.ladderMinForce=140,this.ladderMaxForce=410,this.ladderAccelTicks=105,this._ticksSinceSwappedLadderDir=0,this._lastLadderDirWasUp=!0,this.jumpOffLadderApplyForceOverTicks=f,this.jumpOffLadderMaxForce=175,this.jumpOffLadderMinForce=0,this._ticksSinceJumpOffLadder=-1,this._jumpOffLadderAxis=0,this._jumpOffLadderMoveDir=1,this._jumpBeenUnheldSinceOnLadder=!1,this._lastJumpingStart=0,this._flying=!1,this._flyMoveDirNumTicks=0,this.noa=void 0}return(0,s.Z)(e,[{key:"shouldIgnoreCrouchingSpeedReduction",value:function(){return this._flying||this.isInWater()&&!this.isOnGround()}},{key:"isInWater",value:function(){return(0,c.vG)(this.noa,this.noa.ents.getPositionData(this.__id))}},{key:"isOnGround",value:function(){return this.noa.ents.getPhysicsBody(this.__id).atRestY()<0}},{key:"isInCobweb",value:function(){var e=this.noa.ents.getPositionData(this.__id);return(0,c.Wc)((0,u.rL)(),e,(0,h.blockNameToId)("Cobweb"))||(0,c.Wc)((0,u.rL)(),e,(0,h.blockNameToId)("Net"))}}]),e}();function m(){var e=(0,u.Zx)().ents.getMovement((0,u.Zx)().playerEntity);return n&&i&&(e.isInCobweb!==n||e.isInWater!==i)}function g(e){return{name:"movement",order:30,stateConstructor:p,onAdd:function(t,r){r.noa=e,n=r.isInCobweb,i=r.isInWater},onRemove:null,system:function(e,t){}}}function v(e,t){for(var r=e.entities.getStatesList("movement"),n=e.entities,i=0;i<r.length;i++){var o=r[i];if(n.getPhysics(o.__id)){var s=n.getPhysicsBody(o.__id);S(e,t,o,n.getMoveState(o.__id),s)}}}var y=l().create(),_=l().create(),b=l().create();function S(e,t,r,n,i){if(e.entities.getState(r.__id,"genericPlayerState").isAlive){var o=n.jumping&&!r._hadJumpInputPrevTick;e.serverSettings.creative&&o&&Date.now()-r._lastJumpingStart<300?r._flying=!r._flying:e.serverSettings.creative||(r._flying=!1),o&&(r._lastJumpingStart=Date.now());var s=r.isInWater(),a=(0,c.kQ)(e.bloxd,r.__id,i),h=a.onLadder,f=a.goingUpLadderOnAxis,p=r.isInCobweb(),m=r.isOnGround(),g=(m||r._jumpCount<function(e,t,r){var n=e.serverSettings.airJumpCount;if(r)return n+1;return n}(e,r.__id,s))&&!n.hitInPrevTick&&!p;if(m&&(r._isJumping=!1,r._jumpCount=0,r._flying=!1),!n.jumping||h||r._flying)r._isJumping=!1,m&&(r._bhopCount=0,n.speedMultiplier.setMultiplierType("bhop",1));else if(r._isJumping){if(r._currjumptime>0){var v=r.jumpForce;r._currjumptime<t&&(v*=r._currjumptime/t),i.applyForce([0,v,0]),r._currjumptime-=t}}else if(g)if(r._isJumping=!0,i.applyImpulse([0,e.serverSettings.jumpAmount,0]),r._currjumptime=r.jumpTime,m)if(r._onGroundPrevTick||r._hadJumpInputPrevTick||!n.speed||u.EU.clientEscMenuOptions.disableBunnyHopping)r._bhopCount=0,n.speedMultiplier.setMultiplierType("bhop",1);else{var S=e.serverSettings.bunnyhopMaxMultiplier-1,A=0;0===r._bhopCount?A=.5*S:1===r._bhopCount?A=.75*S:r._bhopCount>=2&&(A=S),n.speedMultiplier.setMultiplierType("bhop",1+A),r._bhopCount++}else r._jumpCount++,i.velocity[1]<0&&(i.velocity[1]=0);var x={flying:!1,a:0};if(x.a=2,x.a+=5,x.flying&&x.a||r._flying){i.gravityMultiplier=0;var C,M=65;n.jumping?(C=1,r._hadJumpInputPrevTick||(r._flyMoveDirNumTicks=0)):n.crouching?(C=-1,r._hadCrouchInputPrevTick||(r._flyMoveDirNumTicks=0)):(C=0,r._flyMoveDirNumTicks=0),r._flyMoveDirNumTicks++;M+=.5*Math.min(r._flyMoveDirNumTicks,200),i.applyForce([0,M*C,0]),i.velocity[1]=6*i.velocity[1]/10,Math.abs(i.velocity[1])<.5&&(i.velocity[1]=0)}if(!r._flying){if(h){i.velocity[1]<=0?(r._lastLadderDirWasUp&&(r._ticksSinceSwappedLadderDir=0),r._lastLadderDirWasUp=!1):(r._lastLadderDirWasUp||(r._ticksSinceSwappedLadderDir=0),r._lastLadderDirWasUp=!0);var T=Math.min(r._ticksSinceSwappedLadderDir,r.ladderAccelTicks)/r.ladderAccelTicks,P=r.ladderMinForce+T*(r.ladderMaxForce-r.ladderMinForce);i.velocity[1]<=0&&n.crouching?i.gravityMultiplier=0:i.gravityMultiplier=P/20,n.speedMultiplier.setMultiplierType("ladder",.7),i.friction=.25,i.velocity[1]=0;for(var I=0,k=[0,2];I<k.length;I++){var E=k[I];if(null!==f[E]){var R=f[E];l().set(y,0,P*d[R].upForceScalar,0),i.applyForce(y),!0,n.jumping&&r._jumpBeenUnheldSinceOnLadder&&(r._ticksSinceJumpOffLadder=0,r._jumpOffLadderAxis=E,r._jumpOffLadderMoveDir=-i.resting[E])}}n.jumping||(r._jumpBeenUnheldSinceOnLadder=!0),r._ticksSinceSwappedLadderDir++}else n.speedMultiplier.setMultiplierType("ladder",1),i.gravityMultiplier=2,i.friction=1,r._jumpBeenUnheldSinceOnLadder=!1,r._ticksSinceSwappedLadderDir=0;if(-1!==r._ticksSinceJumpOffLadder){var w=r._ticksSinceJumpOffLadder/r.jumpOffLadderApplyForceOverTicks,B=r.jumpOffLadderMaxForce+w*(r.jumpOffLadderMinForce-r.jumpOffLadderMaxForce);if(l().set(y,0,0,0),r._ticksSinceJumpOffLadder>0){y[1]=.4*B}var D=B*r._jumpOffLadderMoveDir;y[r._jumpOffLadderAxis]=D,i.applyForce(y),++r._ticksSinceJumpOffLadder>r.jumpOffLadderApplyForceOverTicks&&(r._ticksSinceJumpOffLadder=-1)}if(s){var O=function(e){var t=e-Math.abs(i.velocity[1]);return t<=0?0:t<1?30*t:30};if(n.speedMultiplier.setMultiplierType("water",.8),n.crouching){var L=O(5);l().set(y,0,-L,0),i.applyForce(y)}if(n.jumping){var F=O(3);l().set(y,0,F,0),i.applyForce(y)}}else n.speedMultiplier.setMultiplierType("water",1)}if(n.speedMultiplier.setMultiplierType("inCobweb",!r._flying&&p?.07:1),!p||r._flying||m||(i.velocity[1]=0,i.gravityMultiplier=.3),(0,u.rL)().getIsStoodOnBlock(e.playerEntity)){var N=(0,u.rL)().getStoodBlockSpeedMultiplier(e.playerEntity);n.speedMultiplier.setMultiplierType("blockSpeedMult",N)}else r._flying&&n.speedMultiplier.setMultiplierType("blockSpeedMult",1);var U=n.speed*n.speedMultiplier.getTotalMultipliedVal()*(r._flying?e.serverSettings.flySpeedMultiplier:1);r._onGroundPrevTick=m,r._hadJumpInputPrevTick=n.jumping,r._hadCrouchInputPrevTick=n.crouching;var W=y,G=_;if(n.speed){l().set(W,0,0,U),l().rotateY(W,W,b,n.heading),l().subtract(G,W,i.velocity),G[1]=0;var z=l().length(G);if(l().normalize(G,G),z>0){var j=r.moveForce;m||(j*=r.airMoveMult);var V=r.responsiveness*z;z<.3&&(V*=z),j>V&&(j=V),l().scale(G,G,j),i.applyForce(G)}i.friction=r.movingFriction}else i.friction=r.standingFriction}}},26885:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(37762),i=r(41038),o=r(52126).ZP;function s(e){return{name:"playerCameraAdjustment",order:105,state:{movementBasedFov:1.2,fovMultiplier:new i.N},renderSystem:function(t,r){var i,s=(0,n.Z)(r);try{for(s.s();!(i=s.n()).done;){var a=i.value,l=e.ents.getMoveState(a.__id),u=e.ents.getState(e.camera.cameraTarget,"followsEntity"),c=l.speed*l.speedMultiplier.getTotalMultipliedVal(),h=void 0;h=c<=4?1.2:1.2+.033*(c-4),h*=a.fovMultiplier.getTotalMultipliedVal(),a.movementBasedFov=a.movementBasedFov+(h-a.movementBasedFov)*(a.movementBasedFov>h?.3:.2),Math.abs(h-a.movementBasedFov)<5e-4&&(a.movementBasedFov=h),e.rendering._camera.fov=a.movementBasedFov;var d=void 0;d=l.crouching?.75*o.playerHeight:o.playerEyeToHeightRatio*o.playerHeight,u.offset[1]<d?u.offset[1]=Math.max(u.offset[1]-.05,d):u.offset[1]>d&&(u.offset[1]=Math.min(u.offset[1]+.05,d))}}catch(f){s.e(f)}finally{s.f()}}}}},77666:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r(16510),i=r(52126);function o(e){return{name:"playerHowlerListenerUpdate",order:45,state:{},onAdd:null,onRemove:null,system:function(t,r){console.assert(1===r.length,"Component should only be on playerEntity");var o=e.entities.getPosition(e.playerEntity);n.Howler.pos(o[2],o[1]+i.ZP.playerHeight*i.ZP.playerEyeToHeightRatio,o[0]);var s=e.camera.getDirection(),a=e.camera.getUpDirection();n.Howler.orientation(s[2],s[1],s[0],a[2],a[1],a[0])},renderSystem:null}}},64716:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(37762),i=r(80105),o=r(54044),s=r(85774),a=new i.P(0,1,0),l=15;function u(e){return{name:"playerMesh",order:105,state:{rootMesh:null,namedNodes:null,consumedNetworkArmSwing:!0,_ticksSinceSwing:16,_queuedSwing:!1,_walkingAngle:0,_angleMoveDir:1},onAdd:function(t,r){r.rootMesh.rotationQuaternion=null;var i=r.rootMesh.getChildTransformNodes(!1);r.namedNodes={};var o,s=(0,n.Z)(i);try{for(s.s();!(o=s.n()).done;){var a=o.value,l=a.name.split(" "),u=l[l.length-1];r.namedNodes[u]=a}}catch(f){s.e(f)}finally{s.f()}e.rendering.addMeshToScene(r.rootMesh);var c,h=(0,n.Z)(r.rootMesh.getChildMeshes(!1));try{for(h.s();!(c=h.n()).done;){var d=c.value;e.rendering.addMeshToScene(d),d.alwaysSelectAsActiveMesh=!0,d.doNotSyncBoundingInfo=!0}}catch(f){h.e(f)}finally{h.f()}},onRemove:function(e,t){t.rootMesh.dispose(!1)},renderSystem:function(f,p){var m,g=(0,n.Z)(p);try{for(g.s();!(m=g.n()).done;){var v,y,_=m.value,b=e.ents.getMoveState(_.__id),S=null===(v=e.ents.getHeldItemState(_.__id))||void 0===v?void 0:v.heldItem,A=(null===S||void 0===S?void 0:S.gunTypeObj)||(null===S||void 0===S||null===(y=S.typeObj)||void 0===y?void 0:y.holdAsAiming),x=0;b.crouching?(x=Math.PI/8,r(_.namedNodes.TorsoNode,x,0,0)):r(_.namedNodes.TorsoNode,0,0,0);var C=_.__id===e.playerEntity?e.camera.pitch:b.cameraPitch;C-=x,r(_.namedNodes.HeadMesh,u(C),0,0);var M=!0;if(A){var T,P,I,k=C;k=i(k+=null!==(T=null===(P=(I=e.entities.getHeldItem(_.__id)).getThirdPersonArmPitchFromReloading)||void 0===P?void 0:P.call(I))&&void 0!==T?T:0),r(_.namedNodes.ArmRightMesh,Math.min(.3*-Math.PI+k,0),0,0),_.namedNodes.ArmRightMesh.rotate(a,.18*Math.PI,o.T.WORLD),r(_.namedNodes.ArmLeftMesh,Math.min(.4*-Math.PI+k,.1*-Math.PI),0,0),_.namedNodes.ArmLeftMesh.rotate(a,.15*-Math.PI,o.T.WORLD),M=!1}else if(b.armSwinging||!_.consumedNetworkArmSwing?(_.consumedNetworkArmSwing=!0,_._ticksSinceSwing>l?(_._ticksSinceSwing=1,_._queuedSwing=!1):_._ticksSinceSwing>=9.75&&!_._queuedSwing&&(_._queuedSwing=!0)):_._queuedSwing&&_._ticksSinceSwing>l&&(_._ticksSinceSwing=1,_._queuedSwing=!1),_._ticksSinceSwing<=l){var E=_._ticksSinceSwing/l,R=c[1].amt;c[1].amt-=x;var w=(0,s.Fu)(c,E,_.namedNodes.ArmRightMesh.rotation.x,l);c[1].amt=R;var B=(0,s.Fu)(h,E,_.namedNodes.ArmRightMesh.rotation.y,l),D=(0,s.Fu)(d,E,_.namedNodes.ArmRightMesh.rotation.z,l);r(_.namedNodes.ArmRightMesh,w,B,D);var O=_.namedNodes.ArmLeftMesh;r(O,(0,s.ml)(O.rotation.x,0,.1),0,0),_._ticksSinceSwing++,M=!1}t(_,M)}}catch(L){g.e(L)}finally{g.f()}}};function t(t,n){var i,o,a=e.ents.getMoveState(t.__id);if(a.crouching)i=.5;else{var l=.16*(a.speed-4)+.9;i=(0,s.uZ)(l,.9,1.4)}if(a.speed){var u=Math.abs(Math.sin(t._walkingAngle/i*.8*Math.PI/2+Math.PI/2));u=Math.max(u,Math.abs(Math.sin(.8*Math.PI/2+Math.PI/2))),o=.03*u*a.speed*i*t._angleMoveDir,t._walkingAngle=t._walkingAngle+o,t._walkingAngle>i?t._angleMoveDir=-1:t._walkingAngle<-i&&(t._angleMoveDir=1)}else o=.07,t._walkingAngle>0?t._walkingAngle=Math.max(0,t._walkingAngle-o):t._walkingAngle=Math.min(0,t._walkingAngle+o);if(r(t.namedNodes.LegRightMesh,-t._walkingAngle,0,0),r(t.namedNodes.LegLeftMesh,t._walkingAngle,0,0),n){var c=function(e,t){Math.abs(e.rotation.x-t)>Math.abs(.8*o)+.01?r(e,(0,s.ml)(e.rotation.x,t,.05),0,0):r(e,t,0,0)};c(t.namedNodes.ArmRightMesh,.8*t._walkingAngle),c(t.namedNodes.ArmLeftMesh,.8*-t._walkingAngle)}}function r(e,t,r,n){e.rotationQuaternion=null,e.rotation.copyFromFloats(t,r,n),e.rotation._isDirty=!0}function i(e){return.95*e}function u(e){return 1*e}}var c=[{atFrac:0,amt:0},{atFrac:.5,amt:.5*-Math.PI},{atFrac:1,amt:0}],h=[{atFrac:0,amt:0},{atFrac:.25,amt:-Math.PI/9},{atFrac:.7,amt:Math.PI/9},{atFrac:1,amt:0}],d=[{atFrac:0,amt:0},{atFrac:.5,amt:Math.PI/6},{atFrac:.5,amt:Math.PI/6},{atFrac:1,amt:0}]},53477:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(9488),i=r(52644),o=r(49620),s=r(87683),a=r(90673);function l(e){return{name:"playerName",order:105,state:{name:null,nameYOffset:2.2,planeEId:null},onAdd:function(t,r){var l,u=null!==(l=r.name)&&void 0!==l?l:e.playerNames[t],c=o.mx.CreatePlane("".concat(r.__id,"NameTag"),{height:.2,width:.1*u.length},e.rendering.getScene());r.planeEId=e.entities.add([0,0,0],1,1,c,[0,r.nameYOffset,0]),c.billboardMode=i.x.BILLBOARDMODE_ALL,c.alwaysSelectAsActiveMesh=!0,c.doNotSyncBoundingInfo=!0,e.ents.addComponent(r.planeEId,"followsEntity",{entity:r.__id});var h=new a.c("".concat(r.__id,"NameTagTex"),{width:30*u.length,height:64},e.rendering.getScene()),d=new s.K("".concat(r.__id,"NameTagMat"),e.rendering.getScene());d.specularColor=new n.Wo(0,0,0),d.diffuseTexture=h,c.material=d;if(h.drawText(u,null,null,"bolder 47px 'Jetbrains Mono'","black","white",!0,!0),d.freeze(),e.ents.getGenericPlayerState(r.__id)){var f=e.ents.getGenericPlayerState(r.__id).meshEnabledCombinator.getTotalBooleanVal();e.ents.getMeshData(r.planeEId).mesh.setEnabled(f)}},onRemove:function(t,r){e.ents.deleteEntity(r.planeEId)},system:null,renderSystem:null}}},30258:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i},tickReceivesInputsPrePhysics:function(){return o}});var n=r(37762);function i(e){return{name:"receivesInputs",order:20,state:{joystickHeading:null,isTouchscreen:!1,canRunCombinator:null,_moving:!1,_running:!1},onAdd:function(e,t){},onRemove:null,system:function(e,t){}}}function o(e,t){var r,i=e.entities.getStatesList("receivesInputs"),o=e.entities,a=e.inputs.state,l=e.camera.heading,u=(0,n.Z)(i);try{for(u.s();!(r=u.n()).done;){var c=r.value,h=o.getMoveState(c.__id);if(c.isTouchscreen)h.heading=(e.camera.heading+2*Math.PI-(c.joystickHeading+3*Math.PI/2))%(2*Math.PI);else{var d=e.entities.getMovement(c.__id);s(e.serverSettings,h,d,a,c,l)}}}catch(f){u.e(f)}finally{u.f()}}function s(e,t,r,n,i,o){t.jumping=!!n.jump;var s=n.forward?n.backward?0:1:n.backward?-1:0,a=n.right?n.left?0:1:n.left?-1:0;if(n.crouch?t.crouching=!0:t.crouching=!1,0===(s|a))i._moving=!1,i._running=!1,t.speed=0;else{i._moving=!0,n.sprint&&(i._running=!0),t.crouching&&!r.shouldIgnoreCrouchingSpeedReduction()||!i.canRunCombinator.getTotalBooleanVal()?t.speed=e.crouchingSpeed:i._running?t.speed=e.runningSpeed:t.speed=e.walkingSpeed,t.speedMultiplier.setMultiplierType("serverSettingsSpeedMultiplier",e.speedMultiplier);var l=o;s?(-1===s&&(l+=Math.PI),a&&(l+=Math.PI/4*s*a)):l+=a*Math.PI/2,t.heading=l}}},81239:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return s}});var n=r(37762),i=r(47077),o=r.n(i);function s(e){return{name:"smoothToServerPos",order:90,state:{serverPosition:null},onAdd:function(e,t){t.serverPosition||(t.serverPosition=[0,0,0])},onRemove:null,renderSystem:function(t,r){var i,s=(0,n.Z)(r);try{for(s.s();!(i=s.n()).done;){var a=i.value,l=a.serverPosition,u=e.ents.getPosition(a.__id);o().lerp(u,u,l,.3);for(var c=e.ents.getPositionData(a.__id)._extents,h=e.worldOriginOffset[0],d=e.worldOriginOffset[2],f=[c[3]+h,c[2]+d],p=[c[0]+h,c[2]+d],m=[c[3]+h,c[5]+d],g=[c[0]+h,c[5]+d],v=u[1],y=0,_=[f,p,m,g];y<_.length;y++){var b=_[y];if(e.world.getBlockID(b[0],v,b[1])){o().copy(u,l);break}}o().distance(u,l)>10&&o().copy(u,l),e.ents.setPosition(a.__id,u)}}catch(S){s.e(S)}finally{s.f()}}}}},41074:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(85774),i=r(47077),o=r.n(i),s=r(66645),a=r(79520),l={distSinceLastSound:0,lastPos:null};function u(e){return{name:"stepSoundOnWalk",order:1e3,state:l,onAdd:function(e,t){t.lastPos=[0,0,0]},onRemove:null,system:function(t,r){var i=(0,n.rL)();r.forEach((function(t){if(e.entities.getGenericPlayerState(t.__id).isAlive){var r=e.ents.getPosition(t.__id),n=i.getBlock(Math.floor(r[0]),r[1]-1,Math.floor(r[2])),l=o().dist(t.lastPos,r);if(t.distSinceLastSound+=l,o().copy(t.lastPos,r),Number.isInteger(r[1])&&0!==n&&t.distSinceLastSound>2){var u=(0,s.r_)("step_".concat((0,a.sb)(n,!1)));(0,a.GW)().play(u,.15),t.distSinceLastSound=0}}}))}}}},48544:function(e,t,r){"use strict";function n(e){return{name:"templateComp",order:105,state:{},onAdd:function(e,t){},onRemove:function(e,t){},system:function(e,t){}}}r.r(t),r.d(t,{default:function(){return n}})},51012:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return a}});var n=r(85774),i=r(47077),o=r.n(i),s=r(80427);function a(e){return{name:"updateServerOfMovement",order:1e3,state:{},onAdd:null,onRemove:null,system:function(t,r){console.assert(1===r.length,"There should only be one entity with updateServerOfMovement.");(0,n.rL)();e.entities.getGenericPlayerState(e.playerEntity).isAlive&&r.forEach((function(t){var r,i=e.ents.getPosition(e.playerEntity);[].push(1);var a=e.ents.getMoveState(t.__id),l={x:i[0],y:i[1],z:i[2],heading:e.camera.heading,speed:a.speed,jumping:a.jumping,crouching:a.crouching,pitch:e.camera.pitch,armSwinging:e.ents.getMoveState(t.__id).armSwinging,useDir:o().copy([],null!==(r=e.actionDirection)&&void 0!==r?r:e.camera.getDirection())};isNaN(l.speed)&&(console.error("speed was NaN! Setting to 0"),l.speed=0);var u={speed:a.speed,pitch:0,x:0,y:0,z:0},c={x:i[0],y:i[1],z:i[2],speed:0};u.pitch=e.camera.pitch,c.speed=a.speed,0===u.pitch&&(c.speed*=1.3),(0,n.Xi)(s.Vz.move,l)}))}}}},38172:function(e,t,r){"use strict";r.d(t,{K4:function(){return Ie},ij:function(){return ke},rI:function(){return Ee}});var n,i,o,s,a,l,u,c,h,d,f,p,m,g,v,y,_,b,S,A,x,C,M,T,P,I,k,E,R,w,B,D,O,L,F,N,U=r(4942),W=r(37762),G=r(29439),z=r(15861),j=r(64687),V=r.n(j),H=r(85774),q=r(85853),Z=r(44695),K=r(89117),Y=r(75943),X=r.n(Y),Q=r(93239),J=r(47077),$=r.n(J),ee=r(52126),te=r(20306),re=r(77796),ne=r(24412),ie=r(62043),oe=r(30701),se=r(66645),ae=r(79520),le=r(15671),ue=r(43144),ce=r(84906),he=function(){function e(t,r){(0,le.Z)(this,e),this.bloxd=void 0,this.noa=void 0,this.eId=void 0,this.bloxd=t,this.noa=t.noa,this.eId=r}return(0,ue.Z)(e,[{key:"initClient",value:function(e){this.noa.playerNames[this.eId]||(this.noa.playerNames[this.eId]="Player"),this.noa.ents.add([e.x,e.y,e.z],ee.ZP.playerWidth,ee.ZP.playerHeight,null,null,!1,!0,this.eId),this.noa.ents.addComponent(this.eId,this.noa.ents.names.smoothToServerPos),console.log("Added player",this.eId),(0,q.Q8)(this.noa,this.eId)}},{key:"onChangeClient",value:function(e,t){if("name"===e)this.changedName(t);else if("heldItemName"===e){var r=this.noa.entities.getHeldItemState(this.eId);r.networkedHeldItemName=t,(0,ce.updateHeldItemState)(this.noa,r)}else void 0!==this.noa.ents.getMoveState(this.eId)[e]&&(this.noa.ents.getMoveState(this.eId)[e]=t)}},{key:"disposeClient",value:function(){var e;this.noa.ents.deleteEntity(this.eId),delete this.noa.playerNames[this.eId],delete this.noa.otherPlayerSettings[this.noa.playerEntity][this.eId],null===(e=this.noa.otherPlayerSettings[this.noa.serverPlayerEntity])||void 0===e||delete e[this.eId],H.f$.publish("playerLeave",this.eId),H.f$.publish("playerLeave|".concat(this.eId)),H.f$.publish("playerLeaveClientifiedEId|".concat((0,H.dP)(this.eId))),H.f$.publish("playerNamesUpdated")}},{key:"changedName",value:function(e){console.log("Changed name of ".concat(this.eId," to ").concat(e)),this.noa.playerNames[this.eId]=e,this.noa.playerNames[(0,H.dP)(this.eId)]=e,this.noa.ents.removeComponent(this.eId,this.noa.ents.names.playerName),this.noa.ents.addComponent(this.eId,this.noa.ents.names.playerName),H.f$.publish("playerNamesUpdated")}}]),e}(),de=r(91314),fe=r(93433),pe=function(){function e(t,r,n){(0,le.Z)(this,e),this.bloxd=void 0,this.noa=void 0,this.eId=void 0,this.canSeeSub=void 0,this.canAttackSub=void 0,this.colyseusEntity=void 0,this.bloxd=t,this.noa=t.noa,this.eId=r}return(0,ue.Z)(e,[{key:"initClient",value:function(e){var t,r=this;this.colyseusEntity=e,this.noa.ents.add([e.x,e.y,e.z],1,1,null,null,!1,!1,this.eId),this.noa.ents.addComponent(this.eId,"smoothToServerPos"),this.noa.ents.addComponent(this.eId,"meshRotation"),null!==(t=this.noa.otherPlayerSettings[this.noa.playerEntity][this.eId])&&void 0!==t&&t.canSee&&this.addHidingMeshMgr(),this.canSeeSub=H.f$.subscribe("otherPlayerSettings|".concat(this.eId,"|canSee"),(function(e){r.noa.entities.removeComponent(r.eId,"hidingMeshManager"),e&&r.addHidingMeshMgr()})),this.canAttackSub=H.f$.subscribe("otherPlayerSettings|".concat(this.eId,"|canAttack"),(function(e){var t,n=null===(t=r.noa.entities.getMeshData(r.eId))||void 0===t?void 0:t.mesh;if(n)for(var i=0,o=[n].concat((0,fe.Z)(n.getChildMeshes(!1)));i<o.length;i++){var s=o[i];void 0!==s.isPickable&&(s.isPickable=e)}}))}},{key:"onChangeClient",value:function(e,t){if("heading"===e)this.noa.ents.getState(this.eId,"meshRotation").serverSetHeading=t;else if("name"===e){var r;""!==t&&null!==(r=this.noa.otherPlayerSettings[this.noa.playerEntity][this.eId])&&void 0!==r&&r.canSee&&(this.noa.entities.removeComponent(this.eId,"hidingMeshManager"),this.addHidingMeshMgr())}else"type"===e&&(this.noa.entities.removeComponent(this.eId,"hidingMeshManager"),this.addHidingMeshMgr())}},{key:"disposeClient",value:function(){var e;this.noa.ents.deleteEntity(this.eId),delete this.noa.otherPlayerSettings[this.noa.playerEntity][this.eId],null===(e=this.noa.otherPlayerSettings[this.noa.serverPlayerEntity])||void 0===e||delete e[this.eId],H.f$.unsubscribe(this.canSeeSub),H.f$.unsubscribe(this.canAttackSub)}},{key:"addHidingMeshMgr",value:function(){var e=this,t=this.colyseusEntity.type.split("|"),r=(0,G.Z)(t,3),n=(r[0],r[1]),i=r[2],o=JSON.parse(i);this.noa.ents.addComponent(this.eId,"hidingMeshManager",{addMeshComponent:function(){var t=e.bloxd.rendering.getEntityMesh(n,o,(function(t){for(var r=0,n=[t].concat((0,fe.Z)(t.getChildMeshes(!1)));r<n.length;r++){var i=n[r];void 0!==i.isPickable&&(i.isPickable=e.noa.otherPlayerSettings[e.noa.playerEntity][e.eId].canAttack,i.metadata=new e.noa.rendering.MeshMetadataType,i.metadata.eId=e.eId)}})),r=t.mesh,i=t.meshOffset,s=t.nameYOffset;e.noa.entities.addComponent(e.eId,"mesh",{mesh:r,shouldAddMeshToScene:!1,offset:i}),""!==e.colyseusEntity.name&&(e.noa.entities.removeComponent(e.eId,"playerName"),e.noa.entities.addComponent(e.eId,"playerName",{name:e.colyseusEntity.name,nameYOffset:s}))},removeMeshComponent:function(){e.noa.entities.removeComponent(e.eId,"mesh"),e.noa.entities.removeComponent(e.eId,"playerName")},hideDist:80,movingHideDist:120})}}]),e}(),me=r(43269),ge=r(97326),ve=r(60136),ye=r(43668),_e=r(53229),be=r(50061),Se=(n=(0,be.type)("number"),i=(0,be.type)("number"),o=(0,be.type)("number"),s=(0,be.type)("number"),a=(0,be.type)("number"),l=(0,be.type)("number"),u=function(e){(0,ve.Z)(r,e);var t=(0,ye.Z)(r);function r(){var e;(0,le.Z)(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),(0,me.Z)(e,"id",c,(0,ge.Z)(e)),(0,me.Z)(e,"amount",h,(0,ge.Z)(e)),(0,me.Z)(e,"x",d,(0,ge.Z)(e)),(0,me.Z)(e,"y",f,(0,ge.Z)(e)),(0,me.Z)(e,"z",p,(0,ge.Z)(e)),(0,me.Z)(e,"shotsLeft",m,(0,ge.Z)(e)),e}return(0,ue.Z)(r)}(be.Schema),c=(0,_e.Z)(u.prototype,"id",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h=(0,_e.Z)(u.prototype,"amount",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),d=(0,_e.Z)(u.prototype,"x",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f=(0,_e.Z)(u.prototype,"y",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),p=(0,_e.Z)(u.prototype,"z",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),m=(0,_e.Z)(u.prototype,"shotsLeft",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u),Ae=(g=(0,be.type)("string"),v=(0,be.type)("string"),y=(0,be.type)("number"),_=(0,be.type)("number"),b=(0,be.type)("number"),S=(0,be.type)("float32"),A=(0,be.type)("float32"),x=(0,be.type)("boolean"),C=(0,be.type)("boolean"),M=(0,be.type)("float32"),T=(0,be.type)("string"),P=function(e){(0,ve.Z)(r,e);var t=(0,ye.Z)(r);function r(){var e;(0,le.Z)(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),(0,me.Z)(e,"type",I,(0,ge.Z)(e)),(0,me.Z)(e,"name",k,(0,ge.Z)(e)),(0,me.Z)(e,"x",E,(0,ge.Z)(e)),(0,me.Z)(e,"y",R,(0,ge.Z)(e)),(0,me.Z)(e,"z",w,(0,ge.Z)(e)),(0,me.Z)(e,"heading",B,(0,ge.Z)(e)),(0,me.Z)(e,"speed",D,(0,ge.Z)(e)),(0,me.Z)(e,"jumping",O,(0,ge.Z)(e)),(0,me.Z)(e,"crouching",L,(0,ge.Z)(e)),(0,me.Z)(e,"cameraPitch",F,(0,ge.Z)(e)),(0,me.Z)(e,"heldItemName",N,(0,ge.Z)(e)),e}return(0,ue.Z)(r)}(be.Schema),I=(0,_e.Z)(P.prototype,"type",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=(0,_e.Z)(P.prototype,"name",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),E=(0,_e.Z)(P.prototype,"x",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R=(0,_e.Z)(P.prototype,"y",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),w=(0,_e.Z)(P.prototype,"z",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B=(0,_e.Z)(P.prototype,"heading",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D=(0,_e.Z)(P.prototype,"speed",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),O=(0,_e.Z)(P.prototype,"jumping",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),L=(0,_e.Z)(P.prototype,"crouching",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),F=(0,_e.Z)(P.prototype,"cameraPitch",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),N=(0,_e.Z)(P.prototype,"heldItemName",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P),xe=r(43617),Ce=r(23886),Me=r(80427),Te=r(40918),Pe=function(){function e(t){(0,le.Z)(this,e),this.colyRoom=void 0,this.sessionId=void 0,this.colyRoom=t,this.sessionId=t.sessionId}return(0,ue.Z)(e,[{key:"onMessage",value:function(e,t){this.colyRoom.onMessage(e,(function(r){try{Me.bk[e]&&(r=Me.bk[e].fromBuffer(Te.Buffer.from(r))),t(r)}catch(n){(0,H.Zx)().logErrorMessage("Error in onMessage ".concat(e),n)}}))}},{key:"send",value:function(e,t){(new Error).stack.includes("userscript")&&(0,H.qL)(),(0,H.Jg)(t)?this.colyRoom.sendBytes(e,t):this.colyRoom.send(e,t)}},{key:"removeAllListeners",value:function(){this.colyRoom.removeAllListeners()}},{key:"leave",value:function(){this.colyRoom.leave()}}]),e}(),Ie=!1;function ke(){Ie=!0}function Ee(e,t,r,n){return Re.apply(this,arguments)}function Re(){return Re=(0,z.Z)(V().mark((function e(t,r,n,i){var o,s,a,l,u,c,h,d;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=function(e,t){if(e===ee.fV.outdatedVersion.code)return console.error("Outdated client with version ",re.i,", refreshing page"),window.location.reload(),!0;for(var r in ee.fV){var n=ee.fV[r],i=n.code,o=n.text;if(i===e){console.log("matched known error",e,"leaving game");var s=""===o?t:o;return H.f$.publish("kickedFromServer","You have disconnected from the server.\n".concat(s)),(0,Q.mH)(),!0}}return!1},t.serverSettings={},t.otherPlayerSettings=(0,U.Z)({},t.playerEntity,{}),t.playerNames=(0,U.Z)({},t.playerEntity,H.EU.playerName),t.colyRoom=void 0,t.serverPlayerEntity=void 0,o={},s={x:0,y:1,z:2},a=!1,(0,H.Xr)((function(){a=!0})),X().get("id")&&"undefined"!==X().get("id")?l=X().get("id"):H.EU.id?l=H.EU.id:console.error("No id!!!!!!",X().get("id"),H.EU.id),u=[i],H.EU.isLoggedIn&&u.push(H.EU.firebase.auth.currentUser.getIdToken().then((function(e){H.EU.jwToken=e}))),H.EU.id=l,H.EU.firebase&&H.EU.id&&H.EU.firebase.setUserProperties({user_id:H.EU.id}),H.EU.connectedLobbyName=r,console.log("Waiting for promises to resolve"),e.next=19,Promise.all(u);case 19:c={cookies:(0,H.zh)(n),deviceType:Z.vO,generalCookies:{joinDiscord:!!H.Cc.getItem("DiscordPressed"),id:l,newGo:xe.Y},isLoggedIn:H.EU.isLoggedIn,idToken:H.EU.jwToken,lobbyName:r,languages:(0,H.HZ)(),version:re.i},console.log("joining server with lobbyName",r),h=t.colyClient.joinOrCreate(n,c),H.f$.publish("loadingScreenState","Joining Lobby"),h.then((function(e){if(a)return e.removeAllListeners(),void e.leave();var r=new Pe(e);t.colyRoom=r;var i=r.send,l=r.onMessage;H.f$.publish("loadingScreenState","Loading Player Info"),De(n,r,t);var u=setInterval((function(){i===r.send&&l===r.onMessage||ke()}),1e4);(0,H.Xr)((function(){clearInterval(u)}));var c={Player:he,Pebble:de.O,Snowball:de.O,"Reinforced Pebble":de.O,"Reinforced Ball":de.O,Ball:de.O,"Moonstone Orb":de.O,Arrow:de.O,Fireball:de.O,Iceball:de.O,Mesh:pe};e.state.entities.onAdd((function(e,r){if(t.serverPlayerEntity)i();else{var n=H.f$.subscribeOnce("initInfoReceived",(function(){i()}));(0,H.Xr)((function(){H.f$.unsubscribe(n)}))}function i(){if(r!==t.serverPlayerEntity){var n=c[e.type.split("|")[0]];o[r]={colyseusEntity:e,entity:new n((0,H.rL)(),r,e.type)},o[r].entity.initClient(e);var i=function(e,n){e in s?t.ents.getState(r,"smoothToServerPos").serverPosition[s[e]]=n:o[r].entity.onChangeClient(e,n)},a=new Ae,l=function(t){if(a.hasOwnProperty(t)){i(t,e[t]);var r=e.listen(t,(function(e,r){i(t,e)}));(0,H.Xr)((function(){r()}))}};for(var u in a)l(u)}}})),e.state.entities.onRemove((function(e,t){console.log("Removed entity",t),o[t].entity.disposeClient(),delete o[t]}));var h={};e.state.items.onAdd((function(e,r){h[r]=e,(0,K.Ku)(t,r,[e.x,e.y,e.z],e.id,e.amount);var n=function(e,n){e in s?t.ents.hasComponent(r,"itemState")&&(t.ents.getState(r,"smoothToServerPos").serverPosition[s[e]]=n):t.ents.hasComponent(r,"itemState")&&(t.ents.getState(r,t.ents.names.itemState)[e]=n)},i=new Se,o=function(t){if(i.hasOwnProperty(t)){n(t,e[t]);var r=e.listen(t,(function(e,r){n(t,e)}));(0,H.Xr)((function(){r()}))}};for(var a in i)o(a)})),r.onMessage(Me.cU.itemStillThere,(function(e){var r=e.eId,n=e.id,i=e.amount,o=e.x,s=e.y,a=e.z,l=e.cantPickUp;(0,K.Ku)(t,r,[o,s,a],n,i,l)})),r.onMessage(Me.cU.cantPickUpItem,(function(e){t.ents.hasComponent(e,"itemState")&&(t.ents.getState(e,"itemState").cantPickUp=!0)})),e.state.items.onRemove((function(e,r){delete h[r],t.ents.hasComponent(r,t.ents.names.itemState)&&t.ents.deleteEntity(r)})),(0,H.Xr)((function(){for(var e in h)t.ents.deleteEntity(e)})),e.onLeave((function(e){e!==ee.fV.gameOrPluginKick.code&&(console.log("Left room with code ".concat(e)),d(e)||H.f$.publish("colyRoomLeft"))}))})).catch((function(e){console.error("Failed to connect to bloxd room. Check your internet connection. lobbyName: ".concat(r,", gamemode: ").concat(n," code: ").concat(e.code,".")),console.error(e),t.logErrorMessage("Failed to connect to bloxd room, lobbyName: ".concat(r,", gamemode: ").concat(n," code: ").concat(e.code,"\n"),e);var i=e.code;d(i,e.message)||(console.log("Didn't match known error, leaving game"),H.f$.publish("kickedFromServer","You disconnected from the server.\n\t\t\t\t\tidk why, if your internet is working it might be a bug."),(0,Q.mH)())})),(0,H.Xr)((function(){for(var e in o){var r=parseInt(e);r!==t.playerEntity&&o[r].entity.disposeClient()}}));case 25:case"end":return e.stop()}}),e)}))),Re.apply(this,arguments)}function we(e,t){for(var r in t)e.serverSettings[r]=t[r];for(var n in t)H.f$.publish("serverOption|".concat(n),t[n]);H.f$.publish("newAllServerOptions",e.serverSettings)}function Be(e,t){var r=t.taskId,n=t.progress;e.serverSettings._tasks[r].progress=n,we(e,{_tasks:e.serverSettings._tasks})}function De(e,t,r){t.onMessage(Me.cU.newClientOptions,(function(e){we(r,e)})),t.onMessage(Me.cU.newOtherPlayerSettings,(function(e){var t=e.EId,n=e.settings;r.otherPlayerSettings[r.playerEntity][t]||(r.otherPlayerSettings[r.playerEntity][t]={},r.otherPlayerSettings[r.playerEntity][(0,H.dP)(t)]={},r.otherPlayerSettings[r.serverPlayerEntity][t]={},r.otherPlayerSettings[r.serverPlayerEntity][(0,H.dP)(t)]={});for(var i=0,o=Object.entries(n);i<o.length;i++){var s=(0,G.Z)(o[i],2),a=s[0],l=s[1];r.otherPlayerSettings[r.playerEntity][t][a]=l,r.otherPlayerSettings[r.playerEntity][(0,H.dP)(t)][a]=l,r.otherPlayerSettings[r.serverPlayerEntity][t][a]=l,r.otherPlayerSettings[r.serverPlayerEntity][(0,H.dP)(t)][a]=l,H.f$.publish("otherPlayerSettings|".concat(a),{EId:t,value:l}),H.f$.publish("otherPlayerSettings|".concat(t,"|").concat(a),l),H.f$.publish("otherPlayerSettingsClientifiedEId|".concat((0,H.dP)(t),"|").concat(a),l)}})),t.onMessage(Me.cU.teleported,(function(e){var t=e.id,n=e.x,i=e.y,o=e.z;(0,H.Xi)(Me.Vz.confirmTeleport,{id:t,type:Ce.W7}),r.ents.setPosition(r.playerEntity,[n,i,o])}));var n=$().create();function i(){return r.ents.getInventory(r.playerEntity)}t.onMessage(Me.cU.positionCorrected,(function(e){var t=r.ents.getPosition(r.playerEntity);$().copy(n,e),n[1]=t[1];var i=$().dist(n,t);console.log("Server corrected position to",e,"I was at",t,"the horizontal distance of these is",i),i>10&&r.ents.setPosition(r.playerEntity,e)})),t.onMessage(Me.cU.chat,(function(e){H.f$.publish("chat",e,!0)})),t.onMessage(Me.cU.setCookie,(function(t){var r=t.key,n=t.value;(0,H.d8)(e,r,n)})),t.onMessage(Me.cU.initialInfo,(function(e){var n=e.EId,i=e.pass;console.log("Local client is EId",n),H.f$.publish("loadingScreenState","Loading World"),(0,H.Cl)(i),r.serverPlayerEntity=n,r.ents.hasComponent(r.playerEntity,r.ents.names.playerName)&&r.ents.removeComponent(r.playerEntity,r.ents.names.playerName),r.playerNames[r.serverPlayerEntity]=r.playerNames[r.playerEntity],r.otherPlayerSettings[r.serverPlayerEntity]={},r.ents.addComponent(r.playerEntity,r.ents.names.playerName),H.f$.publish("initInfoReceived",t)})),t.onMessage(Me.cU.TopRightHelper,(function(e){H.f$.publish("TopRightHelper",e,!0)})),t.onMessage(Me.cU.ProgressionEvent,(function(e){var t=e.type,n=e.location1,i=e.location2,o=e.location3,s=e.score;r.GA.addProgressionEvent(t,n,i,o,s)})),t.onMessage(Me.cU.ResourceEvent,(function(e){var t=e.type,n=e.resourceType,i=e.amount,o=e.category,s=e.itemName;r.GA.addResourceEvent(t,n,i,o,s)})),t.onMessage(Me.cU.canChangePos,(function(e){r.world.canChangeBlockCoord.add(e),r.world.cantChangeBlockCoord.delete(e)})),t.onMessage(Me.cU.cantChangePos,(function(e){r.world.cantChangeBlockCoord.add(e),r.world.canChangeBlockCoord.delete(e)})),t.onMessage(Me.cU.canChangeType,(function(e){r.world.canChangeBlockType.add(e),r.world.cantChangeBlockType.delete(e)})),t.onMessage(Me.cU.cantChangeType,(function(e){r.world.cantChangeBlockType.add(e),r.world.canChangeBlockType.delete(e)})),t.onMessage(Me.cU.resetChangeType,(function(e){r.world.cantChangeBlockType.delete(e),r.world.canChangeBlockType.delete(e)})),t.onMessage(Me.cU.canChangeRect,(function(e){(0,H.Yl)(e,r.world.cantChangeBlockRect),(0,H.Yl)(e,r.world.canChangeBlockRect),r.world.canChangeBlockRect.push(e)})),t.onMessage(Me.cU.cantChangeRect,(function(e){(0,H.Yl)(e,r.world.canChangeBlockRect),(0,H.Yl)(e,r.world.cantChangeBlockRect),r.world.cantChangeBlockRect.push(e)})),t.onMessage(Me.cU.resetChangeRect,(function(e){(0,H.Yl)(e,r.world.canChangeBlockRect),(0,H.Yl)(e,r.world.cantChangeBlockRect)})),t.onMessage(Me.cU.walkThroughType,(function(e){var t=e.id;e.disable?r.world.walkThroughType.delete(t):r.world.walkThroughType.add(t)})),t.onMessage(Me.cU.walkThroughRect,(function(e){var t=e.rect;e.disable?(0,H.Yl)(t,r.world.walkThroughRect):((0,H.Yl)(t,r.world.walkThroughRect),r.world.walkThroughRect.push(t))})),(0,H.Xr)((function(){r.world.canChangeBlockCoord=new Set,r.world.cantChangeBlockCoord=new Set,r.world.canChangeBlockType=new Set,r.world.cantChangeBlockType=new Set,r.world.canChangeBlockRect=[],r.world.cantChangeBlockRect=[],r.world.walkThroughType=new Set,r.world.walkThroughRect=[]})),t.onMessage(Me.cU.taskProgress,(function(e){Be(r,e)})),t.onMessage(Me.cU.changeBlockFail,(function(e){var t,r=(0,W.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=n.pos,s=n.actualId,a=te.a[s];if(a){var l=a.compX,u=a.compY,c=a.compZ,h=a.mainMultiblock;(0,H.rL)().setBlock(i[0]-l,i[1]-u,i[2]-c,h)}}}catch(_){r.e(_)}finally{r.f()}var d,f=(0,W.Z)(e);try{for(f.s();!(d=f.n()).done;){var p=d.value,m=p.pos,g=p.actualId,v=p.data;(0,H.rL)().setBlockNoMulti(m[0],m[1],m[2],g);var y=JSON.parse(v);void 0!==y&&o.blockDataOwner.setBlockData(m[0],m[1],m[2],y),o.blockAdded(m[0],m[1],m[2],g)}}catch(_){f.e(_)}finally{f.f()}H.f$.publish("EditBoard",{pos:null})})),t.onMessage(Me.cU.pickUpItem,(function(e){var t=e.name,r=e.amount,n=e.metadata;i().pickUpItem({name:t,amount:r,typeObj:K.k2[t],metadata:n})})),t.onMessage(Me.cU.setItemSlot,(function(e){var t=e.index,r=e.name,n=e.amount,o=e.metadata;i().setItemSlot(t,r,n,o)})),t.onMessage(Me.cU.syncInven,(function(e){var t=e.iOpsData,n=e.isErr;r.ents.getInventoryState(r.playerEntity)?(n&&console.error("Had to sync inven"),r.ents.getInvenOps(r.playerEntity).loadFromString(t),H.f$.publish("syncedInvenFromServer")):console.log("Got resync inven but don't have inven component")})),t.onMessage(Me.cU.clearInventory,(function(){i().clearInventory()})),t.onMessage(Me.cU.leaveValues,(function(e){var t=e.leaveEventType,r=e.category,n=e.subCategory,i=e.value;H.f$.publish("leaveValues",{leaveEventType:t,category:r,subCategory:n,value:i})})),t.onMessage(Me.cU.customAnalyticsEvent,(function(e){var t=e.cat1,n=e.cat2,i=e.cat3,o=e.value,s=t;n&&(s+=":"+n),i&&(s+=":"+i),r.GA.addDesignEvent(s,o||0)}));var o=(0,H.rL)();t.onMessage(Me.cU.compressedBlocksChanged,(function(e){var t,r=(0,W.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(4===n.length){var i=(0,G.Z)(n,4),s=i[0],a=i[1],l=i[2],u=i[3];o.setBlock(s,a,l,u)}else for(var c=(0,G.Z)(n,7),h=c[0],d=c[1],f=c[2],p=c[3],m=c[4],g=c[5],v=c[6],y=h;y<d+1;y++)for(var _=f;_<p+1;_++)for(var b=m;b<g+1;b++)o.setBlock(y,_,b,v)}}catch(S){r.e(S)}finally{r.f()}})),t.onMessage(Me.cU.setSelectedInventorySlotI,(function(e){H.f$.publish("setSelectedInventorySlotI",e,!0)})),t.onMessage(Me.cU.leaderboardResponse,(function(e){var t=e.category,r=e.timeframe,n=e.data;H.f$.publish("leaderboardResponse",{category:t,timeframe:r,data:n})})),t.onMessage(Me.cU.bullet,(function(e){var t=e.whoShot,r=e.dirs;H.f$.publish("bulletShot|".concat(t),{bulletDirections:r})})),t.onMessage(Me.cU.gunHit,(function(e){var t,n=e.gunId,i=e.whoShotEId,o=e.direction,s=K.k2[n],a=r.entities.getMoveState(r.playerEntity).speedMultiplier,l=a.getMultiplierType("taggedSlowdown");l?t=l-(l-l*s.tagSpeedMult)*s.subsequentTagSpeedReductionScalar:t=s.tagSpeedMult;a.setMultiplierType("taggedSlowdown",t),r.entities.getGenericPlayerState(r.playerEntity).lastSlowdownUpdate=Date.now(),H.f$.publish("damagedByOtherPlayer",{whoShotEId:i,direction:o},!0)})),t.onMessage(Me.cU.playerKilled,(function(e){H.f$.publish("playerKilled",e,!0)})),t.onMessage(Me.cU.reloading,(function(e){var t,n=e.EId,i=e.numBullets;null===(t=r.entities.getHeldItem(n))||void 0===t||t.reload(i)})),t.onMessage(Me.cU.showShopTutorial,(function(){H.f$.publish("showShopTutorial",null,!0)})),t.onMessage(Me.cU.progressBarUpdate,(function(e){H.f$.publish("progressBarUpdate",e,!0)})),t.onMessage(Me.cU.doorTypeSwap,(function(e){var t=e.initiatorEId,r=e.rootPos;if(o.hasChunkWithBlockCoordinates(r[0],r[1],r[2])){var n=(0,H.rL)().getBlock(r[0],r[1],r[2]);(0,H.rL)().swapDoorTypeOpenClosed(t,r[0],r[1],r[2],n)}})),t.onMessage(Me.cU.chestState,(function(e){var t=e.open,n=e.contents;t?r.ents.getInvenOps(r.playerEntity).chestOpened(n):r.ents.getInvenOps(r.playerEntity).chestClosed(),H.f$.publish("chestToggleFromServer",t,!0)})),t.onMessage(Me.cU.editItemCraftingRecipes,(function(e){var t=e.itemName,n=e.recipesForItem;o.craftingManager.editRecipesForPlayer(r.playerEntity,t,n),H.f$.publish("craftingRecipesEdited",{itemName:t,recipesForItem:n})})),t.onMessage(Me.cU.playerSwingArmChange,(function(e){var t=e.newVal,n=e.eId;if(r.ents.getMoveState(n)){r.ents.getMoveState(n).armSwinging=t;var i=r.ents.getPlayerMeshState(n);i&&t&&(i.consumedNetworkArmSwing=!1)}})),t.onMessage(Me.cU.charCustUpdate,(function(e){var t,r=(0,W.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;(0,q.zI)(n)}}catch(i){r.e(i)}finally{r.f()}H.f$.publish("charCustomisationUpdated",e,!0)})),t.onMessage(Me.cU.entityHurt,(function(e){var t=e.eId,n=(e.yourAttack,e.kbPs),i=void 0!==n&&n,o=e.cPs,s=void 0!==o&&o;if(t=(0,H.dP)(t),r.entities.getState(t,"genericAliveEntity").lastHurtTime=Date.now(),i){var a=r.entities.getPosition(t);(0,ne.JC)(r,ne.QI,[a[0],a[1]+1,a[2]],10)}if(s){var l=r.entities.getPosition(t);(0,ne.JC)(r,ne.Qk,[l[0],l[1]+1,l[2]],10)}}));var s=$().create();t.onMessage(Me.cU.attacked,(function(e){var t=e.dir,n=e.sprinted,i=e.scalar,o=e.redVert,a=r.entities.getPhysicsBody(r.playerEntity);a.velocity[0]=0,a.velocity[2]=0,o&&(a.velocity[1]>0&&(a.velocity[1]=0),a._impulses[1]>0&&(a._impulses[1]=0),r.ents.getMoveState(r.playerEntity).hitInPrevTick=!0);var l=$().copy(s,t),u=.4;l[1]>0&&(u+=.1*l[1]),l[1]=0,0===t[0]&&0===t[2]&&(t[0]=.01),$().normalize(l,l),l[1]=u;var c=r.ents.getMovement(r.playerEntity).isInCobweb(),h=13*(n?1.3:1)*(.9+.2*Math.random())*i*(c?.1:1);l[0]*=h,l[2]*=h;var d=15*(n?1.2:1)*(.9+.2*Math.random())*i*(c?.5:1);l[1]*=d,a.applyImpulse(l)})),t.onMessage(Me.cU.charArmourUpdate,(function(e){var t,r=(0,W.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;(0,q.Z7)(n)}}catch(i){r.e(i)}finally{r.f()}})),t.onMessage(Me.cU.kick,(function(e){H.f$.publish("kickedFromServer","Kicked: ".concat(e)),(0,Q.mH)()})),t.onMessage(Me.cU.removeItemName,(function(e){var t=e.name,n=e.amt;r.ents.getInventory(r.playerEntity).removeItemName(t,n)})),t.onMessage(Me.cU.setCamDir,(function(e){var t=(0,ie.NQ)([-e[0],-e[1],-e[2]]),n=t.theta,i=t.phi;r.camera.heading=n,r.camera.pitch=i})),t.onMessage(Me.cU.matchmake,(function(e){var t=e.toGame,r=e.lobbyName;(0,oe.kB)((function(){console.log("Received matchmaking order from game server to game",t),(0,Q.I4)(null!==t&&void 0!==t?t:H.EU.connectedPlayingMode,null!==r&&void 0!==r?r:null)}))})),t.onMessage(Me.cU.newUiRequest,(function(e){H.f$.publish("newUiRequest",e,!0)})),t.onMessage(Me.cU.removeUiRequest,(function(e){H.f$.publish("removeUiRequest",e,!0)})),t.onMessage(Me.cU.uiRequestPopup,(function(e){var t=e.text,r=e.id;H.f$.publish("uiRequestPopup",{text:t,callback:function(e){(0,H.Xi)(Me.Vz.UiRequestResp,{id:r,response:e})}},!0)})),t.onMessage(Me.cU.EffectUpdate,(function(e){H.f$.publish("EffectUpdate",e,!0)})),t.onMessage(Me.cU.SpeedEffectAmount,(function(e){r.ents.getMoveState(r.playerEntity).speedMultiplier.setMultiplierType("speedEffectAmount",e)})),(0,H.Xr)((function(){r.ents.getMoveState(r.playerEntity).speedMultiplier.setMultiplierType("speedEffectAmount",1)})),t.onMessage(Me.cU.playSound,(function(e){var t,r,n=e.namePrefix,i=e.volume,o=e.rate,s=e.posSettings,a=null!==s&&void 0!==s?s:{},l=a.playerIdOrPos,u=a.maxHearDist,c=a.refDistance;u=null!==(t=u)&&void 0!==t?t:void 0,c=null!==(r=c)&&void 0!==r?r:void 0,l&&(0,H.dP)(l)!==(0,H.Zx)().playerEntity||(0,ae.GW)().play((0,se.r_)(n),i,l,u,c).rate(o)})),t.onMessage(Me.cU.setBlockData,(function(e){var t=e.pos,r=e.data;o.blockDataOwner.setBlockData(t[0],t[1],t[2],r),o.blockAdded(t[0],t[1],t[2],o.getBlock(t[0],t[1],t[2]))})),t.onMessage(Me.cU.overShopInfo,(function(e){var t=e.info;H.f$.publish("overShopInfo",t,!0)})),t.onMessage(Me.cU.forceShowShop,(function(e){H.f$.publish("forceShowShop",e,!0)})),t.onMessage(Me.cU.applyForce,(function(e){console.log("Applying",e),r.entities.getPhysicsBody(r.playerEntity).applyForce(e)}))}H.f$.subscribe("clientTaskProgress",(function(e){Be((0,H.Zx)(),e)})),window.addEventListener("beforeunload",(function(){}))},85853:function(e,t,r){"use strict";r.d(t,{ur:function(){return R},sM:function(){return k},$e:function(){return i},fs:function(){return P},Q8:function(){return B},Z7:function(){return F},zI:function(){return O}});var n,i,o=r(4942),s=r(1413),a=r(37762),l=r(15861),u=r(64687),c=r.n(u),h=(r(4892),r(47984),r(36470),r(35941),r(67269)),d=r(85774),f=r(41038),p=r(41494),m=r(87683),g=r(70937),v=r(9488),y=r(30258),_=r(13813),b=r(37928),S=r(43971),A=r(14848),x=r(92643),C=r(47077),M=r.n(C);function T(e){var t=null,r=[];d.f$.subscribe("serverOption|numClosestPlayersVisible",(function(r){if(t=r,null!==r)o();else{var n,i=e.ents.getStatesList("genericPlayerState"),s=(0,a.Z)(i);try{for(s.s();!(n=s.n()).done;){var l=n.value;l.meshEnabledCombinator.removeBoolean("closestVisibleX"),e.entities.getState(l.__id,"shadow").enabledCombinator.removeBoolean("closestVisibleX")}}catch(u){s.e(u)}finally{s.f()}}}));var n=M().create(),i=0;function o(){if(null!==t){var o=e.entities.getPosition(e.playerEntity);i=Date.now(),M().copy(n,o);for(var s=e.ents.getStatesList("genericPlayerState"),l=0;l<s.length;l++)r[l]=s[l];r.length=s.length,r.sort((function(t,r){return M().dist(e.entities.getPosition(t.__id),o)-M().dist(e.entities.getPosition(r.__id),o)}));var u,c=0,h=(0,a.Z)(r);try{for(h.s();!(u=h.n()).done;){var d=u.value;d.__id!==e.playerEntity&&(c<t?(d.meshEnabledCombinator.setBooleanType("closestVisibleX",!0),e.entities.getState(d.__id,"shadow").enabledCombinator.setBooleanType("closestVisibleX",!0),c++):(d.meshEnabledCombinator.setBooleanType("closestVisibleX",!1),e.entities.getState(d.__id,"shadow").enabledCombinator.setBooleanType("closestVisibleX",!1)))}}catch(f){h.e(f)}finally{h.f()}}}e.on("tick",(function(t){var r=e.entities.getPosition(e.playerEntity),s=M().dist(r,n);Date.now()-i<500&&s<3||o()}))}function P(e){return I.apply(this,arguments)}function I(){return(I=(0,l.Z)(c().mark((function e(t){var r,o,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(t.rendering.getScene());case 2:r=e.sent,o=r.container,s=r.customisationMgr,n=o,i=s,w(t),T(t);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return E.apply(this,arguments)}function E(){return(E=(0,l.Z)(c().mark((function e(t){var r,n,i,o,s,l,u,f,p,y,_,x;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new m.K("playerSpriteSheet",t),new b.Fu(r),r.diffuseTexture=new g.x(S.$,t,null,null,g.x.NEAREST_SAMPLINGMODE),r.specularColor=new v.Wo(0,0,0),r.freeze(),n=new m.K("armourMat",t),new b.J5(n,"".concat(A.Al.toString(),".0")),n.diffuseTexture=new g.x(A.Ng,t,null,null,g.x.NEAREST_SAMPLINGMODE),n.specularColor=new v.Wo(0,0,0),n.diffuseTexture.hasAlpha=!0,n.backFaceCulling=!1,n.freeze(),e.next=14,h.n.LoadAssetContainerAsync((0,d.v7)("64x64UVPlayerArmour2"),null,t);case 14:i=e.sent,o=new b.cd((0,d.rL)(),i),s=i.meshes,l=s[1].material,u=(0,a.Z)(s);try{for(u.s();!(f=u.n()).done;)(p=f.value).material&&("Armour"===p.name.split("|")[1]?p.material=n:p.material=r)}catch(c){u.e(c)}finally{u.f()}l.dispose(),y=(0,a.Z)(s);try{for(y.s();!(_=y.n()).done;)(x=_.value).alwaysSelectAsActiveMesh=!0,x.doNotSyncBoundingInfo=!0,x.setEnabled(!1),x.isPickable=!1}catch(c){y.e(c)}finally{y.f()}return e.abrupt("return",{container:i,customisationMgr:o});case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t){var r,n=e.instantiateModelsToScene((function(e){return e}),!1,{doNotInstantiate:!1}).rootNodes[0],i=(0,a.Z)(n.getChildMeshes(!1));try{for(i.s();!(r=i.n()).done;){var o=r.value;"Armour"===o.name.split("|")[1]&&o.setEnabled(!1)}}catch(s){i.e(s)}finally{i.f()}return n}function w(e){var t=e.playerEntity;B(e,t);var r=e.ents;r.addComponent(e.playerEntity,r.names.receivesInputs),r.addComponent(e.playerEntity,r.names.movement),r.addComponent(t,r.names.updateServerOfMovement),r.addComponent(t,r.names.playerCameraAdjustment),r.addComponent(t,r.names.crouchingHandler),r.addComponent(t,"stepSoundOnWalk"),e.entities.addComponent(t,"playerHowlerListenerUpdate"),e.entities.getPhysicsBody(t).alwaysApplyHorizFriction=!0,e.on("beforePhysicsTick",(function(t){(0,y.tickReceivesInputsPrePhysics)(e,t),(0,_.tickMovementPrePhysics)(e,t)}));var n=new f.C;n.setBooleanType("standardCanRun",!0),e.entities.getState(e.playerEntity,"receivesInputs").canRunCombinator=n,function(e){var t=e.playerEntity;d.f$.subscribe("serverOption|useInventory",(function(r){!0!==r||e.ents.hasInventory(t)||(e.ents.addComponent(t,e.ents.names.inventory),e.ents.getInvenOps(e.playerEntity).inCreative=e.serverSettings.creative),!1===r&&e.ents.hasInventory(t)&&e.ents.removeComponent(t,e.ents.names.inventory)})),d.f$.subscribe("serverOption|creative",(function(r){e.ents.hasComponent(t,"inventory")&&(e.ents.getInvenOps(e.playerEntity).inCreative=r)})),d.f$.subscribe("leaveGame",(function(){e.ents.hasInventory(t)&&e.ents.removeComponent(t,e.ents.names.inventory)}))}(e),(0,p.Bj)(e)}function B(e,t){var r,i,o;e.entities.addComponent(t,e.ents.names.moveState),e.entities.addComponent(t,"genericPlayerState"),e.entities.addComponent(t,"genericAliveEntity"),e.entities.addComponent(t,"heldItem"),e.entities.addComponent(t,"meshRotation"),e.entities.addComponent(t,"hitbox"),function(e,t){var r=e.entities.getGenericPlayerState(t);r.meshEnabledCombinator.setBooleanType("notDead",!0),e.entities.getState(t,"shadow").enabledCombinator.setBooleanType("notDead",!0),r.meshEnabledCombinator.setBooleanType("canSeeSetting",!0),e.entities.getState(t,"shadow").enabledCombinator.setBooleanType("canSeeSetting",!0);var n=function(n,i){r.meshEnabledCombinator.setBooleanType(n,i),e.entities.getState(t,"shadow").enabledCombinator.setBooleanType(n,i)};e.otherPlayerSettings[e.playerEntity][t]&&(n("notDead",e.otherPlayerSettings[e.playerEntity][t]._isAlive),n("canSeeSetting",e.otherPlayerSettings[e.playerEntity][t].canSee));var i,o=d.f$.subscribe("otherPlayerSettingsClientifiedEId|".concat(t,"|_isAlive"),(function(e){n("notDead",e)})),s=d.f$.subscribe("otherPlayerSettingsClientifiedEId|".concat(t,"|canSee"),(function(e){n("canSeeSetting",e)}));if(t===e.playerEntity){var a={gravityMultiplier:null};i=d.f$.subscribe("otherPlayerSettingsClientifiedEId|".concat(e.playerEntity,"|_isAlive"),(function(t){var r=e.entities.getPhysicsBody(e.playerEntity);if(t){if(null===a.gravityMultiplier)return;for(var n in a)r[n]=a[n]}else a.gravityMultiplier=r.gravityMultiplier,r.gravityMultiplier=0,r.velocity[0]=0,r.velocity[1]=0,r.velocity[2]=0,r._forces[0]=0,r._forces[1]=0,r._forces[2]=0,r._impulses[0]=0,r._impulses[1]=0,r._impulses[2]=0}))}var l=d.f$.subscribe("playerLeaveClientifiedEId|".concat(t),(function(){d.f$.unsubscribe(o),d.f$.unsubscribe(s),d.f$.unsubscribe(i),d.f$.unsubscribe(l)}))}(e,t),function(e,t){var r=e.entities.getGenericPlayerState(t),n=r.meshEnabledCombinator,i=e.serverSettings.showPlayersInUnloadedChunks||!1;n.setBooleanType("inLoadedChunk",i);var o=!1,s=i;e.entities.addComponent(t,"inLoadedChunk",{inChunkChange:function(i){o=i,s||(n.setBooleanType("inLoadedChunk",i),t!==e.playerEntity&&(r.playerComponentsOn=i))}});var a=d.f$.subscribe("serverOption|showPlayersInUnloadedChunks",(function(i){(s=i)?(n.setBooleanType("inLoadedChunk",!0),r.playerComponentsOn=!0):(n.setBooleanType("inLoadedChunk",o),t!==e.playerEntity&&(r.playerComponentsOn=o))})),l=d.f$.subscribe("playerLeaveClientifiedEId|".concat(t),(function(){d.f$.unsubscribe(a),d.f$.unsubscribe(l)}))}(e,t);var s=R(n);s.scaling.scaleInPlace(.12);e.ents.addComponent(t,e.ents.names.playerMesh,{rootMesh:s}),e.entities.addComponent(t,e.ents.names.mesh,{mesh:s,offset:[0,0,0],isPickable:!1});var l=e.entities.getGenericPlayerState(t).meshEnabledCombinator.getTotalBooleanVal();s.setEnabled(l),D[t]&&(O({eId:t,part:"head",selected:D[t].head}),O({eId:t,part:"body",selected:D[t].body}),O({eId:t,part:"legs",selected:D[t].legs})),L[t]&&(F({eId:t,part:"Helmet",selected:L[t].Helmet}),F({eId:t,part:"Chestplate",selected:L[t].Chestplate}),F({eId:t,part:"Gauntlets",selected:L[t].Gauntlets}),F({eId:t,part:"Leggings",selected:L[t].Leggings}),F({eId:t,part:"Boots",selected:L[t].Boots})),e.ents.getState(t,e.ents.names.shadow).size=.6;var u=t;t===e.playerEntity&&(u=e.serverPlayerEntity,d.f$.subscribe("initInfoReceived",(function(){u=e.serverPlayerEntity})));var c=s.getChildMeshes(!1),h=d.f$.subscribe("otherPlayerSettings|opacity",(function(e){var t=e.EId,r=e.value;if(t===u){var n,i=(0,a.Z)(c);try{for(i.s();!(n=i.n()).done;){var o=n.value;void 0===b.XT[o.name]&&o.setEnabled(0!==r)}}catch(s){i.e(s)}finally{i.f()}}})),f=d.f$.subscribe("otherPlayerSettingsClientifiedEId|".concat(t,"|_invincible"),(function(e){p(e)}));function p(r){!r&&e.entities.hasComponent(t,"flashingMeshOverlay")&&e.entities.removeComponent(t,"flashingMeshOverlay"),r&&!e.entities.hasComponent(t,"flashingMeshOverlay")&&e.entities.addComponent(t,"flashingMeshOverlay")}p(null===(r=e.otherPlayerSettings[e.playerEntity][t])||void 0===r?void 0:r._invincible);var m=d.f$.subscribe("playerLeaveClientifiedEId|".concat(t),(function(){d.f$.unsubscribe(h),d.f$.unsubscribe(m),d.f$.unsubscribe(f)}));if(null!==(i=e.otherPlayerSettings)&&void 0!==i&&null!==(o=i[e.playerEntity])&&void 0!==o&&o[u]){var g,v=(0,a.Z)(c);try{for(v.s();!(g=v.n()).done;){var y=g.value;void 0===b.XT[y.name]&&y.setEnabled(0!==e.otherPlayerSettings[e.playerEntity][u].opacity)}}catch(_){v.e(_)}finally{v.f()}}d.f$.publish("ModelLoaded|".concat(t))}var D={};function O(e){var t=e.eId,r=e.part,n=e.selected;D[t]=(0,s.Z)((0,s.Z)({},D[t]),{},(0,o.Z)({},r,n));var a=(0,d.dP)(t),l=(0,d.Zx)().entities.getPlayerMeshState(a);l&&i.updateInstanceCustomisation(l.rootMesh,r,n)}(0,d.ZC)((function(){D={}}));var L={};function F(e){var t=e.eId,r=e.part,n=e.selected;L[t]=(0,s.Z)((0,s.Z)({},L[t]),{},(0,o.Z)({},r,n));var a=(0,d.dP)(t);if((0,d.Zx)().entities.getPlayerMeshState(a)){var l=n?(0,x.uO)(n):null,u=n?(0,x.yE)(n):null;i.updateInstanceArmour(a,r,l,u)}}(0,d.ZC)((function(){F({eId:(0,d.Zx)().serverPlayerEntity,part:"Helmet",selected:null}),F({eId:(0,d.Zx)().serverPlayerEntity,part:"Chestplate",selected:null}),F({eId:(0,d.Zx)().serverPlayerEntity,part:"Gauntlets",selected:null}),F({eId:(0,d.Zx)().serverPlayerEntity,part:"Leggings",selected:null}),F({eId:(0,d.Zx)().serverPlayerEntity,part:"Boots",selected:null}),L={}}))},91314:function(e,t,r){"use strict";r.d(t,{O:function(){return v}});var n,i=r(37762),o=r(15671),s=r(43144),a=r(47077),l=r.n(a),u=r(52126),c=r(39269);function h(e,t,r,n){var i=e.getItemStat(t,r,"drops"),o=e.getItemStat(t,r,"specialToolDrop");return null!==o&&void 0!==o&&o.tool&&n===o.tool?o.drops:i||(null!==i?e.getMetaInfo(r).rootName:null)}!function(e){e[e.Boom=0]="Boom",e[e.Freeze=1]="Freeze"}(n||(n={}));var d=[0,0,0],f=[0,0,0],p=[0,0,0];function m(e,t,r,i,o,s,a,u){if(e.checkValid(r)){for(var c=Math.floor(i),m=Math.floor(o),g=Math.floor(s),v=0;v<300;v++)for(var y=l().set(d,c,m,g),_=a,b=0;b<7;b++){if(y[Math.floor(3*Math.random())]+=Math.random()<.5?-1:1,(_-=.6)<=0)break;var S=e.getBlock(y);if("Air"!==S&&"Protector"!==S&&"Unloaded"!==S){var A=e.getItemStat(r,S,"ttb");if((_-=(null!==A&&void 0!==A?A:500)/2e3)<=0)break;var x=e.attemptWorldChangeBlock(e.getPlayerDbId(r),y[0],y[1],y[2],"Air"),C=h(e,r,S,null);if(x&&A&&C)Math.random()<(t===n.Freeze?.4:0)?e.setBlock(y[0],y[1],y[2],"Ice"):e.createItemDrop(y[0]+.5,y[1]+.5,y[2]+.5,C,1,!0)}}var M=2*a,T=l().set(f,i,o-.1,s);e.forEachEntity((function(i){var o=e.getPosition(i),s=l().distance(o,T);if(s<M){var c=e.getPhysicsBody(i);o[1]+=c?c.aabb.vec[1]/2:.9,s=l().distance(o,T);var h=l().subtract(p,o,T);0===l().length(h)&&(h[1]=1),l().normalize(h,h);var d=1-s/M;l().scale(h,h,1e3*d),c||(h[0]*=1.5,h[2]*=1.5);var f=!0;c||(f=e.applyDamage(r,i,37.5*d*a*(t===n.Freeze?.5:1),u,null,!1,!1,!0,!1,!0,null,!0)),f&&(t===n.Boom?e.applyForce(i,h[0],h[1],h[2]):t===n.Freeze&&(e.applyForce(i,.05*h[0],.05*h[1],.05*h[2]),c||e.applyEffect(i,"Frozen",2e3*d)))}}))}}var g=.1,v=function(){function e(t,r,n){(0,o.Z)(this,e),this.bloxd=void 0,this.noa=void 0,this.eId=void 0,this.type=void 0,this.bloxd=t,this.noa=t.noa,this.eId=r,this.type=n}return(0,s.Z)(e,[{key:"initClient",value:function(e){var t=this;this.noa.ents.add([e.x,e.y,e.z],g,g,null,null,!1,!1,this.eId),this.noa.ents.addComponent(this.eId,this.noa.ents.names.smoothToServerPos),this.noa.ents.addComponent(this.eId,"doOnFirstTick",{cb:function(){t.noa.ents.addComponent(t.eId,"hidingMeshManager",{addMeshComponent:function(){console.log("Adding throwable",t.eId),t.noa.entities.addComponent(t.eId,"mesh",{mesh:t.bloxd.rendering.getThrowableMesh(t.type),shouldAddMeshToScene:!1})},removeMeshComponent:function(){t.noa.entities.removeComponent(t.eId,"mesh")},hideDist:30,movingHideDist:130})}})}},{key:"onChangeClient",value:function(e,t){}},{key:"disposeClient",value:function(){this.noa.ents.deleteEntity(this.eId)}},{key:"initServer",value:function(e){var t,r,o=this,s=e.pos,a=e.throwerEId,h=e.thrownDir,d=e.dispose,f=e.extraVelocityMult,p=e.extraDamageMult,v={Snowball:{velocityMult:15,removeOnHitTerrain:!1,friction:300,restitution:.2,canPickUpAfterBounceCount:1,autoRemoveAfterTime:2e4},Pebble:{velocityMult:20,removeOnHitTerrain:!0},"Reinforced Pebble":{velocityMult:30,removeOnHitTerrain:!0},Ball:{velocityMult:10,removeOnHitTerrain:!1,friction:1,restitution:.8,canPickUpAfterBounceCount:0,autoRemoveAfterTime:6e4},"Reinforced Ball":{velocityMult:15,removeOnHitTerrain:!1,friction:.5,restitution:.2,canPickUpAfterBounceCount:0,autoRemoveAfterTime:6e4},Fireball:{velocityMult:20,removeOnHitTerrain:!0,gravityMult:0,onHitTerrain:function(){var e=_.getPosition(o.eId);m(o.bloxd.room.api,n.Boom,a,e[0],e[1],e[2],1.7,"Fireball Block")},onHitPlayer:function(){var e=_.getPosition(o.eId);m(o.bloxd.room.api,n.Boom,a,e[0],e[1],e[2],1.7,"Fireball Block")}},Iceball:{velocityMult:20,removeOnHitTerrain:!0,gravityMult:0,onHitTerrain:function(){var e=_.getPosition(o.eId);m(o.bloxd.room.api,n.Freeze,a,e[0],e[1],e[2],2,"Iceball Block")},onHitPlayer:function(){var e=_.getPosition(o.eId);m(o.bloxd.room.api,n.Freeze,a,e[0],e[1],e[2],2,"Iceball Block")}},"Moonstone Orb":{velocityMult:25,removeOnHitTerrain:!0,onHitTerrain:function(){if(_.checkValid(a)){var e=_.getPosition(o.eId),t=[Math.floor(e[0]),Math.floor(e[1]),Math.floor(e[2])];"Air"!==_.getBlock(t[0],t[1]+1,t[2])&&"Air"===_.getBlock(t[0],t[1]-1,t[2])&&(t[1]-=1),t[0]+=.5,t[2]+=.5,_.setPosition(a,t)}else b()}},Arrow:{velocityMult:45,removeOnHitTerrain:!1,friction:1e5,restitution:0,canPickUpAfterBounceCount:1,autoRemoveAfterTime:2e4,onHitTerrain:function(){o.noa.ents.getPhysicsBody(o.eId).gravityMultiplier=0,l().copy(o.noa.ents.getPhysicsBody(o.eId).velocity,y)}}},_=this.bloxd.room.api,b=function(){d(),_.clearInterval(S),_.clearTimeout(A)};this.noa.ents.add(s,g,g,null,null,!0,!1,this.eId),this.noa.ents.addComponent(this.eId,"syncablePosition");var S=_.setInterval((function(){var e,t=_.getPosition(o.eId),r=1e5,n=(0,i.Z)(_.getPlayerIds());try{for(n.s();!(e=n.n()).done;){var s=e.value;r=Math.min(r,l().dist(t,_.getPosition(s)))}}catch(a){n.e(a)}finally{n.f()}r>100&&b()}),3e3,this.eId),A=_.setTimeout((function(){b()}),null!==(t=v[this.type].autoRemoveAfterTime)&&void 0!==t?t:6e4,this.eId),x=0;this.noa.ents.addComponent(this.eId,"collideTerrain",{callback:function(){var e,t,r=o.noa.ents.getPhysicsBody(o.eId);l().length(r.velocity)>.1&&v[o.type].removeOnHitTerrain&&((0,c.doSingleEntityProjectileCollisionFromPhysics)(o.noa,o.eId),!o.noa.ents.hasComponent(o.eId,"collideTerrain"))||(null===(e=(t=v[o.type]).onHitTerrain)||void 0===e||e.call(t),x++,v[o.type].removeOnHitTerrain&&b())}}),this.noa.ents.addComponent(this.eId,"collideEntitiesProjectile",{callback:function(e){if("Player"===_.getEntityType(e)){var t,r=null!==(t=v[o.type].canPickUpAfterBounceCount)&&void 0!==t?t:1e5;e===a&&(r=Math.max(1,r));var n,i,s=x>=r;if(o.bloxd.getItemStat(a,o.type,"secondaryDamage")&&e!==a&&!s&&o.bloxd.canAttack(a,e))o.bloxd.playerAttemptDamageOtherPlayer(a,e,o.bloxd.getItemStat(a,o.type,"secondaryDamage")*p,o.type,l().normalize([0,0,0],h),!1,!0,!0,!0,!0,"Arrow"===o.type?{sound:"successfulBowHit",volume:1,pitch:.9+.2*Math.random()}:void 0),null===(n=(i=v[o.type]).onHitPlayer)||void 0===n||n.call(i),b();else s&&o.bloxd.getPlayerClientOption(e,"canPickUpItems")&&(_.giveItem(e,o.type,1),_.playSound(e,"pickUp",u.ZP.pickupSoundVol,1+Math.random()*u.ZP.pickupSoundRateVariation),b())}}}),l().normalize(h,h),l().scale(h,h,v[this.type].velocityMult*f);var C=this.noa.ents.getPhysicsBody(this.eId);l().copy(C.velocity,h),C.gravityMultiplier=null!==(r=v[this.type].gravityMult)&&void 0!==r?r:1,C.mass=.02,C.airDrag=.1*C.mass,C.fluidDrag=.2,C.slideOnCollision=!1,v[this.type].restitution&&(C.restitution=v[this.type].restitution),void 0!==v[this.type].friction&&(C.friction=v[this.type].friction)}}]),e}(),y=l().create()},57906:function(e,t,r){"use strict";r.d(t,{Ii:function(){return p},ay:function(){return f}});var n=r(93433),i=r(15671),o=r(43144),s=r(44815),a=r(52126),l=r(85774),u=r(92643),c=r(34177),h=r(79520),d=r(80427),f=function(){function e(t,r,n){(0,i.Z)(this,e),this.noa=void 0,this.playerInventory=void 0,this.openChest=null,this.inCreative=!1,this.onChestUpdate=void 0,this.noa=t,this.playerInventory=r,this.onChestUpdate=n}return(0,o.Z)(e,[{key:"chestOpened",value:function(e){this.openChest=this.makeChestFromStr(e)}},{key:"chestClosed",value:function(){this.openChest=null}},{key:"removeItemClient",value:function(e,t){if(e>=this.playerInventory.numSlots&&!this.openChest&&!this.inCreative)return!1;var r,i=this.getItemAtIdx(e);if(null!==i&&void 0!==i&&i.amount&&i.amount<=0)return console.error(new Error("Found item ".concat(i.name," with non-positive amount ").concat(i.amount)).stack),!1;if(e<this.playerInventory.numSlots?r=this.playerInventory.removeItem(e,t):this.openChest?r=this.openChest.removeItem(e-this.playerInventory.numSlots,t):(console.assert(this.inCreative,"Must be in creative to get here"),r=!0),!r)return!1;var o=(0,n.Z)(this.noa.ents.getPosition(this.noa.playerEntity)),s=this.noa.camera.getDirection();return o=[o[0]+2*s[0],o[1]+1.5,o[2]+2*s[2]],(0,l.Xi)(d.Vz.dropItem,{idx:e,id:i.typeObj.id,pos:o,amount:t}),!0}},{key:"removeItem",value:function(e,t){return!(e>=this.playerInventory.numSlots&&!this.openChest&&!this.inCreative)&&(e<this.playerInventory.numSlots?this.playerInventory.removeItem(e,t):this.openChest?this.openChest.removeItem(e-this.playerInventory.numSlots,t):(console.assert(this.inCreative,"Must be in creative to get here"),!0))}},{key:"swapPosClient",value:function(t,r){var n=this.swapPos(t,r);if(n){(0,l.Xi)(d.Vz.swapInvenSlots,{i:t,j:r});var i=e.getSlotArmourType(t),o=e.getSlotArmourType(r);(i||o)&&(0,h.GW)().play("equip_leather1",1).rate(.9+.3*Math.random())}return n}},{key:"swapPos",value:function(t,r){if(!this.openChest&&!this.inCreative&&(t>=this.playerInventory.numSlots||r>=this.playerInventory.numSlots))return!1;var n=this.getItemAtIdx(t),i=this.getItemAtIdx(r),o=e.getSlotArmourType(t),s=e.getSlotArmourType(r);return!(s&&n&&(0,u.r9)(n.name)!==s||o&&i&&(0,u.r9)(i.name)!==o)&&(this.setItemAtIdx(t,i),this.setItemAtIdx(r,n),this.update(),!0)}},{key:"movePosWithAmtClient",value:function(e,t,r){if(e===t)return!0;var n=this.movePosWithAmt(e,t,r);return n&&(0,l.Xi)(d.Vz.moveInvenItemWithAmt,{i:e,j:t,amt:r}),n}},{key:"movePosWithAmt",value:function(e,t,r){if(!this.openChest&&!this.inCreative&&(e>=this.playerInventory.numSlots||t>=this.playerInventory.numSlots))return!1;var n=this.getItemAtIdx(e),i=this.getItemAtIdx(t);if(e===t)return!0;if(null===n)return!1;if(i&&(n.name!==i.name||i.amount+r>a.ZP.maxItemStackSize))return!1;if(null===n.amount)return!1;if(n.amount<=0)return console.error(new Error("movePosWithAmt found item ".concat(n.name," with amount ").concat(n.amount)).stack),!1;if(n.amount-r<0)return!1;n.amount-=r;var o=r;return n.name===(null===i||void 0===i?void 0:i.name)&&(o+=i.amount),this.setItemSlot(t,n.name,o,n.metadata),0===n.amount&&this.setItemSlot(e,"Air",0,null),this.update(),!0}},{key:"moveItemIntoIdxsClient",value:function(e,t,r,n){var i=this.moveItemIntoIdxs(e,t,r,n);return 0!==i&&(0,l.Xi)(d.Vz.moveItemIntoIdxs,{start:e,end:t,moveIdx:r,itemAmount:i}),i}},{key:"moveItemIntoIdxs",value:function(e,t,r,n){var i=this.getItemAtIdx(r);if(!i)return 0;if(null!==i.amount&&i.amount<=0)return console.error(new Error("moveItemIntoIdxs found item ".concat(i.name," with amount ").concat(i.amount)).stack),0;if(null!==i.amount&&i.amount-n<0)return 0;var o=n,s=n;if(null!==i.amount)for(var l=e;l<t;l++){var u=this.getItemAtIdx(l);if((null===u||void 0===u?void 0:u.name)===i.name){if(u.amount<=0){console.error(new Error("moveItemIntoIdxs found item ".concat(u.name," with amount ").concat(u.amount)).stack);continue}if(null===u.amount)continue;if(u.amount+s<=a.ZP.maxItemStackSize)return u.amount+=s,i.amount-=s,i.amount<=0&&(this.setItemAtIdx(r,null),i.amount<0&&console.error(new Error("Moved too much item into existing slot!").stack)),this.update(),o;if(u.amount<a.ZP.maxItemStackSize){var c=a.ZP.maxItemStackSize-u.amount;u.amount+=c,s-=c,i.amount-=c}}}var h=this.getFreeSlotBoundIdxs(e,t);return null!==h?(this.setItemAtIdx(h,{name:i.name,amount:s,typeObj:i.typeObj,metadata:i.metadata}),i.amount-=s,i.amount<=0&&(this.setItemAtIdx(r,null),i.amount<0&&console.error(new Error("Moved too much item!").stack)),this.update(),o):(this.update(),null===o?0:o-s)}},{key:"getFreeSlotBoundIdxs",value:function(e,t){for(var r=this.playerInventory.numSlots+(this.openChest?this.openChest.numSlots:0),n=e;n<Math.min(t,r);n++)if(null===this.getItemAtIdx(n))return n;return null}},{key:"setItemSlot",value:function(e,t,r,n){if(e>=this.playerInventory.numSlots){if(this.openChest)this.openChest.setItemSlot(e-this.playerInventory.numSlots,t,r,n);else if(!this.inCreative)throw new Error("Attempting to setItemSlot in high idx when not in chest or creative")}else if(e>=this.playerInventory.numSlots-u.XL.length){var i=e-this.playerInventory.numSlots+u.XL.length;if("Air"!==t&&(0,u.r9)(t)!==u.XL[i])throw new Error("Attempting to put invalid item ".concat(t," ").concat(r," ").concat(n," \t\t\t\t\tinto armour inven slot idx ").concat(e));this.playerInventory.setItemSlot(e,t,r,n)}else this.playerInventory.setItemSlot(e,t,r,n);return!0}},{key:"setItemAtIdx",value:function(e,t){if(t&&null!==t.amount&&(t.amount<0||t.amount>a.ZP.maxItemStackSize)&&(console.error(new Error("Tried to setItemAtIdx ".concat(e," with invalid amount ").concat(t.amount,". Slot will be set to null instead")).stack),t=null),e>=this.playerInventory.numSlots){if(this.openChest)this.openChest.items[e-this.playerInventory.numSlots]=t;else if(!this.inCreative)throw new Error("Attempting to set item in high idx when not in chest or creative")}else if(e>=this.playerInventory.numSlots-u.XL.length){var r,n,i,o,s=e-this.playerInventory.numSlots+u.XL.length;if(t&&(0,u.r9)(t.name)!==u.XL[s])throw new Error("Attempting to put invalid item ".concat(null===(r=t)||void 0===r?void 0:r.name," ").concat(null===(n=t)||void 0===n?void 0:n.amount," ").concat(JSON.stringify(null!==(i=null===(o=t)||void 0===o?void 0:o.metadata)&&void 0!==i?i:{})," into armour inven slot idx ").concat(e));this.playerInventory.items[e]=t}else this.playerInventory.items[e]=t}},{key:"getItemAtIdx",value:function(e){if(e>=this.playerInventory.numSlots){if(this.openChest)return this.openChest.items[e-this.playerInventory.numSlots];if(this.inCreative){var t=c.T[e-this.playerInventory.numSlots],r=this.noa.bloxd.getItemTypeObj(t);return{name:t,amount:r.stackable?1:null,metadata:(0,s.getInvenItemMetadata)(t),typeObj:r}}throw new Error("Attempting to get item in high idx when not in chest or creative")}return this.playerInventory.items[e]}},{key:"update",value:function(){var e;this.playerInventory.update(),null===(e=this.openChest)||void 0===e||e.update()}},{key:"stringify",value:function(){return{playerInven:this.playerInventory.stringify(),openChest:this.openChest?this.openChest.stringify():null}}},{key:"loadFromString",value:function(e){var t=e.playerInven,r=e.openChest;this.playerInventory.loadFromString(t),this.openChest=r?this.makeChestFromStr(r):null}},{key:"makeChestFromStr",value:function(e){var t=this;return p(e,this.noa,this.playerInventory.state.__id,(function(e){var r;null===(r=t.onChestUpdate)||void 0===r||r.call(t,e)}))}}],[{key:"getSlotArmourType",value:function(e){var t=e-s.playerInvenNumSlots+u.XL.length;return t<0||t>=u.XL.length?null:u.XL[t]}}]),e}();function p(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=m(t,r,n);return i.loadFromString(e),i}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new s.Inventory(e,{__id:t,selectedItem:null,inventory:null,opWrapper:null,onInventoryUpdate:function(){null===r||void 0===r||r(n.stringify())}},36);return n}},20306:function(e,t,r){"use strict";r.d(t,{E:function(){return o},a:function(){return a}});var n=r(37762),i=r(38017),o={"Maple Door":{positions:[{block:"Maple Door",x:0,y:0,z:0},{block:"_Maple Door Top",x:0,y:1,z:0}]},"Maple Door|meta|rot1|open":{positions:[{block:"Maple Door|meta|rot1|open",x:0,y:0,z:0},{block:"_Maple Door Top|meta|rot1|open",x:0,y:1,z:0}]},"Maple Door|meta|rot2|closed":{positions:[{block:"Maple Door|meta|rot2|closed",x:0,y:0,z:0},{block:"_Maple Door Top|meta|rot2|closed",x:0,y:1,z:0}]},"Maple Door|meta|rot2|open":{positions:[{block:"Maple Door|meta|rot2|open",x:0,y:0,z:0},{block:"_Maple Door Top|meta|rot2|open",x:0,y:1,z:0}]},"Maple Door|meta|rot3|closed":{positions:[{block:"Maple Door|meta|rot3|closed",x:0,y:0,z:0},{block:"_Maple Door Top|meta|rot3|closed",x:0,y:1,z:0}]},"Maple Door|meta|rot3|open":{positions:[{block:"Maple Door|meta|rot3|open",x:0,y:0,z:0},{block:"_Maple Door Top|meta|rot3|open",x:0,y:1,z:0}]},"Maple Door|meta|rot4|closed":{positions:[{block:"Maple Door|meta|rot4|closed",x:0,y:0,z:0},{block:"_Maple Door Top|meta|rot4|closed",x:0,y:1,z:0}]},"Maple Door|meta|rot4|open":{positions:[{block:"Maple Door|meta|rot4|open",x:0,y:0,z:0},{block:"_Maple Door Top|meta|rot4|open",x:0,y:1,z:0}]},"Pine Door":{positions:[{block:"Pine Door",x:0,y:0,z:0},{block:"_Pine Door Top",x:0,y:1,z:0}]},"Pine Door|meta|rot1|open":{positions:[{block:"Pine Door|meta|rot1|open",x:0,y:0,z:0},{block:"_Pine Door Top|meta|rot1|open",x:0,y:1,z:0}]},"Pine Door|meta|rot2|closed":{positions:[{block:"Pine Door|meta|rot2|closed",x:0,y:0,z:0},{block:"_Pine Door Top|meta|rot2|closed",x:0,y:1,z:0}]},"Pine Door|meta|rot2|open":{positions:[{block:"Pine Door|meta|rot2|open",x:0,y:0,z:0},{block:"_Pine Door Top|meta|rot2|open",x:0,y:1,z:0}]},"Pine Door|meta|rot3|closed":{positions:[{block:"Pine Door|meta|rot3|closed",x:0,y:0,z:0},{block:"_Pine Door Top|meta|rot3|closed",x:0,y:1,z:0}]},"Pine Door|meta|rot3|open":{positions:[{block:"Pine Door|meta|rot3|open",x:0,y:0,z:0},{block:"_Pine Door Top|meta|rot3|open",x:0,y:1,z:0}]},"Pine Door|meta|rot4|closed":{positions:[{block:"Pine Door|meta|rot4|closed",x:0,y:0,z:0},{block:"_Pine Door Top|meta|rot4|closed",x:0,y:1,z:0}]},"Pine Door|meta|rot4|open":{positions:[{block:"Pine Door|meta|rot4|open",x:0,y:0,z:0},{block:"_Pine Door Top|meta|rot4|open",x:0,y:1,z:0}]},"Plum Door":{positions:[{block:"Plum Door",x:0,y:0,z:0},{block:"_Plum Door Top",x:0,y:1,z:0}]},"Plum Door|meta|rot1|open":{positions:[{block:"Plum Door|meta|rot1|open",x:0,y:0,z:0},{block:"_Plum Door Top|meta|rot1|open",x:0,y:1,z:0}]},"Plum Door|meta|rot2|closed":{positions:[{block:"Plum Door|meta|rot2|closed",x:0,y:0,z:0},{block:"_Plum Door Top|meta|rot2|closed",x:0,y:1,z:0}]},"Plum Door|meta|rot2|open":{positions:[{block:"Plum Door|meta|rot2|open",x:0,y:0,z:0},{block:"_Plum Door Top|meta|rot2|open",x:0,y:1,z:0}]},"Plum Door|meta|rot3|closed":{positions:[{block:"Plum Door|meta|rot3|closed",x:0,y:0,z:0},{block:"_Plum Door Top|meta|rot3|closed",x:0,y:1,z:0}]},"Plum Door|meta|rot3|open":{positions:[{block:"Plum Door|meta|rot3|open",x:0,y:0,z:0},{block:"_Plum Door Top|meta|rot3|open",x:0,y:1,z:0}]},"Plum Door|meta|rot4|closed":{positions:[{block:"Plum Door|meta|rot4|closed",x:0,y:0,z:0},{block:"_Plum Door Top|meta|rot4|closed",x:0,y:1,z:0}]},"Plum Door|meta|rot4|open":{positions:[{block:"Plum Door|meta|rot4|open",x:0,y:0,z:0},{block:"_Plum Door Top|meta|rot4|open",x:0,y:1,z:0}]},"Cedar Door":{positions:[{block:"Cedar Door",x:0,y:0,z:0},{block:"_Cedar Door Top",x:0,y:1,z:0}]},"Cedar Door|meta|rot1|open":{positions:[{block:"Cedar Door|meta|rot1|open",x:0,y:0,z:0},{block:"_Cedar Door Top|meta|rot1|open",x:0,y:1,z:0}]},"Cedar Door|meta|rot2|closed":{positions:[{block:"Cedar Door|meta|rot2|closed",x:0,y:0,z:0},{block:"_Cedar Door Top|meta|rot2|closed",x:0,y:1,z:0}]},"Cedar Door|meta|rot2|open":{positions:[{block:"Cedar Door|meta|rot2|open",x:0,y:0,z:0},{block:"_Cedar Door Top|meta|rot2|open",x:0,y:1,z:0}]},"Cedar Door|meta|rot3|closed":{positions:[{block:"Cedar Door|meta|rot3|closed",x:0,y:0,z:0},{block:"_Cedar Door Top|meta|rot3|closed",x:0,y:1,z:0}]},"Cedar Door|meta|rot3|open":{positions:[{block:"Cedar Door|meta|rot3|open",x:0,y:0,z:0},{block:"_Cedar Door Top|meta|rot3|open",x:0,y:1,z:0}]},"Cedar Door|meta|rot4|closed":{positions:[{block:"Cedar Door|meta|rot4|closed",x:0,y:0,z:0},{block:"_Cedar Door Top|meta|rot4|closed",x:0,y:1,z:0}]},"Cedar Door|meta|rot4|open":{positions:[{block:"Cedar Door|meta|rot4|open",x:0,y:0,z:0},{block:"_Cedar Door Top|meta|rot4|open",x:0,y:1,z:0}]},"Aspen Door":{positions:[{block:"Aspen Door",x:0,y:0,z:0},{block:"_Aspen Door Top",x:0,y:1,z:0}]},"Aspen Door|meta|rot1|open":{positions:[{block:"Aspen Door|meta|rot1|open",x:0,y:0,z:0},{block:"_Aspen Door Top|meta|rot1|open",x:0,y:1,z:0}]},"Aspen Door|meta|rot2|closed":{positions:[{block:"Aspen Door|meta|rot2|closed",x:0,y:0,z:0},{block:"_Aspen Door Top|meta|rot2|closed",x:0,y:1,z:0}]},"Aspen Door|meta|rot2|open":{positions:[{block:"Aspen Door|meta|rot2|open",x:0,y:0,z:0},{block:"_Aspen Door Top|meta|rot2|open",x:0,y:1,z:0}]},"Aspen Door|meta|rot3|closed":{positions:[{block:"Aspen Door|meta|rot3|closed",x:0,y:0,z:0},{block:"_Aspen Door Top|meta|rot3|closed",x:0,y:1,z:0}]},"Aspen Door|meta|rot3|open":{positions:[{block:"Aspen Door|meta|rot3|open",x:0,y:0,z:0},{block:"_Aspen Door Top|meta|rot3|open",x:0,y:1,z:0}]},"Aspen Door|meta|rot4|closed":{positions:[{block:"Aspen Door|meta|rot4|closed",x:0,y:0,z:0},{block:"_Aspen Door Top|meta|rot4|closed",x:0,y:1,z:0}]},"Aspen Door|meta|rot4|open":{positions:[{block:"Aspen Door|meta|rot4|open",x:0,y:0,z:0},{block:"_Aspen Door Top|meta|rot4|open",x:0,y:1,z:0}]},"Elm Door":{positions:[{block:"Elm Door",x:0,y:0,z:0},{block:"_Elm Door Top",x:0,y:1,z:0}]},"Elm Door|meta|rot1|open":{positions:[{block:"Elm Door|meta|rot1|open",x:0,y:0,z:0},{block:"_Elm Door Top|meta|rot1|open",x:0,y:1,z:0}]},"Elm Door|meta|rot2|closed":{positions:[{block:"Elm Door|meta|rot2|closed",x:0,y:0,z:0},{block:"_Elm Door Top|meta|rot2|closed",x:0,y:1,z:0}]},"Elm Door|meta|rot2|open":{positions:[{block:"Elm Door|meta|rot2|open",x:0,y:0,z:0},{block:"_Elm Door Top|meta|rot2|open",x:0,y:1,z:0}]},"Elm Door|meta|rot3|closed":{positions:[{block:"Elm Door|meta|rot3|closed",x:0,y:0,z:0},{block:"_Elm Door Top|meta|rot3|closed",x:0,y:1,z:0}]},"Elm Door|meta|rot3|open":{positions:[{block:"Elm Door|meta|rot3|open",x:0,y:0,z:0},{block:"_Elm Door Top|meta|rot3|open",x:0,y:1,z:0}]},"Elm Door|meta|rot4|closed":{positions:[{block:"Elm Door|meta|rot4|closed",x:0,y:0,z:0},{block:"_Elm Door Top|meta|rot4|closed",x:0,y:1,z:0}]},"Elm Door|meta|rot4|open":{positions:[{block:"Elm Door|meta|rot4|open",x:0,y:0,z:0},{block:"_Elm Door Top|meta|rot4|open",x:0,y:1,z:0}]},"Palm Door":{positions:[{block:"Palm Door",x:0,y:0,z:0},{block:"_Palm Door Top",x:0,y:1,z:0}]},"Palm Door|meta|rot1|open":{positions:[{block:"Palm Door|meta|rot1|open",x:0,y:0,z:0},{block:"_Palm Door Top|meta|rot1|open",x:0,y:1,z:0}]},"Palm Door|meta|rot2|closed":{positions:[{block:"Palm Door|meta|rot2|closed",x:0,y:0,z:0},{block:"_Palm Door Top|meta|rot2|closed",x:0,y:1,z:0}]},"Palm Door|meta|rot2|open":{positions:[{block:"Palm Door|meta|rot2|open",x:0,y:0,z:0},{block:"_Palm Door Top|meta|rot2|open",x:0,y:1,z:0}]},"Palm Door|meta|rot3|closed":{positions:[{block:"Palm Door|meta|rot3|closed",x:0,y:0,z:0},{block:"_Palm Door Top|meta|rot3|closed",x:0,y:1,z:0}]},"Palm Door|meta|rot3|open":{positions:[{block:"Palm Door|meta|rot3|open",x:0,y:0,z:0},{block:"_Palm Door Top|meta|rot3|open",x:0,y:1,z:0}]},"Palm Door|meta|rot4|closed":{positions:[{block:"Palm Door|meta|rot4|closed",x:0,y:0,z:0},{block:"_Palm Door Top|meta|rot4|closed",x:0,y:1,z:0}]},"Palm Door|meta|rot4|open":{positions:[{block:"Palm Door|meta|rot4|open",x:0,y:0,z:0},{block:"_Palm Door Top|meta|rot4|open",x:0,y:1,z:0}]},"Pear Door":{positions:[{block:"Pear Door",x:0,y:0,z:0},{block:"_Pear Door Top",x:0,y:1,z:0}]},"Pear Door|meta|rot1|open":{positions:[{block:"Pear Door|meta|rot1|open",x:0,y:0,z:0},{block:"_Pear Door Top|meta|rot1|open",x:0,y:1,z:0}]},"Pear Door|meta|rot2|closed":{positions:[{block:"Pear Door|meta|rot2|closed",x:0,y:0,z:0},{block:"_Pear Door Top|meta|rot2|closed",x:0,y:1,z:0}]},"Pear Door|meta|rot2|open":{positions:[{block:"Pear Door|meta|rot2|open",x:0,y:0,z:0},{block:"_Pear Door Top|meta|rot2|open",x:0,y:1,z:0}]},"Pear Door|meta|rot3|closed":{positions:[{block:"Pear Door|meta|rot3|closed",x:0,y:0,z:0},{block:"_Pear Door Top|meta|rot3|closed",x:0,y:1,z:0}]},"Pear Door|meta|rot3|open":{positions:[{block:"Pear Door|meta|rot3|open",x:0,y:0,z:0},{block:"_Pear Door Top|meta|rot3|open",x:0,y:1,z:0}]},"Pear Door|meta|rot4|closed":{positions:[{block:"Pear Door|meta|rot4|closed",x:0,y:0,z:0},{block:"_Pear Door Top|meta|rot4|closed",x:0,y:1,z:0}]},"Pear Door|meta|rot4|open":{positions:[{block:"Pear Door|meta|rot4|open",x:0,y:0,z:0},{block:"_Pear Door Top|meta|rot4|open",x:0,y:1,z:0}]},"White Bed":{positions:[{block:"White Bed",x:0,y:0,z:0},{block:"_White Bed Head",x:0,y:0,z:-1}]},"White Bed|meta|rot2":{positions:[{block:"White Bed|meta|rot2",x:0,y:0,z:0},{block:"_White Bed Head|meta|rot2",x:-1,y:0,z:0}]},"White Bed|meta|rot3":{positions:[{block:"White Bed|meta|rot3",x:0,y:0,z:0},{block:"_White Bed Head|meta|rot3",x:0,y:0,z:1}]},"White Bed|meta|rot4":{positions:[{block:"White Bed|meta|rot4",x:0,y:0,z:0},{block:"_White Bed Head|meta|rot4",x:1,y:0,z:0}]},"Orange Bed":{positions:[{block:"Orange Bed",x:0,y:0,z:0},{block:"_Orange Bed Head",x:0,y:0,z:-1}]},"Orange Bed|meta|rot2":{positions:[{block:"Orange Bed|meta|rot2",x:0,y:0,z:0},{block:"_Orange Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Orange Bed|meta|rot3":{positions:[{block:"Orange Bed|meta|rot3",x:0,y:0,z:0},{block:"_Orange Bed Head|meta|rot3",x:0,y:0,z:1}]},"Orange Bed|meta|rot4":{positions:[{block:"Orange Bed|meta|rot4",x:0,y:0,z:0},{block:"_Orange Bed Head|meta|rot4",x:1,y:0,z:0}]},"Magenta Bed":{positions:[{block:"Magenta Bed",x:0,y:0,z:0},{block:"_Magenta Bed Head",x:0,y:0,z:-1}]},"Magenta Bed|meta|rot2":{positions:[{block:"Magenta Bed|meta|rot2",x:0,y:0,z:0},{block:"_Magenta Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Magenta Bed|meta|rot3":{positions:[{block:"Magenta Bed|meta|rot3",x:0,y:0,z:0},{block:"_Magenta Bed Head|meta|rot3",x:0,y:0,z:1}]},"Magenta Bed|meta|rot4":{positions:[{block:"Magenta Bed|meta|rot4",x:0,y:0,z:0},{block:"_Magenta Bed Head|meta|rot4",x:1,y:0,z:0}]},"Light Blue Bed":{positions:[{block:"Light Blue Bed",x:0,y:0,z:0},{block:"_Light Blue Bed Head",x:0,y:0,z:-1}]},"Light Blue Bed|meta|rot2":{positions:[{block:"Light Blue Bed|meta|rot2",x:0,y:0,z:0},{block:"_Light Blue Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Light Blue Bed|meta|rot3":{positions:[{block:"Light Blue Bed|meta|rot3",x:0,y:0,z:0},{block:"_Light Blue Bed Head|meta|rot3",x:0,y:0,z:1}]},"Light Blue Bed|meta|rot4":{positions:[{block:"Light Blue Bed|meta|rot4",x:0,y:0,z:0},{block:"_Light Blue Bed Head|meta|rot4",x:1,y:0,z:0}]},"Yellow Bed":{positions:[{block:"Yellow Bed",x:0,y:0,z:0},{block:"_Yellow Bed Head",x:0,y:0,z:-1}]},"Yellow Bed|meta|rot2":{positions:[{block:"Yellow Bed|meta|rot2",x:0,y:0,z:0},{block:"_Yellow Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Yellow Bed|meta|rot3":{positions:[{block:"Yellow Bed|meta|rot3",x:0,y:0,z:0},{block:"_Yellow Bed Head|meta|rot3",x:0,y:0,z:1}]},"Yellow Bed|meta|rot4":{positions:[{block:"Yellow Bed|meta|rot4",x:0,y:0,z:0},{block:"_Yellow Bed Head|meta|rot4",x:1,y:0,z:0}]},"Lime Bed":{positions:[{block:"Lime Bed",x:0,y:0,z:0},{block:"_Lime Bed Head",x:0,y:0,z:-1}]},"Lime Bed|meta|rot2":{positions:[{block:"Lime Bed|meta|rot2",x:0,y:0,z:0},{block:"_Lime Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Lime Bed|meta|rot3":{positions:[{block:"Lime Bed|meta|rot3",x:0,y:0,z:0},{block:"_Lime Bed Head|meta|rot3",x:0,y:0,z:1}]},"Lime Bed|meta|rot4":{positions:[{block:"Lime Bed|meta|rot4",x:0,y:0,z:0},{block:"_Lime Bed Head|meta|rot4",x:1,y:0,z:0}]},"Pink Bed":{positions:[{block:"Pink Bed",x:0,y:0,z:0},{block:"_Pink Bed Head",x:0,y:0,z:-1}]},"Pink Bed|meta|rot2":{positions:[{block:"Pink Bed|meta|rot2",x:0,y:0,z:0},{block:"_Pink Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Pink Bed|meta|rot3":{positions:[{block:"Pink Bed|meta|rot3",x:0,y:0,z:0},{block:"_Pink Bed Head|meta|rot3",x:0,y:0,z:1}]},"Pink Bed|meta|rot4":{positions:[{block:"Pink Bed|meta|rot4",x:0,y:0,z:0},{block:"_Pink Bed Head|meta|rot4",x:1,y:0,z:0}]},"Gray Bed":{positions:[{block:"Gray Bed",x:0,y:0,z:0},{block:"_Gray Bed Head",x:0,y:0,z:-1}]},"Gray Bed|meta|rot2":{positions:[{block:"Gray Bed|meta|rot2",x:0,y:0,z:0},{block:"_Gray Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Gray Bed|meta|rot3":{positions:[{block:"Gray Bed|meta|rot3",x:0,y:0,z:0},{block:"_Gray Bed Head|meta|rot3",x:0,y:0,z:1}]},"Gray Bed|meta|rot4":{positions:[{block:"Gray Bed|meta|rot4",x:0,y:0,z:0},{block:"_Gray Bed Head|meta|rot4",x:1,y:0,z:0}]},"Light Gray Bed":{positions:[{block:"Light Gray Bed",x:0,y:0,z:0},{block:"_Light Gray Bed Head",x:0,y:0,z:-1}]},"Light Gray Bed|meta|rot2":{positions:[{block:"Light Gray Bed|meta|rot2",x:0,y:0,z:0},{block:"_Light Gray Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Light Gray Bed|meta|rot3":{positions:[{block:"Light Gray Bed|meta|rot3",x:0,y:0,z:0},{block:"_Light Gray Bed Head|meta|rot3",x:0,y:0,z:1}]},"Light Gray Bed|meta|rot4":{positions:[{block:"Light Gray Bed|meta|rot4",x:0,y:0,z:0},{block:"_Light Gray Bed Head|meta|rot4",x:1,y:0,z:0}]},"Cyan Bed":{positions:[{block:"Cyan Bed",x:0,y:0,z:0},{block:"_Cyan Bed Head",x:0,y:0,z:-1}]},"Cyan Bed|meta|rot2":{positions:[{block:"Cyan Bed|meta|rot2",x:0,y:0,z:0},{block:"_Cyan Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Cyan Bed|meta|rot3":{positions:[{block:"Cyan Bed|meta|rot3",x:0,y:0,z:0},{block:"_Cyan Bed Head|meta|rot3",x:0,y:0,z:1}]},"Cyan Bed|meta|rot4":{positions:[{block:"Cyan Bed|meta|rot4",x:0,y:0,z:0},{block:"_Cyan Bed Head|meta|rot4",x:1,y:0,z:0}]},"Purple Bed":{positions:[{block:"Purple Bed",x:0,y:0,z:0},{block:"_Purple Bed Head",x:0,y:0,z:-1}]},"Purple Bed|meta|rot2":{positions:[{block:"Purple Bed|meta|rot2",x:0,y:0,z:0},{block:"_Purple Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Purple Bed|meta|rot3":{positions:[{block:"Purple Bed|meta|rot3",x:0,y:0,z:0},{block:"_Purple Bed Head|meta|rot3",x:0,y:0,z:1}]},"Purple Bed|meta|rot4":{positions:[{block:"Purple Bed|meta|rot4",x:0,y:0,z:0},{block:"_Purple Bed Head|meta|rot4",x:1,y:0,z:0}]},"Blue Bed":{positions:[{block:"Blue Bed",x:0,y:0,z:0},{block:"_Blue Bed Head",x:0,y:0,z:-1}]},"Blue Bed|meta|rot2":{positions:[{block:"Blue Bed|meta|rot2",x:0,y:0,z:0},{block:"_Blue Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Blue Bed|meta|rot3":{positions:[{block:"Blue Bed|meta|rot3",x:0,y:0,z:0},{block:"_Blue Bed Head|meta|rot3",x:0,y:0,z:1}]},"Blue Bed|meta|rot4":{positions:[{block:"Blue Bed|meta|rot4",x:0,y:0,z:0},{block:"_Blue Bed Head|meta|rot4",x:1,y:0,z:0}]},"Brown Bed":{positions:[{block:"Brown Bed",x:0,y:0,z:0},{block:"_Brown Bed Head",x:0,y:0,z:-1}]},"Brown Bed|meta|rot2":{positions:[{block:"Brown Bed|meta|rot2",x:0,y:0,z:0},{block:"_Brown Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Brown Bed|meta|rot3":{positions:[{block:"Brown Bed|meta|rot3",x:0,y:0,z:0},{block:"_Brown Bed Head|meta|rot3",x:0,y:0,z:1}]},"Brown Bed|meta|rot4":{positions:[{block:"Brown Bed|meta|rot4",x:0,y:0,z:0},{block:"_Brown Bed Head|meta|rot4",x:1,y:0,z:0}]},"Green Bed":{positions:[{block:"Green Bed",x:0,y:0,z:0},{block:"_Green Bed Head",x:0,y:0,z:-1}]},"Green Bed|meta|rot2":{positions:[{block:"Green Bed|meta|rot2",x:0,y:0,z:0},{block:"_Green Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Green Bed|meta|rot3":{positions:[{block:"Green Bed|meta|rot3",x:0,y:0,z:0},{block:"_Green Bed Head|meta|rot3",x:0,y:0,z:1}]},"Green Bed|meta|rot4":{positions:[{block:"Green Bed|meta|rot4",x:0,y:0,z:0},{block:"_Green Bed Head|meta|rot4",x:1,y:0,z:0}]},"Red Bed":{positions:[{block:"Red Bed",x:0,y:0,z:0},{block:"_Red Bed Head",x:0,y:0,z:-1}]},"Red Bed|meta|rot2":{positions:[{block:"Red Bed|meta|rot2",x:0,y:0,z:0},{block:"_Red Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Red Bed|meta|rot3":{positions:[{block:"Red Bed|meta|rot3",x:0,y:0,z:0},{block:"_Red Bed Head|meta|rot3",x:0,y:0,z:1}]},"Red Bed|meta|rot4":{positions:[{block:"Red Bed|meta|rot4",x:0,y:0,z:0},{block:"_Red Bed Head|meta|rot4",x:1,y:0,z:0}]},"Black Bed":{positions:[{block:"Black Bed",x:0,y:0,z:0},{block:"_Black Bed Head",x:0,y:0,z:-1}]},"Black Bed|meta|rot2":{positions:[{block:"Black Bed|meta|rot2",x:0,y:0,z:0},{block:"_Black Bed Head|meta|rot2",x:-1,y:0,z:0}]},"Black Bed|meta|rot3":{positions:[{block:"Black Bed|meta|rot3",x:0,y:0,z:0},{block:"_Black Bed Head|meta|rot3",x:0,y:0,z:1}]},"Black Bed|meta|rot4":{positions:[{block:"Black Bed|meta|rot4",x:0,y:0,z:0},{block:"_Black Bed Head|meta|rot4",x:1,y:0,z:0}]}};for(var s in o)o[i.blockMetadata[s].id]=o[s];var a={};for(var l in o){var u,c=(0,n.Z)(o[l].positions);try{for(c.s();!(u=c.n()).done;){var h=u.value,d=h.block,f={mainMultiblock:l,compX:h.x,compY:h.y,compZ:h.z};a[d]=f,a[i.blockMetadata[d].id]=f}}catch(p){c.e(p)}finally{c.f()}}},62043:function(e,t,r){"use strict";r.d(t,{EH:function(){return i.EH},NQ:function(){return i.NQ},Np:function(){return n.N}});var n=r(85630),i=(r(30877),r(82936),r(56434))},90574:function(e,t,r){"use strict";r.d(t,{IE:function(){return u},So:function(){return A},Wc:function(){return f},kQ:function(){return d},vG:function(){return l}});var n=r(93433),i=r(29439),o=r(37762),s=r(52126),a=r(38017);function l(e,t){var r,n=p(e,t),i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){if(S(e,r.value))return!0}}catch(s){i.e(s)}finally{i.f()}return!1}function u(e,t){var r,n=m(e,t),s=(0,o.Z)(n);try{for(s.s();!(r=s.n()).done;){var a=(0,i.Z)(r.value,3),l=a[0],u=a[1],c=a[2];if(!e.hasChunkWithBlockCoordinates(l,u,c))return!0}}catch(h){s.e(h)}finally{s.f()}return!1}var c=[a.blockMetadata.Ladder.id,a.blockMetadata.Vines.id,a.blockMetadata["Iron Ladder"].id].concat((0,n.Z)(h("Maple Trapdoor")),(0,n.Z)(h("Pine Trapdoor")),(0,n.Z)(h("Plum Trapdoor")),(0,n.Z)(h("Cedar Trapdoor")),(0,n.Z)(h("Aspen Trapdoor")),(0,n.Z)(h("Elm Trapdoor")),(0,n.Z)(h("Palm Trapdoor")),(0,n.Z)(h("Pear Trapdoor")));function h(e){return[a.blockMetadata["".concat(e,"|meta|rot1|open")].id,a.blockMetadata["".concat(e,"|meta|rot2|open")].id,a.blockMetadata["".concat(e,"|meta|rot3|open")].id,a.blockMetadata["".concat(e,"|meta|rot4|open")].id]}function d(e,t,r){var n,i=m(e,r,.2),l=e.noa.ents.getPosition(t),u={onLadder:!1,goingUpLadderOnAxis:[null,null,null]},h=(0,o.Z)(i);try{for(h.s();!(n=h.n()).done;){var d=n.value,f=e.getBlock(d[0],d[1],d[2]),p=(0,a.blockIdToName)(f),g=e.getMetaInfo(p);if(c.includes(f)||c.includes(g.rootId)){var v=void 0,y=void 0,_=void 0,b=void 0;1===g.rot||3===g.rot?(v=2,b=d[_=0]+.5,y=1===g.rot?d[v]:d[v]+1):(v=0,b=d[_=2]+.5,y=2===g.rot?d[v]:d[v]+1),Math.abs(l[v]-y)<s.ZP.playerWidth/2+.2&&Math.abs(l[_]-b)-.499<s.ZP.playerWidth/2&&(u.onLadder=!0,0!==r.resting[v]&&(u.goingUpLadderOnAxis[v]=g.rootName))}}}catch(S){h.e(S)}finally{h.f()}return u}function f(e,t,r){return p(e.noa,t).map((function(t){return e.getBlock(t[0],t[1],t[2])})).includes(r)}function p(e,t){return b(e,t._extents)}function m(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;console.assert(n<.1,"heightIncrease must be less than 0.1 or else assumptions made in getUnitCoordinatesPlayerExtentsWithin are broken");var i=t.aabb.base,o=t.aabb.max,s=[i[0]-r,i[1]-n,i[2]-r,o[0]+r,o[1]+n,o[2]+r];return b(e.noa,s)}var g=[null,null,null,null].map((function(){return[0,0,0]})),v=[null,null,null,null].map((function(){return[0,0,0]})),y=[null,null,null,null].map((function(){return[0,0,0]}));var _=[];function b(e,t){for(var r=e.worldOriginOffset,n=0,o=C(t),s=0;s<o.length;s++){var a=(0,i.Z)(o[s],2),l=a[0],u=a[1],c=g[s],h=v[s],d=y[s];c[0]=Math.floor(l+r[0]),c[1]=Math.floor(t[1]+r[1]),c[2]=Math.floor(u+r[2]),h[0]=Math.floor(l+r[0]),h[1]=Math.floor(t[1]+(t[4]-t[1])/2+r[1]),h[2]=Math.floor(u+r[2]),d[0]=Math.floor(l+r[0]),d[1]=Math.floor(t[4]+r[1]),d[2]=Math.floor(u+r[2]),_[n++]=c,_[n++]=d,h[1]!==c[1]&&h[1]!==d[1]&&(_[n++]=h)}return _.length=n,_}function S(e,t){var r,n=e.getBlock(t);return!(null===(r=a.blockMetadata[n])||void 0===r||!r.fluid)}function A(e,t){var r,n=function(e,t){var r=e.ents.getPositionData(t);if(!Number.isInteger(r.position[1]))return[];var n,s=r._extents,a=e.worldOriginOffset,l=[],u=(0,o.Z)(C(s));try{for(u.s();!(n=u.n()).done;){var c=(0,i.Z)(n.value,2),h=c[0],d=c[1],f=[Math.floor(h+a[0]),r.position[1]-1,Math.floor(d+a[2])];0!==e.getBlock(f)&&l.push(f)}}catch(A){u.e(A)}finally{u.f()}for(var p=[],m=0,g=l;m<g.length;m++){var v,y=g[m],_=!0,b=(0,o.Z)(p);try{for(b.s();!(v=b.n()).done;){var S=v.value;y[0]===S[0]&&y[2]===S[2]&&(_=!1)}}catch(A){b.e(A)}finally{b.f()}_&&p.push(y)}return p}(e,t),s=[],a=(0,o.Z)(n);try{for(a.s();!(r=a.n()).done;){var l=r.value;s.push(e.getBlock(l))}}catch(u){a.e(u)}finally{a.f()}return s}var x=[[0,0],[0,0],[0,0],[0,0]];function C(e){return x[0][0]=e[3],x[0][1]=e[2],x[1][0]=e[0],x[1][1]=e[2],x[2][0]=e[3],x[2][1]=e[5],x[3][0]=e[0],x[3][1]=e[5],x}},77796:function(e,t,r){"use strict";r.d(t,{i:function(){return n}});var n=143},71173:function(e,t,r){var n={"./autoRemoveMesh.js":42845,"./autoRotate.js":17309,"./bullet.js":48912,"./collideEntitiesProjectile.ts":39269,"./crouchingHandler.ts":36764,"./doOnFirstTick.ts":95933,"./flashingMeshOverlay.js":32052,"./genericAliveEntity.ts":40060,"./genericPlayerState.js":62590,"./heldItem.ts":84906,"./hidingMeshManager.ts":94899,"./hitbox.ts":68564,"./inLoadedChunk.ts":36217,"./inventory.ts":44815,"./itemState.js":17870,"./meshRotation.ts":21262,"./moveState.ts":92199,"./movement.ts":13813,"./playerCameraAdjustment.js":26885,"./playerHowlerListenerUpdate.ts":77666,"./playerMesh.ts":64716,"./playerName.ts":53477,"./receivesInputs.ts":30258,"./smoothToServerPos.ts":81239,"./stepSoundOnWalk.ts":41074,"./templateComponent.ts":48544,"./updateServerOfMovement.ts":51012};function i(e){var t=o(e);return r(t)}function o(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=o,e.exports=i,i.id=71173},26927:function(e,t,r){var n={"./destroy_stage_0.png":2966,"./destroy_stage_1.png":7799,"./destroy_stage_2.png":49794,"./destroy_stage_3.png":63328,"./destroy_stage_4.png":52897,"./destroy_stage_5.png":31593,"./destroy_stage_6.png":5789,"./destroy_stage_7.png":6666,"./destroy_stage_8.png":22192,"./destroy_stage_9.png":30503};function i(e){var t=o(e);return r(t)}function o(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=o,e.exports=i,i.id=26927},86940:function(e,t,r){var n={"./bob_body_preview.png":27667,"./bob_head_preview.png":51681,"./bob_legs_preview.png":31795,"./componentAtlas.png":95359,"./emma_body_preview.png":72319,"./emma_head_preview.png":85908,"./emma_legs_preview.png":33430,"./green_top_with_rolled_up_sleeves_preview.png":7932,"./isabel_head_preview.png":47712,"./khakis_body_preview.png":13063,"./khakis_legs_preview.png":85874,"./leo_head_preview.png":52118,"./light_blue_crop_top_preview.png":77237,"./light_blue_polo_preview.png":918,"./navy_blue_denim_shorts_preview.png":28880,"./navy_blue_jeans_preview.png":46633,"./sanjay_head_preview.png":72173,"./sara_head_preview.png":51899,"./tan_shorts_preview.png":61212};function i(e){var t=o(e);return r(t)}function o(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=o,e.exports=i,i.id=86940},4841:function(e,t,r){var n={"./critical_hit.png":9567,"./generic_2.png":80521};function i(e){var t=o(e);return r(t)}function o(e){if(!r.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}i.keys=function(){return Object.keys(n)},i.resolve=o,e.exports=i,i.id=4841},88996:function(e,t,r){"use strict";e.exports=r.p+"static/media/JetBrainsMono-VariableFont.d08f929cab66fc19b568.ttf"},74304:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAAgCAYAAABkS8DlAAAABmJLR0QA/wD/AP+gvaeTAAAHTklEQVR4nO2dMW/bOhDHzw8evLiAOwZIgACJEHfs4jEJkKJB0ClBOvQD+EPpA3SI4U6B0aIB0oxeMtaBU6BAC2SsgXrxpje80E86iaQokSYp3m+jRFEneziS979jCyTEcZyI7g+Hw5ZsDMJfxtcT4f9/8e6M/v8Gs7zaE/7/3fc/6P9vMPujO+H//3h5SP+/x7TLdIqiKNPu9XoAADCdTvVbRDhHv3+Qae/ubAMAwOTLVxvmEBumc9zNXng5AgCA1fjUgjXEptk66WTaH1+8AgCAo0/3NswhNPJPlYcWi4VuOwiP+Pnrt20TCJv8ubRtAWGRD3+/2zaB0ESlCQAATQJChyYBgUOTgKChSUAzqDwBIAiCIAjCX0pNAFjMnwgTFvMnAuU55k+ECYv5E82j9A4ATQLChiYBgUOTgKChSUAzKZUFQGr/sCG1f9iQ2j9sSO3fXFqyPH/TUB0Bu8jy/E1DdQTsIsvzNw3VEbCLLM/fNFRHwC5tAHme/2AwAIC88n8+n4OO5wm7yPL8z96+AYC88n82e9DyPGEXWZ5/5+Lzf9eR8n91u9TyPGEXWZ7/t/PXAJBX/j/drLQ8T9ijUAOAHfV0Os2EAebzudB5F6UIUtqgP2BHPfnyNRMGmM0ehM67KEWQ0gY9Ajvq8WkmDLC6XYqdd1GKIKUNegN21Eef7jNhgKebldB5F6UIUtqgm3A1AGmHzbbpWbgAt2XPk/P3j7TDZtv0LFyA27Lnyfl7SMphs216Fi7Abdnz5Pz9I+2w19v0z+EC1haFD9LPk/N3lzaAeCteFKMfDoetOI4T2sr3G9FqXhSjv3h31hpfTxLayvcb0WpeFKPvvv/RWl7tJbSV7zei1bwoRv94edjaH90ltJXvL8YFGGyXAOsE2KSBRIDNhu0SYJ0AmzSQCLDZsF0CrBNgkwYSATYbtkuAdQJs0kAiQLts7MfH4QJy/GGBwwXk+MMChwvI8YcFDheQ4ycIgiAIgrCEdBbm2spdVregrn2ufa9tXFu5y+oW1LXPte+1jWsrd1ndgrr2ufa9tnFt5S6rW1DXPte+1zSlSgFHUZSL4dtkMBhk7NFtn2vfa5t+/yAXw7fJ2ds3GXt02+fa99qmc9zN5/pbpHPxOWOPbvtc+17bbJ10cjF8m3w7f52xR7d9rn2vSbw9DZDOJggbOpsgcOhsgqChswn0UOosANfS/PDZBLrtc+17beNamh8+m0C3fa59r21cS/PDZxPots+177WNa2l++GwC3fa59r0mqR3f4MXkcexcNXav64wCWQy/7ntII1Ack8exc9XYva4zCmQx/LrvIY1AcUwex85VY/e6ziiQxfDrvoc0AsUxeRw7V43d6zqjQBbDr/se3zUCpXYAZLBa/2xlHkURxHGcpCsGRlG0Xlnz+qfHFPVXbavar3v8psNq/bOVeb9/AOPrSZKuGNjvH6xX1rz+6TFF/VXbqvbrHr/psFr/69r/x11YXu0l6YqBnePu/2cHcPpnxhT1V2wr2695/KbDav2zlfnWSQdgdJekKwZunXTWK2te//SYov6qbVX7dY/vMlomAADZcr+9Xg8GgwG3CNBiscjF8NN98D3cHzteWbuM7UXvLHufyJb73d3Zht2dbW4RoJ+/fudi+CLRXVF/XGpYdL+M7SbHD4J0ud+XI+hcACyvTguLAMGfy1wMXyi6K+ifKzUsui/D9PgBkC73+/HFK4BzgCNOEaAPf7/nYvjpPuvDhOC+sD92vLJ2GduxPbiUsei+z2iZAPCcoUhJr+pAcX/dW/uyswvobAM+PGcoc+pV3yE7bKiKczY9fqPhOEOpU6/6DtlhQ1Wcs+nxGwzPGYqU9KoOFPfXvbUvO7ugqWcbaNsBSFPXQdKxwX6j20FiUZ5qm9gwmh0kFuWptonNUtdB0rHBm8PIBEAnVUV2oYvzmkLoIrvQCV1kFzpVRXa+i/M2RVuX2p7wE11qe8JPdKntCT/RpbYn/KQN4LYK3vU0PdMTqE3sZLisgnc9Tc/0BGoTOyAuq+BdT9MzPYHaxA6Iyyp419P0TE+gTNvfBqivgleN0av2Nz1BwfaotpnYkV3niR/x/bL9TVNXBa8ac1ftb3qCUldjwMSO7DpP/Ijvl+1vnJoqeNWYu2p/0xOUuhoDJnZcpy1yxI/4ftn+pqmrgleN0av2Nz1BwfaotpnYkV3niR/x/bL9TbLWAFRVwRetUFnef5r5fM5dzYqKCcVxnJhM09N9eJCvVFXBF61QWd5/mtnsgbuaFRUTGl9PEpNperoPD/KWiir4ohUqy/tPs7pdclezomJCy6u9xGSanu7Dg3ylqgq+cIX6nPef5ulmxV/NCooJ7Y/uEpNperoPD/INIyJA5rjxNVF/2ZiUpucPzHHja6L+sjEpTc8f1o4bXRP1lw5KaXre8Hh52MJOXeRoyzjhUNP0TJNz1Kq4HmN33T4Zpu1veozddftkmLa/6TF21+2TYdr+psfYXbdPhmn7/wVy6N2HB1UGFwAAAABJRU5ErkJggg=="},27667:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAAABmJLR0QA/wD/AP+gvaeTAAAAeUlEQVQokWN8EOHxnwELePLlK4MMDzcDAwMDw/2PnxkU+XmxKWNgwipKAhjEBixl+ANnr2L+h9MARlyBSLELiAUs2ATvf/yMVTG2qKTcBU++fEURgCUeXABdPSO6gkwfS3igRvWtZGBgYGBYVhQOl5++5TiKHoq9AADxcB4x4rtOogAAAABJRU5ErkJggg=="},51681:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAABmJLR0QA/wD/AP+gvaeTAAAAZklEQVQYlWN00Zf9z4AHMOGTJEoBCwMDA0OVryNWybbN+xmYqnwdGazq5zIsvJ4Dl1h4PYfBqn4uQ5WvIwOTnKIEAwMDA8Pxy3EMcooSDHKKEgzHL8cxMDAwMMgpSjAw3plbRpkvAJ12FV7SojEeAAAAAElFTkSuQmCC"},31795:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMCAYAAACwXJejAAAABmJLR0QA/wD/AP+gvaeTAAAANElEQVQYlWNMO3PmPwMSmGViwoguxsRABBhVxMDy8fFjDEF0MUYLS2uU0D1x/CiGGFHWAQA/jBIvEGia0gAAAABJRU5ErkJggg=="},95359:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAACAAAAABACAYAAACOEJc7AAAABmJLR0QA/wD/AP+gvaeTAAAMiUlEQVR4nO3df2yU530A8Of4oaLWHjISlUhL5EYrWTcxJGzJAlVFdFeJUEBU3TTDH6BJgYg1XcdQV4IyoaioS6tkWVEFaqF/gDrwuk5BjDqoOTXK0gZcnZGcikBpljp1BBpIIASR0gbv9gez5zP3w/Z75+fuvc9HinK+5+59v1+/73s+8f0+z5sJFWRXLC1UGg8hhNzQSKbaa5rZ66eerfg7WL15b6rz37RsbsX8T18ZTXX+1a6BtJ//Pd0rKuY/kB9Kdf7ZnpWVj//AhVTnDwAAAAAAQHOZEzsAAAAAAAAAACA5DQAAAAAAAAAAkAIaAAAAAAAAAAAgBTQAAAAAAAAAAEAKaAAAAAAAAAAAgBTQAAAAAAAAAAAAKaABAAAAAAAAAABSIJNdsbQQM4Dc0Egm5v5fP/Vs1PxXb94bNf9Ny+ZGzf/0ldGo+bf6+d/TvSJq/gP5objHv2dl3OM/cCFq/gAAAAAAAKSLFQAAAAAAAAAAIAU0AEzT4rb2sLitPXYYRLJv49qwb+Pa2GEQyZrlS8Ka5UtihwEAAAAAAAAlzZvKi8oVPL/xH6/UNJhGN7Hwv7itPdy4eydiNHEcPHQghBDC3/z105EjmX0Tr4N9G9e2zPnf2zUv9A3eC71dxR8XfYP3IkUUx8TC/5rlS8Krv7wWMRoAAAAAAAB4UNUVAPZtXBtW7/9+OHbpyfHnjl16Mqze//1Uz4QeK/YvbmsPKz+/J/z9xdz42F8NvBiWrtkZVm/em2mV1QA6lp8bL/7vP/xn4YcX3x//Oa3GZvufyb8dPvaH/z7+/MTzP83XQAj3i/+7vnM+fPGRPxh/7oNbHw67vnP+gYaAtDrzs4HQ9uG54z8P/tf18NXDpyJGBAAAAAAAAKVlsiuWFiY/uW/j2vDZA8czYz+//8EHhT/9k+XhypXLmRBCWLbsjwpvXPxlWDB//vhrfvr0tsJMZkTnhkYy1V9VP6+fevaB/Be3tYdPZr80rfxLbWcqVm/eGzX/Tcvmlo374KEDoTP7VGYq+Q/n/rEwk1UBTl8ZjZp/qfM/hOLzcir5l9tONbHP/57uFQ/E3ds1L+z+7uC08n/hia7CTFYEGMgPxT3+PSurHrczPxsIpfLf8OmexPvPDVyImj8AAAAAAADpUrQCwL6Na0NuaCQzsfgfQggL5s/PjBW/QgjhypXLmYnFvxBC+OyB45nc0EgmDTOiJxb/Q5ha/mlYCeDgoQPh9JXRzNh/ndmnMiFMLf/O7FOZ01dGM2lYFWDyOTyV/NNw3vd2zQsD+aHMxOJ/CFPLf/d3BzMD+aFMGlcFmEr+AAAAAAAA0AjmTZztnxs6nniDE5sHfvr0tkIIoey90u83HCTfZy3NtJB/4+6dGkcyO8Zm+YcQwunsU4m3N7atEO6vChBCCOVWBjh46EBN9llrM1nJYibvaQQTZ/sP5JNvb2LzwAtPdBVCCKHcygD3Gw6S7xMAAAAAAAC4zyzWGqt0K4DYy/1Tf9VuBRB7yX/qq9otBdK+5P9w77pCZ9/ZkjkO964rfPPu7YrvP3zmXMXfz3DvuqLfb7l9xXJkS39hx8n1JWM6sqW/cOHO1yu+v1r+R7b0F+Vfbl+xHMvfLGzvXlQypmP5m4WDT3yu4vsHBwcr5nMsf7Mo/3L7iuWh3NGK1//o7cqNgv/9xd0V85m8/avZxxsq/xN9+wtbe58pGdOJvv2F137wk4rvr3b+n+jbX5R/uX3F8uq131U8/muWfKih4p1sZz5fFP8bX/5K0fj5cz9v6PiT2rVhVVH+r7x1q2j88uXLqc6/+7FtRfkXrl8sGq/2+dzsBvufL8r/6KEfFY1X+3xqdpM/Xw9+O1c0nvbr/9Ge4u+X58+eLBrv6OhIdf4AAACkU/rW6wYAiKBcUb5acwDpUK7IX605AAAAAACgljQA1MnitvbwyeyXzBZoUZNn+ldbGWAmsiuWFqwo0LjGZvtXWxUAAAAAAAAAamVO7ADS6sbdykv9km4TC/71KP4DAAAAAAAATGb2cEKvn3q2bHF39ea9U/79ltvOdLbB7KtU3B+bnZ+kAaDSDH8rAMRXaXZ/LVYAGNtGoxruXVcyt3fvvhc+3vaREEIIv7l9J3xiYfusxjWms+9sXX9/R7b0P5D/jpPrS+6z1GvrrVwstXIsf7Ohm5u2dy+qa/6llvVvpFsAlIulVibfM7rRbO19pq75l1rWv5a3ACi3rVrZmc8nOn7f6+5u6L9P1ezasCpR/s1+T/jux7Ylyj//0vGmzn+w//lE+Xet39PU+Sf9/K7352u9PdpT+vvrVP1qoL7fLwEAAKAW3AIgobEC/eQC/uK26RW8ym2HxpYbGsmUKvBPLMxXeo3VAZpbbuBCZqYF/kYv7jMzR7b0FyYX3mMU/4njodzRwuTCe4ziP3G8eu13hcmF+5kU/wEAAAAAktAAUCOTC/gzvQWAGf/Np9RM/0qz8yc3B9Q/QuppujP9Ff7TT8H/vt8Ovz3++OHORyJGMrsU/O+79Obw+ONP/XFntDhmm4I/AAAAABCbBoAaW715b8Ys/tY0cUb/5ML+2FgtC/6aBxrXxCJ/klUCoNk93PlIUSMAUzd6e2aNhGmRfXhh7BAASKH2RR+NHQIAAADUnQaAOtAE0NqmMvOf9JlKob9VZv//S7gXvvZ/j38493/GHzM9k28l0IwU/2funU1PJnr/grC7RpHMTCvN+geaS9f6PU3/95WZy7903PEHAAAg9TQA1Iml/FuTIj+E8LW2hSUf01qSLvt//d3yzQPv30u0aQAAAAAASC0NAABAw/nq5u6WbqhaMH9+S+cPAAAAAMDMaAAAoGZ+U+a+5Z9Y2D7LkQAAAAAAALQeDQAANZIbuJDJ9qwslBub7XgAqI81Sz7kM72J/eLa72OHAAAAAAB1owEAgIb07t33YocARHLp11djh5Bqt0dGYodARHduXo8dQlS7Nqwq2aw5VYfPnGvqBqBLbw7HDiGqW7duJTr+HR0dTX38AQAAaA0aAABqqNRM/7TO/v/m3dsPPjn3/v+2/tO/hhBCOPF3f3n/iVKvraLR/4H9wp2vlx174cX/DCGEsPsLn5mtcGbdwSc+V3bsn0++GEII4W+3fGG2wpl1o2Vud9EqXvvBT8qOfePffhxCCGHfX3x+xttv9Ou/UgGxFtd/vfN/51vP1XPzNLi2ezdih0BEL7/8VuwQAAAAgDqbEzsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgfjKxAwCAEEIY7l1XmPhzZ9/ZlvobdWRLf1H+O06ub6n8j+VvFuW/vXtRS+X/UO5oUf5Xs4+3VP4n+vYX5b+195mWyr/Z7czni47fG1/+StH4+XM/T/Xx3LVhVVH+r7x1q2j88uXLqc6/+7FtRfkXrl8sGh8cHEx1/oP9zxflf/TQj4rGD585l+r8J39+H/x2rmg87df/oz3F31/Pnz1ZNN7R0ZHq/AEAAGhMc2IHAAAAAAAAAAAkpwEAGkh2xdJC9VcBAAAAAAAAPEgDAAAAAAAAAACkgPvRQQPJrlhayA2NuC5pCcO96xKteNHZd7apr5UjW/oT5b/j5Pqmzv9Y/mai/Ld3L2rq/B/KHU2U/9Xs402d/+R7Rk/X1t5nmjr/Zrczn090/L7X3d3Ux2/XhlWJ8m/2e8J3P7YtUf75l443df6D/c8nyr9r/Z6mzr/VP78f7Un2/fVXA839/RUAAIDmYAUAAAAAAAAAAEgBDQAAAAAAAAAAkALzYgcA/D/L/wO0htHbd2KHEFX24YWxQwCAaWtf9NHYIQAAAEBVGgAAIIIdJ9dr+Glh72x6MtH7F4TdNYoEgOnoWr/H3+8Wln/puOMPAABAw9MAAADMut8Ovx07BAAAAAAASB0NAADArPuHP+9u6Rl0C+bPb+n8AQAAAACojzmxAwAAAAAAAAAAkrMCAAAAwBT94trvY4cAAAAAAGVpAAAginfvvhc7BCCSS7++GjsEErg9MhI7BCK6c/N67BCi2rVhVSHJ+w+fOdfUt4C59OZw7BCiunXrVqLj39HR0dTHHwAAgOagAQCAKD595jX/AAotas3251z/Teydbz0XOwQiart3I3YIRPTyy2/FDgEAAACoYk7sAAAAAAAAAACA5P4XQpzs9noAFO8AAAAASUVORK5CYII="},72319:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAAABmJLR0QA/wD/AP+gvaeTAAAAU0lEQVQokWOcHbntPwMaSF3uxYguxsDAwIBNLROxCrGJMTAwMDDikiAWYHUBKQDDr4RchB4+FLtg1AAGBhZ0gXOfm+Hs/vWHGBgYGBgKA+1o5wIAhRMYAC54iVwAAAAASUVORK5CYII="},85908:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAABmJLR0QA/wD/AP+gvaeTAAAAXklEQVQYlWM8tqHjPwMewIRPEqsCUR5eBlEeXuwKkCVgbCZRHl4GI+9ihrKre+CSiSfXM8japzFoamgyMInIyDAwMDAwvFr4hEFERoZBREaG4dXCJ3DFjO9vbKTMFwAY2xM3oMZViQAAAABJRU5ErkJggg=="},33430:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMCAYAAACwXJejAAAABmJLR0QA/wD/AP+gvaeTAAAAKElEQVQYlWPM9LH8z4AEpm85zoguxsRABBjeilhOPf+FIYguRmc3AQDdaAtdkGFLoQAAAABJRU5ErkJggg=="},7932:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAAABmJLR0QA/wD/AP+gvaeTAAAAZ0lEQVQokWOU2jPnPwMaeOaSwoguxsDAwIBNLROxCrGJMTAwMDDikiAWsPz9+BlFgJmfF68GdPWMP37/RnGB0sGFeA24Zx+PwscaBqQAJg5WVkZkTEgDunrKXTDgBrCgC6BHE81dAADuvh4lpHA/yAAAAABJRU5ErkJggg=="},47712:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAABmJLR0QA/wD/AP+gvaeTAAAAZUlEQVQYlWN00Zf9z4AHMOGTxKqgyteRocrXEbsCZAkYm6nK15Fhy5l7DNIqa+GSC6/nMFjVz2Wo8nVkYJJTlGBgYGBgOH45jkFOUYJBTlGC4fjlOAYGBgYGOUUJBsY7c8so8wUAlMEWjDgPss0AAAAASUVORK5CYII="},13063:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAAABmJLR0QA/wD/AP+gvaeTAAAAaUlEQVQokWNctqL+PwMFgIkSzQwMDAwshBRcv/YAztbUUsA0wEWOH0Vgz6OPeA1EV0/QBdhsRQYUh8EwMIDl+u1nqCLs3Hg1oKtnRFeQ6WMJT5ltq7cyMDAwMFSFesPlp285jqKHYi8AAHNlFhGWFkdWAAAAAElFTkSuQmCC"},85874:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMCAYAAACwXJejAAAABmJLR0QA/wD/AP+gvaeTAAAAMElEQVQYlWNctqL+PwMSiIpoZEQXY2IgAowqYmC5fu0BhiC6GMvu3XcwFKGLEWUdAJ5zEKbopMRpAAAAAElFTkSuQmCC"},52118:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAABmJLR0QA/wD/AP+gvaeTAAAAZUlEQVQYlWP0U2P+z4AHMOGTJE/BpGktDJOmtcD5LDCGoO5xhsbMvQwMDAwM9dOdGVZdLWF4cbCHgeH/g43/f/z+/V9NTeP//wcb//9/sPG/mprG/x+/f////2Djf8b/DzZS5gsA3GIpletnM6oAAAAASUVORK5CYII="},77237:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAAABmJLR0QA/wD/AP+gvaeTAAAARklEQVQokWNgQAMHn//8jy6GT46JWIW4DGYhxTZsAKsLSAGjBgwGwIgukOljCY///vWHGBgYGBgKA+3g8tO3HEfRQ3EYAAAZ8hk0ZXMJlQAAAABJRU5ErkJggg=="},918:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAAABmJLR0QA/wD/AP+gvaeTAAAAYklEQVQokWNceObdfwYKABMlmhkYGBhYCCl49OAenC2noESeC7BpJMkAZFegA5ZXTxCSP/5g2obORzeMEd1EQrESbyKEoofiWBh4AzDSwaR0Vzh7wvL1DAwMDAwFkYG0cwEAOtYZtcKzKcgAAAAASUVORK5CYII="},28880:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMCAYAAACwXJejAAAABmJLR0QA/wD/AP+gvaeTAAAANUlEQVQYlWNUN/f4z4AEbp7cwYguxsRABCBKEQuvkBiGIDaxIQkY379/jxJwgoKCGGLUC0wACIMN6sJ3AA0AAAAASUVORK5CYII="},46633:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMCAYAAACwXJejAAAABmJLR0QA/wD/AP+gvaeTAAAAMElEQVQYlWM08Yz7z4AEzmxfxIguxsRABBhVxMDy+d0rDEF0MRaeP68xFKGLEWUdAACfD3JhNCu8AAAAAElFTkSuQmCC"},72173:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAABmJLR0QA/wD/AP+gvaeTAAAAb0lEQVQYlWM0N9H/z4AHMOGTJEoBCwMDA0OEMQvDirN/GCKMWVAkV5z9w8AUYczCkDnlBEOwEh9c4vd7LobMKScYIoxZGJjUFEQZGBgYGOZceM2gpiDKoKYgyjDnwmsGBgYGBjUFUQbGre0elPkCAOh7F2aOwoumAAAAAElFTkSuQmCC"},51899:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAABmJLR0QA/wD/AP+gvaeTAAAAXElEQVQYlWN0MTf6z4AHMOGTxKrAXleSwV5XErsCZAkYm4mBgYFhy5GTDDxczHDJs3dfMZRO34BqwrWnnxk4eQQYOHkEGK49/QxXzOhibvTfw1ITqwN3HL9O2BcAwlIUyxiVJ0IAAAAASUVORK5CYII="},61212:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAMCAYAAACwXJejAAAABmJLR0QA/wD/AP+gvaeTAAAALUlEQVQYlWM8u633PwMSMPYqZkQXY2IgAlBP0ZAFjJk+ligBN33LcQwx6oUTACiWDQn4dpdQAAAAAElFTkSuQmCC"},9567:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAAXNSR0IArs4c6QAAACVJREFUGJVj+P///38GKMDFhnPQaeLAfyggJEbYFJxuIMoX+AAAfZM/wcpTlRQAAAAASUVORK5CYII="},80521:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAABGdBTUEAALGOfPtRkwAAACxJREFUGJVjYKA6+P///39kPiMWCUYGBgYGRkZGBqzgPxTA+CxYjMehlVwAAAJKE/fy//W5AAAAAElFTkSuQmCC"},11442:function(e){"use strict";e.exports=JSON.parse('{"Dirt":[133,92,73],"Messy Dirt":[115,75,59],"Grass Block":[104,163,77],"Sand":[223,211,167],"Clay":[164,174,183],"Gravel":[125,125,127],"Snow":[230,235,235],"Maple Log":[128,94,57],"Pine Log":[66,43,23],"Plum Log":[92,84,76],"Cedar Log":[57,43,24],"Aspen Log":[187,184,159],"Elm Log":[97,77,23],"Maple Wood Planks":[170,137,82],"Aspen Wood Planks":[192,172,122],"Plum Wood Planks":[167,91,46],"Elm Wood Planks":[159,117,82],"Pine Wood Planks":[115,84,48],"Cedar Wood Planks":[75,48,23],"Barkless Maple Log":[167,134,80],"Barkless Aspen Log":[189,168,120],"Barkless Plum Log":[163,88,44],"Barkless Elm Log":[157,113,79],"Barkless Pine Log":[114,83,48],"Barkless Cedar Log":[73,46,22],"Books":[124,118,82],"Stone":[150,146,146],"Messy Stone":[133,129,129],"free_placeholder":[133,129,129],"Smooth Stone":[148,145,145],"Diorite":[210,206,201],"Smooth Diorite":[199,194,190],"Andesite":[130,134,139],"Smooth Andesite":[126,129,134],"Granite":[156,106,88],"Smooth Granite":[153,102,83],"Sandstone":[220,206,162],"Yellowstone":[234,234,168],"Coal Ore":[114,112,112],"Iron Ore":[159,151,144],"Gold Ore":[165,151,110],"Lapis Lazuli Ore":[115,118,134],"Emerald Ore":[117,159,128],"Diamond Ore":[118,160,150],"Block of Coal":[19,19,19],"Block of Iron":[235,232,227],"Block of Gold":[248,209,63],"Block of Lapis Lazuli":[48,111,186],"Block of Emerald":[45,216,105],"White Wool":[238,239,240],"Orange Wool":[245,122,24],"Magenta Wool":[194,69,181],"Light Blue Wool":[56,183,222],"Yellow Wool":[251,202,49],"Lime Wool":[121,191,26],"Pink Wool":[247,145,177],"Gray Wool":[66,72,76],"Light Gray Wool":[146,146,140],"Cyan Wool":[22,143,148],"Purple Wool":[126,41,175],"Blue Wool":[54,60,159],"Brown Wool":[117,74,41],"Green Wool":[88,112,29],"Red Wool":[165,39,34],"Black Wool":[23,24,29],"Baked Clay":[150,93,67],"White Baked Clay":[210,177,161],"Orange Baked Clay":[162,83,38],"Magenta Baked Clay":[149,87,108],"Light Blue Baked Clay":[112,108,138],"Yellow Baked Clay":[186,133,36],"Lime Baked Clay":[103,117,53],"Pink Baked Clay":[162,78,79],"Gray Baked Clay":[58,42,36],"Light Gray Baked Clay":[135,107,98],"Cyan Baked Clay":[85,90,90],"Purple Baked Clay":[118,70,86],"Blue Baked Clay":[73,59,91],"Brown Baked Clay":[77,50,35],"Green Baked Clay":[75,82,40],"Red Baked Clay":[142,61,47],"Black Baked Clay":[36,21,15],"Gray Concrete":[55,58,62],"Light Gray Concrete":[125,125,115],"Black Concrete":[9,11,16],"Blue Concrete":[45,47,144],"Brown Concrete":[97,60,32],"Cyan Concrete":[21,119,135],"Light Blue Concrete":[37,138,200],"Lime Concrete":[95,170,25],"Magenta Concrete":[169,48,159],"Orange Concrete":[225,97,0],"Pink Concrete":[214,101,143],"Purple Concrete":[101,32,157],"Red Concrete":[143,33,33],"White Concrete":[208,214,215],"Green Concrete":[73,91,36],"Yellow Concrete":[242,176,21],"Pine Leaves":[33,60,17],"Aspen Leaves":[49,92,29],"Maple Leaves":[49,92,29],"Elm Leaves":[40,135,11],"Pumpkin_placeholder":[198,134,45],"Watermelon":[126,156,30],"Glass":[200,232,230],"Black Glass":[30,30,30],"Blue Glass":[52,80,182],"Brown Glass":[107,80,53],"Cyan Glass":[78,131,157],"Gray Glass":[80,80,80],"Light Gray Glass":[80,80,80],"Green Glass":[105,130,52],"Light Blue Glass":[104,156,218],"Lime Glass":[130,207,25],"Magenta Glass":[181,77,218],"Orange Glass":[218,130,52],"Pink Glass":[243,130,167],"Purple Glass":[131,63,182],"Red Glass":[157,52,52],"Silver Glass":[156,156,156],"White Glass":[254,254,254],"Yellow Glass":[231,231,54],"Dim Lamp On":[126,85,45],"Dim Lamp Off":[75,39,11],"Invisible Solid":[0,0,0],"Bricks":[149,98,83],"Stone Bricks":[135,131,131],"Dark Red Brick":[68,34,39],"Dark Red Stone":[100,45,42],"Block of Quartz":[251,248,239],"Chiseled Block of Quartz":[241,235,223],"Engraved Stone":[125,121,121],"Mossy Stone Bricks":[128,129,117],"Cracked Stone Bricks":[132,128,128],"Smooth Sandstone":[230,222,177],"Engraved Sandstone":[221,207,163],"Ice":[139,208,253],"Obsidian":[28,17,44],"Hay Bale":[180,130,32],"Sponge":[185,174,55],"Beacon":[209,242,250],"Golden Decoration":[179,138,92],"Moonstone Explosive":[191,197,217],"Bedrock":[33,33,34],"Smooth Double Stone Slab":[148,145,145],"Cactus":[93,154,47],"Tall Grass":[122,173,71],"Dandelion":[195,196,60],"Poppy":[135,93,37],"Red Tulip":[118,117,40],"Pink Tulip":[118,163,104],"White Tulip":[121,178,103],"Orange Tulip":[120,150,38],"Daisy":[192,205,137],"Bluebell":[48,171,195],"Forget-me-not":[70,115,160],"Allium":[140,123,170],"Azure Bluet":[198,217,192],"Lily of the Valley":[121,176,103],"Wither Rose":[51,51,30],"Furnace":[88,85,85],"Workbench":[131,97,61],"Block of Diamond":[70,211,202],"Maple Door":[164,143,94],"_Maple Door Top":[164,143,94],"Maple Trapdoor":[150,116,71],"Aspen Sapling":[149,176,95],"Maple Sapling":[84,107,43],"Elm Sapling":[48,87,19],"Plum Sapling":[122,131,27],"Pine Sapling":[64,76,47],"Cedar Sapling":[58,105,40],"Maple Log|TreeBase":[128,94,57],"Chest":[109,81,42],"Pine Leaves|TreeCanopy":[33,60,17],"Aspen Leaves|TreeCanopy":[49,92,29],"Maple Leaves|TreeCanopy":[49,92,29],"Elm Leaves|TreeCanopy":[40,135,11],"Protector":[128,135,133],"Fat Cactus":[104,165,46],"Dry Fat Cactus":[140,96,40],"Ladder":[151,115,71],"Vines":[72,106,42],"Dirt|GrassRoots":[133,92,73],"Iron Ladder":[165,172,174],"White Planks":[246,237,222],"Orange Planks":[205,121,63],"Magenta Planks":[152,75,122],"Light Blue Planks":[81,148,165],"Yellow Planks":[213,178,78],"Lime Planks":[149,168,82],"Pink Planks":[192,119,145],"Gray Planks":[78,74,68],"Light Gray Planks":[147,142,133],"Cyan Planks":[100,167,167],"Purple Planks":[144,107,167],"Blue Planks":[82,89,168],"Brown Planks":[126,90,62],"Green Planks":[98,113,56],"Red Planks":[167,69,66],"Black Planks":[35,32,28],"Artisan Bench":[117,91,74],"White Ceramic":[185,216,202],"Orange Ceramic":[157,153,97],"Magenta Ceramic":[215,115,195],"Light Blue Ceramic":[113,168,208],"Yellow Ceramic":[233,192,88],"Lime Ceramic":[161,202,66],"Pink Ceramic":[234,159,184],"Gray Ceramic":[85,92,95],"Light Gray Ceramic":[124,156,159],"Cyan Ceramic":[52,103,111],"Purple Ceramic":[105,47,144],"Blue Ceramic":[35,70,133],"Brown Ceramic":[133,113,92],"Green Ceramic":[115,139,67],"Red Ceramic":[181,59,53],"Black Ceramic":[77,28,30],"Wheat Seeds":[7,156,18],"Wheat_stage1":[6,152,18],"Wheat_stage2":[6,152,18],"Wheat_stage3":[42,148,15],"Wheat_stage4":[73,144,12],"Wheat_stage5":[109,140,9],"Wheat":[209,173,92],"Wheat|FreshlyGrown":[209,173,92],"Tilled Soil":[159,107,71],"Bread Block":[181,125,33],"ReservedBread BlockRotation1":[181,125,33],"ReservedBread BlockRotation2":[181,125,33],"ReservedBread BlockRotation3":[181,125,33],"Mossy Messy Stone":[120,123,108],"Dandelion|Roots":[195,196,60],"Poppy|Roots":[135,93,37],"Red Tulip|Roots":[118,117,40],"Pink Tulip|Roots":[118,163,104],"White Tulip|Roots":[121,178,103],"Orange Tulip|Roots":[120,150,38],"Daisy|Roots":[192,205,137],"Bluebell|Roots":[48,171,195],"Forget-me-not|Roots":[70,115,160],"Allium|Roots":[140,123,170],"Azure Bluet|Roots":[198,217,192],"Lily of the Valley|Roots":[121,176,103],"Wither Rose|Roots":[51,51,30],"White Bed":[164,143,94],"_White Bed Head":[164,143,94],"Orange Bed":[164,143,94],"_Orange Bed Head":[164,143,94],"Magenta Bed":[164,143,94],"_Magenta Bed Head":[164,143,94],"Light Blue Bed":[164,143,94],"_Light Blue Bed Head":[164,143,94],"Yellow Bed":[164,143,94],"_Yellow Bed Head":[164,143,94],"Lime Bed":[164,143,94],"_Lime Bed Head":[164,143,94],"Pink Bed":[164,143,94],"_Pink Bed Head":[164,143,94],"Gray Bed":[164,143,94],"_Gray Bed Head":[164,143,94],"Light Gray Bed":[164,143,94],"_Light Gray Bed Head":[164,143,94],"Cyan Bed":[164,143,94],"_Cyan Bed Head":[164,143,94],"Purple Bed":[164,143,94],"_Purple Bed Head":[164,143,94],"Blue Bed":[164,143,94],"_Blue Bed Head":[164,143,94],"Brown Bed":[164,143,94],"_Brown Bed Head":[164,143,94],"Green Bed":[164,143,94],"_Green Bed Head":[164,143,94],"Red Bed":[164,143,94],"_Red Bed Head":[164,143,94],"Black Bed":[164,143,94],"_Black Bed Head":[164,143,94],"Apple Block":[189,34,37],"Moonstone Ore":[159,156,164],"Moonstone Chest":[139,137,147],"Block of Moonstone":[196,205,238],"Magma":[150,66,32],"Useless Soil":[100,66,24],"Marked Sandstone":[225,213,169],"Red Sandstone":[194,96,31],"Smooth Red Sandstone":[203,110,36],"Engraved Red Sandstone":[195,100,32],"Marked Red Sandstone":[198,104,34],"Green Stone":[107,166,147],"Green Bricks":[83,159,143],"Dark Green Bricks":[53,118,96],"Sandstone Bricks":[223,211,167],"Engraved Diorite":[232,230,225],"Diorite Bricks":[231,229,224],"Engraved Andesite":[112,116,121],"Andesite Bricks":[120,124,129],"Engraved Granite":[145,95,77],"Granite Bricks":[148,98,80],"Ice Bricks":[166,216,247],"Placeholder Packed Ice":[166,216,247],"Placeholder Blue Ice":[166,216,247],"Plum Leaves":[49,92,29],"Cedar Leaves":[33,60,17],"Palm Leaves":[40,135,11],"Plum Leaves|TreeCanopy":[49,92,29],"Cedar Leaves|TreeCanopy":[33,60,17],"Palm Leaves|TreeCanopy":[40,135,11],"Pine Log|TreeBase":[66,43,23],"Plum Log|TreeBase":[92,84,76],"Cedar Log|TreeBase":[57,43,24],"Aspen Log|TreeBase":[187,184,159],"Elm Log|TreeBase":[97,77,23],"Palm Log":[94,88,45],"Palm Log|TreeBase":[94,88,45],"Palm Wood Planks":[209,149,71],"Palm Sapling":[55,127,20],"Pine Door":[164,143,94],"_Pine Door Top":[164,143,94],"Plum Door":[164,143,94],"_Plum Door Top":[164,143,94],"Cedar Door":[164,143,94],"_Cedar Door Top":[164,143,94],"Aspen Door":[164,143,94],"_Aspen Door Top":[164,143,94],"Elm Door":[164,143,94],"_Elm Door Top":[164,143,94],"Palm Door":[164,143,94],"_Palm Door Top":[164,143,94],"Pine Trapdoor":[97,74,49],"Plum Trapdoor":[171,94,48],"Cedar Trapdoor":[62,37,18],"Aspen Trapdoor":[226,215,181],"Elm Trapdoor":[140,99,71],"Palm Trapdoor":[194,138,66],"Red Sand":[197,100,32],"Red Sandstone Bricks":[197,103,33],"Rocky Dirt":[131,95,78],"Autumn Maple Leaves":[191,113,31],"Autumn Maple Leaves|TreeCanopy":[191,113,31],"Fallen Maple Leaves":[191,114,31],"Maple Slab":[170,137,82],"Pine Slab":[115,84,48],"Plum Slab":[167,91,46],"Cedar Slab":[75,48,23],"Aspen Slab":[192,172,122],"Elm Slab":[159,117,82],"Palm Slab":[209,149,71],"Dirt Slab":[133,92,73],"Grass Slab":[104,163,77],"Messy Stone Slab":[131,127,127],"Stone Slab":[150,146,146],"Smooth Stone Slab":[148,145,145],"Engraved Stone Slab":[125,121,121],"Stone Bricks Slab":[134,130,130],"Mossy Stone Slab":[120,122,110],"Mossy Stone Bricks Slab":[125,127,113],"Andesite Slab":[130,134,139],"Smooth Andesite Slab":[119,122,128],"Engraved Andesite Slab":[112,116,121],"Andesite Bricks Slab":[119,123,129],"Diorite Slab":[209,205,200],"Smooth Diorite Slab":[190,185,181],"Engraved Diorite Slab":[232,229,224],"Diorite Bricks Slab":[230,228,223],"Granite Slab":[156,106,88],"Smooth Granite Slab":[145,95,77],"Engraved Granite Slab":[145,95,77],"Granite Bricks Slab":[148,97,79],"Sandstone Slab":[219,204,160],"Smooth Sandstone Slab":[230,222,177],"Engraved Sandstone Slab":[222,209,165],"Marked Sandstone Slab":[225,213,169],"Sandstone Bricks Slab":[223,210,166],"Red Sandstone Slab":[193,95,30],"Smooth Red Sandstone Slab":[203,110,36],"Engraved Red Sandstone Slab":[196,102,33],"Marked Red Sandstone Slab":[198,104,34],"Red Sandstone Bricks Slab":[197,102,33],"Bricks Slab":[149,98,84],"Ice Bricks Slab":[167,216,247],"Cactus|Growing":[93,154,47],"Fat Cactus|Growing":[104,165,46],"Plum Block":[161,26,161],"Coconut Block":[132,98,44],"Pear Log":[100,100,100],"Pear Wood Planks":[132,101,90],"Pear Leaves":[231,241,218],"Pear Door":[164,143,94],"_Pear Door Top":[164,143,94],"Pear Trapdoor":[138,107,96],"Pear Sapling":[195,199,190],"Pear Log|TreeBase":[100,100,100],"Pear Leaves|TreeCanopy":[231,241,218],"Pear Slab":[132,101,90],"Pear Block":[251,235,78],"Compressed Messy Stone":[100,100,100],"Extra Compressed Messy Stone":[93,93,93],"Super Compressed Messy Stone":[70,70,70],"Hyper Compressed Messy Stone":[65,65,65],"Ultra Compressed Messy Stone":[56,56,56],"Mega Compressed Messy Stone":[48,48,48],"Board":[175,143,85],"Net":[170,104,63],"Cobweb":[236,233,218],"Brown Mushroom Block":[193,151,119],"Red Mushroom Block":[227,82,67],"Mushroom Stem":[203,196,185],"Fireball Block":[245,102,27],"Iceball Block":[27,162,244],"Watermelon Seeds":[67,93,3],"Watermelon Seeds|Growing":[67,93,3],"Attached Watermelon Stem":[66,91,3],"Pumpkin Seeds":[67,93,3],"Pumpkin Seeds|Growing":[67,93,3],"Attached Pumpkin Stem":[66,91,3],"Pumpkin":[183,98,15],"Carved Pumpkin":[157,79,11],"Jack o\'Lantern":[198,134,45],"Melon Seeds":[67,93,3],"Melon Seeds|Growing":[67,93,3],"Attached Melon Stem":[66,91,3],"Melon":[243,233,84],"Iron Watermelon":[232,229,223]}')}}]);